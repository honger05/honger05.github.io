{"version":3,"sources":["webpack:///webpack/bootstrap c558d392c20b656963b1?7ab7****","webpack:///C:/Users/Administrator/AppData/Roaming/npm/~/spm/~/spm-webpack/~/handlebars/dist/cjs/handlebars/base.js?cdbb***","webpack:///C:/Users/Administrator/AppData/Roaming/npm/~/spm/~/spm-webpack/~/handlebars/dist/cjs/handlebars/exception.js?4bc9***","webpack:///C:/Users/Administrator/AppData/Roaming/npm/~/spm/~/spm-webpack/~/handlebars/dist/cjs/handlebars/utils.js?161e***","webpack:///C:/Users/Administrator/AppData/Roaming/npm/~/spm/~/spm-webpack/~/handlebars/dist/cjs/handlebars/safe-string.js?b392***","webpack:///./interpreter/panel.css?254d***","webpack:///./interpreter/panel.handlebars?342a****","webpack:///./interpreter/panel.handlebars?4dd3***","webpack:///C:/Users/Administrator/AppData/Roaming/npm/~/spm/~/spm-webpack/~/css-loader/lib/css-base.js?a576***","webpack:///C:/Users/Administrator/AppData/Roaming/npm/~/spm/~/spm-webpack/~/handlebars/dist/cjs/handlebars.runtime.js?b13c***","webpack:///C:/Users/Administrator/AppData/Roaming/npm/~/spm/~/spm-webpack/~/handlebars/dist/cjs/handlebars/runtime.js?62bf***","webpack:///C:/Users/Administrator/AppData/Roaming/npm/~/spm/~/spm-webpack/~/handlebars/runtime.js?6407***","webpack:///./build/jslet-data.debug.js?387a***","webpack:///./build/jslet-ui.debug.js?070f***","webpack:///./build/locale/zh-cn/locale.js?675e***","webpack:///./interpreter/interpreter.js?0bc8***","webpack:///C:/Users/Administrator/AppData/Roaming/npm/~/spm/~/spm-webpack/~/style-loader/addStyles.js?edaa***","webpack:///./interpreter/panel.css?6321****","webpack:///./demo/dataModel/employee.js?9f31*","webpack:///./demo/editPanel/index.js"],"names":[],"mappings":";AAAA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,uBAAe;AACf;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;;;;;;;;;;;;;ACtCA;AACA;AACA;;AAEA;AACA,2BAA0B;AAC1B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA,uDAAsD;AACtD;;AAEA;AACA;;AAEA;AACA;AACA,2BAA0B,gEAAgE;AAC1F;AACA,MAAK;AACL,qBAAoB,kBAAkB;AACtC;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA,IAAG;;AAEH;AACA,mDAAkD;;AAElD,+BAA8B,8BAA8B;;AAE5D;AACA;AACA,MAAK;AACL;AACA,MAAK;AACL;AACA;AACA,QAAO;AACP;AACA;AACA,MAAK;AACL;AACA;AACA,IAAG;;AAEH;AACA;AACA;;AAEA,+BAA8B,8BAA8B;;AAE5D;AACA;AACA;;AAEA;AACA;AACA,oCAAmC,KAAK;AACxC;AACA;AACA;AACA;AACA;AACA,uCAAsC,aAAa;AACnD;AACA,QAAO;AACP;AACA;AACA,uB;AACA,8B;AACA;AACA;AACA;AACA,2CAA0C,WAAW;AACrD;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,IAAG;;AAEH;AACA,mCAAkC,sCAAsC;;AAExE;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA,IAAG;;AAEH;AACA,4DAA2D,6DAA6D;AACxH,IAAG;;AAEH;AACA,+BAA8B,8BAA8B;;AAE5D;AACA,IAAG;;AAEH;AACA;AACA;AACA,IAAG;AACH;;AAEA;AACA,eAAc,+CAA+C;;AAE7D;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2BAA0B,wBAAwB;;AAElD,mBAAkB;AAClB;AACA;AACA;AACA;AACA,mC;;;;;;ACnLA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA,oBAAmB,yBAAyB;AAC5C;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA,gC;;;;;;AC3BA;AACA;AACA;;AAEA;AACA,cAAa;AACb,aAAY;AACZ,aAAY;AACZ,eAAc;AACd,eAAc;AACd,eAAc;AACd;;AAEA;AACA;;AAEA;AACA,+BAA8B;AAC9B;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,yBAAwB;AACxB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;;AAEA;AACA;AACA;AACA;;AAEA,+BAA8B,eAAe;AAC7C;AACA;;AAEA,6CAA4C;AAC5C;AACA;AACA,IAAG;AACH;AACA,IAAG;AACH;AACA;AACA;;AAEA,2B;;;;;;AC3EA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,iC;;;;;;ACVA;AACA,6CAA4C,yBAAyB,KAAK,qBAAqB,yBAAyB,eAAe,kBAAkB,KAAK,mCAAmC,mBAAmB,KAAK,wBAAwB,uBAAuB,KAAK,qBAAqB,6BAA6B,KAAK,sBAAsB,sBAAsB,KAAK,kBAAkB,kBAAkB,4BAA4B,KAAK,Q;;;;;;ACD1b,kBCAA,mBDAA,CCAA,EDAA;AACA;AACA;AACA,mDAAkD;AAClD;;AAEA;;AAEA;AACA;AACA,4IAA2I,OAAO,gEAAgE;AAClN,+BAA8B,kBAAkB;AAChD;AACA,6IAA4I,OAAO,gEAAgE;AACnN,+BAA8B,kBAAkB;AAChD;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,gCAA+B,+BAA+B,OAAO,WAAW,EAAE;AAClF,SAAQ,mCAAmC,gEAAgE,OAAO,WAAW,WAAW;AACxI;AACA;AACA,oEAAmE,OAAO,gEAAgE;AAC1I,+BAA8B,kBAAkB;AAChD;AACA,mEAAkE,OAAO,gEAAgE;AACzI,+BAA8B,kBAAkB;AAChD;AACA,kCAAiC,+BAA+B,OAAO,WAAW,EAAE;AACpF,SAAQ,qCAAqC,gEAAgE,OAAO,WAAW,WAAW;AAC1I,+BAA8B,kBAAkB;AAChD;AACA;AACA,IAAG,E;;;;;;AEnEH;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,iBAAgB,iBAAiB;AACjC;AACA;AACA,yCAAwC,gBAAgB;AACxD,KAAI;AACJ;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,iBAAgB,iBAAiB;AACjC;AACA;AACA;AACA;AACA,aAAY,oBAAoB;AAChC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;ACjDA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA,iC;;;;;;AC/BA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;;AAEA,uCAAsC;;AAEtC;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,0BAAyB,eAAe;;AAExC;AACA,sBAAqB;AACrB,8CAA6C,2BAA2B;AACxE;AACA,MAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAO;AACP;AACA;AACA;AACA,MAAK;AACL;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,6BAA4B;AAC5B;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA,6CAA4C;AAC5C;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA,2BAA0B;AAC1B,kBAAiB;;AAEjB;AACA;AACA,IAAG;AACH;AACA;AACA;;AAEA,uCAAsC,iBAAiB,WAAW;;AAElE,qB;;;;;;ACxIA;AACA;AACA;;;;;;;ACFA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,YAAW,OAAO;AAClB,YAAW,OAAO;AAClB;AACA,aAAY,QAAQ;AACpB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,YAAW,YAAY;AACvB;AACA,aAAY,YAAY;AACxB;AACA;AACA;AACA;;AAEA;AACA;;;;AAIA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;;AAEH;AACA;;AAEA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA,+CAA8C,YAAY;AAC1D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,+CAA8C,YAAY;AAC1D;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;;AAEL;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;AACD;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,aAAY,OAAO;AACnB;AACA,cAAa,OAAO;AACpB;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,oCAAmC,SAAS;AAC5C;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,uBAAsB,kCAAkC;AACxD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+C;AACA,UAAS;AACT,6D;AACA;AACA;AACA,+C;AACA,sD;AACA;AACA,kBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA,yB;AACA,MAAK;AACL;;AAEA;AACA;AACA;AACA,GAAE;AACF;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,6C;AACA,MAAK;AACL,6D;AACA;AACA;AACA,6C;AACA,oD;AACA;AACA,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA,qB;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,sCAAqC;AACrC;AACA;AACA;AACA;AACA;AACA;AACA,wBAAuB,SAAS;AAChC;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,wBAAuB,SAAS;AAChC;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,gDAA+C,EAAE,UAAU;AAC3D,4CAA2C,EAAE,MAAM,EAAE;AACrD;AACA;AACA,YAAW,OAAO,8CAA8C,EAAE;AAClE,YAAW,uBAAuB;AAClC;AACA;AACA;AACA;AACA;AACA,iB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+BAA8B;AAC9B;AACA,oBAAmB,SAAS;AAC5B,uCAAsC,UAAU;AAChD;AACA,MAAK,oBAAoB;AACzB;AACA;AACA,oBAAmB,SAAS;AAC5B;AACA,uCAAsC,aAAa;AACnD;AACA,MAAK;AACL,2BAA0B,EAAE;AAC5B;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,oDAAmD;AACnD,oDAAmD;AACnD,4CAA2C;AAC3C;AACA;AACA;AACA,YAAW,OAAO;AAClB,YAAW,OAAO;AAClB;AACA;AACA;AACA;AACA,aAAY;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAY,oBAAoB;AAChC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,8BAA6B,QAAQ;AACrC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0BAAyB,QAAQ;AACjC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS,QAAQ;AACjB;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,aAAY,gBAAgB;AAC5B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,sDAAqD;AACrD;AACA;AACA,YAAW,KAAK;AAChB,YAAW,OAAO;AAClB,aAAY,OAAO;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,YAAW,OAAO;AAClB,YAAW,OAAO;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,mBAAkB;;AAElB,qCAAoC,SAAS;AAC7C;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,YAAW,OAAO;AAClB,aAAY,K;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,YAAW,OAAO;AAClB,YAAW,OAAO;AAClB,aAAY,OAAO;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAkB,UAAU;AAC5B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA,IAAG;AACH;AACA,aAAY,YAAY;AACxB;AACA;AACA;AACA;AACA,GAAE;AACF;AACA;AACA,MAAK;AACL;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,aAAY,OAAO;AACnB,aAAY,OAAO;AACnB,cAAa,QAAQ;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,YAAW,OAAO;AAClB,YAAW,OAAO;AAClB,YAAW,OAAO;AAClB,aAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,YAAW,OAAO;AAClB,YAAW,OAAO;AAClB,aAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;AACA;AACA,iBAAgB,SAAS;AACzB;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,YAAW,OAAO;AAClB,aAAY,QAAQ;AACpB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,YAAW,OAAO;AAClB,aAAY,QAAQ;AACpB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,YAAW,OAAO;AAClB,aAAY,QAAQ;AACpB;AACA;AACA;AACA;;AAEA;AACA,kG;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,8CAA6C,QAAQ;AACrD;AACA;AACA,YAAW,OAAO;AAClB,aAAY;AACZ;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA,gCAA+B,QAAQ;AACvC;AACA;AACA,YAAW,OAAO;AAClB,aAAY;AACZ;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,sCAAqC;AACrC,sCAAqC;AACrC;AACA;AACA,YAAW,gBAAgB;AAC3B,YAAW,QAAQ;AACnB,aAAY;AACZ;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA,MAAK;AACL;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA,aAAY;AACZ,kBAAiB;AACjB;AACA,I;AACA,oCAAmC,QAAQ;AAC3C;;AAEA,mBAAkB;AAClB;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0BAAyB;AACzB;AACA;AACA;AACA,0CAAyC;AACzC;AACA;AACA,wBAAuB;AACvB;AACA;AACA;AACA;AACA;AACA,iBAAgB;AAChB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kBAAiB;AACjB;AACA;AACA,GAAE;;AAEF;AACA;AACA,8CAA6C;AAC7C;AACA,IAAG;AACH;AACA;AACA,GAAE;;AAEF;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,YAAW,mBAAmB;AAC9B,YAAW,OAAO;AAClB,aAAY;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,WAAU,uBAAuB;AACjC,WAAU,SAAS;AACnB;AACA;AACA;AACA,WAAU,QAAQ;AAClB;AACA;AACA;AACA;AACA;AACA,GAAE;AACF;AACA;AACA;AACA;AACA,GAAE;AACF;AACA;AACA;;AAEA;AACA;AACA;AACA,WAAU,uBAAuB;AACjC,WAAU,SAAS;AACnB;AACA;AACA;AACA,WAAU,QAAQ;AAClB;AACA;AACA;AACA;AACA;AACA,GAAE;AACF;AACA;AACA;AACA;AACA,GAAE;AACF;AACA;AACA;;AAEA;AACA;AACA;AACA,kEAAiE;;AAEjE;AACA;AACA;AACA;AACA;AACA,YAAW;AACX;AACA;AACA;AACA;AACA;AACA;AACA,OAAM;AACN;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAY,OAAO;AACnB,cAAa,OAAO;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uCAAsC;AACtC;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAY,OAAO;AACnB,aAAY,OAAO;AACnB,aAAY,OAAO;AACnB,aAAY,OAAO;AACnB,aAAY,OAAO;AACnB,aAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAkB;AAClB,gBAAe;AACf,kBAAiB;AACjB,kBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAY,OAAO;AACnB,aAAY,OAAO;AACnB,aAAY,OAAO;AACnB;AACA;AACA;AACA;AACA,gBAAe;AACf,kBAAiB;AACjB,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8CAA6C,YAAY;AACzD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,aAAY,OAAO;AACnB,aAAY,OAAO;AACnB;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,sCAAqC,SAAS;AAC9C;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;;AAEA;AACA;AACA;AACA,YAAW,OAAO;AAClB,YAAW,OAAO;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,aAAY,OAAO;AACnB,aAAY,OAAO;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA,EAAC;;AAED;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,uCAAsC,SAAS;AAC/C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,aAAY,oBAAoB;AAChC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,oBAAoB;AAChC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,oBAAoB;AAChC,cAAa;AACb;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,qBAAqB;AACjC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,qBAAqB;AACjC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,qBAAqB;AACjC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,qBAAqB;AACjC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,2CAA2C;AACvD,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,qBAAqB;AACjC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,aAAY,oBAAoB;AAChC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,aAAY,oBAAoB;AAChC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,4BAA2B;AAC3B;AACA,wBAAuB;AACvB;AACA;AACA;AACA,aAAY,2BAA2B;AACvC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;;AAEA,wDAAuD,iBAAiB;AACxE,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAY,oBAAoB;AAChC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,6BAA4B,eAAe;AAC3C;AACA;AACA,kBAAiB;AACjB;AACA,kBAAiB;AACjB;AACA,kBAAiB;AACjB;AACA;AACA;AACA,aAAY,qBAAqB;AACjC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,+BAA8B,IAAI,MAAM,IAAI,SAAS,EAAE,8BAA8B;AACrF;AACA;AACA,aAAY,sBAAsB,mCAAmC;AACrE,cAAa,OAAO,kBAAkB;AACtC;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,oBAAoB;AAChC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,SAAS;AACrB;AACA;AACA;AACA;AACA,yF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gDAA+C,SAAS;AACxD;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,4CAA2C,SAAS;AACpD;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;;AAEA;AACA;AACA,4CAA2C,SAAS;AACpD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,4CAA2C,SAAS;AACpD;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,qCAAoC,SAAS;AAC7C;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAa,SAAS;AACtB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAa,SAAS;AACtB;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA,4CAA2C,SAAS;AACpD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,qCAAoC,SAAS;AAC7C;AACA;AACA;AACA;AACA;AACA;;AAEA,+B;AACA;AACA;AACA;AACA;;AAEA,mC;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,qCAAoC,SAAS;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA,GAAE;;AAEF;AACA;AACA,kDAAiD,SAAS;AAC1D;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;;AAEA,4CAA2C,SAAS;AACpD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,qCAAoC,SAAS;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wCAAuC,gBAAgB;AACvD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wCAAuC,gBAAgB;AACvD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;AAUA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,YAAW,OAAO;AAClB,aAAY,mBAAmB;AAC/B;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA,0FAAyF;;;AAGzF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,MAAK,OAAO;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mB;AACA;AACA,MAAK,QAAQ;AACb;AACA;AACA;AACA,MAAK,OAAO;AACZ;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA,6BAA4B;;AAE5B;AACA;AACA,WAAU;AACV,GAAE;;AAEF;AACA,WAAU;AACV,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA,iBAAgB;AAChB;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA,WAAU;AACV,GAAE;;AAEF;AACA,WAAU;AACV,GAAE;;AAEF;AACA,WAAU;AACV,GAAE;;AAEF;AACA,WAAU;AACV,GAAE;;AAEF;AACA,WAAU;AACV,GAAE;;AAEF;AACA,WAAU;AACV,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA,WAAU;AACV,GAAE;;AAEF;AACA,WAAU;AACV,GAAE;;AAEF;AACA,WAAU,6C;AACV;AACA;;AAEA,mDAAkD;AAClD;AACA,uDAAsD;AACtD,uDAAsD;AACtD;AACA,2CAA0C;;AAE1C,uDAAsD;AACtD,iDAAgD;AAChD;AACA,2CAA0C;AAC1C;AACA;AACA;;AAEA;;AAEA,4CAA2C;AAC3C,6CAA4C;;AAE5C;AACA;AACA;AACA;AACA;;AAEA;;AAEA,eAAc,2BAA2B;;AAEzC,iBAAgB,0CAA0C;;AAE1D;AACA;AACA;AACA;AACA,aAAY,OAAO;AACnB,aAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,aAAY,iBAAiB;AAC7B,aAAY,OAAO;AACnB,cAAa,OAAO;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAM;AACN;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,0BAAyB;AACzB;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8CAA6C;AAC7C;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,iBAAiB;AAC7B,aAAY,OAAO;AACnB,cAAa,OAAO;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,aAAY,iBAAiB;AAC7B,aAAY,OAAO;AACnB,cAAa,OAAO;AACpB;AACA;AACA;AACA;AACA;AACA;;AAEA,mBAAkB;AAClB;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,0CAAyC,SAAS;AAClD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,EAAC;AACD;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA,EAAC;;AAED;AACA;AACA;AACA,gB;AACA,GAAE;;AAEF;AACA;AACA;AACA;;AAEA;AACA;AACA,EAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,EAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA,EAAC;;AAED;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,YAAW,iBAAiB;AAC5B;AACA,aAAY,+BAA+B;AAC3C;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,YAAW,gBAAgB;AAC3B,YAAW,gBAAgB;AAC3B;AACA,aAAY,OAAO;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4E;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,8CAA6C,SAAS;AACtD;AACA;AACA;AACA;AACA;AACA;AACA,gB;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA,IAAG;AACH;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,wCAAuC,SAAS;AAChD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,wCAAuC,SAAS;AAChD;AACA;AACA;AACA;AACA,yC;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oBAAmB;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAgB;AAChB;AACA;AACA;AACA;AACA;AACA;;AAEA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,K;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,wCAAuC,SAAS;AAChD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,wCAAuC,SAAS;AAChD;AACA,yC;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,aAAY,OAAO;AACnB,aAAY,OAAO;AACnB,aAAY,OAAO;AACnB,aAAY,uBAAuB;AACnC;AACA;AACA,yCAAwC,SAAS;AACjD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAkB,yHAAyH;AAC3I;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,oCAAmC,QAAQ;AAC3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,oCAAmC,QAAQ;AAC3C;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,yCAAwC,SAAS;AACjD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,yCAAwC,SAAS;AACjD;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,yCAAwC,SAAS;AACjD;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,sCAAqC,SAAS;AAC9C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,0CAAyC,YAAY;AACrD;AACA,kBAAiB,UAAU;AAC3B;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA,KAAI;AACJ,IAAG;AACH,iBAAgB,YAAY;AAC5B;AACA;AACA;AACA;AACA,GAAE;;AAEF;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,aAAY,SAAS;AACrB,aAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0CAAyC,SAAS;AAClD;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,QAAQ;AACpB,aAAY,QAAQ;AACpB,aAAY,SAAS;AACrB,aAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,8BAA6B,mBAAmB;AAChD,uCAAsC,SAAS;AAC/C;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,QAAQ;AACpB,aAAY,QAAQ;AACpB,aAAY,SAAS;AACrB,aAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8BAA6B,mBAAmB;AAChD,uCAAsC,SAAS;AAC/C;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,SAAS;AACrB;AACA;AACA;AACA;AACA,6C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,QAAQ;AACpB,aAAY,OAAO;AACnB;AACA,cAAa;AACb;AACA;AACA;AACA;AACA;AACA,+CAA8C,SAAS;AACvD;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,OAAO;AACnB;AACA,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6B;AACA,mBAAkB,YAAY;AAC9B;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAO;AACP;AACA;AACA;AACA;AACA;AACA,mC;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oB;AACA,K;AACA,IAAG,U;AACH,oC;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,+CAA8C,SAAS;AACvD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAa;AACb;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA,kBAAiB,mBAAmB;AACpC;AACA,aAAY,sBAAsB;AAClC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,kBAAiB,mBAAmB;AACpC,oBAAmB,OAAO;AAC1B;AACA,aAAY,sBAAsB;AAClC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,kBAAiB,mBAAmB;AACpC,qBAAoB,OAAO;AAC3B,oBAAmB,OAAO;AAC1B;AACA,aAAY,sBAAsB;AAClC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,kBAAiB,mBAAmB;AACpC,qBAAoB,OAAO;AAC3B,sBAAqB,OAAO;AAC5B,sBAAqB,QAAQ;AAC7B;AACA,aAAY,sBAAsB;AAClC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,YAAW,OAAO;AAClB;AACA;;AAEA;AACA,iBAAgB;AAChB,mDAAkD;AAClD,qBAAoB;AACpB;AACA,iBAAgB;AAChB;;AAEA,uBAAsB;AACtB;AACA;;AAEA;AACA;AACA;;AAEA,gBAAe,8CAA8C,UAAU,UAAU;AACjF,6BAA4B;;AAE5B,wB;AACA;AACA;AACA,wBAAuB;AACvB;AACA,+BAA8B;;AAE9B,gCAA+B;;AAE/B;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA,2BAA0B;;AAE1B,yBAAwB;;AAExB,yBAAwB;AACxB,uBAAsB;AACtB;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA,0BAAyB;AACzB,qBAAoB;AACpB,sBAAqB;AACrB;AACA,gB;AACA;AACA;AACA;AACA;;AAEA;;AAEA,2B;;AAEA;;AAEA,4BAA2B;;AAE3B;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA,YAAW,OAAO;AAClB,aAAY;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gFAA+E;AAC/E;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,YAAW,OAAO;AAClB,aAAY;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,YAAW,OAAO;AAClB,YAAW,gBAAgB;AAC3B;AACA,aAAY,mBAAmB;AAC/B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,yCAAwC,SAAS;AACjD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,YAAY;AACxB,aAAY,YAAY;AACxB;AACA;AACA,gCAA+B;AAC/B;AACA;;AAEA,2CAA0C,SAAS;AACnD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0CAAyC,SAAS;AAClD;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,mBAAmB;AAC/B,aAAY,gBAAgB;AAC5B;AACA;AACA;AACA;AACA;AACA;AACA,yCAAwC,SAAS;AACjD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,QAAQ;AACpB,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,sCAAqC,SAAS;AAC9C;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,QAAQ;AACpB,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,QAAQ;AACpB,cAAa;AACb;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,QAAQ;AACpB,cAAa;AACb;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,cAAa;AACb;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,QAAQ;AACpB,cAAa;AACb;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,QAAQ;AACpB,cAAa;AACb;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,aAAY,QAAQ;AACpB,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,OAAO;AACnB,aAAY,OAAO;AACnB,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,wDAAuD,SAAS;AAChE;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAO;AACP;AACA;AACA,aAAY,SAAS;AACrB,cAAa;AACb;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,iBAAgB,OAAO;AACvB,eAAc,OAAO;AACrB,oBAAmB,QAAQ;AAC3B;AACA;AACA;AACA;AACA;AACA,QAAO;AACP;AACA;AACA,aAAY,SAAS;AACrB,cAAa;AACb;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,GAAE;;AAEF;AACA;AACA,cAAa;AACb;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,cAAa;AACb;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;;AAEA,sCAAqC,SAAS;AAC9C;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAY,SAAS;AACrB;AACA;AACA;AACA;AACA;AACA,iBAAgB;AAChB,IAAG;AACH;AACA;AACA;AACA,8CAA6C,SAAS;AACtD;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sCAAqC,SAAS;AAC9C;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAgB;AAChB,IAAG;AACH,GAAE;;AAEF;AACA;AACA;AACA,aAAY,MAAM;AAClB,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,YAAW,iBAAiB;AAC5B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yC;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,yCAAwC,SAAS;AACjD;AACA;AACA;;AAEA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+BAA8B,cAAc;AAC5C;AACA;AACA;AACA,KAAI;AACJ,yBAAwB,eAAe;AACvC;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,OAAO;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,0CAAyC,SAAS;AAClD;AACA;AACA;;AAEA;;AAEA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,OAAO;AACnB;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wBAAuB;AACvB,IAAG;;AAEH;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,8BAA6B;AAC7B;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ,qCAAoC;AACpC;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,OAAO;AACnB;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,OAAO;AACnB,aAAY,OAAO;AACnB;AACA;AACA;;AAEA;AACA;AACA;AACA,0CAAyC,SAAS;AAClD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0CAAyC,SAAS;AAClD;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA,KAAI;AACJ;AACA,KAAI;AACJ;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,OAAO;AACnB,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,8CAA6C,MAAM;AACnD;AACA,yDAAwD,SAAS;AACjE;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,OAAO;AACnB,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,8CAA6C,MAAM;AACnD;AACA,yDAAwD,SAAS;AACjE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,wDAAuD,SAAS;AAChE;AACA;AACA,mDAAkD,SAAS;AAC3D;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,mDAAkD,MAAM;AACxD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8CAA6C,MAAM;AACnD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA,cAAa;AACb;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,cAAa;AACb;AACA,sCAAqC,SAAS;AAC9C;AACA;AACA;AACA;AACA,KAAI;AACJ,eAAc;AACd,KAAI;AACJ,gBAAe;AACf;AACA,iBAAgB,qCAAqC;AACrD,IAAG;AACH;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,yDAAwD,SAAS;AACjE;AACA;AACA,IAAG;AACH,oDAAmD,SAAS;AAC5D;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA,I;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH,8CAA6C,cAAc;AAC3D;AACA;AACA,I;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,mDAAkD,SAAS;AAC3D;AACA,qCAAoC;AACpC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAY,OAAO;AACnB,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAY,OAAO;AACnB,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,aAAY,QAAQ;AACpB,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA,0B;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8CAA6C,SAAS;AACtD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,QAAQ;AACpB,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,aAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,qDAAoD,SAAS;AAC7D;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,cAAa;AACb;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,aAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,OAAO;AACnB,cAAa,QAAQ;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;;AAEA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,cAAa;AACb;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,cAAa;AACb;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,OAAO;AACnB;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;;AAEA;AACA;AACA,IAAG;AACH,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;;AAEA;AACA;AACA,IAAG;AACH,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;;AAEA;AACA;;AAEA;AACA,kDAAiD,QAAQ;AACzD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,aAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,aAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,MAAM;AAClB,aAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,wCAAuC,SAAS;AAChD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAM;AACN;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,mDAAkD,YAAY;AAC9D;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA,KAAI;AACJ;AACA;AACA,oC;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sCAAqC,QAAQ;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sCAAqC,QAAQ;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uCAAsC;AACtC,MAAK;AACL;AACA;AACA;AACA,yBAAwB,kDAAkD;AAC1E;AACA;AACA;AACA;AACA,qC;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,2CAA0C,SAAS;AACnD;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,qB;AACA,6CAA4C,SAAS;AACrD;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;;AAEA;AACA,kB;AACA,6CAA4C,SAAS;AACrD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,4CAA2C,YAAY;AACvD;AACA;;AAEA,mBAAkB,YAAY;AAC9B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2BAA0B;AAC1B,kD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL,KAAI;AACJ,IAAG;AACH;AACA;AACA;AACA,iBAAgB,YAAY;AAC5B;AACA;AACA;AACA;AACA;AACA,yBAAwB;AACxB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH,oC;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,QAAQ;AACpB,cAAa,OAAO;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;;AAEA;AACA;AACA,IAAG;AACH;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH,gCAA+B;AAC/B;AACA,KAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wCAAuC,SAAS;AAChD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI,E;AACJ;AACA;AACA;;AAEA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,IAAG;AACH;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA;AACA;AACA;;AAEA,4D;AACA;AACA;AACA;AACA;AACA,6CAA4C,SAAS;AACrD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mCAAkC,QAAQ;AAC1C;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,gDAA+C,SAAS;AACxD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2CAA0C,SAAS;AACnD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAM;AACN;AACA;;AAEA,IAAG;AACH;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,wCAAuC,SAAS;AAChD;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uD;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gDAA+C,SAAS;AACxD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2CAA0C,SAAS;AACnD;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0B;AACA;AACA;AACA;AACA;AACA,wD;AACA,0B;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA,yB;AACA;;AAEA,yB;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,GAAE;;AAEF;;AAEA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sDAAqD,SAAS;AAC9D;AACA;AACA;AACA;AACA;AACA;AACA,iDAAgD,SAAS;AACzD;AACA;AACA;AACA,MAAK;;AAEL;AACA;AACA;AACA;AACA,aAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mDAAkD,SAAS;AAC3D;AACA;AACA,yB;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,mDAAkD,SAAS;AAC3D;AACA;AACA,yB;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,qBAAoB,OAAO;AAC3B,wBAAuB,QAAQ;AAC/B,cAAa,QAAQ;AACrB;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,OAAO;AACnB,aAAY,OAAO;AACnB,cAAa,OAAO;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,OAAO;AACnB,aAAY,OAAO;AACnB,cAAa,OAAO;AACpB;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,eAAc;AACd;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA,OAAM;AACN;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;;AAEA,IAAG,OAAO;AACV;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;;AAEA,yDAAwD;AACxD;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,OAAO;AACnB,aAAY,qBAAqB;AACjC;AACA,cAAa;AACb;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,OAAO;AACnB,aAAY,OAAO;AACnB,aAAY,qBAAqB;AACjC;AACA,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yDAAwD;AACxD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;;AAEA;AACA,0DAAyD;AACzD;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ,qBAAoB,gBAAgB;AACpC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,I;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sCAAqC,SAAS;AAC9C;AACA;AACA;AACA;AACA,IAAG;AACH;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yCAAwC,SAAS;AACjD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uCAAsC,SAAS;AAC/C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,OAAO;AACnB,aAAY,QAAQ;AACpB,aAAY,QAAQ;AACpB,cAAa,O;AACb;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,OAAO;AACnB,aAAY,OAAO;AACnB,aAAY,QAAQ;AACpB,aAAY,QAAQ;AACpB,cAAa,O;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,OAAO;AACnB,aAAY,OAAO;AACnB,aAAY,QAAQ;AACpB,aAAY,QAAQ;AACpB,cAAa,O;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAc;AACd;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAM;AACN;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,kBAAiB,UAAU;AAC3B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,6BAA4B;AAC5B;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,aAAY,OAAO;AACnB,aAAY,OAAO;AACnB,aAAY,OAAO;AACnB,aAAY,OAAO;AACnB,aAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kBAAiB,SAAS;AAC1B;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;;AAEA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,cAAa,OAAO;AACpB;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,cAAa,OAAO;AACpB;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAY,OAAO;AACnB,aAAY,QAAQ;AACpB,cAAa,Q;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA,yBAAwB;AACxB;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,OAAO;AACnB,aAAY,OAAO;AACnB,aAAY,QAAQ;AACpB,aAAY,QAAQ;AACpB,aAAY,OAAO;AACnB,cAAa,Q;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kBAAiB,SAAS;AAC1B;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAkB,SAAS;AAC3B;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA,yBAAwB;AACxB;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,OAAO;AACnB,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,OAAO;AACnB,aAAY,OAAO;AACnB,aAAY,OAAO;AACnB,cAAa,O;AACb;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,IAAG;AACH;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAY,QAAQ,0DAA0D,MAAM;AACpF,cAAa,SAAS;AACtB;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,OAAO;AACnB,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,OAAO;AACnB,cAAa;AACb;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,OAAO;AACnB,cAAa;AACb;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,OAAO;AACnB,cAAa;AACb;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,OAAO;AACnB,cAAa;AACb;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;;AAEA;AACA,mBAAkB,eAAe;AACjC;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,yBAAyB;AACrC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA,sCAAqC,SAAS;AAC9C;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,cAAa;AACb;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,QAAQ;AACpB,aAAY;AACZ;AACA;AACA;AACA;;AAEA,aAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,0CAAyC,SAAS;AAClD;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,QAAQ;AACpB,aAAY;AACZ,aAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAkB,SAAS;AAC3B;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAY,QAAQ;AACpB,aAAY;AACZ;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA,eAAc,YAAY;AAC1B;AACA;AACA;AACA;AACA,8CAA6C,YAAY;AACzD;AACA;AACA,iBAAgB,YAAY;AAC5B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;;AAEA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,oBAAoB;AAChC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,4FAA2F;AAC3F;AACA,GAAE;;AAEF;AACA;AACA;AACA,cAAa,SAAS;AACtB;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,6CAA4C,YAAY;AACxD;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;AACA,cAAa,SAAS;AACtB;AACA;AACA;AACA;AACA,6CAA4C,SAAS;AACrD;AACA;AACA,gCAA+B;AAC/B;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,qBAAoB;AACpB;AACA;AACA,aAAY,kCAAkC;AAC9C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,oBAAmB;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uBAAsB,oBAAoB;AAC1C,IAAG;AACH;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,sCAAqC,SAAS;AAC9C;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;;AAEA,sCAAqC,SAAS;AAC9C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wCAAuC,SAAS;AAChD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wCAAuC,SAAS;AAChD;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAY,OAAO;AACnB,aAAY,gBAAgB;AAC5B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sBAAqB;AACrB;AACA;AACA;AACA;AACA,mBAAkB;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ,IAAG;AACH;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2BAA0B,QAAQ;AAClC;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAY,OAAO;AACnB,aAAY,QAAQ;AACpB,aAAY,OAAO;AACnB,aAAY,gBAAgB;AAC5B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sBAAqB;AACrB;AACA;AACA;AACA;AACA;;AAEA;AACA,mBAAkB;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ,IAAG;AACH;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAc,SAAS;AACvB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAa,SAAS;AACtB;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,OAAO;AACnB;AACA;AACA;AACA;AACA,6CAA4C,QAAQ;AACpD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAM;AACN;AACA;AACA;AACA,KAAI;AACJ,IAAG;AACH,GAAE;;AAEF;AACA;AACA;AACA,aAAY,OAAO;AACnB;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,OAAO;AACnB,aAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,0BAAyB,WAAW;AACpC;AACA,cAAa,OAAO;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAa,YAAY;AACzB;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,M;;AAEA;AACA;AACA;AACA;AACA;AACA,eAAc,YAAY;AAC1B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAc,YAAY;AAC1B;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAO;AACP;AACA;AACA,OAAM;AACN;AACA;AACA;AACA;AACA,OAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,SAAS;AACrB,aAAY,OAAO;AACnB,aAAY,QAAQ;AACpB,aAAY,QAAQ;AACpB,aAAY,SAAS;AACrB;AACA;AACA;AACA;AACA;;AAEA,qCAAoC,oBAAoB;AACxD;AACA;AACA;AACA,MAAK;;AAEL;AACA;AACA;AACA;AACA,gC;AACA;AACA;AACA,gC;AACA;AACA,Q;AACA,yCAAwC,SAAS;AACjD,uB;AACA,gC;AACA,K;AACA,IAAG,U;AACH,6B;AACA,I;AACA,iB;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI,E;AACJ;AACA;AACA,uD;AACA,wF;AACA;AACA;AACA,mC;AACA;AACA;AACA;AACA;AACA;AACA,2BAA0B,eAAe;AACzC;AACA,qB;AACA,yB;AACA,M;AACA,K;AACA,IAAG,Q;AACH,8B;AACA,I;AACA,iB;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,SAAS;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA,uCAAsC,SAAS;AAC/C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,oBAAmB;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yB;AACA;AACA;AACA,yB;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,0CAAyC,SAAS;AAClD;AACA;AACA,mBAAkB,YAAY;AAC9B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,cAAa,OAAO;AACpB;AACA;AACA;AACA,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAgB;AAChB;AACA;AACA;AACA;AACA,6CAA4C,SAAS;AACrD;AACA;AACA;AACA;AACA;AACA;AACA,gBAAe;AACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,OAAO;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uCAAsC,SAAS;AAC/C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,4D;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,mCAAkC;AAClC,mCAAkC;AAClC;AACA,mCAAkC;AAClC,mCAAkC;AAClC;AACA;AACA,YAAW,OAAO,qB;AAClB,YAAW,iBAAiB,qEAAqE;AACjG,aAAY;AACZ;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,qCAAoC,SAAS;AAC7C;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAE;AACF;AACA,iCAAgC;AAChC;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAM;AACN;AACA;AACA;AACA;AACA,OAAM;AACN,mBAAkB;AAClB;AACA;AACA;AACA,YAAW,OAAO;AAClB,YAAW,mBAAmB;AAC9B,YAAW,OAAO;AAClB,aAAY;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2CAA0C,SAAS;AACnD;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,sB;AACA,iD;AACA,K;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sC;AACA,mB;AACA,6F;AACA,K;AACA,yD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI,uBAAuB,yCAAyC;AACpE,4BAA2B,yCAAyC;AACpE;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0CAAyC,SAAS;AAClD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6BAA4B;AAC5B;AACA;AACA;AACA,kDAAiD,YAAY;AAC7D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;;AAEA;AACA,6CAA4C,SAAS;AACrD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,wCAAuC,SAAS;AAChD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kCAAiC,QAAQ;AACzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA,KAAI;AACJ;AACA,yCAAwC,SAAS;AACjD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,gBAAe;AACf;AACA;AACA;AACA,YAAW,mBAAmB;AAC9B,YAAW,OAAO;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;AACF;AACA;AACA;;AAEA,kBAAiB;AACjB;AACA;;AAEA;AACA,4CAA2C,IAAI;;AAE/C;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,IAAG;AACH;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,cAAa;AACb;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,cAAa,gBAAgB,yBAAyB,yCAAyC;AAC/F;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,OAAO;AACnB,cAAa,OAAO;AACpB;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;;;AAGA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,YAAW,OAAO;AAClB,YAAW,oBAAoB;AAC/B;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,oDAAmD;AACnD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uBAAsB;AACtB;AACA;AACA,mBAAkB;AAClB,qBAAoB;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sBAAqB;AACrB;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,6C;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,oBAAoB;AAChC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,oBAAoB;AAChC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,oBAAoB;AAChC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY;AACZ;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,8BAA8B;AAC1C,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,gCAAgC;AAC5C,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wCAAuC,SAAS;AAChD;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,aAAY,qBAAqB;AACjC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,qBAAqB;AACjC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,aAAY,qBAAqB;AACjC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yBAAwB;AACxB;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,qBAAqB;AACjC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,oBAAoB;AAChC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,oBAAoB;AAChC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,aAAY,qBAAqB;AACjC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,aAAY,oBAAoB;AAChC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,aAAY,oBAAoB;AAChC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,wB;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAY,oBAAoB;AAChC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,qBAAqB;AACjC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,qBAAqB;AACjC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,iCAAiC;AAC7C,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAY;AACZ;AACA,IAAG;AACH;AACA;AACA;AACA,wB;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0CAAyC,SAAS;AAClD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6CAA4C,SAAS;AACrD;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oBAAmB,oBAAoB;AACvC;AACA;AACA;AACA;AACA;AACA;AACA,uBAAsB,EAAE,KAAK,EAAE;AAC/B,KAAI;AACJ;AACA,KAAI;AACJ;AACA;AACA;AACA,yBAAwB,EAAE,KAAK,EAAE,KAAK,EAAE,QAAQ,EAAE,EAAE,IAAI,EAAE,IAAI;AAC9D;AACA,qBAAoB;AACpB;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,aAAY,oBAAoB;AAChC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,6B;AACA;AACA;AACA,2D;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,qBAAqB;AACjC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yBAAwB;AACxB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,qBAAqB;AACjC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,qBAAqB;AACjC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,qBAAqB;AACjC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wB;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,qBAAqB;AACjC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA,wB;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,oBAAoB;AAChC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,4BAA2B;AAC3B;AACA,2BAA0B;AAC1B;AACA;AACA;AACA,aAAY,2BAA2B;AACvC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,8DAA6D,iBAAiB;AAC9E;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,4BAA2B;AAC3B;AACA,wBAAuB;AACvB;AACA;AACA;AACA,aAAY,2BAA2B;AACvC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,aAAY;AACZ;AACA;AACA,aAAY;AACZ;;AAEA,kCAAiC,iBAAiB,EAAE;AACpD;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL,mBAAkB;AAClB;AACA,KAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA,MAAK,MAAM;AACX;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,oCAAoC;AAChD,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA,0F;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,wB;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;;AAEA;AACA;AACA;AACA,aAAY,gCAAgC;AAC5C,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,M;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8FAA6F;AAC7F;AACA;AACA;AACA;AACA;AACA;AACA,2F;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,wB;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,aAAY,qBAAqB;AACjC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,6BAA4B,eAAe;AAC3C;AACA;AACA,kBAAiB;AACjB;AACA,kBAAiB;AACjB;AACA,kBAAiB;AACjB;AACA;AACA;AACA,aAAY,qBAAqB;AACjC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,+BAA8B,IAAI,MAAM,IAAI,SAAS,EAAE,8BAA8B;AACrF;AACA;AACA,aAAY,OAAO;AACnB,aAAY,OAAO;AACnB,cAAa,OAAO,kBAAkB;AACtC;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,IAAG;AACH,sBAAqB;AACrB;AACA;AACA;AACA,GAAE;;;AAGF;AACA;AACA;AACA,aAAY,+BAA+B;AAC3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,SAAS;AACrB;AACA;AACA;AACA;AACA,yF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+CAA8C,SAAS;AACvD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,e;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,e;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,e;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,e;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,qBAAqB;AACjC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,aAAY,oBAAoB;AAChC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,qBAAqB;AACjC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,oBAAoB;AAChC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,aAAY,oBAAoB;AAChC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,oBAAoB;AAChC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4CAA2C,SAAS;AACpD;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA,yCAAwC,+CAA+C;AACvF;AACA;AACA,YAAW,YAAY,wFAAwF;AAC/G,YAAW,iBAAiB;AAC5B,aAAY;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mCAAkC;AAClC;AACA,MAAK;AACL,gBAAe;AACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4CAA2C,SAAS;AACpD;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,YAAW,OAAO;AAClB,YAAW,QAAQ;AACnB,YAAW,iBAAiB;AAC5B,aAAY;AACZ;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,YAAW,OAAO;AAClB,YAAW,QAAQ;AACnB,YAAW,QAAQ;AACnB,YAAW,iBAAiB;AAC5B,aAAY;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,YAAW,OAAO;AAClB,YAAW,iBAAiB;AAC5B,aAAY;AACZ;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,YAAW,OAAO;AAClB,YAAW,iBAAiB;AAC5B,aAAY;AACZ;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,YAAW,OAAO;AAClB,YAAW,mBAAmB;AAC9B,YAAW,iBAAiB;AAC5B,aAAY;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,YAAW,OAAO;AAClB,YAAW,OAAO;AAClB,YAAW,iBAAiB;AAC5B,aAAY;AACZ;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,gCAAgC;AAC5C,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;;AAEL;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gHAA+G;AAC/G;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,aAAY,oBAAoB;AAChC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,aAAY,oBAAoB;AAChC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,aAAY,oBAAoB;AAChC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,aAAY,oBAAoB;AAChC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,aAAY,oBAAoB;AAChC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,iD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,kCAAiC,2DAA2D,E;AAC5F;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,qBAAqB;AACjC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,qD;AACA;AACA;AACA,aAAY,oBAAoB;AAChC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,aAAY,qBAAqB;AACjC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,YAAW,YAAY,wFAAwF;AAC/G,aAAY;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA,oBAAmB;AACnB;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,0BAAyB;AACzB,0B;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,oBAAoB;AAChC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,aAAY,oBAAoB;AAChC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,aAAY,sBAAsB;AAClC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,aAAY,sBAAsB;AAClC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,aAAY,oBAAoB;AAChC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,qBAAqB;AACjC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,aAAY,oBAAoB;AAChC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,oBAAoB;AAChC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,GAAE;AACF;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,2BAA0B;;AAE1B;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0CAAyC,SAAS;AAClD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA,eAAc;AACd,KAAI;AACJ;AACA;AACA;AACA;AACA,eAAc;AACd;AACA;AACA,IAAG;AACH;AACA,6CAA4C;AAC5C;AACA;AACA;AACA,gBAAe;AACf,MAAK;AACL,gBAAe;AACf;AACA;AACA,KAAI;AACJ;AACA;AACA,IAAG;AACH;AACA;AACA;;;;;;;;ACnuXA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,qCAAoC,SAAS;AAC7C;AACA;AACA,sBAAqB,QAAQ;AAC7B;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA;AACA,IAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA,KAAI;;AAEJ;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,eAAc;AACd;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA,EAAC;;AAED;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAY,aAAa;AACzB,aAAY,iBAAiB;AAC7B,uDAAsD,6BAA6B;AACnF;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;;AAEA,GAAE;;AAEF;;AAEA,GAAE;;AAEF;;AAEA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kBAAiB,SAAS;AAC1B;AACA;AACA;AACA;AACA,IAAG;AACH,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,gDAA+C,SAAS;AACxD;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;;AAED;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,GAAE;;AAEF;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,iBAAiB,qFAAqF,6BAA6B;AAC/I;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,aAAY,wBAAwB;AACpC,eAAc,QAAQ;AACtB;AACA,cAAa,QAAQ;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;AACA,qCAAoC;;AAEpC,+BAA8B;;AAE9B,gCAA+B;;AAE/B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;;AAEA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,6D;AACA,IAAG;AACH;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,uE;AACA,IAAG;AACH;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,cAAa,OAAO,uBAAuB,mBAAmB;AAC9D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;;AAEA,EAAC;;AAED;AACA;AACA;AACA;AACA,WAAU,iBAAiB;AAC3B,YAAW;AACX;AACA;AACA;AACA;AACA;AACA,uBAAsB;AACtB,UAAS,SAAS;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,WAAU,OAAO;AACjB,WAAU,YAAY;AACtB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,WAAU,iBAAiB;AAC3B,WAAU,aAAa;AACvB,WAAU,QAAQ;AAClB,WAAU,QAAQ,iC;AAClB,WAAU,QAAQ;AAClB;AACA,YAAW;AACX;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,G;AACA;AACA;AACA,GAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA,0BAAyB;AACzB;AACA;AACA;AACA;AACA,4BAA2B;AAC3B;;AAEA;AACA;;AAEA;AACA;AACA;AACA,YAAW,OAAO;AAClB,aAAY;AACZ;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,WAAU,aAAa;AACvB,WAAU,iBAAiB;AAC3B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,WAAU,aAAa;AACvB;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,WAAU,aAAa;AACvB;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,WAAU,aAAa;AACvB,WAAU,SAAS;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,iBAAgB,SAAS;AACzB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,OAAM,MAAM;AACZ;AACA;AACA;;AAEA;AACA;AACA;AACA,WAAU,aAAa;AACvB;AACA;AACA;AACA;AACA;AACA,GAAE;AACF;AACA;AACA;AACA,sCAAqC,SAAS;AAC9C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,2BAA0B;AAC1B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,aAAY,OAAO;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;;AAGA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,YAAW,OAAO;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAU,QAAQ;AAClB,WAAU,OAAO;AACjB;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,SAAQ,mDAAmD;AAC3D,SAAQ,+CAA+C;AACvD,SAAQ,gDAAgD;AACxD,SAAQ,kDAAkD;AAC1D,SAAQ,mDAAmD;AAC3D,SAAQ,qDAAqD;AAC7D,SAAQ,sDAAsD;AAC9D,SAAQ,gCAAgC;AACxC,SAAQ;AACR,GAAE;;AAEF;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,kBAAkB;AAC9B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uB;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2BAA0B,kBAAkB;AAC5C;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA,qBAAoB,SAAS;AAC7B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,IAAG;AACH;AACA,sCAAqC,QAAQ;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,iBAAgB,QAAQ;AACxB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,YAAW;AACX;AACA;AACA;AACA;AACA;AACA,kDAAiD,SAAS;AAC1D;AACA;AACA;AACA;AACA;AACA;AACA,aAAY;AACZ;AACA;AACA,WAAU;AACV,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA,wCAAuC,SAAS;AAChD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0BAAyB,+BAA+B;AACxD;AACA,yBAAwB,wBAAwB;AAChD,KAAI;AACJ;AACA,yBAAwB,wBAAwB;AAChD;AACA;AACA;AACA;AACA;AACA;AACA,uDAAsD,eAAe;AACrE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAgB,SAAS;AACzB;AACA;AACA;AACA;AACA,iBAAgB,QAAQ;AACxB;AACA;AACA;AACA;;AAEA,IAAG;AACH,iBAAgB,QAAQ;AACxB;AACA;AACA;AACA;AACA,iBAAgB,SAAS;AACzB;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sBAAqB,UAAU;AAC/B;AACA;AACA,GAAE;;AAEF;AACA;AACA,kBAAiB,QAAQ;AACzB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kBAAiB,SAAS;AAC1B;AACA;AACA;AACA;AACA;AACA;;AAEA,oBAAmB,YAAY;AAC/B;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA,GAAE;;AAEF;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,mDAAkD,SAAS;AAC3D;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;;AAEA,uBAAsB;AACtB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,8CAA6C,SAAS;AACtD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kBAAiB,uBAAuB;AACxC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAY,kBAAkB;AAC9B,aAAY,QAAQ;AACpB,aAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA;AACA;AACA,I;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,kBAAkB;AAC9B,cAAa,O;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,kBAAkB;AAC9B,cAAa;AACb;AACA;AACA,iBAAgB;;AAEhB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,kBAAkB;AAC9B,aAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,I;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8CAA6C,YAAY;AACzD;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,aAAY,aAAa;AACzB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA;AACA;AACA,sCAAqC,SAAS;AAC9C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;;AAEA;AACA;AACA;AACA,aAAY,OAAO;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,aAAY,OAAO;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA,EAAC;;AAED;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAgB;AAChB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,aAAY,QAAQ;AACpB,aAAY,QAAQ;AACpB,aAAY,QAAQ;AACpB,aAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,aAAY,aAAa;AACzB,aAAY,OAAO;AACnB,aAAY,OAAO;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,WAAU,aAAa;AACvB;AACA,YAAW,QAAQ;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;AACF;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,oCAAmC;AACnC,uCAAsC;AACtC;AACA;AACA,WAAU,aAAa;AACvB,WAAU,QAAQ;AAClB;AACA,YAAW,aAAa;AACxB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAgB,WAAW;AAC3B;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAoB,6BAA6B;AACjD,qBAAoB;AACpB;AACA;AACA;AACA,WAAU,aAAa;AACvB,WAAU,SAAS,+CAA+C,IAAI;AACtE;AACA,WAAU,SAAS,mDAAmD,IAAI;AAC1E;AACA;AACA,YAAW,aAAa;AACxB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;AACF;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,YAAW,aAAa;AACxB,aAAY,aAAa;AACzB;AACA;AACA;AACA,iC;AACA,GAAE;AACF;;AAEA;AACA;AACA;AACA,YAAW,aAAa;AACxB,YAAW,aAAa;AACxB,aAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,aAAY,aAAa;AACzB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,aAAY,OAAO;AACnB;AACA,cAAa,QAAQ;AACrB;AACA;AACA;AACA;AACA;AACA,WAAU;AACV;;AAEA;AACA;AACA;AACA,aAAY,OAAO;AACnB;AACA,cAAa,QAAQ;AACrB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,aAAY,OAAO;AACnB;AACA,cAAa,QAAQ;AACrB;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,0DAAyD;AACzD;AACA;AACA,YAAW,OAAO;AAClB,YAAW,OAAO;AAClB;AACA,aAAY,OAAO;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;AACF;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,aAAY,QAAQ;AACpB;AACA;AACA;;AAEA;AACA,2CAA0C,YAAY;AACtD;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,wBAAuB,OAAO;AAC9B;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,6BAA4B,SAAS;AACrC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA,+B;AACA;;AAEA;AACA,+B;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;;AAEA;;;AAGA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,sBAAqB,yCAAyC,mBAAmB,EAAE,mBAAmB;AACtG;AACA,QAAO,gDAAgD,eAAe;AACtE,YAAW,gBAAgB;AAC3B,YAAW,gBAAgB;AAC3B,WAAU;AACV;AACA;AACA,WAAU;AACV,aAAY,gBAAgB;AAC5B,aAAY,gBAAgB;AAC5B,WAAU;AACV;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA,uCAAsC,gBAAgB,EAAE,gBAAgB;AACxE;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,qBAAqB;AACjC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,aAAY,sBAAsB;AAClC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,OAAM,gBAAgB;AACtB;AACA,aAAY,0BAA0B;AACtC,cAAa,qB;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qCAAoC,SAAS;AAC7C;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA,IAAG;;AAEH;AACA;;AAEA;AACA;;AAEA,iFAAgF;AAChF;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;AACD;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,uBAAsB;AACtB;AACA,WAAU;AACV;AACA;AACA,WAAU;AACV;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,kBAAkB;AAC9B,aAAY;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,kBAAkB;AAC9B,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,kBAAkB;AAC9B,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,aAAY,sBAAsB;AAClC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yBAAwB,MAAM,IAAI,yBAAyB,oFAAoF;AAC/I,8BAA6B,gDAAgD,oFAAoF;AACjK,8BAA6B,mFAAmF,IAAI;AACpH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4DAA2D,oCAAoC,oCAAoC,oCAAoC,oCAAoC,oCAAoC,2DAA2D;AAC1S,4DAA2D,oCAAoC,oCAAoC,oCAAoC,oCAAoC,oCAAoC,2DAA2D;AAC1S,4DAA2D,oCAAoC,oCAAoC,oCAAoC,oCAAoC,oCAAoC,2DAA2D;AAC1S,4DAA2D,oCAAoC,2DAA2D,oCAAoC,oCAAoC,oCAAoC,2DAA2D;AACjU,4DAA2D,oCAAoC,2DAA2D,oCAAoC,oCAAoC,oCAAoC,2DAA2D;AACjU,4DAA2D,oCAAoC,oCAAoC,oCAAoC,oCAAoC,oCAAoC,2DAA2D;AAC1S,mGAAkG;;AAElG;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA,IAAG;;AAEH;AACA;AACA,IAAG;;AAEH;AACA;AACA,IAAG;;AAEH;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA,K;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA,IAAG;AACH,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,KAAK;AACjB;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;;AAEA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,kBAAiB,aAAa;AAC9B;AACA,6CAA4C,YAAY;AACxD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA,KAAI;AACJ,IAAG;AACH;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,4DAA2D,mBAAmB,EAAE;AAChF;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kBAAiB,YAAY;AAC7B;AACA,6CAA4C,WAAW;AACvD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAM;AACN;AACA,MAAK;AACL;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;AACD;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,aAAY;AACZ;AACA;AACA,aAAY;AACZ;AACA,2BAA0B;AAC1B;AACA;AACA;AACA;AACA,2BAA0B;AAC1B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,qB;;AAEA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,oBAAoB;AAChC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,qBAAqB;AACjC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,aAAY,SAAS;AACrB;AACA;;AAEA;AACA;AACA;AACA,aAAY,SAAS;AACrB;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;;AAED;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,YAAW,OAAO;AAClB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,YAAW,OAAO;AAClB;AACA;AACA,2CAA0C,SAAS;AACnD;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,qCAAoC,SAAS;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,uBAAsB;AACtB,MAAK;AACL,aAAY,iDAAiD;AAC7D,UAAS;AACT;AACA;AACA,WAAU;AACV;AACA;AACA,WAAU;AACV;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,aAAY,sBAAsB;AAClC,aAAY;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,YAAW,OAAO;AAClB,cAAa,OAAO;AACpB,iBAAgB,MAAM;AACtB;AACA;AACA,kBAAiB,QAAQ;AACzB,oBAAmB,OAAO;AAC1B,2BAA0B,OAAO;AACjC,kBAAiB,OAAO;AACxB,iBAAgB,QAAQ;AACxB,eAAc,OAAO;AACrB,eAAc,MAAM;AACpB;AACA,aAAY,0BAA0B;AACtC,aAAY;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qCAAoC,SAAS;AAC7C;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH,GAAE;;AAEF;AACA;AACA;AACA;AACA;;AAEA,+CAA8C,SAAS;AACvD;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6CAA4C,oDAAoD;AAChG;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA;;AAEA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA,EAAC;AACD;AACA;;AAEA;AACA;AACA;AACA,uBAAsB;AACtB,SAAQ,mDAAmD;AAC3D,SAAQ,4CAA4C;AACpD,SAAQ,YAAY;AACpB;AACA;AACA,YAAW;AACX;AACA;AACA,YAAW;AACX;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iDAAgD;AAChD;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,aAAY,sBAAsB;AAClC,aAAY;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,YAAW,OAAO;AAClB,cAAa,OAAO;AACpB,iBAAgB,MAAM;AACtB;AACA;AACA,kBAAiB,QAAQ;AACzB,oBAAmB,OAAO;AAC1B,2BAA0B,OAAO;AACjC,kBAAiB,OAAO;AACxB,iBAAgB,QAAQ;AACxB,eAAc,OAAO;AACrB,eAAc,MAAM;AACpB;AACA,aAAY,0BAA0B;AACtC,aAAY;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qCAAoC,SAAS;AAC7C;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ,IAAG;AACH,GAAE;;AAEF;AACA;AACA;AACA,aAAY,QAAQ;AACpB,aAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,sDAAqD;AACrD;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,cAAa,SAAS;AACtB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;;AAEA;AACA;AACA;AACA,cAAa,SAAS;AACtB;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6CAA4C,iEAAiE;AAC7G;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA,EAAC;;AAED;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;AACF;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,wDAAuD,SAAS;AAChE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAU,aAAa;AACvB,WAAU,OAAO;AACjB;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;AACF;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,aAAY,QAAQ;AACpB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,sBAAqB;AACrB;AACA,YAAW,gDAAgD,eAAe;AAC1E,YAAW,gBAAgB;AAC3B,YAAW,gBAAgB;AAC3B,YAAW;AACX;AACA;AACA,YAAW;AACX,cAAa,gBAAgB;AAC7B,cAAa,gBAAgB;AAC7B,YAAW;AACX;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,8DAA6D,GAAG;;AAEhE;;AAEA;;AAEA;;AAEA;;AAEA,mBAAkB;AAClB;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,qBAAqB;AACjC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,aAAY,oBAAoB;AAChC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,2B;AACA;AACA;AACA,aAAY,sBAAsB;AAClC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,oC;AACA;AACA;AACA;AACA,aAAY,sBAAsB;AAClC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA,MAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,IAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,KAAI;AACJ;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,qCAAoC;AACpC;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;;AAEH;AACA,yCAAwC,SAAS;AACjD;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,cAAa,a;AACb;AACA;AACA,kC;AACA,GAAE;;AAEF;;AAEA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,QAAQ;AACpB,aAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA,IAAG;AACH;AACA;AACA,KAAI;AACJ;AACA;AACA;;AAEA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0CAAyC;AACzC;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yCAAwC,SAAS;AACjD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;;AAED;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,sBAAqB;AACrB;AACA;AACA;AACA,OAAM,oFAAoF;AAC1F,OAAM,2CAA2C;AACjD,OAAM,wCAAwC;AAC9C;AACA;AACA,SAAQ,gDAAgD,eAAe;AACvE;AACA;AACA,SAAQ;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,qBAAqB;AACjC,aAAY;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,qBAAqB;AACjC,cAAa,gB;AACb;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,qBAAqB;AACjC,cAAa,gB;AACb;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,aAAY,sBAAsB;AAClC,cAAa,iB;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAY,sBAAsB;AAClC,cAAa,iB;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAY,sBAAsB;AAClC,cAAa,iB;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,aAAY,sBAAsB;AAClC,cAAa,iB;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,gCAAgC;AAC5C,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qCAAoC,SAAS;AAC7C;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2CAA0C;AAC1C;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA,IAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA,mBAAkB,SAAS;AAC3B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,QAAQ;AACpB;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,kBAAiB,UAAU;AAC3B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;;AAEH;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+BAA8B,QAAQ;AACtC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA,qDAAoD,SAAS;AAC7D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAgB,kBAAkB;AAClC;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,kCAAiC;AACjC,iDAAgD;;AAEhD;AACA;AACA;AACA,sCAAqC;AACrC;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,kBAAiB,kBAAkB;AACnC;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,kBAAiB,kBAAkB;AACnC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,2BAA0B,oBAAoB;AAC9C;AACA;AACA;AACA,GAAE;;;AAGF;AACA;AACA;AACA,aAAY,OAAO;AACnB,aAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,0BAAyB,QAAQ;AACjC;AACA;AACA;AACA;AACA,IAAG;AACH,iDAAgD,SAAS;AACzD;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,oCAAmC,QAAQ;AAC3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,kBAAiB;AACjB,KAAI,kDAAkD;AACtD,KAAI,4DAA4D;AAChE;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;;AAEA;AACA;AACA,EAAC;;AAED;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,cAAa,IAAI,OAAO;AACxB,eAAc,IAAI,QAAQ;AAC1B,kBAAiB,IAAI,OAAO;AAC5B,qBAAoB,IAAI,QAAQ;AAChC,qBAAoB,IAAI,Q;AACxB,sBAAqB,IAAI;AACzB;AACA,eAAc,IAAI,O;AAClB,iBAAgB,IAAI,O;AACpB,mBAAkB,IAAI,O;AACtB;;;;AAIA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAY,OAAO;AACnB,aAAY,iBAAiB;AAC7B,aAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;AACA,kBAAiB;AACjB;AACA;;AAEA,yBAAwB;AACxB;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,YAAW,aAAa;AACxB,YAAW,OAAO;AAClB,YAAW,QAAQ;AACnB;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,aAAY,OAAO;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,IAAG;;AAEH;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qCAAoC,iKAAiK;AACrM;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;;AAEA,mB;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,oBAAoB;AAChC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,oBAAoB;AAChC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,qBAAqB;AACjC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,qBAAqB;AACjC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,qBAAqB;AACjC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,qBAAqB;AACjC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,qBAAqB;AACjC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,qBAAqB;AACjC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,qBAAqB;AACjC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,qBAAqB;AACjC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,qBAAqB;AACjC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,qBAAqB;AACjC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,qBAAqB;AACjC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,qBAAqB;AACjC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,oBAAoB;AAChC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAY,sBAAsB;AAClC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAY,sBAAsB;AAClC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,aAAY,sBAAsB;AAClC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;;AAGF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAY,sBAAsB;AAClC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,yFAAwF;AACxF,0FAAyF;AACzF,0FAAyF;AACzF;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ,IAAG;AACH;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,QAAQ;AACpB,aAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,QAAQ;AACpB,aAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,+BAA8B;AAC9B,iCAAgC;AAChC;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,QAAQ;AACpB,aAAY,QAAQ;AACpB,aAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,QAAQ;AACpB,aAAY,QAAQ;AACpB,aAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,cAAa;AACb;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,OAAO;AACnB;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,cAAa;AACb;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,OAAO;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6CAA4C,SAAS;AACrD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,QAAQ;AACpB;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA,IAAG;AACH;AACA;AACA;AACA,IAAG;AACH;AACA,IAAG;AACH;AACA;AACA,IAAG;AACH;AACA,IAAG;AACH;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA,IAAG;AACH;AACA,IAAG;AACH;AACA,IAAG;AACH;AACA,IAAG;AACH;AACA,IAAG;AACH;AACA,IAAG;AACH;AACA;;AAEA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,EAAC;AACD;AACA;;;AAGA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,aAAY,OAAO;AACnB,aAAY,OAAO;AACnB,aAAY,OAAO;AACnB,aAAY,SAAS;AACrB,aAAY,SAAS;AACrB;AACA,eAAc,OAAO,SAAS,OAAO;AACrC;AACA;AACA,aAAY,QAAQ;AACpB,aAAY,OAAO;AACnB,aAAY,SAAS;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAgB,YAAY;AAC5B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,0BAAyB,OAAO;AAChC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH,eAAc,cAAc;AAC5B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA;AACA;AACA,8DAA6D,wBAAwB,gBAAgB;AACrG;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA,cAAa,cAAc;AAC3B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,qEAAoE;AACpE,2EAA0E;AAC1E;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2E;AACA,GAAE;AACF;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;AACF;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,cAAa;AACb;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA,KAAI;AACJ;AACA,KAAI;AACJ;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;;;AAIA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,uBAAsB;AACtB;AACA;AACA,SAAQ;AACR;AACA,SAAQ;AACR;AACA;AACA,SAAQ;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,OAAM,OAAO;AACb;AACA;AACA;AACA,OAAM,OAAO;AACb;AACA;AACA;AACA,OAAM,OAAO;AACb;AACA;AACA;AACA,OAAM,OAAO;AACb;AACA;;AAEA;AACA,OAAM,OAAO;AACb;AACA;;AAEA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,8CAA6C,SAAS;AACtD;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,YAAW;AACX;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,gDAA+C,YAAY;AAC3D;AACA;AACA,mBAAkB,iBAAiB;AACnC;AACA;AACA;AACA;AACA;AACA,OAAM;AACN;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ,IAAG;AACH;AACA;AACA,WAAU;AACV,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,gDAA+C,YAAY;AAC3D;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;;AAEA;AACA,I;AACA;AACA;AACA;AACA;AACA,uBAAsB,aAAa;AACnC,mBAAkB,+B;AAClB,KAAI;;AAEJ,YAAW;AACX;AACA,KAAI;;AAEJ;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH,GAAE;;AAEF;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,mBAAkB,+B;AAClB,KAAI;AACJ,YAAW;AACX,IAAG;AACH,GAAE;;AAEF;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAkB,+B;AAClB,cAAa;;AAEb,YAAW;AACX;AACA,KAAI;;AAEJ;AACA;AACA;AACA;AACA;AACA,cAAa;AACb,2BAA0B;AAC1B,UAAS,E;AACT,GAAE;;AAEF;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;AACF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;;AAED;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,OAAM,QAAQ;AACd;AACA;AACA;AACA,OAAM,QAAQ;AACd;AACA;;AAEA;AACA,OAAM,QAAQ;AACd;AACA;AACA;AACA,sDAAqD,wCAAwC;AAC7F;AACA;;AAEA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,sCAAqC,SAAS;AAC9C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,0CAAyC,UAAU;AACnD;AACA;AACA;AACA;AACA,oBAAmB,eAAe;AAClC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,OAAM;AACN;AACA,KAAI;AACJ,IAAG;AACH;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,2CAA0C,SAAS;AACnD;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ,6C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,0CAAyC,SAAS;AAClD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,wCAAuC,SAAS;AAChD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;;AAEL;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;;AAED;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,uBAAsB;AACtB;AACA;AACA,SAAQ;AACR;AACA,SAAQ;AACR;AACA;AACA,SAAQ;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,OAAM,QAAQ;AACd;AACA;AACA;AACA,OAAM,QAAQ;AACd;AACA;;AAEA;;AAEA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,sCAAqC,SAAS;AAC9C;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,iEAAgE,UAAU,mBAAmB,WAAW;AACxG;AACA;AACA;AACA,cAAa,UAAU;AACvB;AACA;AACA;AACA;AACA,2CAA0C,SAAS;AACnD;AACA;AACA;AACA;AACA;AACA,O;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAa,eAAe;AAC5B;AACA;AACA;AACA;AACA,cAAa,UAAU;AACvB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,cAAa,eAAe;AAC5B;AACA;;AAEA;;AAEA;AACA;AACA;AACA,cAAa,eAAe;AAC5B;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,cAAa,UAAU;AACvB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,oCAAmC;AACnC;AACA;AACA,IAAG;AACH,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;;AAED;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA,uBAAsB;AACtB,wBAAuB;AACvB;;AAEA;AACA;AACA;AACA;AACA;AACA,iBAAgB;AAChB,kBAAiB;AACjB,iBAAgB;AAChB,iBAAgB;AAChB,wBAAuB;AACvB,iBAAgB;AAChB,mBAAkB;AAClB,4BAA2B;AAC3B,sBAAqB;AACrB,sBAAqB;AACrB,mBAAkB;AAClB,sBAAqB;AACrB;;AAEA;AACA;AACA;AACA;AACA;AACA,uBAAsB;AACtB,oBAAmB;AACnB,eAAc;AACd;;AAEA;AACA;AACA;AACA;AACA;AACA,iBAAgB;AAChB,iBAAgB;AAChB,cAAa;AACb,gBAAe;AACf,gBAAe;AACf,4BAA2B;AAC3B,oBAAmB;AACnB;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA,0B;;AAEA;;AAEA;;AAEA;;AAEA,wB;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA,qBAAoB;;AAEpB,wBAAuB;AACvB;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,qBAAqB;AACjC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,qBAAqB;AACjC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,qBAAqB;AACjC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,qBAAqB;AACjC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,qBAAqB;AACjC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,qBAAqB;AACjC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,oBAAoB;AAChC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,qBAAqB;AACjC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,qBAAqB;AACjC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,qBAAqB;AACjC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,qBAAqB;AACjC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,qBAAqB;AACjC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,qBAAqB;AACjC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,qBAAqB;AACjC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,qBAAqB;AACjC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAY,oBAAoB;AAChC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAY,oBAAoB;AAChC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,iDAAgD,EAAE;AAClD,gDAA+C,EAAE;AACjD,wDAAuD;AACvD,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,aAAY,sBAAsB;AAClC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,aAAY,sBAAsB;AAClC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,aAAY,sBAAsB;AAClC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAY,sBAAsB;AAClC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAY,sBAAsB;AAClC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,aAAY,sBAAsB;AAClC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,8BAA6B;AAC7B;AACA;AACA;AACA,aAAY,sBAAsB;AAClC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,yCAAwC;AACxC;AACA;AACA;AACA;AACA,aAAY,sBAAsB;AAClC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,qBAAqB;AACjC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,qBAAqB;AACjC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;;AAGF;AACA;AACA;AACA,aAAY,oCAAoC;AAChD,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uCAAsC,SAAS;AAC/C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,OAAO;AACnB;AACA;AACA;AACA;AACA;AACA,iBAAgB,iBAAiB;AACjC;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,OAAO;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,8DAA6D;AAC7D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;AAKA;AACA;AACA,UAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gCAA+B;AAC/B;AACA,YAAW;AACX;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;;AAET;AACA;;AAEA,wCAAuC;AACvC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wCAAuC;AACvC;AACA;AACA;AACA,mCAAkC,cAAc;AAChD;AACA;AACA;AACA,wCAAuC;AACvC;AACA,gDAA+C,SAAS;AACxD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wBAAuB;AACvB;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI,2BAA2B;AAC/B;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI,0BAA0B;AAC9B;AACA;AACA;AACA;AACA;AACA,KAAI,0BAA0B;AAC9B;AACA;AACA;AACA;AACA;AACA,KAAI,0BAA0B;AAC9B;AACA;AACA;AACA,KAAI,0BAA0B;AAC9B;AACA;AACA;AACA;AACA,IAAG,E;AACH,GAAE;;AAEF;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iDAAgD,SAAS;AACzD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,6CAA4C;AAC5C;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,kCAAiC,oBAAoB;AACrD;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,YAAW,aAAa;AACxB;AACA;AACA;AACA;AACA,YAAW;AACX;AACA;AACA;;AAEA;AACA,YAAW,aAAa;AACxB;AACA;AACA;AACA;AACA;AACA;AACA,8CAA6C,YAAY;AACzD;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,gDAA+C,YAAY;AAC3D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,2CAA0C,YAAY;AACtD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL,KAAI;AACJ;AACA,+CAA8C,YAAY;AAC1D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sBAAqB,uBAAuB;AAC5C;AACA;AACA;AACA;AACA,SAAQ;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL,KAAI;AACJ;;AAEA;AACA;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA,yCAAwC;;AAExC,6CAA4C,YAAY;AACxD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,4CAA2C,SAAS;AACpD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,qCAAoC,SAAS;AAC7C;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4CAA2C,QAAQ;AACnD;AACA;AACA,IAAG;AACH;AACA;AACA;AACA,kBAAiB,SAAS;AAC1B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0DAAyD;AACzD,qCAAoC;AACpC;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,sBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8CAA6C,SAAS;AACtD;AACA;AACA,kBAAiB,kBAAkB;AACnC;AACA;AACA;AACA,IAAG;AACH;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,4D;AACA,IAAG;AACH,+D;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wCAAuC,SAAS;AAChD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6CAA4C,SAAS;AACrD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,8CAA6C,SAAS;AACtD;AACA,iDAAgD,6BAA6B;AAC7E;AACA,+CAA8C,QAAQ;AACtD;AACA,iDAAgD,6BAA6B;AAC7E;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,2CAA0C;AAC1C;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oBAAmB;AACnB,gDAA+C;AAC/C;AACA,IAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4B;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4B;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,kC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;;AAEH;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wDAAuD;AACvD;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA,0B;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,IAAG;AACH;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA,sCAAqC,SAAS;AAC9C;AACA;AACA;AACA,MAAK;AACL;AACA,MAAK;AACL;AACA;AACA;AACA;;AAEA;AACA;;AAEA,8B;AACA;AACA,0CAAyC,SAAS;AAClD;AACA;AACA,KAAI;AACJ;AACA,iCAAgC,QAAQ;AACxC;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4CAA2C,SAAS;AACpD;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,4CAA2C,SAAS;AACpD;AACA,qB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,qCAAoC,SAAS;AAC7C;AACA;AACA;AACA,KAAI;AACJ;AACA,KAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yBAAwB,aAAa;AACrC;AACA;AACA;AACA,0BAAyB,cAAc;AACvC;AACA;AACA;AACA,IAAG;AACH;AACA,yBAAwB,aAAa;AACrC;AACA;AACA;AACA,2BAA0B,cAAc;AACxC;AACA;AACA;AACA,I;AACA,GAAE;;AAEF;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,GAAE;;AAEF;AACA;AACA;;AAEA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH,kCAAiC;AACjC;AACA;AACA;AACA;AACA,K;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;;AAEA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH,kCAAiC;AACjC;AACA;AACA;AACA;AACA;AACA,K;AACA;AACA;AACA;AACA;AACA,4CAA2C;AAC3C;AACA;AACA;AACA,cAAa;AACb;AACA,cAAa;AACb;AACA,wB;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAgB,mBAAmB;AACnC;AACA;AACA;AACA;AACA,6CAA4C,SAAS;AACrD;AACA;AACA;AACA;AACA;AACA;AACA,4CAA2C,UAAU;AACrD;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAgB,oBAAoB;AACpC;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,0DAAyD,SAAS;AAClE;AACA;AACA,IAAG;AACH,8CAA6C,SAAS;AACtD;AACA;AACA,sCAAqC,SAAS;AAC9C;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;;AAEA,sC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;;AAEH;AACA,mC;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,+CAA8C,SAAS;AACvD;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA,IAAG;AACH;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA,8CAA6C,SAAS;AACtD;AACA;AACA;AACA;AACA;;AAEA,+CAA8C,SAAS;AACvD;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,kBAAiB,aAAa;AAC9B;AACA;AACA;AACA,gCAA+B;AAC/B;AACA;AACA;AACA;AACA,kBAAiB,SAAS;AAC1B;AACA,mBAAkB,aAAa;AAC/B;AACA;AACA;AACA;AACA;AACA;AACA,uBAAsB;AACtB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA,wBAAuB;AACvB,IAAG;AACH;AACA;AACA,KAAI;AACJ;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yBAAwB,YAAY;AACpC;AACA;AACA;;AAEA;AACA;AACA;AACA,mBAAkB,eAAe;AACjC;AACA;AACA;;AAEA;AACA,oBAAmB,kBAAkB;AACrC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8BAA6B,YAAY;AACzC;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,8CAA6C,SAAS;AACtD;AACA;AACA;;AAEA,mBAAkB,kBAAkB;AACpC;AACA;AACA;AACA;AACA;AACA;AACA,0DAAyD,SAAS;AAClE;AACA;AACA;;AAEA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+CAA8C,SAAS;AACvD;;AAEA;AACA;AACA,KAAI;AACJ;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,wBAAuB;AACvB,OAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,uBAAsB;AACtB;AACA;;AAEA,kBAAiB,gBAAgB;AACjC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oBAAmB,UAAU;AAC7B;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAkB,UAAU;AAC5B;AACA;AACA,KAAI;AACJ;AACA,IAAG;AACH,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,gCAA+B;AAC/B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,IAAG;AACH;AACA,IAAG;AACH;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wCAAuC,UAAU;AACjD;AACA;AACA;AACA;AACA;AACA;AACA,OAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uCAAsC,UAAU;AAChD;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,qCAAoC,SAAS;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF,4CAA2C;AAC3C;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;;AAEA,mBAAkB;AAClB;AACA;AACA;AACA;AACA,YAAW;AACX;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,YAAW;AACX;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,qCAAoC;AACpC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,0DAAyD,mBAAmB;AAC5E,wDAAuD;AACvD;AACA;AACA,2C;AACA;AACA,IAAG;AACH;AACA;AACA;AACA,0CAAyC,mBAAmB;AAC5D,qDAAoD;AACpD;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,qCAAoC;AACpC;AACA;AACA,yDAAwD,mBAAmB;AAC3E,uDAAsD;AACtD;AACA;AACA,iB;AACA;AACA;AACA;AACA;AACA,yCAAwC,mBAAmB;AAC3D,oDAAmD;AACnD;AACA;AACA;AACA;AACA,iB;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sCAAqC,SAAS;AAC9C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,kB;AACA,IAAG;AACH,GAAE;;AAEF;AACA;AACA;AACA,kB;AACA,IAAG;AACH,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,IAAG;AACH,0B;AACA,IAAG;;AAEH,IAAG;AACH;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA,IAAG;AACH;AACA,IAAG;AACH;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA,IAAG;AACH;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sCAAqC,SAAS;AAC9C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,qDAAoD,SAAS;AAC7D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,uDAAsD,SAAS;AAC/D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA,IAAG;AACH,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA,G;AACA,EAAC;;AAED,mEAAkE;;;AAGlE;AACA;;AAEA;AACA;;AAEA,GAAE;;AAEF;;AAEA,GAAE;;AAEF;;AAEA;AACA,EAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kBAAiB;AACjB;AACA,uC;AACA;AACA;AACA;AACA,G;AACA,EAAC;;AAED;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,G;;AAEA,EAAC;;AAED;AACA;AACA,sDAAqD;AACrD,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA,EAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA,EAAC;;AAED;AACA;AACA;AACA;AACA,EAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAoB;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;;AAED;AACA;AACA,GAAE;;AAEF;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAI;;AAEJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL,KAAI;AACJ;AACA;AACA,MAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2BAA0B;AAC1B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;;AAED;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;;AAEA;;AAEA;AACA;AACA,qB;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ,IAAG;AACH,sBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAQ;AACR;AACA,SAAQ;AACR;AACA;AACA,SAAQ;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,OAAM,OAAO;AACb;AACA;AACA;AACA,OAAM,QAAQ;AACd;AACA;AACA;AACA,OAAM,QAAQ;AACd;AACA;;AAEA;AACA,OAAM,QAAQ;AACd;AACA;;AAEA;;AAEA;AACA,SAAQ,OAAO;AACf;AACA;AACA;AACA,SAAQ,OAAO;AACf;AACA;AACA;AACA,OAAM,OAAO;AACb;AACA;;AAEA;AACA,OAAM,QAAQ;AACd;AACA;;AAEA;;AAEA;;AAEA;;AAEA;AACA,OAAM,MAAM;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA,IAAG;AACH;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA,0B;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,GAAE;;AAEF;AACA;AACA;;AAEA;AACA;;AAEA;AACA,iBAAgB,OAAO,MAAM;AAC7B;AACA;AACA;AACA;AACA;AACA,yFAAwF,WAAW;AACnG,oCAAmC,SAAS;AAC5C;AACA;AACA;AACA,4CAA2C;AAC3C;AACA,4CAA2C;AAC3C;AACA,4CAA2C;AAC3C;AACA,4CAA2C;AAC3C;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA,IAAG;AACH;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA,IAAG,E;AACH,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,sBAAqB;AACrB;AACA;AACA,IAAG,0BAA0B;AAC7B;AACA;AACA,IAAG,0BAA0B;AAC7B;AACA;AACA,IAAG,0BAA0B;AAC7B;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA,IAAG,0BAA0B;AAC7B;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA,IAAG,0BAA0B;AAC7B;AACA;AACA,IAAG,0BAA0B;AAC7B;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,qCAAoC,SAAS;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2CAA0C;AAC1C;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA,yBAAwB;AACxB;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sCAAqC,OAAO;AAC5C;AACA;AACA;AACA,yB;AACA,KAAI;AACJ;AACA;AACA;;AAEA,yBAAwB,aAAa;AACrC;AACA;AACA;AACA;AACA;AACA,OAAM;AACN;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,uBAAsB;AACtB;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+CAA8C,UAAU;AACxD;AACA;AACA;AACA;AACA;AACA,gDAA+C,SAAS;AACxD;AACA;AACA,sCAAqC,iBAAiB;AACtD;AACA;AACA;AACA;AACA;AACA;AACA,0BAAyB,MAAM;AAC/B;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA,IAAG;AACH;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,KAAI;AACJ;AACA,sFAAqF;AACrF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sCAAqC,SAAS;AAC9C;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,kBAAiB;AACjB,KAAI,2DAA2D;AAC/D,KAAI,8DAA8D;AAClE;AACA;AACA,wBAAuB,YAAY;AACnC,wBAAuB,yDAAyD;AAChF,wBAAuB,6DAA6D;AACpF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH,GAAE;;AAEF;AACA;AACA;AACA,IAAG;AACH;AACA,IAAG;AACH;AACA,IAAG;AACH;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,EAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;;;AAIA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,sDAAqD;AACrD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gCAA+B;AAC/B,oCAAmC;AACnC,oCAAmC;AACnC,yCAAwC;AACxC,kCAAiC;;AAEjC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iDAAgD,gBAAgB;AAChE;AACA;AACA;AACA;AACA;AACA,mCAAkC,MAAM;AACxC;AACA,qC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oCAAmC,OAAO;AAC1C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK,O;AACL;AACA;AACA,aAAY;AACZ;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;;AAEA,KAAI;AACJ,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gDAA+C,SAAS;AACxD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,sCAAqC,SAAS;AAC9C;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,sCAAqC,SAAS;AAC9C;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,4CAA2C,SAAS;AACpD;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,0CAAyC,UAAU;AACnD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,sCAAqC,SAAS;AAC9C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,8B;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+B;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,IAAG;AACH;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,IAAG;AACH;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,8CAA6C,SAAS;AACtD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+CAA8C,SAAS;AACvD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;;AAEA,KAAI;AACJ,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,sBAAqB;AACrB;AACA,aAAY;AACZ;AACA;AACA,aAAY;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA,4B;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,OAAO;AACnB,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,QAAQ;AACpB,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,QAAQ;AACpB,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,OAAO;AACnB,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA,MAAK,SAAS;AACd;AACA;AACA,qC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,OAAO;AACnB,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA,MAAK,SAAS;AACd;AACA;AACA,qC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ,IAAG;AACH;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,0GAAyG;AACzG;AACA;AACA;AACA;AACA;AACA;AACA,wBAAuB;AACvB;AACA;AACA;AACA;AACA,wBAAuB;AACvB;AACA;AACA;AACA;AACA;AACA;;AAEA,yDAAwD;AACxD;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,4B;AACA,IAAG;AACH,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA;AACA,yCAAwC,SAAS;AACjD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,EAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sCAAqC,SAAS;AAC9C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,kBAAiB;AACjB;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,sBAAqB;AACrB;AACA;AACA,SAAQ;AACR;AACA;AACA,SAAQ;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAe,iBAAiB;AAChC;;AAEA,6CAA4C;AAC5C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;;AAEA,EAAC;;AAED;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,sBAAqB;AACrB;AACA;AACA,QAAO;AACP;AACA,QAAO;AACP;AACA;AACA,QAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;;AAED;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,sBAAqB;AACrB;AACA;AACA,QAAO;AACP;AACA,QAAO;AACP;AACA;AACA,QAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAM,QAAQ;AACd;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iCAAgC;AAChC;AACA,KAAI;AACJ,IAAG;AACH;AACA;AACA,IAAG;AACH,iCAAgC;AAChC;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yCAAwC,SAAS;AACjD;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAa,YAAY;AACzB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAc,YAAY;AAC1B;AACA,oBAAmB,cAAc;AACjC;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kDAAiD;AACjD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAkB,WAAW;AAC7B;AACA;AACA;AACA;AACA;AACA,OAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mDAAkD;AAClD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4CAA2C,YAAY;AACvD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;;AAEJ;AACA;AACA;;AAEA;AACA,2CAA0C,YAAY;AACtD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;;AAED;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,sBAAqB;AACrB;AACA;AACA,QAAO;AACP;AACA,QAAO;AACP;AACA;AACA,QAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;AACA,uBAAsB,OAAO;AAC7B,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,yBAAwB,QAAQ;AAChC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,yBAAwB,QAAQ;AAChC,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,OAAO;AACnB,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,SAAS;AACrB,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,W;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;;AAED;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA;AACA,uCAAsC,SAAS;AAC/C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;;AAEA;;AAEA;AACA;AACA,qB;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ,IAAG;AACH,sBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8CAA6C,SAAS;AACtD;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,2BAA0B;AAC1B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4CAA2C,SAAS;AACpD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oE;AACA;AACA,6I;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;;AAEA;AACA;;AAEA;AACA;AACA,KAAI;AACJ;AACA;AACA,KAAI;;AAEJ;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,I;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;;;;;AAKD;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,sBAAqB;AACrB;AACA;AACA,QAAO;AACP;AACA,QAAO;AACP;AACA;AACA,QAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,gEAA+D;AAC/D,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;;AAED;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,sBAAqB;AACrB;AACA;AACA,QAAO;AACP;AACA,QAAO;AACP;AACA;AACA,QAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,OAAM,QAAQ;AACd;AACA;;AAEA;AACA,OAAM,QAAQ;AACd;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6CAA4C;AAC5C;AACA;AACA;AACA;AACA;AACA;AACA,OAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA,KAAI,2CAA2C;AAC/C;;AAEA,gDAA+C;AAC/C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,EAAC;;AAED;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,sBAAqB;AACrB;AACA;AACA,QAAO;AACP;AACA,QAAO;AACP;AACA;AACA,QAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;;AAED;AACA,yDAAwD;;AAExD;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,sBAAqB;AACrB;AACA;AACA,QAAO,iBAAiB,gDAAgD;AACxE;AACA,QAAO;AACP;AACA;AACA,QAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAM,OAAO;AACb;AACA;;AAEA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;;AAEA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;;AAED;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,sBAAqB;AACrB;AACA;AACA,QAAO;AACP;AACA,QAAO;AACP;AACA;AACA,QAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA,EAAC;;AAED;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,wBAAuB;AACvB;AACA;AACA,UAAS,mBAAmB,2GAA2G;AACvI;AACA,UAAS;AACT;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,OAAM,OAAO;AACb;AACA;AACA;AACA,OAAM,OAAO;AACb;AACA;AACA;AACA,OAAM,OAAO;AACb;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;AACD;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,sBAAqB;AACrB;AACA;AACA,SAAQ;AACR;AACA;AACA,SAAQ;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;;AAED;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,sBAAqB;AACrB;AACA;AACA,QAAO;AACP;AACA,QAAO;AACP;AACA;AACA,QAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAM,QAAQ;AACd;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iCAAgC;AAChC;AACA,KAAI;AACJ,IAAG;AACH;AACA;AACA,IAAG;AACH,iCAAgC;AAChC;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA,uCAAsC,SAAS;AAC/C;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sCAAqC,SAAS;AAC9C;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,mBAAkB,SAAS;AAC3B;AACA;AACA;AACA;AACA;AACA,OAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;;AAEA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;;AAED;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,sBAAqB;AACrB;AACA;AACA,QAAO;AACP;AACA,QAAO;AACP;AACA;AACA,QAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,OAAM,QAAQ;AACd;AACA;AACA;AACA,OAAM,QAAQ;AACd;AACA;AACA;AACA,OAAM,QAAQ;AACd;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,IAAG;AACH,+B;AACA;AACA;AACA;AACA,mCAAkC;AAClC;AACA;AACA,IAAG;AACH;AACA;AACA;AACA,KAAI,EAAE;AACN;AACA,iCAAgC;AAChC,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAM;AACN;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA,6BAA4B,iBAAiB;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA,gBAAe,YAAY;AAC3B;AACA;AACA;AACA;AACA;;AAEA;AACA,gBAAe,YAAY;AAC3B;AACA,oBAAmB,QAAQ;AAC3B;AACA;AACA;AACA;AACA,OAAM;AACN,MAAK;AACL,KAAI;AACJ;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA,mBAAkB,aAAa;AAC/B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA,IAAG;AACH;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;;AAED;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,sBAAqB;AACrB;AACA;AACA,QAAO;AACP;AACA,QAAO;AACP;AACA;AACA,QAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAM,QAAQ;AACd;AACA;AACA;AACA,OAAM,QAAQ;AACd;AACA;AACA;AACA;AACA,OAAM,QAAQ;AACd;AACA;AACA;AACA,OAAM,QAAQ;AACd;AACA;AACA;AACA,OAAM,QAAQ;AACd;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,kBAAiB,aAAa;AAC9B;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,IAAG;AACH;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,kBAAiB,aAAa;AAC9B;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0FAAyF;;AAEzF;AACA;;AAEA;AACA,kBAAiB,cAAc;AAC/B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,EAAC;;AAED;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,sBAAqB;AACrB;AACA;AACA,QAAO;AACP;AACA,QAAO;AACP;AACA;AACA,QAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAM,OAAO;AACb;AACA;AACA;;AAEA;AACA,OAAM,6BAA6B;AACnC;AACA;;AAEA;;AAEA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,IAAG;AACH,+B;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA,iCAAgC;AAChC;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAM;AACN;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA;AACA,qCAAoC;AACpC,KAAI;AACJ;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6CAA4C,SAAS;AACrD;AACA;AACA;AACA;AACA;AACA,OAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAO;AACP;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAa,YAAY;AACzB;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,gBAAe,YAAY;AAC3B;;AAEA,oBAAmB,QAAQ;AAC3B;AACA;AACA;AACA;AACA,OAAM;AACN,MAAK;AACL,KAAI;AACJ;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,wC;AACA;AACA;AACA,IAAG;AACH;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA,mBAAkB,aAAa;AAC/B;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,M;AACA,KAAI;AACJ;AACA;;AAEA,IAAG;AACH;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;;AAED;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,sBAAqB;AACrB;AACA;AACA,QAAO;AACP;AACA,QAAO;AACP;AACA;AACA,QAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAM,QAAQ;AACd;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA,IAAG;;AAEH;AACA;AACA,IAAG;;AAEH;AACA;AACA,IAAG;;AAEH;AACA;AACA,IAAG;;AAEH,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,I;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAU;AACV,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,EAAC;AACD;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,sBAAqB,WAAW,YAAY,aAAa;AACzD;AACA,QAAO,eAAe,YAAY,YAAY,UAAU;AACxD;AACA,QAAO,eAAe,YAAY,YAAY,UAAU,cAAc,WAAW,YAAY,aAAa,WAAW;AACrH;AACA;AACA,QAAO,eAAe,YAAY,YAAY,UAAU;AACxD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,QAAQ;AACpB,aAAY,QAAQ;AACpB;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,aAAY,OAAO;AACnB;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oCAAmC,SAAS;AAC5C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kC;AACA;AACA,sD;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;AACD;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;;AAED;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;;AAED;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,sBAAqB;AACrB;AACA,SAAQ;AACR;AACA,SAAQ,2CAA2C,iCAAiC;AACpF;AACA;AACA,SAAQ;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAkB,8BAA8B;AAChD,mBAAkB;;AAElB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,wBAAuB,aAAa;AACpC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,qBAAoB,UAAU;AAC9B;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sCAAqC,SAAS;AAC9C;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAU;AACV,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;AACD;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,uBAAsB;AACtB;AACA;AACA,SAAQ;AACR;AACA,SAAQ;AACR;AACA;AACA,SAAQ;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA,EAAC;;AAED;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uBAAsB;AACtB;AACA;AACA,SAAQ;AACR;AACA,SAAQ;AACR;AACA;AACA,SAAQ;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAM,QAAQ;AACd;AACA;AACA;AACA,OAAM,QAAQ;AACd;AACA;;AAEA;AACA,OAAM;AACN;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,4CAA2C,SAAS;AACpD;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iFAAgF,uEAAuE;AACvJ;AACA,oJAAmJ;AACnJ;AACA,gFAA+E,sEAAsE;AACrJ;AACA;;AAEA;AACA;AACA;AACA;AACA,mBAAkB,SAAS;AAC3B;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,IAAG;;AAEH;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,IAAG;;AAEH;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA,EAAC;;AAED;AACA;;;;;;;ACzmkBA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,sBAAqB;;AAErB;AACA,kCAAiC,EAAE;AACnC;AACA;;AAEA;AACA;AACA;;AAEA;AACA,iCAAgC,EAAE;AAClC,yBAAwB,EAAE;AAC1B;AACA,yBAAwB,EAAE;AAC1B,0CAAyC,EAAE;AAC3C,yCAAwC,EAAE;AAC1C;AACA,8BAA6B,EAAE;AAC/B,6BAA4B,EAAE;AAC9B,8BAA6B,EAAE;AAC/B,0BAAyB,EAAE;AAC3B,gCAA+B,EAAE;AACjC;AACA,wBAAuB,EAAE;AACzB;AACA;AACA;AACA,mCAAkC,EAAE,MAAM,EAAE;AAC5C,mCAAkC,EAAE,MAAM,EAAE;AAC5C;AACA,yBAAwB,EAAE,EAAE,EAAE;AAC9B,8BAA6B,EAAE;AAC/B,8BAA6B,EAAE;AAC/B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,6BAA4B,EAAE;AAC9B,+BAA8B,EAAE;AAChC,gCAA+B,EAAE;AACjC;AACA,qCAAoC,EAAE;AACtC,0CAAyC,EAAE;AAC3C;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,uCAAsC,EAAE;AACxC;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,sBAAqB,EAAE;AACvB;;AAEA,yB;AACA;AACA;;AAEA,sB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,oB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,sB;AACA;AACA;AACA;AACA;AACA;;AAEA,qB;AACA;AACA;AACA;;AAEA,mB;AACA;AACA;AACA;AACA,G;;AAEA;AACA,kBAAiB,EAAE;AACnB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;;;;;;;ACnKA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA,QAAO,SAAS;AAChB;;AAEA;;AAEA;;AAEA,sCAAqC,UAAU;AAC/C;AACA;;AAEA,G;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;;;;;;;;;ACtCA;AACA;AACA;AACA;AACA,qBAAoB;AACpB;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;AACF;AACA;AACA,GAAE;AACF;AACA;AACA,GAAE;AACF;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,iBAAgB,mBAAmB;AACnC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAgB,sBAAsB;AACtC;AACA;AACA,mBAAkB,2BAA2B;AAC7C;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,gBAAe,mBAAmB;AAClC;AACA;AACA;AACA;AACA,kBAAiB,2BAA2B;AAC5C;AACA;AACA,SAAQ,uBAAuB;AAC/B;AACA;AACA,IAAG;AACH;AACA,kBAAiB,uBAAuB;AACxC;AACA;AACA,4BAA2B;AAC3B;AACA;AACA;;AAEA;AACA;AACA;AACA,gBAAe,iBAAiB;AAChC;AACA;AACA;AACA;AACA;AACA,eAAc;AACd;AACA,iCAAgC,sBAAsB;AACtD;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAE;AACF;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;AACF;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,GAAE;AACF;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,yDAAwD;AACxD,uCAAsC;AACtC,IAAG;AACH;;AAEA;AACA;AACA;;AAEA;AACA;AACA,GAAE;AACF;AACA;AACA;AACA;AACA;AACA;;;;;;;AC7LA;;AAEA;AACA;AACA;AACA;AACA,iDAA4K;AAC5K;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;AACF;AACA,iCAAgC,UAAU,EAAE;AAC5C,E;;;;;;ACjBA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;AACD;AACA;AACA;AACA;AACA,EAAC;AACD;AACA;AACA;AACA;AACA,EAAC;AACD;AACA;AACA;AACA;AACA;AACA,EAAC;;AAED;AACA,UAAS;AACT,+DAA8D;;AAE9D;AACA;AACA;AACA;AACA;AACA,EAAC;AACD;AACA;AACA;AACA;AACA,EAAC;AACD;AACA;AACA;AACA;AACA,EAAC;AACD;AACA;AACA;AACA;AACA,EAAC;AACD;AACA;AACA;AACA;AACA,EAAC;AACD;AACA;AACA;AACA;AACA,EAAC;AACD;AACA;AACA;AACA;AACA,EAAC;AACD;AACA;AACA;AACA;AACA,EAAC;AACD;AACA;AACA;AACA;AACA,EAAC;AACD,uBAAsB;AACtB;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,mBAAkB,mBAAmB;AACrC;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,mBAAkB,4BAA4B;AAC9C;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,2BAA0B,IAAI,MAAM,IAAI,SAAS,EAAE,8BAA8B;AACjF;AACA;;AAEA;AACA;AACA,yBAAwB,GAAG,mCAAmC;AAC9D;AACA;;AAEA;AACA;AACA,4FAA2F,IAAI,gCAAgC;AAC/H;AACA;;AAEA;AACA;AACA,wBAAuB,GAAG,kDAAkD;AAC5E;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;AACD;AACA;AACA;AACA;AACA;AACA,+BAA8B;;AAE9B;;;;;;;;;;;;;;ACrXA;AACA;;AAEA;;AAEA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA,mBAAkB;AAClB,KAAI;AACJ;AACA,mBAAkB;AAClB;AACA,QAAO,6BAA6B;AACpC,QAAO;AACP;AACA;AACA,KAAI;AACJ;AACA;AACA;;AAEA;;AAEA;;AAEA;;;AAGA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA","file":"demo/editPanel/index.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap c558d392c20b656963b1\n **/","\"use strict\";\nvar Utils = require(\"./utils\");\nvar Exception = require(\"./exception\")[\"default\"];\n\nvar VERSION = \"1.3.0\";\nexports.VERSION = VERSION;var COMPILER_REVISION = 4;\nexports.COMPILER_REVISION = COMPILER_REVISION;\nvar REVISION_CHANGES = {\n  1: '<= 1.0.rc.2', // 1.0.rc.2 is actually rev2 but doesn't report it\n  2: '== 1.0.0-rc.3',\n  3: '== 1.0.0-rc.4',\n  4: '>= 1.0.0'\n};\nexports.REVISION_CHANGES = REVISION_CHANGES;\nvar isArray = Utils.isArray,\n    isFunction = Utils.isFunction,\n    toString = Utils.toString,\n    objectType = '[object Object]';\n\nfunction HandlebarsEnvironment(helpers, partials) {\n  this.helpers = helpers || {};\n  this.partials = partials || {};\n\n  registerDefaultHelpers(this);\n}\n\nexports.HandlebarsEnvironment = HandlebarsEnvironment;HandlebarsEnvironment.prototype = {\n  constructor: HandlebarsEnvironment,\n\n  logger: logger,\n  log: log,\n\n  registerHelper: function(name, fn, inverse) {\n    if (toString.call(name) === objectType) {\n      if (inverse || fn) { throw new Exception('Arg not supported with multiple helpers'); }\n      Utils.extend(this.helpers, name);\n    } else {\n      if (inverse) { fn.not = inverse; }\n      this.helpers[name] = fn;\n    }\n  },\n\n  registerPartial: function(name, str) {\n    if (toString.call(name) === objectType) {\n      Utils.extend(this.partials,  name);\n    } else {\n      this.partials[name] = str;\n    }\n  }\n};\n\nfunction registerDefaultHelpers(instance) {\n  instance.registerHelper('helperMissing', function(arg) {\n    if(arguments.length === 2) {\n      return undefined;\n    } else {\n      throw new Exception(\"Missing helper: '\" + arg + \"'\");\n    }\n  });\n\n  instance.registerHelper('blockHelperMissing', function(context, options) {\n    var inverse = options.inverse || function() {}, fn = options.fn;\n\n    if (isFunction(context)) { context = context.call(this); }\n\n    if(context === true) {\n      return fn(this);\n    } else if(context === false || context == null) {\n      return inverse(this);\n    } else if (isArray(context)) {\n      if(context.length > 0) {\n        return instance.helpers.each(context, options);\n      } else {\n        return inverse(this);\n      }\n    } else {\n      return fn(context);\n    }\n  });\n\n  instance.registerHelper('each', function(context, options) {\n    var fn = options.fn, inverse = options.inverse;\n    var i = 0, ret = \"\", data;\n\n    if (isFunction(context)) { context = context.call(this); }\n\n    if (options.data) {\n      data = createFrame(options.data);\n    }\n\n    if(context && typeof context === 'object') {\n      if (isArray(context)) {\n        for(var j = context.length; i<j; i++) {\n          if (data) {\n            data.index = i;\n            data.first = (i === 0);\n            data.last  = (i === (context.length-1));\n          }\n          ret = ret + fn(context[i], { data: data });\n        }\n      } else {\n        for(var key in context) {\n          if(context.hasOwnProperty(key)) {\n            if(data) { \n              data.key = key; \n              data.index = i;\n              data.first = (i === 0);\n            }\n            ret = ret + fn(context[key], {data: data});\n            i++;\n          }\n        }\n      }\n    }\n\n    if(i === 0){\n      ret = inverse(this);\n    }\n\n    return ret;\n  });\n\n  instance.registerHelper('if', function(conditional, options) {\n    if (isFunction(conditional)) { conditional = conditional.call(this); }\n\n    // Default behavior is to render the positive path if the value is truthy and not empty.\n    // The `includeZero` option may be set to treat the condtional as purely not empty based on the\n    // behavior of isEmpty. Effectively this determines if 0 is handled by the positive path or negative.\n    if ((!options.hash.includeZero && !conditional) || Utils.isEmpty(conditional)) {\n      return options.inverse(this);\n    } else {\n      return options.fn(this);\n    }\n  });\n\n  instance.registerHelper('unless', function(conditional, options) {\n    return instance.helpers['if'].call(this, conditional, {fn: options.inverse, inverse: options.fn, hash: options.hash});\n  });\n\n  instance.registerHelper('with', function(context, options) {\n    if (isFunction(context)) { context = context.call(this); }\n\n    if (!Utils.isEmpty(context)) return options.fn(context);\n  });\n\n  instance.registerHelper('log', function(context, options) {\n    var level = options.data && options.data.level != null ? parseInt(options.data.level, 10) : 1;\n    instance.log(level, context);\n  });\n}\n\nvar logger = {\n  methodMap: { 0: 'debug', 1: 'info', 2: 'warn', 3: 'error' },\n\n  // State enum\n  DEBUG: 0,\n  INFO: 1,\n  WARN: 2,\n  ERROR: 3,\n  level: 3,\n\n  // can be overridden in the host environment\n  log: function(level, obj) {\n    if (logger.level <= level) {\n      var method = logger.methodMap[level];\n      if (typeof console !== 'undefined' && console[method]) {\n        console[method].call(console, obj);\n      }\n    }\n  }\n};\nexports.logger = logger;\nfunction log(level, obj) { logger.log(level, obj); }\n\nexports.log = log;var createFrame = function(object) {\n  var obj = {};\n  Utils.extend(obj, object);\n  return obj;\n};\nexports.createFrame = createFrame;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** C:/Users/Administrator/AppData/Roaming/npm/~/spm/~/spm-webpack/~/handlebars/dist/cjs/handlebars/base.js\n ** module id = 1\n ** module chunks = 0 1 2 3 4 5 6\n **/","\"use strict\";\n\nvar errorProps = ['description', 'fileName', 'lineNumber', 'message', 'name', 'number', 'stack'];\n\nfunction Exception(message, node) {\n  var line;\n  if (node && node.firstLine) {\n    line = node.firstLine;\n\n    message += ' - ' + line + ':' + node.firstColumn;\n  }\n\n  var tmp = Error.prototype.constructor.call(this, message);\n\n  // Unfortunately errors are not enumerable in Chrome (at least), so `for prop in tmp` doesn't work.\n  for (var idx = 0; idx < errorProps.length; idx++) {\n    this[errorProps[idx]] = tmp[errorProps[idx]];\n  }\n\n  if (line) {\n    this.lineNumber = line;\n    this.column = node.firstColumn;\n  }\n}\n\nException.prototype = new Error();\n\nexports[\"default\"] = Exception;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** C:/Users/Administrator/AppData/Roaming/npm/~/spm/~/spm-webpack/~/handlebars/dist/cjs/handlebars/exception.js\n ** module id = 2\n ** module chunks = 0 1 2 3 4 5 6\n **/","\"use strict\";\n/*jshint -W004 */\nvar SafeString = require(\"./safe-string\")[\"default\"];\n\nvar escape = {\n  \"&\": \"&amp;\",\n  \"<\": \"&lt;\",\n  \">\": \"&gt;\",\n  '\"': \"&quot;\",\n  \"'\": \"&#x27;\",\n  \"`\": \"&#x60;\"\n};\n\nvar badChars = /[&<>\"'`]/g;\nvar possible = /[&<>\"'`]/;\n\nfunction escapeChar(chr) {\n  return escape[chr] || \"&amp;\";\n}\n\nfunction extend(obj, value) {\n  for(var key in value) {\n    if(Object.prototype.hasOwnProperty.call(value, key)) {\n      obj[key] = value[key];\n    }\n  }\n}\n\nexports.extend = extend;var toString = Object.prototype.toString;\nexports.toString = toString;\n// Sourced from lodash\n// https://github.com/bestiejs/lodash/blob/master/LICENSE.txt\nvar isFunction = function(value) {\n  return typeof value === 'function';\n};\n// fallback for older versions of Chrome and Safari\nif (isFunction(/x/)) {\n  isFunction = function(value) {\n    return typeof value === 'function' && toString.call(value) === '[object Function]';\n  };\n}\nvar isFunction;\nexports.isFunction = isFunction;\nvar isArray = Array.isArray || function(value) {\n  return (value && typeof value === 'object') ? toString.call(value) === '[object Array]' : false;\n};\nexports.isArray = isArray;\n\nfunction escapeExpression(string) {\n  // don't escape SafeStrings, since they're already safe\n  if (string instanceof SafeString) {\n    return string.toString();\n  } else if (!string && string !== 0) {\n    return \"\";\n  }\n\n  // Force a string conversion as this will be done by the append regardless and\n  // the regex test will do this transparently behind the scenes, causing issues if\n  // an object's to string has escaped characters in it.\n  string = \"\" + string;\n\n  if(!possible.test(string)) { return string; }\n  return string.replace(badChars, escapeChar);\n}\n\nexports.escapeExpression = escapeExpression;function isEmpty(value) {\n  if (!value && value !== 0) {\n    return true;\n  } else if (isArray(value) && value.length === 0) {\n    return true;\n  } else {\n    return false;\n  }\n}\n\nexports.isEmpty = isEmpty;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** C:/Users/Administrator/AppData/Roaming/npm/~/spm/~/spm-webpack/~/handlebars/dist/cjs/handlebars/utils.js\n ** module id = 3\n ** module chunks = 0 1 2 3 4 5 6\n **/","\"use strict\";\n// Build out our basic SafeString type\nfunction SafeString(string) {\n  this.string = string;\n}\n\nSafeString.prototype.toString = function() {\n  return \"\" + this.string;\n};\n\nexports[\"default\"] = SafeString;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** C:/Users/Administrator/AppData/Roaming/npm/~/spm/~/spm-webpack/~/handlebars/dist/cjs/handlebars/safe-string.js\n ** module id = 4\n ** module chunks = 0 1 2 3 4 5 6\n **/","exports = module.exports = require(\"./../../../../../Users/Administrator/AppData/Roaming/npm/node_modules/spm/node_modules/spm-webpack/node_modules/css-loader/lib/css-base.js\")();\nexports.push([module.id, \"\\r\\n.fn-relative {\\r\\n\\tposition: relative;\\r\\n}\\r\\n\\r\\n.fn-toolbar {\\r\\n\\tposition: absolute;\\r\\n\\ttop: 4px;\\r\\n\\tright: 10px;\\r\\n}\\r\\n\\r\\n.jl-comb-btn-group > .btn {\\r\\n\\theight: 30px;\\r\\n}\\r\\n\\r\\n.jl-msg-button {\\r\\n    line-height: 1;\\r\\n}\\r\\n\\r\\n.jl-overlay {\\r\\n  background-color: #000;\\r\\n}\\r\\n\\r\\n.panel-title {\\r\\n\\tdisplay: inline;\\r\\n}\\r\\n\\r\\n.options {\\r\\n\\twidth: 100%;\\r\\n\\tdisplay: inline-block;\\r\\n}\", \"\"]);\n\n\n/*****************\n ** WEBPACK FOOTER\n ** C:/Users/Administrator/AppData/Roaming/npm/~/spm/~/spm-webpack/~/css-loader!./interpreter/panel.css\n ** module id = 5\n ** module chunks = 0 1 2 3 4 5 6\n **/","var Handlebars = require(\"C:\\\\Users\\\\Administrator\\\\AppData\\\\Roaming\\\\npm\\\\node_modules\\\\spm\\\\node_modules\\\\spm-webpack\\\\node_modules\\\\handlebars\\\\runtime.js\");\nmodule.exports = (Handlebars[\"default\"] || Handlebars).template(function (Handlebars,depth0,helpers,partials,data) {\n  this.compilerInfo = [4,'>= 1.0.0'];\nhelpers = this.merge(helpers, Handlebars.helpers); data = data || {};\n  var buffer = \"\", stack1, helper, functionType=\"function\", escapeExpression=this.escapeExpression, self=this;\n\nfunction program1(depth0,data) {\n  \n  var buffer = \"\", stack1;\n  buffer += \"\\r\\n\t\t<div class=\\\"options form-horizontal\\\">\\r\\n\t\t\t\";\n  stack1 = helpers.each.call(depth0, ((stack1 = (depth0 && depth0.options)),stack1 == null || stack1 === false ? stack1 : stack1.inputs), {hash:{},inverse:self.noop,fn:self.program(2, program2, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\r\\n\t\t\t\";\n  stack1 = helpers.each.call(depth0, ((stack1 = (depth0 && depth0.options)),stack1 == null || stack1 === false ? stack1 : stack1.buttons), {hash:{},inverse:self.noop,fn:self.program(4, program4, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\r\\n\t\t</div>\\r\\n\t\t\";\n  return buffer;\n  }\nfunction program2(depth0,data) {\n  \n  var buffer = \"\";\n  buffer += \"\\r\\n\t\t\t\t<label class=\\\"col-sm-1 control-label\\\">\"\n    + escapeExpression((typeof depth0 === functionType ? depth0.apply(depth0) : depth0))\n    + \"</label>\\r\\n\t\t\t\t<div class=\\\"col-sm-3\\\">\\r\\n\t\t\t\t\t<input type=\\\"text\\\" class=\\\"form-control\\\" id=\"\n    + escapeExpression((typeof depth0 === functionType ? depth0.apply(depth0) : depth0))\n    + \"Option>\\r\\n\t\t\t\t</div>\\r\\n\t\t\t\";\n  return buffer;\n  }\n\nfunction program4(depth0,data) {\n  \n  var buffer = \"\";\n  buffer += \"\\r\\n\t\t\t\t<div class=\\\"col-sm-3\\\">\\r\\n\t\t\t\t\t<button class=\\\"btn btn-default\\\" id=\\\"\"\n    + escapeExpression((typeof depth0 === functionType ? depth0.apply(depth0) : depth0))\n    + \"Btn\\\">\"\n    + escapeExpression((typeof depth0 === functionType ? depth0.apply(depth0) : depth0))\n    + \"</button>\\r\\n\t\t\t\t</div>\\r\\n\t\t\t\";\n  return buffer;\n  }\n\nfunction program6(depth0,data) {\n  \n  var buffer = \"\";\n  buffer += \"\\r\\n\t\t\t\t<button class=\\\"btn btn-default\\\" id=\\\"\"\n    + escapeExpression((typeof depth0 === functionType ? depth0.apply(depth0) : depth0))\n    + \"Btn\\\">\"\n    + escapeExpression((typeof depth0 === functionType ? depth0.apply(depth0) : depth0))\n    + \"</button>\\r\\n\t\t\t\";\n  return buffer;\n  }\n\n  buffer += \"<div class=\\\"panel panel-default\\\">\\r\\n\\r\\n\t<div class=\\\"panel-heading fn-relative\\\">\\r\\n\\r\\n\t\t<div class=\\\"panel-title\\\">\";\n  if (helper = helpers.title) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.title); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"</div>\\r\\n\\r\\n\t\t\";\n  stack1 = helpers['if'].call(depth0, (depth0 && depth0.options), {hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\r\\n\\r\\n\t\t<div class=\\\"btn-group fn-toolbar\\\">\\r\\n\t\t\t\";\n  stack1 = helpers.each.call(depth0, (depth0 && depth0.toolbar), {hash:{},inverse:self.noop,fn:self.program(6, program6, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\r\\n\t\t</div>\\r\\n\\r\\n\t</div>\\r\\n\\r\\n\t<div class=\\\"panel-body\\\">\\r\\n\t\t\";\n  if (helper = helpers.bodyTpl) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.bodyTpl); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\r\\n\t</div>\\r\\n\\r\\n</div>\";\n  return buffer;\n  });\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./interpreter/panel.handlebars\n ** module id = 6\n ** module chunks = 0 1 2 3 4 5 6\n **/","null\n\n\n/** WEBPACK FOOTER **\n ** helpers!./interpreter/panel.handlebars\n **/","/*\r\n\tMIT License http://www.opensource.org/licenses/mit-license.php\r\n\tAuthor Tobias Koppers @sokra\r\n*/\r\n// css base code, injected by the css-loader\r\nmodule.exports = function() {\r\n\tvar list = [];\r\n\r\n\t// return the list of modules as css string\r\n\tlist.toString = function toString() {\r\n\t\tvar result = [];\r\n\t\tfor(var i = 0; i < this.length; i++) {\r\n\t\t\tvar item = this[i];\r\n\t\t\tif(item[2]) {\r\n\t\t\t\tresult.push(\"@media \" + item[2] + \"{\" + item[1] + \"}\");\r\n\t\t\t} else {\r\n\t\t\t\tresult.push(item[1]);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn result.join(\"\");\r\n\t};\r\n\r\n\t// import a list of modules into the list\r\n\tlist.i = function(modules, mediaQuery) {\r\n\t\tif(typeof modules === \"string\")\r\n\t\t\tmodules = [[null, modules, \"\"]];\r\n\t\tvar alreadyImportedModules = {};\r\n\t\tfor(var i = 0; i < this.length; i++) {\r\n\t\t\tvar id = this[i][0];\r\n\t\t\tif(typeof id === \"number\")\r\n\t\t\t\talreadyImportedModules[id] = true;\r\n\t\t}\r\n\t\tfor(i = 0; i < modules.length; i++) {\r\n\t\t\tvar item = modules[i];\r\n\t\t\t// skip already imported module\r\n\t\t\t// this implementation is not 100% perfect for weird media query combinations\r\n\t\t\t//  when a module is imported multiple times with different media queries.\r\n\t\t\t//  I hope this will never occur (Hey this way we have smaller bundles)\r\n\t\t\tif(typeof item[0] !== \"number\" || !alreadyImportedModules[item[0]]) {\r\n\t\t\t\tif(mediaQuery && !item[2]) {\r\n\t\t\t\t\titem[2] = mediaQuery;\r\n\t\t\t\t} else if(mediaQuery) {\r\n\t\t\t\t\titem[2] = \"(\" + item[2] + \") and (\" + mediaQuery + \")\";\r\n\t\t\t\t}\r\n\t\t\t\tlist.push(item);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\treturn list;\r\n};\r\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** C:/Users/Administrator/AppData/Roaming/npm/~/spm/~/spm-webpack/~/css-loader/lib/css-base.js\n ** module id = 7\n ** module chunks = 0 1 2 3 4 5 6\n **/","\"use strict\";\n/*globals Handlebars: true */\nvar base = require(\"./handlebars/base\");\n\n// Each of these augment the Handlebars object. No need to setup here.\n// (This is done to easily share code between commonjs and browse envs)\nvar SafeString = require(\"./handlebars/safe-string\")[\"default\"];\nvar Exception = require(\"./handlebars/exception\")[\"default\"];\nvar Utils = require(\"./handlebars/utils\");\nvar runtime = require(\"./handlebars/runtime\");\n\n// For compatibility and usage outside of module systems, make the Handlebars object a namespace\nvar create = function() {\n  var hb = new base.HandlebarsEnvironment();\n\n  Utils.extend(hb, base);\n  hb.SafeString = SafeString;\n  hb.Exception = Exception;\n  hb.Utils = Utils;\n\n  hb.VM = runtime;\n  hb.template = function(spec) {\n    return runtime.template(spec, hb);\n  };\n\n  return hb;\n};\n\nvar Handlebars = create();\nHandlebars.create = create;\n\nexports[\"default\"] = Handlebars;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** C:/Users/Administrator/AppData/Roaming/npm/~/spm/~/spm-webpack/~/handlebars/dist/cjs/handlebars.runtime.js\n ** module id = 8\n ** module chunks = 0 1 2 3 4 5 6\n **/","\"use strict\";\nvar Utils = require(\"./utils\");\nvar Exception = require(\"./exception\")[\"default\"];\nvar COMPILER_REVISION = require(\"./base\").COMPILER_REVISION;\nvar REVISION_CHANGES = require(\"./base\").REVISION_CHANGES;\n\nfunction checkRevision(compilerInfo) {\n  var compilerRevision = compilerInfo && compilerInfo[0] || 1,\n      currentRevision = COMPILER_REVISION;\n\n  if (compilerRevision !== currentRevision) {\n    if (compilerRevision < currentRevision) {\n      var runtimeVersions = REVISION_CHANGES[currentRevision],\n          compilerVersions = REVISION_CHANGES[compilerRevision];\n      throw new Exception(\"Template was precompiled with an older version of Handlebars than the current runtime. \"+\n            \"Please update your precompiler to a newer version (\"+runtimeVersions+\") or downgrade your runtime to an older version (\"+compilerVersions+\").\");\n    } else {\n      // Use the embedded version info since the runtime doesn't know about this revision yet\n      throw new Exception(\"Template was precompiled with a newer version of Handlebars than the current runtime. \"+\n            \"Please update your runtime to a newer version (\"+compilerInfo[1]+\").\");\n    }\n  }\n}\n\nexports.checkRevision = checkRevision;// TODO: Remove this line and break up compilePartial\n\nfunction template(templateSpec, env) {\n  if (!env) {\n    throw new Exception(\"No environment passed to template\");\n  }\n\n  // Note: Using env.VM references rather than local var references throughout this section to allow\n  // for external users to override these as psuedo-supported APIs.\n  var invokePartialWrapper = function(partial, name, context, helpers, partials, data) {\n    var result = env.VM.invokePartial.apply(this, arguments);\n    if (result != null) { return result; }\n\n    if (env.compile) {\n      var options = { helpers: helpers, partials: partials, data: data };\n      partials[name] = env.compile(partial, { data: data !== undefined }, env);\n      return partials[name](context, options);\n    } else {\n      throw new Exception(\"The partial \" + name + \" could not be compiled when running in runtime-only mode\");\n    }\n  };\n\n  // Just add water\n  var container = {\n    escapeExpression: Utils.escapeExpression,\n    invokePartial: invokePartialWrapper,\n    programs: [],\n    program: function(i, fn, data) {\n      var programWrapper = this.programs[i];\n      if(data) {\n        programWrapper = program(i, fn, data);\n      } else if (!programWrapper) {\n        programWrapper = this.programs[i] = program(i, fn);\n      }\n      return programWrapper;\n    },\n    merge: function(param, common) {\n      var ret = param || common;\n\n      if (param && common && (param !== common)) {\n        ret = {};\n        Utils.extend(ret, common);\n        Utils.extend(ret, param);\n      }\n      return ret;\n    },\n    programWithDepth: env.VM.programWithDepth,\n    noop: env.VM.noop,\n    compilerInfo: null\n  };\n\n  return function(context, options) {\n    options = options || {};\n    var namespace = options.partial ? options : env,\n        helpers,\n        partials;\n\n    if (!options.partial) {\n      helpers = options.helpers;\n      partials = options.partials;\n    }\n    var result = templateSpec.call(\n          container,\n          namespace, context,\n          helpers,\n          partials,\n          options.data);\n\n    if (!options.partial) {\n      env.VM.checkRevision(container.compilerInfo);\n    }\n\n    return result;\n  };\n}\n\nexports.template = template;function programWithDepth(i, fn, data /*, $depth */) {\n  var args = Array.prototype.slice.call(arguments, 3);\n\n  var prog = function(context, options) {\n    options = options || {};\n\n    return fn.apply(this, [context, options.data || data].concat(args));\n  };\n  prog.program = i;\n  prog.depth = args.length;\n  return prog;\n}\n\nexports.programWithDepth = programWithDepth;function program(i, fn, data) {\n  var prog = function(context, options) {\n    options = options || {};\n\n    return fn(context, options.data || data);\n  };\n  prog.program = i;\n  prog.depth = 0;\n  return prog;\n}\n\nexports.program = program;function invokePartial(partial, name, context, helpers, partials, data) {\n  var options = { partial: true, helpers: helpers, partials: partials, data: data };\n\n  if(partial === undefined) {\n    throw new Exception(\"The partial \" + name + \" could not be found\");\n  } else if(partial instanceof Function) {\n    return partial(context, options);\n  }\n}\n\nexports.invokePartial = invokePartial;function noop() { return \"\"; }\n\nexports.noop = noop;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** C:/Users/Administrator/AppData/Roaming/npm/~/spm/~/spm-webpack/~/handlebars/dist/cjs/handlebars/runtime.js\n ** module id = 9\n ** module chunks = 0 1 2 3 4 5 6\n **/","// Create a simple path alias to allow browserify to resolve\n// the runtime on a supported path.\nmodule.exports = require('./dist/cjs/handlebars.runtime');\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** C:/Users/Administrator/AppData/Roaming/npm/~/spm/~/spm-webpack/~/handlebars/runtime.js\n ** module id = 10\n ** module chunks = 0 1 2 3 4 5 6\n **/","/* ========================================================================\r\n * Jslet framework: jslet.global.js\r\n *\r\n * Copyright (c) 2014 Jslet Group(https://github.com/jslet/jslet/)\r\n * Licensed under MIT (https://github.com/jslet/jslet/LICENSE.txt)\r\n * ======================================================================== */\r\n\r\nif (!jslet.rootUri) {\r\n    var ohead = document.getElementsByTagName('head')[0], \r\n        uri = ohead.lastChild.src;\r\n    if(uri) {\r\n\t    uri = uri.substring(0, uri.lastIndexOf('/') + 1);\r\n\t    jslet.rootUri = uri;\r\n    }\r\n}\r\njslet.global = {\r\n\tversion: '3.0.0',\r\n\t\r\n\t//Used in jslet.data.Dataset_applyChanges\r\n\tchangeStateField: 'rs',\r\n\t\r\n\t//Used in jslet.data.Dataset_selected\r\n\tselectStateField: '_sel_',\r\n\t\r\n\t//Value separator\r\n\tvalueSeparator: ',',\r\n\t\r\n\tdefaultRecordClass: null,\r\n\t\r\n\tdefaultFocusKeyCode: 9,\r\n\t\r\n\tdefaultCharWidth: 12,\r\n\t\r\n\tdebugMode: true\r\n};\r\n\r\n/**\r\n * Global server error handler\r\n * \r\n * @param {String} errCode, error code\r\n * @param {String} errMsg,  error message\r\n * \r\n * @return {Boolean} Identify if handler catch this error, if catched, the rest handler will not process it.\r\n */\r\njslet.global.serverErrorHandler = function(errCode, errMsg) {\r\n\treturn false;\r\n}\r\n\r\n/**\r\n * Global event handler for jQuery.ajax, you can set settings here.\r\n * \r\n * @param {Plan Object} settings jQuery.ajax settings.\r\n * \r\n * @return {Plan Object} jQuery.ajax settings, @see http://api.jquery.com/jQuery.ajax/.\r\n * \t\t\tAttension: \r\n * \t\t\tthe following attributes can not be set: type, contentType, mimeType, dataType, data, context.\r\n */\r\njslet.global.beforeSubmit = function(settings) {\r\n\t\r\n\treturn settings;\r\n}\r\n\r\n\r\n\r\n/* ========================================================================\r\n * Jslet framework: jslet.class.js\r\n *\r\n * Copyright (c) 2014 Jslet Group(https://github.com/jslet/jslet/)\r\n * Licensed under MIT (https://github.com/jslet/jslet/LICENSE.txt)\r\n * ======================================================================== */\r\n\r\n/**\r\n * the below code from prototype.js(http://prototypejs.org/) \r\n */\r\njslet.toArray = function(iterable) {\r\n\tif (!iterable) {\r\n\t\treturn [];\r\n\t}\r\n\tif ('toArray' in Object(iterable)) {\r\n\t\treturn iterable.toArray();\r\n\t}\r\n\tvar length = iterable.length || 0, results = new Array(length);\r\n\twhile (length--) {\r\n\t\tresults[length] = iterable[length];\r\n\t}\r\n\treturn results;\r\n};\r\n\r\njslet.extend = function(destination, source) {\r\n\tfor ( var property in source) {\r\n\t\tdestination[property] = source[property];\r\n\t}\r\n\treturn destination;\r\n};\r\n\r\njslet.emptyFunction = function() {\r\n};\r\n\r\njslet.keys = function(object) {\r\n\tif ((typeof object) != 'object') {\r\n\t\treturn [];\r\n\t}\r\n\tvar results = [];\r\n\tfor ( var property in object) {\r\n\t\tif (object.hasOwnProperty(property)) {\r\n\t\t\tresults.push(property);\r\n\t\t}\r\n\t}\r\n\treturn results;\r\n};\r\n\r\njslet.extend(Function.prototype,\r\n\t\t(function() {\r\n\t\t\tvar slice = Array.prototype.slice;\r\n\r\n\t\t\tfunction update(array, args) {\r\n\t\t\t\tvar arrayLength = array.length, length = args.length;\r\n\t\t\t\twhile (length--) {\r\n\t\t\t\t\tarray[arrayLength + length] = args[length];\r\n\t\t\t\t}\r\n\t\t\t\treturn array;\r\n\t\t\t}\r\n\r\n\t\t\tfunction merge(array, args) {\r\n\t\t\t\tarray = slice.call(array, 0);\r\n\t\t\t\treturn update(array, args);\r\n\t\t\t}\r\n\r\n\t\t\tfunction argumentNames() {\r\n\t\t\t\tvar names = this.toString().match(\r\n\t\t\t\t\t\t/^[\\s\\(]*function[^(]*\\(([^)]*)\\)/)[1].replace(\r\n\t\t\t\t\t\t/\\/\\/.*?[\\r\\n]|\\/\\*(?:.|[\\r\\n])*?\\*\\//g, '').replace(\r\n\t\t\t\t\t\t/\\s+/g, '').split(',');\r\n\t\t\t\treturn names.length == 1 && !names[0] ? [] : names;\r\n\t\t\t}\r\n\r\n\t\t\tfunction bind(context) {\r\n\t\t\t\tif (arguments.length < 2 && (typeof arguments[0] === 'undefined')) {\r\n\t\t\t\t\treturn this;\r\n\t\t\t\t}\r\n\t\t\t\tvar __method = this, args = slice.call(arguments, 1);\r\n\t\t\t\treturn function() {\r\n\t\t\t\t\tvar a = merge(args, arguments);\r\n\t\t\t\t\treturn __method.apply(context, a);\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\tfunction bindAsEventListener(context) {\r\n\t\t\t\tvar __method = this, args = slice.call(arguments, 1);\r\n\t\t\t\treturn function(event) {\r\n\t\t\t\t\tvar a = update( [ event || window.event ], args);\r\n\t\t\t\t\treturn __method.apply(context, a);\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\tfunction curry() {\r\n\t\t\t\tif (!arguments.length) {\r\n\t\t\t\t\treturn this;\r\n\t\t\t\t}\r\n\t\t\t\tvar __method = this, args = slice.call(arguments, 0);\r\n\t\t\t\treturn function() {\r\n\t\t\t\t\tvar a = merge(args, arguments);\r\n\t\t\t\t\treturn __method.apply(this, a);\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\tfunction delay(timeout) {\r\n\t\t\t\tvar __method = this, args = slice.call(arguments, 1);\r\n\t\t\t\ttimeout = timeout * 1000;\r\n\t\t\t\treturn window.setTimeout(function() {\r\n\t\t\t\t\treturn __method.apply(__method, args);\r\n\t\t\t\t}, timeout);\r\n\t\t\t}\r\n\r\n\t\t\tfunction defer() {\r\n\t\t\t\tvar args = update( [ 0.01 ], arguments);\r\n\t\t\t\treturn this.delay.apply(this, args);\r\n\t\t\t}\r\n\r\n\t\t\tfunction wrap(wrapper) {\r\n\t\t\t\tvar __method = this;\r\n\t\t\t\treturn function() {\r\n\t\t\t\t\tvar a = update( [ __method.bind(this) ], arguments);\r\n\t\t\t\t\treturn wrapper.apply(this, a);\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\tfunction methodize() {\r\n\t\t\t\tif (this._methodized) {\r\n\t\t\t\t\treturn this._methodized;\r\n\t\t\t\t}\r\n\t\t\t\tvar __method = this;\r\n\t\t\t\tthis._methodized = function() {\r\n\t\t\t\t\tvar a = update( [ this ], arguments);\r\n\t\t\t\t\treturn __method.apply(null, a);\r\n\t\t\t\t};\r\n\t\t\t\treturn this._methodized;\r\n\t\t\t}\r\n\r\n\t\t\treturn {\r\n\t\t\t\targumentNames : argumentNames,\r\n\t\t\t\tbind : bind,\r\n\t\t\t\tbindAsEventListener : bindAsEventListener,\r\n\t\t\t\tcurry : curry,\r\n\t\t\t\tdelay : delay,\r\n\t\t\t\tdefer : defer,\r\n\t\t\t\twrap : wrap,\r\n\t\t\t\tmethodize : methodize\r\n\t\t\t};\r\n\t\t})());\r\n\r\n/* Based on Alex Arnell's inheritance implementation. */\r\njslet.Class = (function() {\r\n\r\n\tvar IS_DONTENUM_BUGGY = (function() {\r\n\t\tfor ( var p in {\r\n\t\t\ttoString : 1\r\n\t\t}) {\r\n\t\t\tif (p === 'toString') {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn true;\r\n\t})();\r\n\r\n\tfunction subclass() {\r\n\t}\r\n\t\r\n\tfunction create() {\r\n\t\tvar parent = null, properties = jslet.toArray(arguments);\r\n\t\tif (jQuery.isFunction(properties[0])) {\r\n\t\t\tparent = properties.shift();\r\n\t\t}\r\n\t\tfunction klass() {\r\n\t\t\tthis.initialize.apply(this, arguments);\r\n\t\t}\r\n\r\n\t\tjslet.extend(klass, jslet.Class.Methods);\r\n\t\tklass.superclass = parent;\r\n\t\tklass.subclasses = [];\r\n\r\n\t\tif (parent) {\r\n\t\t\tsubclass.prototype = parent.prototype;\r\n\t\t\tklass.prototype = new subclass();\r\n\t\t\tparent.subclasses.push(klass);\r\n\t\t}\r\n\r\n\t\tfor ( var i = 0, length = properties.length; i < length; i++) {\r\n\t\t\tklass.addMethods(properties[i]);\r\n\t\t}\r\n\t\tif (!klass.prototype.initialize) {\r\n\t\t\tklass.prototype.initialize = jslet.emptyFunction;\r\n\t\t}\r\n\t\tklass.prototype.constructor = klass;\r\n\t\treturn klass;\r\n\t}\r\n\r\n\tfunction addMethods(source) {\r\n\t\tvar ancestor = this.superclass && this.superclass.prototype, properties = jslet\r\n\t\t\t\t.keys(source);\r\n\r\n\t\tif (IS_DONTENUM_BUGGY) {\r\n\t\t\tif (source.toString != Object.prototype.toString) {\r\n\t\t\t\tproperties.push('toString');\r\n\t\t\t}\r\n\t\t\tif (source.valueOf != Object.prototype.valueOf) {\r\n\t\t\t\tproperties.push('valueOf');\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor ( var i = 0, length = properties.length; i < length; i++) {\r\n\t\t\tvar property = properties[i], value = source[property];\r\n\t\t\tif (ancestor && jQuery.isFunction(value) && value.argumentNames()[0] == '$super') {\r\n\t\t\t\tvar method = value;\r\n\t\t\t\tvalue = (function(m) {\r\n\t\t\t\t\treturn function() {\r\n\t\t\t\t\t\treturn ancestor[m].apply(this, arguments);\r\n\t\t\t\t\t};\r\n\t\t\t\t})(property).wrap(method);\r\n\r\n\t\t\t\tvalue.valueOf = method.valueOf.bind(method);\r\n\t\t\t\tvalue.toString = method.toString.bind(method);\r\n\t\t\t}\r\n\t\t\tthis.prototype[property] = value;\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\treturn {\r\n\t\tcreate : create,\r\n\t\tMethods : {\r\n\t\t\taddMethods : addMethods\r\n\t\t}\r\n\t};\r\n})();\r\n/* end Prototype code */\r\n\r\n/* ========================================================================\r\n * Jslet framework: jslet.common.js\r\n *\r\n * Copyright (c) 2014 Jslet Group(https://github.com/jslet/jslet/)\r\n * Licensed under MIT (https://github.com/jslet/jslet/LICENSE.txt)\r\n * ======================================================================== */\r\n\r\nif (window.jslet === undefined || jslet === undefined){\r\n\t/**\r\n\t * Root object/function of jslet framework. Example:\r\n\t * <pre><code>\r\n\t * var jsletObj = jslet('#tab');\r\n\t * </code></pre>\r\n\t * @param {String} Html tag id, like '#id'\r\n\t * \r\n\t * @return {Object} jslet object of the specified Html tag\r\n\t */\r\n    jslet=window.jslet = function(id){\r\n        var ele = jQuery(id)[0];\r\n        return (ele && ele.jslet) ? ele.jslet : null;\r\n    };\r\n}\r\n\r\njslet._AUTOID = 0;\r\njslet.nextId = function(){\r\n\treturn 'jslet' + (jslet._AUTOID++);\r\n};\r\n\r\n/**\r\n * Namespace\r\n */\r\nif(!jslet.data) {\r\n\tjslet.data = {};\r\n}\r\n\r\nif(!jslet.locale) {\r\n\tjslet.locale={};\r\n}\r\nif(!jslet.temp) {\r\n\tjslet.temp = {};\r\n}\r\n\r\n//if (!jslet.rootUri) {\r\n//    var ohead = document.getElementsByTagName('head')[0], uri = ohead.lastChild.src;\r\n//    uri = uri.substring(0, uri\r\n//\t\t\t\t\t.lastIndexOf('/')\r\n//\t\t\t\t\t+ 1);\r\n//    jslet.rootUri = uri\r\n//}\r\n\r\n/**\r\n * Javascript language enhancement\r\n */\r\nif(!Array.indexOf){\r\n\tArray.prototype.indexOf = function(value){\r\n\t\tfor(var i = 0, cnt = this.length; i < cnt; i++){\r\n\t\t\tif(this[i] == value)\r\n\t\t\t\treturn i;\r\n\t\t}\r\n\t\treturn -1;\r\n\t};\r\n}\r\n\r\nif(!Object.deepClone){\r\n\t\r\n\t/**\r\n\t * Deep clone object.\r\n\t * <pre><code>\r\n     *     var obj = {attr1: 'aaa', attr2: 123, attr3: {y1: 12, y2:'test'}};\r\n     *  var objClone = obj.deepClone();\r\n     * </code></pre>\r\n     * \r\n     */\r\n\t/*\r\n    Object.prototype.deepClone = function(){\r\n        var objClone;\r\n        if (this.constructor == Object){\r\n            objClone = new this.constructor(); \r\n        }else{\r\n            objClone = new this.constructor(this.valueOf()); \r\n        }\r\n        for(var key in this){\r\n            if ( objClone[key] != this[key] ){ \r\n                if ( typeof(this[key]) == 'object' ){ \r\n                    objClone[key] = this[key].deepClone();\r\n                }else{\r\n                    objClone[key] = this[key];\r\n                }\r\n            }\r\n        }\r\n        objClone.toString = this.toString;\r\n        objClone.valueOf = this.valueOf;\r\n        return objClone; \r\n    } */\r\n}\r\n\r\nif(!String.prototype.trim){\r\n\tString.prototype.trim = function(){\r\n\t\tthis.replace(/^\\s+/, '').replace(/\\s+$/, '');\r\n\t}\t;\r\n}\r\n\r\nif(!String.prototype.startsWith){\r\n\tString.prototype.startsWith = function(pattern) {\r\n\t\treturn this.lastIndexOf(pattern, 0) === 0;\r\n\t};\r\n}\r\n\r\nif(!String.prototype.endsWith){\r\n\t//From Prototype.js\r\n\tString.prototype.endsWith = function(pattern){\r\n        var d = this.length - pattern.length;\r\n        return d >= 0 && this.indexOf(pattern, d) === d;\r\n\t};\r\n}\r\n\r\n\r\njslet.debounce = function(func, wait, immediate) {\r\n\tvar timeoutHander;\r\n\treturn function() {\r\n\t\tvar context = this, args = arguments;\r\n\t\tif(!wait) {\r\n\t\t\tfunc.apply(context, args);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar later = function() {\r\n\t\t\ttimeoutHander = null;\r\n\t\t\tfunc.apply(context, args);\r\n\t\t};\r\n\t\tif(timeoutHander) {\r\n\t\t\tclearTimeout(timeoutHander);\r\n\t\t}\r\n\t\ttimeoutHander = setTimeout(later, wait);\r\n\t};\r\n};\r\n\r\n/*\r\n * Javascript language enhancement(end)\r\n */\r\n\r\njslet.deepClone = function(srcObj){\r\n    var objClone;\r\n    if (srcObj.constructor == Object){\r\n        objClone = new srcObj.constructor(); \r\n    } else {\r\n        objClone = new srcObj.constructor(srcObj.valueOf()); \r\n    }\r\n    for(var key in srcObj){\r\n        if ( objClone[key] != srcObj[key] ){ \r\n            if ( typeof(srcObj[key]) == 'object' ){ \r\n                objClone[key] = srcObj[key].deepClone();\r\n            } else {\r\n                objClone[key] = srcObj[key];\r\n            }\r\n        }\r\n    }\r\n    objClone.toString = srcObj.toString;\r\n    objClone.valueOf = srcObj.valueOf;\r\n    return objClone; \r\n};\r\n                                        \r\n/**\r\n * A simple map for Key/Value data. Example:\r\n * <pre><code>\r\n * var map = new jslet.SimpleMap();\r\n * map.set('background', 'red');\r\n * var color = map.get('background');//return 'red'\r\n * </code></pre>\r\n */\r\njslet.SimpleMap = function () {\r\n    var _keys = [], _values = [];\r\n    this.get = function (key) {\r\n        var len = _keys.length;\r\n        for (var i = 0; i < len; i++) {\r\n            if (key == _keys[i]) {\r\n                return _values[i];\r\n            }\r\n        }\r\n        return null;\r\n    };\r\n\r\n    this.set = function (key, value) {\r\n        var k = _keys.indexOf(key);\r\n        if(k >=0){\r\n            _values[k] = value;\r\n        } else {\r\n            _keys.push(key);\r\n            _values.push(value);\r\n        }\r\n    };\r\n\r\n    this.clear = function () {\r\n        _keys.length = 0;\r\n        _values.length = 0;\r\n    };\r\n\r\n    this.unset = function (key) {\r\n        var len = _keys.length;\r\n        for (var i = 0; i < len; i++) {\r\n            if (_keys[i] == key) {\r\n                _keys.splice(i, 1);\r\n                _values.splice(i, 1);\r\n                return;\r\n            }\r\n        }\r\n    };\r\n\r\n    this.count = function () {\r\n        return _keys.length;\r\n    };\r\n\r\n    this.keys = function () {\r\n        return _keys;\r\n    };\r\n    \r\n    this.values = function() {\r\n    \treturn _values;\r\n    }\r\n};\r\n\r\n/**\r\n * format message with argument. Example:\r\n * <pre><code>\r\n * var msg = jslet.formatString('Your name is:{0}', 'Bob');//return: your name is: Bob\r\n * var msg = jslet.formatString('They are:{0} and {1}', ['Jerry','Mark']);\r\n * </code></pre>\r\n * \r\n * @param {String} Initial message, placeholder of argument is {n}, n is number \r\n * @param {String/Array of String} args arguments\r\n * @return formatted message\r\n */\r\njslet.formatString = function (msg, args) {\r\n\tjslet.Checker.test('jslet.formatString#msg', msg).required().isString();\r\n    if(args === undefined || args === null) {\r\n    \treturn msg; \r\n    }\r\n    if(args === false) {\r\n    \targs = 'false';\r\n    }\r\n    if(args === true) {\r\n    \targs = 'true';\r\n    }\r\n    var result = msg, cnt, i;\r\n    if (jslet.isArray(args)) {// array\r\n        cnt = args.length;\r\n        for (i = 0; i < cnt; i++) {\r\n            result = result.replace('{' + i + '}', args[i]);\r\n        }\r\n    } else if(args.keys){// Hash\r\n        var arrKeys = args.keys(), sKey;\r\n        cnt = arrKeys.length;\r\n        for (i = 0; i < cnt; i++) {\r\n            sKey = arrKeys[i];\r\n            result = result.replace('{' + sKey + '}', args.get(sKey));\r\n        }\r\n    } else {\r\n    \treturn msg.replace('{0}', args);\r\n    }\r\n    return result;\r\n};\r\n\r\n/**\r\n * private constant value\r\n */\r\njslet._SCALEFACTOR = '100000000000000000000000000000000000';\r\n\r\n/**\r\n * Format a number. Example:\r\n * <pre><code>\r\n * var strNum = formatNumber(12345.999,'#,##0.00'); //return '12,346.00'\r\n * var strNum = formatNumber(12345.999,'#,##0.##'); //return '12,346'\r\n * var strNum = formatNumber(123,'000000'); //return '000123'\r\n * </code></pre>\r\n * \r\n * \r\n * @param {Number} num number that need format \r\n * @param {String} pattern pattern for number, like '#,##0.00'\r\n *  # - not required\r\n *  0 - required, if the corresponding digit of the number is empty, fill in with '0'\r\n *  . - decimal point\r\n *\r\n * @return {String}\r\n */\r\njslet.formatNumber = function(num, pattern) {\r\n\tif (!pattern) {\r\n\t\treturn num;\r\n\t}\r\n\tif(!num && num !== 0) {\r\n\t\treturn '';\r\n\t}\r\n\tvar preFix = '', c, i;\r\n\tfor (i = 0; i < pattern.length; i++) {\r\n\t\tc = pattern.substr(i, 1);\r\n\t\tif (c == '#' || c == '0' || c == ',') {\r\n\t\t\tif (i > 0) {\r\n\t\t\t\tpreFix = pattern.substr(0, i);\r\n\t\t\t\tpattern = pattern.substr(i);\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\tvar suffix = '';\r\n\tfor (i = pattern.length - 1; i >= 0; i--) {\r\n\t\tc = pattern.substr(i, 1);\r\n\t\tif (c == '#' || c == '0' || c == ',') {\r\n\t\t\tif (i > 0) {\r\n\t\t\t\tsuffix = pattern.substr(i + 1);\r\n\t\t\t\tpattern = pattern.substr(0, i + 1);\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\tvar fmtarr = pattern ? pattern.split('.') : [''],fmtDecimalLen = 0;\r\n\tif (fmtarr.length > 1) {\r\n\t\tfmtDecimalLen = fmtarr[1].length;\r\n\t}\r\n\tvar strarr = num ? num.toString().split('.') : ['0'],dataDecimalLen = 0;\r\n\tif (strarr.length > 1) {\r\n\t\tdataDecimalLen = strarr[1].length;\r\n\t}\r\n\tif (dataDecimalLen > fmtDecimalLen) {\r\n\t\tvar factor = parseInt(jslet._SCALEFACTOR.substring(0, fmtDecimalLen + 1));\r\n\t\tnum = Math.round(num * factor) / factor;\r\n\t\tstrarr = num ? num.toString().split('.') : ['0'];\r\n\t}\r\n\tvar retstr = '',\r\n\tstr = strarr[0],\r\n\tfmt = fmtarr[0],\r\n\tcomma = false,\r\n\tk = str.length - 1,\r\n\tf;\r\n\tfor (f = fmt.length - 1; f >= 0; f--) {\r\n\t\tswitch (fmt.substr(f, 1)) {\r\n\t\t\tcase '#' :\r\n\t\t\t\tif (k >= 0) {\r\n\t\t\t\t\tretstr = str.substr(k--, 1) + retstr;\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase '0' :\r\n\t\t\t\tif (k >= 0) {\r\n\t\t\t\t\tretstr = str.substr(k--, 1) + retstr;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tretstr = '0' + retstr;\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase ',' :\r\n\t\t\t\tcomma = true;\r\n\t\t\t\tretstr = ',' + retstr;\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\tif (k >= 0) {\r\n\t\tif (comma) {\r\n\t\t\tvar l = str.length;\r\n\t\t\tfor (; k >= 0; k--) {\r\n\t\t\t\tretstr = str.substr(k, 1) + retstr;\r\n\t\t\t\tif (k > 0 && ((l - k) % 3) === 0) {\r\n\t\t\t\t\tretstr = ',' + retstr;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tretstr = str.substr(0, k + 1) + retstr;\r\n\t\t}\r\n\t}\r\n\r\n\tretstr = retstr + '.';\r\n\r\n\tstr = strarr.length > 1 ? strarr[1] : '';\r\n\tfmt = fmtarr.length > 1 ? fmtarr[1] : '';\r\n\tk = 0;\r\n\tfor (f = 0; f < fmt.length; f++) {\r\n\t\tswitch (fmt.substr(f, 1)) {\r\n\t\t\tcase '#' :\r\n\t\t\t\tif (k < str.length) {\r\n\t\t\t\t\tretstr += str.substr(k++, 1);\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase '0' :\r\n\t\t\t\tif (k < str.length) {\r\n\t\t\t\t\tretstr += str.substr(k++, 1);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tretstr += '0';\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\treturn preFix + retstr.replace(/^,+/, '').replace(/\\.$/, '') + suffix;\r\n};\r\n\r\n/**\r\n * Format date with specified format. Example:\r\n * <pre><code>\r\n * var date = new Date();\r\n * console.log(jslet.formatDate(date, 'yyyy-MM-dd'));//2012-12-21\r\n * </code></pre>\r\n * \r\n * @param {Date} date value.\r\n * @param {String} date format.\r\n * @return {String} String date after format\r\n */\r\njslet.formatDate = function(date, format) {\r\n\tif(!date) {\r\n\t\treturn '';\r\n\t}\r\n\tjslet.Checker.test('jslet.formatDate#date', date).isDate();\r\n\tjslet.Checker.test('jslet.formatDate#format', format).required().isString();\r\n\tvar o = {\r\n\t\t'M+' : date.getMonth() + 1, // month\r\n\t\t'd+' : date.getDate(), // day\r\n\t\t'h+' : date.getHours(), // hour\r\n\t\t'm+' : date.getMinutes(), // minute\r\n\t\t's+' : date.getSeconds(), // second\r\n\t\t'q+' : Math.floor((date.getMonth() + 3) / 3), // quarter\r\n\t\t'S' : date.getMilliseconds()\r\n\t\t// millisecond\r\n\t};\r\n\tif (/(y+)/.test(format)) {\r\n\t\tformat = format.replace(RegExp.$1, \r\n\t\t\t\t(date.getFullYear() + '').substr(4 - RegExp.$1.length));\r\n\t}\r\n\tfor (var k in o) {\r\n\t\tif (new RegExp('(' + k + ')').test(format)) {\r\n\t\t\tformat = format.replace(RegExp.$1, \r\n\t\t\t\tRegExp.$1.length == 1 ? o[k] : ('00' + o[k]).substr(('' + o[k]).length));\r\n\t\t}\r\n\t}\r\n\treturn format;\r\n};\r\n\r\n/**\r\n * Parse a string to Date object. Example\r\n * <pre><code>\r\n * var date = jslet.parseDate('2013-03-25', 'yyyy-MM-dd');\r\n * var date = jslet.parseDate('2013-03-25 15:20:18', 'yyyy-MM-dd hh:mm:ss');\r\n * \r\n * </code></pre>\r\n * \r\n * @param {String} strDate String date\r\n * @param {String} format Date format, like: 'yyyy-MM-dd hh:mm:ss'\r\n * @return Date Object\r\n */\r\njslet.parseDate = function(strDate, format) {\r\n\tif(!strDate) {\r\n\t\treturn null;\r\n\t}\r\n\tjslet.Checker.test('jslet.parseDate#strDate', strDate).isString();\r\n\tjslet.Checker.test('jslet.parseDate#format', format).required().isString();\r\n\t\r\n\tvar preChar = null, ch, v, \r\n\t\tbegin = -1, \r\n\t\tend = 0;\r\n\tvar dateParts = {'y': 0, 'M': 0,'d': 0, 'h': 0,\t'm': 0, 's': 0, 'S': 0};\r\n\t\r\n\tfor(var i = 0, len = format.length; i < len; i++) {\r\n\t\tch = format.charAt(i);\r\n\t\r\n\t\tif(ch != preChar) {\r\n\t\t\tif(preChar && dateParts[preChar] !== undefined && begin >= 0) {\r\n\t\t\t\tend = i;\r\n\t\t\t\tv = parseInt(strDate.substring(begin, end));\r\n\t\t\t\tdateParts[preChar] = isNaN(v)?0:v;\r\n\t\t\t}\r\n\t\t\tbegin = i;\r\n\t\t\tpreChar = ch;\r\n\t\t}\r\n\t}\r\n\tif(begin >= 0) {\r\n\t\tv = parseInt(strDate.substring(begin));\r\n\t\tdateParts[ch] = isNaN(v)?0:v;\r\n\t}\r\n\tvar year = dateParts.y;\r\n\tif(year < 100) {\r\n\t\tyear += 2000;\r\n\t}\r\n\tvar result = new Date(year, dateParts.M - 1, dateParts.d, dateParts.h, dateParts.m, dateParts.s, dateParts.S);\r\n\treturn result;\r\n};\r\n\r\n/**\r\n * Convert Date to SO8601\r\n */\r\nDate.prototype.toJSON = function() {\r\n\treturn jslet.formatDate(this, 'yyyy-MM-ddThh:mm:ss');\r\n}\r\n\r\n/**\r\n * Convert string(ISO date format) to date\r\n * \r\n * @param {String} dateStr date string with ISO date format. Example: 2012-12-21T09:30:24Z\r\n * @return {Date} \r\n */\r\njslet.convertISODate= function(dateStr) {\r\n\tif(!dateStr) {\r\n\t\treturn null;\r\n\t}\r\n\tif(jslet.isDate(dateStr)) {\r\n\t\treturn dateStr;\r\n\t}\r\n\tvar flag = dateStr.substr(10,1);\r\n\tif('T' == flag) {\r\n\t\tvar year = dateStr.substr(0,4),\r\n\t\tmonth = dateStr.substr(5,2),\r\n\t\tday = dateStr.substr(8,2),\r\n\t\thour = dateStr.substr(11,2),\r\n\t\tminute = dateStr.substr(14,2),\r\n\t\tsecond = dateStr.substr(17,2);\r\n\t\tif('Z' == dateStr.substr(-1,1)) {\r\n\t\t\treturn new Date(Date.UTC(+year, +month - 1, +day, +hour,\r\n\t\t\t\t\t+minute, +second));\r\n\t\t}\r\n\t\treturn new Date(+year, +month - 1, +day, +hour,\r\n\t\t\t\t+minute, +second);\r\n\t}\r\n    return dateStr;\r\n};\r\n\r\n/**\r\n * private variable for convertToJsPattern,don't use it in your program\r\n */\r\njslet._currentPattern = {};\r\n\r\n/**\r\n * private variable for convertToJsPattern,don't use it in your program\r\n * Convert sql pattern to javascript pattern\r\n * \r\n * @param {String} pattern sql pattern\r\n * @param {String} escapeChar default is '\\'\r\n * @return {String} js regular pattern\r\n */\r\njslet._convertToJsPattern = function(pattern, escapeChar) {\r\n\tif (jslet._currentPattern.pattern == pattern && \r\n\t\t\tjslet._currentPattern.escapeChar == escapeChar) {\r\n\t\treturn jslet._currentPattern.result;\r\n\t}\r\n\tjslet._currentPattern.pattern = pattern;\r\n\tjslet._currentPattern.escapeChar = escapeChar;\r\n\r\n\tvar jsPattern = [],\r\n\t\tlen = pattern.length - 1,\r\n\t\tc, \r\n\t\tnextChar,\r\n\t\tbgn = 0, \r\n\t\tend = len,\r\n\t\thasLeft = false,\r\n\t\thasRight = false;\r\n\tif (pattern.charAt(0) == '%'){\r\n       bgn = 1;\r\n       hasLeft = true;\r\n    }\r\n    if (pattern.charAt(len) == '%'){\r\n       end = len - 1;\r\n       hasRight = true;\r\n    }\r\n    if (hasLeft && hasRight){\r\n       jsPattern.push('.*');\r\n    }\r\n    else if (hasRight){\r\n       jsPattern.push('^');\r\n    }\r\n\tfor (var i = bgn; i <= end; i++) {\r\n\t\tc = pattern.charAt(i);\r\n\t\tif (c == '\\\\' && i < len) {\r\n\t\t\tnextChar = pattern.charAt(i + 1);\r\n\t\t\tif (nextChar == '%' || nextChar == '_') {\r\n\t\t\t\tjsPattern.push(nextChar);\r\n\t\t\t\ti++;\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t} else if (c == '_') {\r\n\t\t\tjsPattern.push('.');\r\n\t\t} else {\r\n\t\t\tif (c == '.' || c == '*' || c == '[' || c == ']' || \r\n\t\t\t\t\tc == '{' || c == '}' || c == '+' || c == '(' || \r\n\t\t\t\t\tc == ')' || c == '\\\\' || c == '?' || c == '$' || c == '^')\r\n\t\t\t\tjsPattern.push('\\\\');\r\n\t\t\tjsPattern.push(c);\r\n\t\t}\r\n\t}// end for\r\n\tif (hasLeft && hasRight || hasRight){\r\n       jsPattern.push('.*');\r\n    } else if (hasLeft){\r\n       jsPattern.push('$');\r\n    }\r\n\r\n    jslet._currentPattern.result = new RegExp(jsPattern.join(''), 'ig');\r\n\treturn jslet._currentPattern.result;\r\n};\r\n\r\n/**\r\n *  Test if  the value to match pattern or not,for example:\r\n *  like('abc','%b%') -> true, like('abc','%b') -> false \r\n *  \r\n *  @param {String} testValue need to test value\r\n *  @param {String} pattern sql pattern, syntax like SQL\r\n *  @return {Boolean} True if matched, false otherwise\r\n */\r\njslet.like = like = window.like = function(testValue, pattern, escapeChar) {\r\n\tif (!testValue || !pattern) {\r\n\t\treturn false;\r\n\t}\r\n\tif (pattern.length === 0) {\r\n\t\treturn false;\r\n\t}\r\n\tif (!escapeChar) {\r\n\t\tescapeChar = '\\\\';\r\n\t}\r\n\tvar jsPattern = jslet._convertToJsPattern(pattern, escapeChar);\r\n\tif(!jslet.isString(testValue)) {\r\n\t\ttestValue += '';\r\n\t}\r\n\treturn testValue.match(jsPattern) !== null;\r\n};\r\n\r\n/**\r\n * Between function, all parameters' type must be same. Example:\r\n * <pre><code>\r\n * return between(4,2,5) //true\r\n * return between('c','a','b') // false\r\n * </code></pre>\r\n * \r\n * @param {Object} testValue test value\r\n * @param {Object} minValue minimum value\r\n * @param {Object} maxValue maximum value\r\n * @return {Boolean} True if matched, false otherwise\r\n */\r\njslet.between = between = window.between = function(testValue, minValue, maxValue) {\r\n\tif (arguments.length != 3) {\r\n\t\treturn false;\r\n\t}\r\n\treturn testValue >= minValue && testValue <= maxValue;\r\n};\r\n\r\n/**\r\n * Test if the value is in the following list. Example:\r\n * <pre><code>\r\n * return inlist('a','c','d','e') // false\r\n * \r\n * </code></pre>\r\n * @param {Object} testValue test value\r\n * @param {Object} valueList - one or more arguments\r\n * @return {Boolean} True if matched, false otherwise\r\n */\r\njslet.inlist = inlist = window.inlist = function(testValue, valueList) {\r\n\tvar cnt = arguments.length;\r\n\tif (cnt <= 2) {\r\n\t\treturn false;\r\n\t}\r\n\tfor (var i = 1; i < cnt; i++) {\r\n\t\tif (testValue == arguments[i]) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t}\r\n\treturn false;\r\n};\r\n\r\n/**\r\n * Test if the given value is an array.\r\n * \r\n * @param {Object} testValue test value\r\n * @return {Boolean} True if the given value is an array, false otherwise\r\n */\r\njslet.isArray = function (testValue) {\r\n    return !testValue || Object.prototype.toString.apply(testValue) === '[object Array]';\r\n};\r\n\r\n/**\r\n * Test if the given value is date object.\r\n * \r\n * @param {Object} testValue test value\r\n * @return {Boolean} True if the given value is date object, false otherwise\r\n */\r\njslet.isDate = function(testValue) {\r\n\treturn !testValue || testValue.constructor == Date;\r\n};\r\n\r\n/**\r\n * Test if the given value is a string object.\r\n * \r\n * @param {Object} testValue test value\r\n * @return {Boolean} True if the given value is String object, false otherwise\r\n */\r\njslet.isString = function(testValue) {\r\n\treturn testValue === null || testValue === undefined || typeof testValue == 'string';\r\n};\r\n\r\njslet.isObject = function(testValue) {\r\n\treturn testValue === null || testValue === undefined || jQuery.type(this.varValue) !== \"object\";\t\r\n}\r\n\r\njslet.setTimeout = function(obj, func, time) {\r\n    jslet.delayFunc = function () {\r\n        func.call(obj);\r\n    };\r\n    setTimeout(jslet.delayFunc, time);\r\n};\r\n\r\n/**\r\n * Encode html string. Example:\r\n * <pre><code>\r\n * return jslet.htmlEncode('<div />') // 'lt;div /gt;'\r\n * </code></pre>\r\n * \r\n * @param {String} htmlText html text\r\n * @return {String}\r\n */\r\njslet.htmlEncode = function(htmlText){\r\n    if (htmlText) {\r\n        return jQuery('<div />').text(htmlText).html();\r\n    } else {\r\n        return '';\r\n    }\r\n};\r\n\r\n/**\r\n * Decode html string. Example:\r\n * <pre><code>\r\n * return jslet.htmlDecode('lt;div /gt;') // '<div />'\r\n * </code></pre>\r\n * \r\n * @param {String} htmlText encoded html text\r\n * @return {String}\r\n */\r\njslet.htmlDecode = function(htmlText) {\r\n    if (htmlText) {\r\n        return jQuery('<div />').html(htmlText).text();\r\n    } else {\r\n        return '';\r\n    }\r\n};\r\n\r\n/**\r\n * Get a array item safely. Example:\r\n * <pre><code>\r\n * var arrValues = ['a','b'];\r\n * jslet.getArrayValue(arrValues, 1); // return 'b'\r\n * jslet.getArrayValue(arrValues, 3); // return null\r\n * </code></pre>\r\n * \r\n * @param {Array of Object} arrValues  a array of values\r\n * @param {Integer} index index of wanted to get item\r\n * @return {Object}\r\n */\r\njslet.getArrayValue = function(arrValues, index) {\r\n\tif(!arrValues) {\r\n\t\treturn null;\r\n\t}\r\n\t\t\r\n    if(jslet.isArray(arrValues)){\r\n        var len = arrValues.length;\r\n        if(index < len) {\r\n            return arrValues[index];\r\n        } else {\r\n            return null;\r\n        }\r\n    } else {\r\n        if(index === 0) {\r\n            return arrValues;\r\n        } else {\r\n            return null;\r\n        }\r\n    }\r\n};\r\n\r\njslet.Checker = {\r\n\tvarName: null,\r\n\tvarValue: null,\r\n\t\r\n\ttest: function(varName, varValue) {\r\n\t\tthis.varName = varName;\r\n\t\tthis.varValue = varValue;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\ttestValue: function(varValue) {\r\n\t\tthis.varValue = varValue;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\trequired: function() {\r\n\t\tif(this.varValue === null || this.varValue === undefined || this.varValue === '') {\r\n\t\t\tthrow new Error('[' + this.varName + '] is Required!');\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\tisBoolean: function() {\r\n\t\tif(this.varValue !== null && \r\n\t\t   this.varValue !== undefined &&\r\n\t\t   this.varValue !== '' &&\r\n\t\t   this.varValue !== 0 && \r\n\t\t   this.varValue !== true && \r\n\t\t   this.varValue !== false) {\r\n\t\t\tthrow new Error('[' + this.varName + '] must be a boolean value!');\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\tisString: function() {\r\n\t\tif(this.varValue !== null && \r\n\t\t\tthis.varValue !== undefined &&\r\n\t\t\tthis.varValue !== false &&\r\n\t\t\t!jslet.isString(this.varValue)) {\r\n\t\t\tthrow new Error('[' + this.varName + ':' + this.varValue + '] must be a String!');\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\tisDate: function() {\r\n\t\tif(this.varValue !== null && \r\n\t\t\tthis.varValue !== undefined &&\r\n\t\t\tthis.varValue !== false &&\r\n\t\t\t!jslet.isDate(this.varValue)) {\r\n\t\t\tthrow new Error('[' + this.varName + '] must be a Date!');\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\tisNumber: function() {\r\n\t\tif(this.varValue !== null && \r\n\t\t\tthis.varValue !== undefined && \r\n\t\t\tthis.varValue !== false &&\r\n\t\t\t!jQuery.isNumeric(this.varValue)) {\r\n\t\t\tthrow new Error('[' + this.varName + ':' + this.varValue + '] must be a Numberic!');\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\tisGTZero: function() {\r\n\t\tthis.isNumber();\r\n\t\tif(this.varValue <= 0) {\r\n\t\t\tthrow new Error('[' + this.varName + ':' + this.varValue + '] must be great than zero!');\r\n\t\t}\r\n\t},\r\n\t\r\n\tisGTEZero: function() {\r\n\t\tthis.isNumber();\r\n\t\tif(this.varValue < 0) {\r\n\t\t\tthrow new Error('[' + this.varName + ':' + this.varValue + '] must be great than or equal zero!');\r\n\t\t}\r\n\t},\r\n\tbetween: function(minValue, maxValue) {\r\n\t\tvar checkMin = minValue !== null && minValue !== undefined;\r\n\t\tvar checkMax = maxValue !== null && maxValue !== undefined;\r\n\t\tif(checkMin && checkMax && (this.varValue < minValue || this.varValue > maxValue)) {\r\n\t\t\tthrow new Error('[' + this.varName + ':' + this.varValue + '] must be between [' + \r\n\t\t\t\t\tminValue + '] and [' + maxValue + ']!');\r\n\t\t}\r\n\t\tif(!checkMin && checkMax && this.varValue > maxValue) {\r\n\t\t\tthrow new Error('[' + this.varName + ':' + this.varValue + '] must be less than [' + maxValue + ']!');\r\n\t\t}\r\n\t\tif(checkMin && !checkMax && this.varValue < minValue) {\r\n\t\t\tthrow new Error('[' + this.varName + ':' + this.varValue + '] must be great than [' + minValue + ']!');\r\n\t\t}\r\n\t},\r\n\t\r\n\tisArray: function() {\r\n\t\tif(this.varValue !== null && \r\n\t\t\tthis.varValue !== undefined &&\r\n\t\t\tthis.varValue !== false &&\r\n\t\t\t!jslet.isArray(this.varValue)) {\r\n\t\t\tthrow new Error('[' + this.varName + '] must be an Array!');\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\tisObject: function() {\r\n\t\tif(this.varValue !== null && \r\n\t\t\tthis.varValue !== undefined &&\r\n\t\t\tthis.varValue !== false &&\r\n\t\t\tjQuery.type(this.varValue) !== \"object\") {\r\n\t\t\tthrow new Error('[' + this.varName + '] must be a Object!');\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\tisPlanObject: function() {\r\n\t\tif(this.varValue !== null && \r\n\t\t\t\tthis.varValue !== undefined &&\r\n\t\t\t\tthis.varValue !== false &&\r\n\t\t\t\t!jQuery.isPlainObject(this.varValue)) {\r\n\t\t\t\tthrow new Error('[' + this.varName + '] must be a plan object!');\r\n\t\t}\r\n\t\treturn this;\r\n\t\t\t\t\r\n\t},\r\n\t\r\n\tisFunction: function() {\r\n\t\tif(this.varValue !== null && \r\n\t\t\tthis.varValue !== undefined &&\r\n\t\t\tthis.varValue !== false &&\r\n//\t\t\t(typeof this.varValue == 'function') ){\r\n\t\t\t!jQuery.isFunction(this.varValue)) {\r\n\t\t\tthrow new Error('[' + this.varName + '] must be a Function!');\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\tisClass: function(className) {\r\n\t\tthis.isObject();\r\n\t\tif(this.varValue !== null && \r\n\t\t\tthis.varValue !== undefined &&\r\n\t\t\tthis.varValue !== false &&\r\n\t\t\tthis.varValue.className != className)   {\r\n\t\t\tthrow new Error('[' + this.varName + '] must be instance of [' + className+ ']!');\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\tisDataType: function(dataType) {\r\n\t\tif(dataType == 'S') {\r\n\t\t\tthis.isString();\r\n\t\t}\r\n\t\tif(dataType == 'N') {\r\n\t\t\tthis.isNumber();\r\n\t\t}\r\n\t\tif(dataType == 'D') {\r\n\t\t\tthis.isDate();\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\tinArray: function(arrlist) {\r\n\t\tif(this.varValue !== null && \r\n\t\t\tthis.varValue !== undefined &&\r\n\t\t\tthis.varValue !== false &&\r\n\t\t\tarrlist.indexOf(this.varValue) < 0)   {\r\n\t\t\tthrow new Error('[' + this.varName + ':' + this.varValue + '] must be one of [' + arrlist.join(',') + ']!');\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n};\r\n\r\njslet.JSON = {\r\n\tnormalize: function (json) {\r\n\t\t//json = jQuery.trim(json);\r\n\t\tvar result = [], c, next, isKey = false, isArray = false, isObj = true, last = '', quoteChar = null;\r\n\t\tvar c = json.charAt(0), append = false;\r\n\t\tif(c != '{' && c != '[') {\r\n\t\t\tresult.push('{\"');\r\n\t\t\tappend = true;\r\n\t\t}\t\t\r\n\t\tfor(var i = 0, len = json.length; i< len; i++) {\r\n\t\t\tc = json.charAt(i);\r\n\t\t\t\r\n\t\t\tif(quoteChar) {//Not process any char in a String value. \r\n\t\t\t\tif(c == quoteChar) {\r\n\t\t\t\t\tquoteChar = null;\r\n\t\t\t\t\tresult.push('\"');\r\n\t\t\t\t\tlast = '\"';\r\n\t\t\t\t} else {\r\n\t\t\t\t\tresult.push(c);\r\n\t\t\t\t}\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif(c == '[') {\r\n\t\t\t\tisArray = true;\r\n\t\t\t\tisObj = false;\r\n\t\t\t}\r\n\t\t\tif(c == ']' || c == '{') {\r\n\t\t\t\tisArray = false;\r\n\t\t\t\tisObj = true;\r\n\t\t\t}\r\n\t\t\tif(isKey && (c == ' ' || c == '\\b')) {//Trim blank char in a key.\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif(isObj && (c == '{' || c == ',')) {\r\n\t\t\t\tisKey = true;\r\n\t\t\t\tresult.push(c);\r\n\t\t\t\tlast = c;\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif(last == '{' || last == ',') {\r\n\t\t\t\tresult.push('\"');\r\n\t\t\t}\r\n\t\t\tif(isKey && c == \"'\") {\r\n\t\t\t\tresult.push('\"');\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif(c == ':') {\r\n\t\t\t\tisKey = false;\r\n\t\t\t\tif(last != '\"') {\r\n\t\t\t\t\tresult.push('\"');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(!isKey) {\r\n\t\t\t\tif(c == \"'\" || c == '\"') {\r\n\t\t\t\t\tquoteChar = c;\r\n\t\t\t\t\tresult.push('\"');\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tlast = c;\r\n\t\t\tresult.push(c);\r\n\t\t}\r\n\t\tif(append) {\r\n\t\t\tresult.push('}');\r\n\t\t}\r\n\t\treturn result.join('');\r\n\t},\r\n\t\r\n\tparse: function(json) {\r\n\t\ttry {\r\n//\t\t\treturn JSON.parse(this.normalize(json));//has bug\r\n\t\t\treturn JSON.parse(json);\r\n\t\t} catch(e) {\r\n\t\t\tthrow new Error(jslet.formatString(jslet.locale.Common.jsonParseError, [json]));\r\n\t\t}\r\n\t},\r\n\t\r\n\tstringify: function(value, replacer, space) {\r\n\t\treturn JSON.stringify(value, replacer, space);\r\n\t}\r\n\r\n};\r\n\r\n/**\r\n * Get specified function with function object or function name.\r\n * \r\n * @param {String or function} funcOrFuncName If its value is function name, find this function in window context.\r\n * @param {Object} context the context which looking for function in.\r\n * @return {function}\r\n */\r\njslet.getFunction = function(funcOrFuncName, context) {\r\n\tif(!funcOrFuncName) {\r\n\t\treturn null;\r\n\t}\r\n\tif(jQuery.isFunction(funcOrFuncName)) {\r\n\t\treturn funcOrFuncName;\r\n\t}\r\n\tif(!context) {\r\n\t\tcontext = window;\r\n\t}\r\n\t\r\n\tvar result = context[funcOrFuncName];\r\n\tif(!result) {\r\n\t\tconsole.warn('NOT found function:' + funcOrFuncName);\r\n\t}\r\n\treturn result;\r\n}\r\n\r\njslet.getRemainingString = function(wholeStr, cuttingStr) {\r\n\tif(!wholeStr || !cuttingStr) {\r\n\t\treturn wholeStr;\r\n\t}\r\n\treturn wholeStr.replace(cuttingStr, '');\r\n}\r\n\r\n/**\r\n* Show error message.\r\n*  \r\n* @param {Error object or String} e - error object or error message\r\n* @param {Function} callBackFn - call back function, pattern:\r\n* \tfunction() {\r\n* \t\r\n* \t}\r\n* @param {Integer} timeout - timeout for close this dialog. \r\n*/\r\njslet.showError = function (e, callBackFn, timeout) {\r\n\tvar msg;\r\n\tif (typeof (e) == 'string') {\r\n\t\tmsg = e;\r\n\t} else {\r\n\t\tmsg = e.message;\r\n\t}\r\n\tif (jslet.ui && jslet.ui.MessageBox) {\r\n\t\tjslet.ui.MessageBox.error(msg, null, callBackFn);\r\n\t} else {\r\n\t\talert(msg);\r\n\t}\r\n};\r\n\r\n/**\r\n* Show Info message.\r\n* \r\n* @param {Error object or String} e - error object or error message\r\n* @param {Function} callBackFn - call back function, pattern:\r\n* \tfunction() {\r\n* \t\r\n* \t}\r\n* @param {Integer} timeout - timeout for close this dialog. \r\n*/\r\njslet.showInfo = function (e, callBackFn, timeout) {\r\n\tvar msg;\r\n\tif (typeof (e) == 'string') {\r\n\t\tmsg = e;\r\n\t} else {\r\n\t\tmsg = e.message;\r\n\t}\r\n\tif (jslet.ui && jslet.ui.MessageBox) {\r\n\t\tjslet.ui.MessageBox.alert(msg, jslet.locale.MessageBox.Info, callBackFn, timeout);\r\n\t} else {\r\n\t\talert(msg);\r\n\t}\r\n};\r\n\r\njslet.Clipboard = function() {\r\n\tvar clipboard = document.getElementById('jsletClipboard');\r\n\tif(!clipboard) {\r\n\t\tjQuery('<textarea id=\"jsletClipboard\" style=\"position:absolute;top:-1000px\" tabindex=\"-1\"></textarea>').appendTo(document.body);\r\n\t\r\n\t    window.addEventListener('copy', function (event) {\r\n\t        var text = jQuery('#jsletClipboard').val();\r\n\t        if(text) {\r\n\t\t        if(event.clipboardData) {\r\n\t\t        \tevent.clipboardData.setData('text/plain', text);\r\n\t\t        } else {\r\n\t\t        \twindow.clipboardData.setData('text', text);\r\n\t\t        }\r\n\t\t        jQuery('#jsletClipboard').val(null);\r\n\t\t        event.preventDefault();\r\n\t\t        return false;\r\n\t        }\r\n\t    });\r\n\t}\r\n}\r\n\r\njslet.Clipboard.putText = function(text) {\r\n\tvar clipboard = jQuery('#jsletClipboard').val(text);\r\n\tclipboard[0].select();\r\n}\r\n\r\njslet.Clipboard();\r\n\r\n/* ========================================================================\r\n * Jslet framework: jslet.cookie.js\r\n *\r\n * Copyright (c) 2014 Jslet Group(https://github.com/jslet/jslet/)\r\n * Licensed under MIT (https://github.com/jslet/jslet/LICENSE.txt)\r\n * ======================================================================== */\r\n\r\n/**\r\n * Cookie Utils\r\n */\r\nif(!jslet.getCookie){\r\n\t/**\r\n\t * Get cookie value with cookie name. Example:\r\n\t * <pre><code>\r\n\t * console.log(jslet.getCookie('name'));\r\n\t * </code></pre>\r\n\t * \r\n\t * @param {String} name Cookie name\r\n\t * @return {String} Cookie value\r\n\t */\r\n\tjslet.getCookie = function(name) {\r\n\t\tvar start = document.cookie.indexOf(name + '=');\r\n\t\tvar len = start + name.length + 1;\r\n\t\tif ((!start) && (name != document.cookie.substring(0, name.length))) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tif (start == -1){\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tvar end = document.cookie.indexOf(';', len);\r\n\t\tif (end == -1){\r\n\t\t\tend = document.cookie.length;\r\n\t\t}\r\n\t\treturn unescape(document.cookie.substring(len, end));\r\n\t};\r\n}\r\n\r\nif (!jslet.setCookie){\r\n\t/**\r\n\t * Set cookie. Example:\r\n\t * <pre><code>\r\n\t * jslet.setCookie('name', 'value', 1, '/', '.foo.com', true);\r\n\t * </code></pre>\r\n\t * \r\n\t * @param {String} name Cookie name\r\n\t * @param {String} value Cookie value\r\n\t * @param {String} expires Cookie expires(day)\r\n\t * @param {String} path Cookie path\r\n\t * @param {String} domain Cookie domain\r\n\t * @param {Boolean} secure Cookie secure flag\r\n\t * \r\n\t */\r\n\tjslet.setCookie = function(name, value, expires, path, domain, secure) {\r\n\t\tvar today = new Date();\r\n\t\ttoday.setTime(today.getTime());\r\n\t\tif (expires) {\r\n\t\t\texpires = expires * 1000 * 60 * 60 * 24;\r\n\t\t}\r\n\t\tvar expires_date = new Date(today.getTime() + (expires));\r\n\t\tdocument.cookie = name + '=' + escape(value) +\r\n\t\t\t((expires) ? ';expires=' + expires_date.toGMTString() : '') + //expires.toGMTString()\r\n\t\t\t((path) ? ';path=' + path : '') +\r\n\t\t\t((domain) ? ';domain=' + domain : '') +\r\n\t\t\t((secure) ? ';secure' : '');\r\n\t};\r\n}\r\nif (!jslet.deleteCookie){\r\n\t/**\r\n\t * Delete specified cookie. Example:\r\n\t * <pre><code>\r\n\t * jslet.deleteCookie('name', '/', '.foo.com');\r\n\t * </code></pre>\r\n\t * \r\n\t * @param {String} name Cookie name\r\n\t * @param {String} name Cookie path\r\n\t * @param {String} name Cookie domain\r\n\t * \r\n\t */\r\n\tjslet.deleteCookie = function(name, path, domain) {\r\n\t\tif (getCookie(name)) document.cookie = name + '=' +\r\n\t\t\t((path) ? ';path=' + path : '') +\r\n\t\t\t((domain) ? ';domain=' + domain : '') +\r\n\t\t\t';expires=Thu, 01-Jan-1970 00:00:01 GMT';\r\n\t};\r\n}\r\n/* ========================================================================\r\n * Jslet framework: jslet.messagebus.js\r\n *\r\n * Copyright (c) 2014 Jslet Group(https://github.com/jslet/jslet/)\r\n * Licensed under MIT (https://github.com/jslet/jslet/LICENSE.txt)\r\n * ======================================================================== */\r\n\r\n/**\r\n* Message bus. Example:\r\n* <pre><code>\r\n*\tvar myCtrlObj = {\r\n*\t\tonReceiveMessage: function(messageName, messageBody){\r\n*\t\t\talert(messageBody.x);\r\n*\t\t}\r\n*\t}\r\n* \r\n*   //Subcribe a message from MessageBus\r\n*   jslet.messageBus.subcribe('MyMessage', myCtrlObj);\r\n*   \r\n*   //Unsubcribe a message from MessageBus\r\n*\tjslet.messageBus.unsubcribe('MyMessage', myCtrlObj);\r\n*\t\r\n*\t//Send a mesasge to MessageBus\r\n*\tjslet.messageBus.sendMessage('MyMessage', {x: 10, y:10});\r\n* \r\n* </code></pre>\r\n* \r\n*/\r\njslet.MessageBus = function () {\r\n\tvar _messages = {};\r\n\t//SizeChanged is predefined message\r\n\t_messages[jslet.MessageBus.SIZECHANGED] = [];\r\n\t\r\n\tvar _timeoutHandlers = [];\r\n\t/**\r\n\t * Send a message.\r\n\t * \r\n\t * @param {String} messageName Message name.\r\n\t * @param {Object} mesageBody Message body.\r\n\t */\r\n\tthis.sendMessage = function (messageName, messageBody, sender) {\r\n\t\tif(!_messages[messageName]) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar handler = _timeoutHandlers[messageName];\r\n\t\t\r\n\t\tif (handler){\r\n\t\t\twindow.clearTimeout(handler);\r\n\t\t}\r\n\t\thandler = setTimeout(function(){\r\n\t\t\t_timeoutHandlers[messageName] = null;\r\n\t\t\tvar ctrls = _messages[messageName], ctrl;\r\n\t\t\tfor(var i = 0, cnt = ctrls.length; i < cnt; i++){\r\n\t\t\t\tctrl = ctrls[i];\r\n\t\t\t\tif (ctrl && ctrl.onReceiveMessage){\r\n\t\t\t\t\tctrl.onReceiveMessage(messageName, messageBody);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}, 30);\r\n\t\t_timeoutHandlers[messageName] = handler;\r\n\t};\r\n\r\n\t/**\r\n\t* Subscribe a message.\r\n\t* \r\n\t* @param {String} messageName message name.\r\n\t* @param {Object} ctrlObj control object which need subscribe a message, \r\n\t*   there must be a function: onReceiveMessage in ctrlObj.\r\n\t*\tonReceiveMessage: function(messageName, messageBody){}\r\n\t*   //messageName: String, message name;\r\n\t*   //messageBody: Object, message body;\r\n\t*/\r\n\tthis.subscribe = function(messageName, ctrlObj){\r\n\t\tif (!messageName || !ctrlObj) {\r\n\t\t\tthrow new Error(\"MessageName and ctrlObj required!\");\r\n\t\t}\r\n\t\tvar ctrls = _messages[messageName];\r\n\t\tif (!ctrls){\r\n\t\t\tctrls = [];\r\n\t\t\t_messages[messageName] = ctrls;\r\n\t\t}\r\n\t\tctrls.push(ctrlObj);\r\n\t};\r\n\t\r\n\t/**\r\n\t * Subscribe a message.\r\n\t * \r\n\t * @param {String} messageName message name.\r\n\t * @param {Object} ctrlObj control object which need subscribe a message.\r\n\t */\r\n\tthis.unsubscribe = function(messageName, ctrlObj){\r\n\t\tvar ctrls = _messages[messageName];\r\n\t\tif (!ctrls) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar k = ctrls.indexOf(ctrlObj);\r\n\t\tif (k >= 0) {\r\n\t\t\tctrls.splice(k,1);\r\n\t\t}\r\n\t};\r\n};\r\n\r\njslet.MessageBus.SIZECHANGED = \"SIZECHANGED\";\r\n\r\njslet.messageBus = new jslet.MessageBus();\r\n\r\njQuery(window).on(\"resize\",function(){\r\n\tjslet.messageBus.sendMessage(jslet.MessageBus.SIZECHANGED, null, window);\r\n});\r\n\r\n/* ========================================================================\r\n * Jslet framework: jslet.contextrule.js\r\n *\r\n * Copyright (c) 2014 Jslet Group(https://github.com/jslet/jslet/)\r\n * Licensed under MIT (https://github.com/jslet/jslet/LICENSE.txt)\r\n * ======================================================================== */\r\n\r\njslet.data.ContextRule = function() {\r\n\tvar Z = this;\r\n\tZ._name = '';\r\n\tZ._description = '';\r\n\tZ._status = undefined;\r\n\tZ._condition = undefined;\r\n\tZ._rules = [];\r\n};\r\n\r\njslet.data.ContextRule.className = 'jslet.data.ContextRule';\r\n\r\njslet.data.ContextRule.prototype = {\r\n\tclassName: jslet.data.ContextRule.className,\r\n\t\r\n\tdataStatus: ['insert','update','other'],\r\n\t\r\n\tname: function(name) {\r\n\t\tif(name === undefined) {\r\n\t\t\treturn this._name;\r\n\t\t}\r\n\t\t\r\n\t\tjslet.Checker.test('ContextRule.name', name).isString();\r\n\t\tthis._name = jQuery.trim(name);\r\n\t\treturn this;\r\n\t},\r\n\r\n\tstatus: function(status) {\r\n\t\tif(status === undefined) {\r\n\t\t\treturn this._status;\r\n\t\t}\r\n\t\t\r\n\t\tjslet.Checker.test('ContextRule.status', status).isArray();\r\n\t\tif(status) {\r\n\t\t\tvar item, checker;\r\n\t\t\tfor(var i = 0, len = status.length; i < len; i++) {\r\n\t\t\t\titem = jQuery.trim(status[i]);\r\n\t\t\t\tchecker = jslet.Checker.test('ContextRule.status' + i, item).isString().required();\r\n\t\t\t\titem = item.toLowerCase();\r\n\t\t\t\tchecker.testValue(item).inArray(this.dataStatus);\r\n\t\t\t\tstatus[i] = item;\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis._status = status;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\tcondition: function(condition) {\r\n\t\tif(condition === undefined) {\r\n\t\t\treturn this._condition;\r\n\t\t}\r\n\t\t\r\n\t\tjslet.Checker.test('ContextRule.status', condition).isString();\r\n\t\tthis._condition = jQuery.trim(condition);\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\trules: function(rules) {\r\n\t\tif(rules === undefined) {\r\n\t\t\treturn this._rules;\r\n\t\t}\r\n\r\n\t\tjslet.Checker.test('ContextRule.rules', rules).isArray();\r\n\t\tthis._rules = rules;\r\n\t\treturn this;\r\n\t}\r\n};\r\n\r\njslet.data.ContextRuleItem = function(fldName) {\r\n\tvar Z = this;\r\n\tjslet.Checker.test('ContextRule.field', fldName).isString();\r\n\tfldName = jQuery.trim(fldName);\r\n\tjslet.Checker.test('ContextRule.field', fldName).required();\r\n\tZ._field = fldName;\r\n\t\r\n\tZ._meta = undefined;\r\n\tZ._value = undefined;\r\n\tZ._lookup = undefined;\r\n};\r\n\r\njslet.data.ContextRuleItem.className = 'jslet.data.ContextRuleItem';\r\n\r\njslet.data.ContextRuleItem.prototype = {\r\n\tclassName: jslet.data.ContextRuleItem.className,\r\n\t\r\n\tfield: function() {\r\n\t\treturn this._field;\r\n\t},\r\n\t\r\n\tmeta: function(meta) {\r\n\t\tif(meta === undefined) {\r\n\t\t\treturn this._meta;\r\n\t\t}\r\n\t\t\r\n\t\tjslet.Checker.test('ContextRuleItem.meta', meta).isClass(jslet.data.ContextRuleMeta.className);\r\n\t\tthis._meta = meta;\r\n\t\treturn this;\r\n\t},\r\n\r\n\tlookup: function(lookup) {\r\n\t\tif(lookup === undefined) {\r\n\t\t\treturn this._lookup;\r\n\t\t}\r\n\t\t\r\n\t\tjslet.Checker.test('ContextRuleItem.lookup', lookup).isClass(jslet.data.ContextRuleLookup.className);\r\n\t\tthis._lookup = lookup;\r\n\t\treturn this;\r\n\t},\r\n\r\n\tvalue: function(value) {\r\n\t\tif(value === undefined) {\r\n\t\t\treturn this._value;\r\n\t\t}\r\n\t\t\r\n\t\tthis._value = value;\r\n\t\treturn this;\r\n\t}\r\n};\r\n\r\njslet.data.ContextRuleMeta = function() {\r\n\tvar Z = this;\r\n\tZ._label = undefined;\r\n\tZ._tip = undefined;\r\n\tZ._nullText = undefined;\r\n\t\r\n\tZ._required = undefined;\r\n\tZ._disabled = undefined;\r\n\tZ._readOnly = undefined;\r\n\tZ._visible = undefined;\r\n\tZ._formula = undefined;\r\n\tZ._scale = undefined;\r\n\tZ._defaultValue = undefined;\r\n\tZ._displayFormat = undefined;\r\n\tZ._editMask = undefined;\r\n\tZ._editControl = undefined;\r\n\t\r\n\tZ._range = undefined;\r\n\tZ._regularExpr = undefined;\r\n\tZ._valueCountLimit = undefined;\r\n\tZ._validChars = undefined;\r\n\tZ._customValidator = undefined;\r\n};\r\n\r\njslet.data.ContextRuleMeta.className = 'jslet.data.ContextRuleMeta';\r\n\r\njslet.data.ContextRuleMeta.prototype = {\r\n\tclassName: jslet.data.ContextRuleMeta.className,\r\n\t\r\n\tproperties: ['label', 'tip','nullText', 'required','disabled','readOnly','visible',\r\n\t             'formula','scale','defaultValue','displayFormat','editMask','editControl',\r\n\t             'range','regularExpr','valueCountLimit','validChars','customValidator'],\r\n\t/**\r\n\t * Get or set field label.\r\n\t * \r\n\t * @param {String or undefined} label Field label.\r\n\t * @return {String or this}\r\n\t */\r\n\tlabel: function (label) {\r\n\t\tif (label === undefined) {\r\n\t\t\treturn this._label;\r\n\t\t}\r\n\t\tjslet.Checker.test('ContextRuleMeta.label', label).isString();\r\n\t\tthis._label = label;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set field tip.\r\n\t * \r\n\t * @param {String or undefined} tip Field tip.\r\n\t * @return {String or this}\r\n\t */\r\n\ttip: function(tip) {\r\n\t\tif (tip === undefined) {\r\n\t\t\treturn this._tip;\r\n\t\t}\r\n\t\tjslet.Checker.test('ContextRuleMeta.tip', tip).isString();\r\n\t\tthis._tip = tip;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set the display text if the field value is null.\r\n\t * \r\n\t * @param {String or undefined} nullText Field null text.\r\n\t * @return {String or this}\r\n\t */\r\n\tnullText: function (nullText) {\r\n\t\tif (nullText === undefined) {\r\n\t\t\treturn this._nullText;\r\n\t\t}\r\n\t\t\r\n\t\tjslet.Checker.test('ContextRuleMeta.nullText', nullText).isString();\r\n\t\tthis._nullText = jQuery.trim(nullText);\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get or set flag required.\r\n\t * \r\n\t * @param {Boolean or undefined} required Field is required or not.\r\n\t * @return {Boolean or this}\r\n\t */\r\n\trequired: function (required) {\r\n\t\tvar Z = this;\r\n\t\tif (required === undefined) {\r\n\t\t\treturn Z._required;\r\n\t\t}\r\n\t\tZ._required = required ? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get or set field is visible or not.\r\n\t * \r\n\t * @param {Boolean or undefined} visible Field is visible or not.\r\n\t * @return {Boolean or this}\r\n\t */\r\n\tvisible: function (visible) {\r\n\t\tvar Z = this;\r\n\t\tif (visible === undefined){\r\n\t\t\treturn Z._visible;\r\n\t\t}\r\n\t\tZ._visible = visible ? true: false;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set field is disabled or not.\r\n\t * \r\n\t * @param {Boolean or undefined} disabled Field is disabled or not.\r\n\t * @return {Boolean or this}\r\n\t */\r\n\tdisabled: function (disabled) {\r\n\t\tvar Z = this;\r\n\t\tif (disabled === undefined) {\r\n\t\t\treturn Z._disabled;\r\n\t\t}\r\n\t\tZ._disabled = disabled ? true: false;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set field is readOnly or not.\r\n\t * \r\n\t * @param {Boolean or undefined} readOnly Field is readOnly or not.\r\n\t * @return {Boolean or this}\r\n\t */\r\n\treadOnly: function (readOnly) {\r\n\t\tvar Z = this;\r\n\t\tif (readOnly === undefined){\r\n\t\t\treturn Z._readOnly;\r\n\t\t}\r\n\t\t\r\n\t\tZ._readOnly = readOnly? true: false;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set field edit mask.\r\n\t * \r\n\t * @param {jslet.data.EditMask or String or undefined} mask Field edit mask.\r\n\t * @return {jslet.data.EditMask or this}\r\n\t */\r\n\teditMask: function (mask) {\r\n\t\tvar Z = this;\r\n\t\tif (mask === undefined) {\r\n\t\t\treturn Z._editMask;\r\n\t\t}\r\n\t\tZ._editMask = mask;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get or set field decimal length.\r\n\t * \r\n\t * @param {Integer or undefined} scale Field decimal length.\r\n\t * @return {Integer or this}\r\n\t */\r\n\tscale: function (scale) {\r\n\t\tvar Z = this;\r\n\t\tif (scale === undefined) {\r\n\t\t\treturn Z._scale;\r\n\t\t}\r\n\t\tjslet.Checker.test('ContextRuleMeta.scale', scale).isNumber();\r\n\t\tZ._scale = parseInt(scale);\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get or set field formula. Example: \r\n\t * <pre><code>\r\n\t *  obj.formula('[price]*[num]');\r\n\t * </code></pre>\r\n\t * \r\n\t * @param {String or undefined} formula Field formula.\r\n\t * @return {String or this}\r\n\t */\r\n\tformula: function (formula) {\r\n\t\tvar Z = this;\r\n\t\tif (formula === undefined) {\r\n\t\t\treturn Z._formula;\r\n\t\t}\r\n\t\t\r\n\t\tjslet.Checker.test('ContextRuleMeta.formula', formula).isString();\r\n\t\tZ._formula = jQuery.trim(formula);\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set field display format.\r\n\t * For number field like: #,##0.00\r\n\t * For date field like: yyyy/MM/dd\r\n\t * \r\n\t * @param {String or undefined} format Field display format.\r\n\t * @return {String or this}\r\n\t */\r\n\tdisplayFormat: function (format) {\r\n\t\tvar Z = this;\r\n\t\tif (format === undefined) {\r\n\t\t\treturn Z._displayFormat;\r\n\t\t}\r\n\t\t\r\n\t\tjslet.Checker.test('ContextRuleMeta.format', format).isString();\r\n\t\tZ._displayFormat = jQuery.trim(format);\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set field edit control. It is similar as DBControl configuration.\r\n\t * Here you need not set 'dataset' and 'field' property.   \r\n\t * Example:\r\n\t * <pre><code>\r\n\t * //Normal DBControl configuration\r\n\t * //var normalCtrlCfg = {type:\"DBSpinEdit\",dataset:\"employee\",field:\"age\",minValue:10,maxValue:100,step:5};\r\n\t * \r\n\t * var editCtrlCfg = {type:\"DBSpinEdit\",minValue:10,maxValue:100,step:5};\r\n\t * fldObj.displayControl(editCtrlCfg);\r\n\t * </code></pre>\r\n\t * \r\n\t * @param {DBControl Config or String} editCtrl If String, it will convert to DBControl Config.\r\n\t * @return {DBControl Config or this}\r\n\t */\r\n\teditControl: function (editCtrl) {\r\n\t\tvar Z = this;\r\n\t\tif (editCtrl=== undefined){\r\n\t\t\treturn Z._editControl;\r\n\t\t}\r\n\r\n\t\tZ._editControl = (typeof (editCtrl) === 'string') ? { type: editCtrl } : editCtrl;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set field default value.\r\n\t * The data type of default value must be same as Field's.\r\n\t * Example:\r\n\t *   Number field: fldObj.defauleValue(100);\r\n\t *   Date field: fldObj.defaultValue(new Date());\r\n\t *   String field: fldObj.defaultValue('test');\r\n\t * \r\n\t * @param {Object or undefined} dftValue Field default value.\r\n\t * @return {Object or this}\r\n\t */\r\n\tdefaultValue: function (dftValue) {\r\n\t\tvar Z = this;\r\n\t\tif (dftValue === undefined) {\r\n\t\t\treturn Z._defaultValue;\r\n\t\t}\r\n\t\tZ._defaultValue = dftValue;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get or set field rang.\r\n\t * Range is an object as: {min: x, max: y}. Example:\r\n\t * <pre><code>\r\n\t * //For String field\r\n\t *\tvar range = {min: 'a', max: 'z'};\r\n\t *  //For Date field\r\n\t *\tvar range = {min: new Date(2000,1,1), max: new Date(2010,12,31)};\r\n\t *  //For Number field\r\n\t *\tvar range = {min: 0, max: 100};\r\n\t *  fldObj.range(range);\r\n\t * </code></pre>\r\n\t * \r\n\t * @param {Range or Json String} range Field range;\r\n\t * @return {Range or this}\r\n\t */\r\n\trange: function (range) {\r\n\t\tvar Z = this;\r\n\t\tif (range === undefined) {\r\n\t\t\treturn Z._range;\r\n\t\t}\r\n\t\tif (jslet.isString(range)) {\r\n\t\t\tZ._range = new Function('return ' + range);\r\n\t\t} else {\r\n\t\t\tZ._range = range;\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set regular expression.\r\n\t * You can specify your own validator with regular expression. If regular expression not specified, \r\n\t * The default regular expression for Date and Number field will be used. Example:\r\n\t * <pre><code>\r\n\t * fldObj.regularExpr(/(\\(\\d{3,4}\\)|\\d{3,4}-|\\s)?\\d{8}/ig, 'Invalid phone number!');//like: 0755-12345678\r\n\t * </code></pre>\r\n\t * \r\n\t * @param {String or JSON object} expr Regular expression, format: {expr: xxx, message: yyy};\r\n\t * @return {Object} An object like: { expr: expr, message: message }\r\n\t */\r\n\tregularExpr: function (regularExpr) {\r\n\t\tvar Z = this;\r\n\t\tif (regularExpr === undefined){\r\n\t\t\treturn Z._regularExpr;\r\n\t\t}\r\n\t\t\r\n\t\tif (jslet.isString(regularExpr)) {\r\n\t\t\tZ._range = new Function('return ' + regularExpr);\r\n\t\t} else {\r\n\t\t\tZ._regularExpr = regularExpr;\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get or set allowed count when valueStyle is multiple.\r\n\t * \r\n\t * @param {String or undefined} count.\r\n\t * @return {String or this}\r\n\t */\r\n\tvalueCountLimit: function (count) {\r\n\t\tvar Z = this;\r\n\t\tif (count === undefined) {\r\n\t\t\treturn Z._valueCountLimit;\r\n\t\t}\r\n\t\tjslet.Checker.test('ContextRuleMeta.valueCountLimit', count).isNumber();\r\n\t\tZ._valueCountLimit = parseInt(count);\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set customized validator.\r\n\t * \r\n\t * @param {Function} validator Validator function.\r\n\t * Pattern:\r\n\t *   function(fieldObj, fldValue){}\r\n\t *   //fieldObj: jslet.data.Field, Field object\r\n\t *   //fldValue: Object, Field value\r\n\t *   //return: String, if validate failed, return error message, otherwise return null; \r\n\t */\r\n\tcustomValidator: function (validator) {\r\n\t\tvar Z = this;\r\n\t\tif (validator === undefined) {\r\n\t\t\treturn Z._customValidator;\r\n\t\t}\r\n\t\tjslet.Checker.test('ContextRuleMeta.customValidator', validator).isFunction();\r\n\t\tZ._customValidator = validator;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Valid characters for this field.\r\n\t */\r\n\tvalidChars: function(chars){\r\n\t\tvar Z = this;\r\n\t\tif (chars === undefined){\r\n\t\t\treturn Z._validChars;\r\n\t\t}\r\n\t\t\r\n\t\tjslet.Checker.test('ContextRuleMeta.validChars', chars).isString();\r\n\t\tZ._validChars = jQuery.trim(chars);\r\n\t}\r\n\t\r\n};\r\n\r\njslet.data.ContextRuleLookup = function() {\r\n\tvar Z = this;\r\n\tZ._dataset = undefined;\r\n\tZ._filter = undefined;\r\n\tZ._fixedFilter = undefined;\r\n\tZ._criteria = undefined;\r\n\tZ._displayFields = undefined;\r\n\tZ._onlyLeafLevel = undefined;\r\n};\r\n\r\njslet.data.ContextRuleLookup.className = 'jslet.data.ContextRuleLookup';\r\n\r\njslet.data.ContextRuleLookup.prototype ={\r\n\tclassName: jslet.data.ContextRuleLookup.className,\r\n\t\r\n\tproperties: ['dataset', 'filter', 'fixedFilter', 'criteria', 'displayFields', 'onlyLeafLevel'],\r\n\t\r\n\tdataset: function(datasetName){\r\n\t\tvar Z = this;\r\n\t\tif (datasetName === undefined){\r\n\t\t\treturn Z._dataset;\r\n\t\t}\r\n\t\tjslet.Checker.test('ContextRuleLookup.dataset', datasetName).isString();\r\n\t\tZ._dataset = jQuery.trim(datasetName);\r\n\t},\r\n\r\n\tfilter: function(filter){\r\n\t\tvar Z = this;\r\n\t\tif (filter === undefined){\r\n\t\t\treturn Z._filter;\r\n\t\t}\r\n\t\tjslet.Checker.test('ContextRuleLookup.filter', filter).isString();\r\n\t\tZ._filter = jQuery.trim(filter);\r\n\t},\r\n\r\n\tfixedFilter: function(fixedFilter){\r\n\t\tvar Z = this;\r\n\t\tif (fixedFilter === undefined){\r\n\t\t\treturn Z._fixedFilter;\r\n\t\t}\r\n\t\tjslet.Checker.test('ContextRuleLookup.fixedFilter', fixedFilter).isString();\r\n\t\tZ._fixedFilter = jQuery.trim(fixedFilter);\r\n\t},\r\n\r\n\tcriteria: function(criteria){\r\n\t\tvar Z = this;\r\n\t\tif (criteria === undefined){\r\n\t\t\treturn Z._criteria;\r\n\t\t}\r\n\t\tjslet.Checker.test('ContextRuleLookup.criteria', criteria).isString();\r\n\t\tZ._criteria = jQuery.trim(criteria);\r\n\t},\r\n\r\n\tdisplayFields: function(displayFields){\r\n\t\tvar Z = this;\r\n\t\tif (displayFields === undefined){\r\n\t\t\treturn Z._displayFields;\r\n\t\t}\r\n\t\tjslet.Checker.test('ContextRuleLookup.displayFields', displayFields).isString();\r\n\t\tZ._displayFields = jQuery.trim(displayFields);\r\n\t},\r\n\r\n\tonlyLeafLevel: function(onlyLeafLevel){\r\n\t\tvar Z = this;\r\n\t\tif (onlyLeafLevel === undefined){\r\n\t\t\treturn Z._onlyLeafLevel;\r\n\t\t}\r\n\t\tZ._onlyLeafLevel = onlyLeafLevel ? true: false;\r\n\t}\r\n};\r\n\r\njslet.data.createContextRule = function(cxtRuleCfg) {\r\n\tif(!cxtRuleCfg) {\r\n\t\treturn null;\r\n\t}\r\n\tvar ruleObj = new jslet.data.ContextRule();\r\n\tif(cxtRuleCfg.status !== undefined) {\r\n\t\truleObj.status(cxtRuleCfg.status);\r\n\t}\r\n\tif(cxtRuleCfg.condition !== undefined) {\r\n\t\truleObj.condition(cxtRuleCfg.condition);\r\n\t}\r\n\tif(cxtRuleCfg.rules !== undefined) {\r\n\t\tjslet.Checker.test('ContextRule.rules', rules).isArray();\r\n\t\tvar rules = [];\r\n\t\truleObj.rules(rules);\r\n\t\tfor(var i = 0, len = cxtRuleCfg.rules.length; i < len; i++) {\r\n\t\t\trules.push(createContextRuleItem(cxtRuleCfg.rules[i]));\r\n\t\t}\r\n\t}\r\n\t\r\n\tfunction createContextRuleItem(itemCfg) {\r\n\t\tvar item = new jslet.data.ContextRuleItem(itemCfg.field);\r\n\t\tif(itemCfg.meta !== undefined) {\r\n\t\t\titem.meta(createContextRuleMeta(itemCfg.meta));\r\n\t\t}\r\n\t\t\r\n\t\tif(itemCfg.value !== undefined) {\r\n\t\t\titem.value(itemCfg.value);\r\n\t\t}\r\n\t\t\r\n\t\tif(itemCfg.lookup !== undefined) {\r\n\t\t\titem.lookup(createContextRuleLookup(itemCfg.lookup));\r\n\t\t}\r\n\t\treturn item;\r\n\t}\r\n\t\r\n\tfunction createContextRuleMeta(metaCfg) {\r\n\t\tvar meta = new jslet.data.ContextRuleMeta();\r\n\t\tif(metaCfg.label !== undefined) {\r\n\t\t\tmeta.label(metaCfg.label);\r\n\t\t}\r\n\t\t\r\n\t\tif(metaCfg.tip !== undefined) {\r\n\t\t\tmeta.tip(metaCfg.tip);\r\n\t\t}\r\n\t\t\r\n\t\tif(metaCfg.nullText !== undefined) {\r\n\t\t\tmeta.nullText(metaCfg.nullText);\r\n\t\t}\r\n\t\t\r\n\t\tif(metaCfg.required !== undefined) {\r\n\t\t\tmeta.required(metaCfg.required);\r\n\t\t}\r\n\t\t\r\n\t\tif(metaCfg.disabled !== undefined) {\r\n\t\t\tmeta.disabled(metaCfg.disabled);\r\n\t\t}\r\n\t\t\r\n\t\tif(metaCfg.readOnly !== undefined) {\r\n\t\t\tmeta.readOnly(metaCfg.readOnly);\r\n\t\t}\r\n\t\t\r\n\t\tif(metaCfg.visible !== undefined) {\r\n\t\t\tmeta.visible(metaCfg.visible);\r\n\t\t}\r\n\t\t\r\n\t\tif(metaCfg.formula !== undefined) {\r\n\t\t\tmeta.formula(metaCfg.formula);\r\n\t\t}\r\n\t\t\r\n\t\tif(metaCfg.scale !== undefined) {\r\n\t\t\tmeta.scale(metaCfg.scale);\r\n\t\t}\r\n\t\t\r\n\t\tif(metaCfg.required !== undefined) {\r\n\t\t\tmeta.required(metaCfg.required);\r\n\t\t}\r\n\t\t\r\n\t\tif(metaCfg.displayFormat !== undefined) {\r\n\t\t\tmeta.displayFormat(metaCfg.displayFormat);\r\n\t\t}\r\n\t\t\r\n\t\tif(metaCfg.editMask !== undefined) {\r\n\t\t\tmeta.editMask(metaCfg.editMask);\r\n\t\t}\r\n\t\t\r\n\t\tif(metaCfg.editControl !== undefined) {\r\n\t\t\tmeta.editControl(metaCfg.editControl);\r\n\t\t}\r\n\t\t\r\n\t\tif(metaCfg.range !== undefined) {\r\n\t\t\tmeta.range(metaCfg.range);\r\n\t\t}\r\n\t\t\r\n\t\tif(metaCfg.regularExpr !== undefined) {\r\n\t\t\tmeta.regularExpr(metaCfg.regularExpr);\r\n\t\t}\r\n\t\t\r\n\t\tif(metaCfg.valueCountLimit !== undefined) {\r\n\t\t\tmeta.valueCountLimit(metaCfg.valueCountLimit);\r\n\t\t}\r\n\t\t\r\n\t\tif(metaCfg.validChars !== undefined) {\r\n\t\t\tmeta.validChars(metaCfg.validChars);\r\n\t\t}\r\n\t\t\r\n\t\tif(metaCfg.customValidator !== undefined) {\r\n\t\t\tmeta.customValidator(metaCfg.customValidator);\r\n\t\t}\r\n\t\t\r\n\t\treturn meta;\r\n\t}\r\n\r\n\tfunction createContextRuleLookup(lookupCfg) {\r\n\t\tvar lookup = new jslet.data.ContextRuleLookup();\r\n\t\tif(lookupCfg.dataset !== undefined) {\r\n\t\t\tlookup.dataset(lookupCfg.dataset);\r\n\t\t}\r\n\t\t\r\n\t\tif(lookupCfg.filter !== undefined) {\r\n\t\t\tlookup.filter(lookupCfg.filter);\r\n\t\t}\r\n\t\t\r\n\t\tif(lookupCfg.fixedFilter !== undefined) {\r\n\t\t\tlookup.fixedFilter(lookupCfg.fixedFilter);\r\n\t\t}\r\n\t\t\r\n\t\tif(lookupCfg.criteria !== undefined) {\r\n\t\t\tlookup.criteria(lookupCfg.criteria);\r\n\t\t}\r\n\t\t\r\n\t\tif(lookupCfg.displayFields !== undefined) {\r\n\t\t\tlookup.displayFields(lookupCfg.displayFields);\r\n\t\t}\r\n\t\t\r\n\t\tif(lookupCfg.onlyLeafLevel !== undefined) {\r\n\t\t\tlookup.onlyLeafLevel(lookupCfg.onlyLeafLevel);\r\n\t\t}\r\n\t\t\r\n\t\treturn lookup;\r\n\t}\r\n\treturn ruleObj;\r\n};\r\n\r\njslet.data.ContextRuleEngine = function(dataset) {\r\n\tthis._dataset = dataset;\r\n\tthis._matchedRules = [];\r\n\tthis._ruleEnv = {};\r\n};\r\n\r\njslet.data.ContextRuleEngine.prototype = {\r\n\r\n\tcompile: function() {\r\n\t\tvar contextRules = this._dataset.contextRules();\r\n\t\tfor(var i = 0, len = contextRules.length; i < len; i++) {\r\n\t\t\tthis._compileOneRule(contextRules[i]);\r\n\t\t}\r\n\t},\r\n\r\n\tevalStatus: function() {\r\n\t\tvar contextRules = this._dataset.contextRules(),\r\n\t\t\tstatus = 'other', \r\n\t\t\tdsStatus = this._dataset.changedStatus();\r\n\t\tif(dsStatus == jslet.data.DataSetStatus.INSERT) {\r\n\t\t\tstatus = 'insert';\r\n\t\t} else if(dsStatus == jslet.data.DataSetStatus.UPDATE) {\r\n\t\t\tstatus = 'update';\r\n\t\t}\r\n\r\n\t\tthis._matchedRules = [];\r\n\t\tvar ruleObj, ruleStatus;\r\n\t\tfor(var i = 0, len = contextRules.length; i < len; i++) {\r\n\t\t\truleObj = contextRules[i];\r\n\t\t\truleStatus = ruleObj.status();\r\n\t\t\tif(ruleStatus && ruleStatus.indexOf(status) >= 0) {\r\n\t\t\t\tthis._evalRuleItems(ruleObj.rules(), status == 'insert' || status == 'update');\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis._syncMatchedRules();\r\n\t},\r\n\t\r\n\tevalRule: function(changingFldName){\r\n\t\tvar contextRules = this._dataset.contextRules();\r\n\t\tvar ruleObj;\r\n\t\tthis._matchedRules = [];\r\n\t\tthis._ruleEnv = {};\r\n\t\tfor(var i = 0, len = contextRules.length; i < len; i++) {\r\n\t\t\truleObj = contextRules[i];\r\n\t\t\tif(!ruleObj.status()) {\r\n\t\t\t\tthis._evalOneRule(ruleObj, changingFldName);\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis._syncMatchedRules();\r\n\t},\r\n\t\r\n\t_compileOneRule: function(ruleObj) {\r\n\t\tvar condition = ruleObj.condition;\r\n\t\tthis._compileExpr(ruleObj, 'condition', true);\r\n\t\tvar rules = ruleObj.rules();\r\n\t\tfor(var i = 0, len = rules.length; i < len; i++) {\r\n\t\t\tthis._compileRuleItem(rules[i]);\r\n\t\t}\r\n\t},\r\n\t\r\n\t_compileRuleItem: function(ruleItem) {\r\n\t\tthis._compileExpr(ruleItem, 'value');\r\n\t\tvar metaObj = ruleItem.meta();\r\n\t\tvar props, propName, i, len;\r\n\t\tif(metaObj) {\r\n\t\t\tprops = metaObj.properties;\r\n\t\t\tlen = props.length;\r\n\t\t\tfor(i = 0; i < len; i++) {\r\n\t\t\t\tpropName = props[i];\r\n\t\t\t\tthis._compileExpr(metaObj, propName);\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar lookupObj = ruleItem.lookup();\r\n\t\tif(lookupObj) {\r\n\t\t\tprops = lookupObj.properties;\r\n\t\t\tlen = props.length;\r\n\t\t\tfor(i = 0; i < len; i++) {\r\n\t\t\t\tpropName = props[i];\r\n\t\t\t\tthis._compileExpr(lookupObj, propName);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\t_compileExpr: function(itemObj, propName, isExpr) {\r\n\t\tvar setting = itemObj[propName].call(itemObj),\r\n\t\t\texprName = propName +'Expr';\r\n\t\t\r\n\t\tif(setting !== null && setting !== undefined && jslet.isString(setting)) {\r\n\t\t\tif(setting.indexOf('expr:') === 0) {\r\n\t\t\t\tsetting = setting.substring(5);\r\n\t\t\t\tisExpr = true;\r\n\t\t\t}\r\n\t\t\tif(isExpr) {\r\n\t\t\t\titemObj[exprName] = new jslet.Expression(this._dataset, setting);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\t_evalOneRule: function(ruleObj, changingFldName) {\r\n\t\tvar matched = false;\r\n\t\tvar exprObj = ruleObj.conditionExpr;\r\n\t\tvar mainFields = null;\r\n\t\tif(exprObj) {\r\n\t\t\tmainFields = exprObj.mainFields();\r\n\t\t\tif(changingFldName) {\r\n\t\t\t\tif(mainFields && mainFields.indexOf(changingFldName) < 0) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tmatched = ruleObj.conditionExpr.eval();\r\n\t\t} else {\r\n\t\t\tmatched = ruleObj.condition();\r\n\t\t}\r\n\t\tif(matched) {\r\n\t\t\tvar ruleEnv = null;\r\n\t\t\tif(mainFields) {\r\n\t\t\t\tvar fldName;\r\n\t\t\t\tfor(var i = 0, len = mainFields.length; i < len; i++) {\r\n\t\t\t\t\tfldName = mainFields[i];\r\n\t\t\t\t\tif(this._ruleEnv[fldName] === undefined) {\r\n\t\t\t\t\t\tthis._ruleEnv[fldName] = this._dataset.getFieldValue(fldName);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis._evalRuleItems(ruleObj.rules(), changingFldName? true: false)\r\n\t\t}\r\n\t},\r\n\t\r\n\t_evalRuleItems: function(rules, isValueChanged) {\r\n\t\tvar fldName, ruleItem, matchedRule;\r\n\t\tfor(var i = 0, len = rules.length; i < len; i++) {\r\n\t\t\truleItem = rules[i];\r\n\t\t\tfldName = ruleItem.field();\r\n\t\t\tmatchedRule = this._findMatchedRule(fldName);\r\n\t\t\tif(!matchedRule) {\r\n\t\t\t\tmatchedRule = new jslet.data.ContextRuleItem(fldName);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tvar meta = ruleItem.meta(); \r\n\t\t\tif(meta) {\r\n\t\t\t\tmatchedRule.meta(new jslet.data.ContextRuleMeta());\r\n\t\t\t\tthis._copyProperties(meta, matchedRule.meta());\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tvar lookup = ruleItem.lookup(); \r\n\t\t\tif(lookup) {\r\n\t\t\t\tmatchedRule.lookup(new jslet.data.ContextRuleLookup());\r\n\t\t\t\tthis._copyProperties(lookup, matchedRule.lookup());\r\n\t\t\t}\r\n\r\n\t\t\tif(isValueChanged && ruleItem.value() !== undefined) {\r\n\t\t\t\tmatchedRule.value(this._evalExpr(ruleItem, 'value'));\r\n\t\t\t}\r\n\t\t\tthis._matchedRules.push(matchedRule);\r\n\t\t}\r\n\t},\r\n\t\r\n\t_copyProperties: function(srcObject, descObject) {\r\n\t\tvar props = srcObject.properties, propName, propValue;\r\n\t\tfor(var i = 0, len = props.length; i < len; i++) {\r\n\t\t\tpropName = props[i];\r\n\t\t\tpropValue = this._evalExpr(srcObject, propName);\r\n\t\t\tif(propValue !== undefined) {\r\n\t\t\t\tdescObject[propName].call(descObject, propValue);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\t_evalExpr: function(evalObj, propName) {\r\n\t\tvar exprObj = evalObj[propName + 'Expr'];\r\n\t\tif(exprObj) {\r\n\t\t\treturn exprObj.eval();\r\n\t\t} else {\r\n\t\t\treturn evalObj[propName].call(evalObj);\r\n\t\t}\r\n\t},\r\n\t\r\n\t_findMatchedRule: function(fldName) {\r\n\t\tvar item;\r\n\t\tfor(var i = 0, len = this._matchedRules.length; i < len; i++) {\r\n\t\t\titem = this._matchedRules[i];\r\n\t\t\tif(fldName == item.field()) {\r\n\t\t\t\treturn item;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t},\r\n\t\r\n\t_syncMatchedRules: function() {\r\n\t\tvar matchedRules = this._matchedRules,\r\n\t\t\truleObj, fldName, fldObj;\r\n\t\t\r\n\t\tfor(var i = 0, len = matchedRules.length; i < len; i++) {\r\n\t\t\truleObj = matchedRules[i];\r\n\t\t\tfldName = ruleObj.field();\r\n\t\t\tfldObj = this._dataset.getField(fldName);\r\n\t\t\tif(fldObj) {\r\n\t\t\t\tthis._syncMatchedRuleMeta(fldObj, ruleObj.meta());\r\n\t\t\t\tthis._syncMatchedRuleLookup(fldObj, ruleObj.lookup());\r\n\t\t\t\tthis._syncMatchedRuleValue(fldObj, ruleObj.value());\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\t_syncMatchedRuleMeta: function(fldObj, ruleMeta) {\r\n\t\tif(!ruleMeta) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar props = ruleMeta.properties, \r\n\t\t\tpropName, propValue;\r\n\t\tfor(var i = 0, len = props.length; i < len; i++) {\r\n\t\t\tpropName = props[i];\r\n\t\t\tpropValue = ruleMeta[propName].call(ruleMeta);\r\n\t\t\tif(propValue !== undefined) {\r\n\t\t\t\tfldObj[propName].call(fldObj, propValue);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\t_syncMatchedRuleLookup: function(fldObj, ruleLookup) {\r\n\t\tif(!ruleLookup) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar fieldLookup = fldObj.lookup();\r\n\t\tif(!fieldLookup) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar ruleDs = ruleLookup.dataset();\r\n\t\tif(ruleDs) {\r\n\t\t\tfieldLookup.dataset(ruleDs);\r\n\t\t}\r\n\t\tvar lkDsObj = fieldLookup.dataset();\r\n\t\tlkDsObj.autoRefreshHostDataset(true);\r\n\t\tvar ruleFilter = ruleLookup.filter();\r\n\t\tif(ruleFilter !== undefined) {\r\n\t\t\tfor(var fldName in this._ruleEnv) {\r\n\t\t\t\truleFilter = ruleFilter.replace('${' + fldName + '}', this._ruleEnv[fldName]);\r\n\t\t\t}\r\n\t\t\tlkDsObj.filter(ruleFilter);\r\n\t\t\tlkDsObj.filtered(true);\r\n\t\t}\r\n\t\tvar ruleFilter = ruleLookup.fixedFilter();\r\n\t\tif(ruleFilter !== undefined) {\r\n\t\t\tfor(var fldName in this._ruleEnv) {\r\n\t\t\t\truleFilter = ruleFilter.replace('${' + fldName + '}', this._ruleEnv[fldName]);\r\n\t\t\t}\r\n\t\t\tlkDsObj.fixedFilter(ruleFilter);\r\n\t\t\tlkDsObj.filtered(true);\r\n\t\t}\r\n\t\tvar ruleCriteria = ruleLookup.criteria();\r\n\t\tif(ruleCriteria !== undefined) {\r\n\t\t\tlkDsObj.query(ruleCriteria);\r\n\t\t}\r\n\t\tvar ruleDisplayFields = ruleLookup.displayFields();\r\n\t\tif(ruleDisplayFields !== undefined) {\r\n\t\t\tfieldLookup.displayFields(ruleDisplayFields);\r\n\t\t}\r\n\t\tvar ruleOnlyLeafLevel = ruleLookup.onlyLeafLevel();\r\n\t\tif(ruleOnlyLeafLevel !== undefined) {\r\n\t\t\tfieldLookup.onlyLeafLevel(ruleOnlyLeafLevel);\r\n\t\t}\r\n\t},\r\n\t\r\n\t_syncMatchedRuleValue: function(fldObj, value) {\r\n\t\tif(value !== undefined) {\r\n\t\t\tfldObj.setValue(value);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/* ========================================================================\r\n * Jslet framework: jslet.datacommon.js\r\n *\r\n * Copyright (c) 2014 Jslet Group(https://github.com/jslet/jslet/)\r\n * Licensed under MIT (https://github.com/jslet/jslet/LICENSE.txt)\r\n * ======================================================================== */\r\n\r\n/**\r\n * keep all dataset object,\r\n * key for dataset name, value for dataset object\r\n */\r\n\r\njslet.data.dataModule = new jslet.SimpleMap();\r\n/**\r\n * Get dataset object with dataset name.\r\n * \r\n * @param {String} dsName dataset name;\r\n * @return {jslet.data.Dataset} Dataset object.\r\n */\r\njslet.data.getDataset = function (dsName) {\r\n\treturn jslet.data.dataModule.get(dsName);\r\n};\r\n\r\njslet.data.DatasetType = {\r\n\tNORMAL: 0, //Normal dataset\r\n\tLOOKUP: 1, //Lookup dataset\r\n\tDETAIL: 2  //Detail dataset\t \r\n};\r\n\r\njslet.data.onCreatingDataset = function(dsName, dsCatalog, realDsName, hostDatasetName) { };\r\n\r\n\r\njslet.data.DataType = {\r\n\tNUMBER: 'N', //Number\r\n\tSTRING: 'S', //String\r\n\tDATE: 'D',  //Date\r\n\tTIME: 'T',  //Time\r\n\tBOOLEAN: 'B', //Boolean\r\n\tDATASET: 'V', //Dataset field\r\n\tCROSS: 'C'   //Cross Field\r\n};\r\n\r\njslet.data.FieldValueStyle = {\r\n\tNORMAL: 0,\t//Single value\r\n\tBETWEEN: 1, //Between style value\r\n\tMULTIPLE: 2 //Multile value\r\n};\r\n\r\n/**\r\n * @class Edit Mask \r\n */\r\njslet.data.EditMask = function(mask, keepChar, transform){\r\n\t/**\r\n\t * {String} Mask String, rule:\r\n\t *  '#': char set: 0-9 and -, not required\r\n\t *  '0': char set: 0-9, required\r\n\t *  '9': char set: 0-9, not required\r\n\t *  'L': char set: A-Z,a-z, required\r\n\t *  'l': char set: A-Z,a-z, not required\r\n\t *  'A': char set: 0-9,a-z,A-Z, required\r\n\t *  'a': char set: 0-9,a-z,A-Z, not required\r\n\t *  'C': char set: any char, required\r\n\t *  'c': char set: any char, not required\r\n\t */\r\n\tthis.mask = mask; \r\n\t/**\r\n\t * {Boolean} keepChar Keep the literal character or not\r\n\t */\r\n\tthis.keepChar = (keepChar !== undefined ? keepChar: true);\r\n\t/**\r\n\t * {String} transform Transform character into UpperCase or LowerCase,\r\n\t *  optional value: upper, lower or null.\r\n\t */\r\n\tthis.transform = transform;\r\n\t\r\n\tthis.clone = function(){\r\n\t\treturn new jslet.data.EditMask(this.mask, this.keepChar, this.transform);\r\n\t};\r\n};\r\n\r\njslet.data.DatasetEvent = {\r\n\tBEFORESCROLL: 'beforeScroll',\r\n\tAFTERSCROLL: 'afterScroll',\r\n\t\r\n\tBEFOREINSERT: 'beforeInsert',\r\n\tAFTERINSERT: 'afterInsert',\r\n\t\r\n\tBEFOREUPDATE: 'beforeUpdate',\r\n\tAFTERUPDATE: 'afterUpdate',\r\n\t\r\n\tBEFOREDELETE: 'beforeDelete',\r\n\tAFTERDELETE: 'afterDelete',\r\n\t\r\n\tBEFORECONFIRM: 'beforeConfirm',\r\n\tAFTERCONFIRM: 'afterConfirm',\r\n\t\r\n\tBEFORECANCEL: 'beforeCancel',\r\n\tAFTERCANCEL: 'afterCancel',\r\n\t\r\n\tBEFORESELECT: 'beforeSelect',\r\n\tAFTERSELECT: 'afterSelect'\r\n};\r\n\r\njslet.data.DataSetStatus = {BROWSE:0, INSERT: 1, UPDATE: 2, DELETE: 3};\r\n\r\njslet.data.RefreshEvent = {\r\n\tupdateRecordEvent: function(fldName) {\r\n\t\treturn {eventType: jslet.data.RefreshEvent.UPDATERECORD, fieldName: fldName};\r\n\t},\r\n\t\r\n\tupdateColumnEvent: function(fldName) {\r\n\t\treturn {eventType: jslet.data.RefreshEvent.UPDATECOLUMN, fieldName: fldName};\r\n\t},\r\n\t\r\n\tupdateAllEvent: function() {\r\n\t\treturn this._updateAllEvent;\r\n\t},\r\n\t\r\n\tchangeMetaEvent: function(metaName, fieldName, changeAllRows) {\r\n\t\tvar result = {eventType: jslet.data.RefreshEvent.CHANGEMETA, metaName: metaName, fieldName: fieldName};\r\n\t\tif(changeAllRows !== undefined) {\r\n\t\t\tresult.changeAllRows = changeAllRows;\r\n\t\t}\r\n\t\treturn result;\r\n\t},\r\n\t\r\n\tbeforeScrollEvent: function(recno) {\r\n\t\treturn {eventType: jslet.data.RefreshEvent.BEFORESCROLL, recno: recno};\r\n\t},\r\n\t\r\n\tscrollEvent: function(recno, prevRecno) {\r\n\t\treturn {eventType: jslet.data.RefreshEvent.SCROLL, prevRecno: prevRecno, recno: recno};\r\n\t},\r\n\t\r\n\tinsertEvent: function(prevRecno, recno, needUpdateAll) {\r\n\t\treturn {eventType: jslet.data.RefreshEvent.INSERT, prevRecno: prevRecno, recno: recno, updateAll: needUpdateAll};\r\n\t},\r\n\t\r\n\tdeleteEvent: function(recno) {\r\n\t\treturn {eventType: jslet.data.RefreshEvent.DELETE, recno: recno};\r\n\t},\r\n\t\r\n\tselectRecordEvent: function(recno, selected) {\r\n\t\treturn {eventType: jslet.data.RefreshEvent.SELECTRECORD, recno: recno, selected: selected};\r\n\t},\r\n\t\r\n\tselectAllEvent: function(selected) {\r\n\t\treturn {eventType: jslet.data.RefreshEvent.SELECTALL, selected: selected};\r\n\t},\r\n\t\r\n\tchangePageEvent: function() {\r\n\t\treturn this._changePageEvent;\r\n\t},\r\n\t\r\n\terrorEvent: function(errMessage) {\r\n\t\treturn {eventType: jslet.data.RefreshEvent.ERROR, message: errMessage};\r\n\t},\r\n\t\r\n\tlookupEvent: function(fieldName, recno) {\r\n\t\treturn {eventType: jslet.data.RefreshEvent.UPDATELOOKUP, fieldName: fieldName, recno: recno};\r\n\t},\r\n\t\r\n\taggradedEvent: function() {\r\n\t\treturn {eventType: jslet.data.RefreshEvent.AGGRADED};\t\t\r\n\t}\r\n};\r\n\r\njslet.data.RefreshEvent.CHANGEMETA = 'changeMeta';// fieldname, metatype(title, readonly,disabled,format)\r\njslet.data.RefreshEvent.UPDATEALL = 'updateAll';\r\njslet.data.RefreshEvent.UPDATERECORD = 'updateRecord';// fieldname\r\njslet.data.RefreshEvent.UPDATECOLUMN = 'updateColumn';// fieldname\r\njslet.data.RefreshEvent.BEFORESCROLL = 'beforescroll';\r\njslet.data.RefreshEvent.SCROLL = 'scroll';// preRecno, recno\r\n\r\njslet.data.RefreshEvent.SELECTRECORD = 'selectRecord';//\r\njslet.data.RefreshEvent.SELECTALL = 'selectAll';//\r\njslet.data.RefreshEvent.INSERT = 'insert';\r\njslet.data.RefreshEvent.DELETE = 'delete';// recno\r\njslet.data.RefreshEvent.CHANGEPAGE = 'changePage';\r\njslet.data.RefreshEvent.UPDATELOOKUP = 'updateLookup';\r\njslet.data.RefreshEvent.AGGRADED = 'aggraded';\r\n\r\njslet.data.RefreshEvent.ERROR = 'error';\r\n\r\njslet.data.RefreshEvent._updateAllEvent = {eventType: jslet.data.RefreshEvent.UPDATEALL};\r\njslet.data.RefreshEvent._changePageEvent = {eventType: jslet.data.RefreshEvent.CHANGEPAGE};\r\n\r\n/**\r\n * Field Validator\r\n */\r\njslet.data.FieldValidator = function() {\r\n};\r\n\r\njslet.data.FieldValidator.prototype = {\r\n\t\r\n\tintRegular: { expr: /^(-)?[1-9]*\\d+$/ig},\r\n\t\r\n\tfloatRegular: { expr: /((^-?[1-9])|\\d)\\d*(\\.[0-9]*)?$/ig},\r\n\r\n   /**\r\n\t * Check the specified character is valid or not.\r\n\t * Usually use this when user presses a key down.\r\n\t * \r\n\t * @param {String} inputChar Single character\r\n\t * @param {Boolean} True for passed, otherwise failed.\r\n\t */\r\n\tcheckInputChar: function (fldObj, inputChar, existText, cursorPos) {\r\n\t\tvar validChars = fldObj.validChars();\r\n\t\tvar valid = true;\r\n\t\tif (validChars && inputChar) {\r\n\t\t\tvar c = inputChar.charAt(0);\r\n\t\t\tvalid = validChars.indexOf(c) >= 0;\r\n\t\t}\r\n\t\tif(existText && valid && fldObj.getType() == jslet.data.DataType.NUMBER){\r\n\t\t\tvar scale = fldObj.scale();\r\n\t\t\tvar k = existText.lastIndexOf('.');\r\n\t\t\tif(inputChar == '.') {\r\n\t\t\t\tif(k >= 0) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(scale > 0 && k >= 0) {\r\n\t\t\t\tif(existText.length - k - 1 === scale && cursorPos - 1 > k) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t}\r\n\t\treturn valid;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Check the specified text is valid or not\r\n\t * Usually use this when a field loses focus.\r\n\t * \r\n\t * @param {jslet.data.Field} fldObj Field Object\r\n\t * @param {String} inputText Input text, it is original text that user inputed. \r\n\t * @return {String} If input text is valid, return null, otherwise return error message.\r\n\t */\r\n\tcheckInputText: function (fldObj, inputText) {\r\n\t\tvar result = this.checkRequired(fldObj, inputText);\r\n\t\tif(result) {\r\n\t\t\treturn result;\r\n\t\t}\r\n\t\tif(inputText === \"\") {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tvar fldType = fldObj.getType();\r\n\t\t\r\n\t\t//Check with regular expression\r\n\t\tvar regular = fldObj.regularExpr();\r\n\t\tif (!regular) {\r\n\t\t\tif (fldType == jslet.data.DataType.DATE) {\r\n\t\t\t\tregular = fldObj.dateRegular();\r\n\t\t\t} else {\r\n\t\t\t\tif (fldType == jslet.data.DataType.NUMBER) {\r\n\t\t\t\t\tif (!this.intRegular.message) {\r\n\t\t\t\t\t\tthis.intRegular.message = jslet.locale.Dataset.invalidInt;\r\n\t\t\t\t\t\tthis.floatRegular.message = jslet.locale.Dataset.invalidFloat;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (!fldObj.scale()) {\r\n\t\t\t\t\t\tregular = this.intRegular;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tregular = this.floatRegular;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tif (regular) {\r\n\t\t\tvar regExpObj = regular.expr;\r\n\t\t\tif (typeof regExpObj == 'string') {\r\n\t\t\t\tregExpObj = new RegExp(regular.expr, 'ig');\r\n\t\t\t}\r\n\t\t\tregExpObj.lastIndex = 0;\r\n\t\t\tif (!regExpObj.test(inputText)) {\r\n\t\t\t\treturn regular.message;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tvar value = inputText;\r\n\t\tif (!fldObj.lookup()) {//Not lookup field\r\n\t\t\tif (fldType == jslet.data.DataType.NUMBER) {\r\n\t\t\t\tvar scale = fldObj.scale() || 0;\r\n\t\t\t\tvar length = fldObj.length();\r\n\t\t\t\tif (scale === 0) {\r\n\t\t\t\t\tvalue = parseInt(inputText);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar k = inputText.indexOf('.');\r\n\t\t\t\t\tvar actual = k > 0? k: inputText.length,\r\n\t\t\t\t\t\texpected = length - scale;\r\n\t\t\t\t\tif(actual > expected) {\r\n\t\t\t\t\t\treturn jslet.formatString(jslet.locale.Dataset.invalidIntegerPart, [expected, actual]);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tactual = k > 0 ? inputText.length - k - 1: 0;\r\n\t\t\t\t\tif(actual > scale) {\r\n\t\t\t\t\t\treturn jslet.formatString(jslet.locale.Dataset.invalidDecimalPart, [scale, actual]);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvalue = parseFloat(inputText);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (fldType == jslet.data.DataType.DATE) {// Date convert\r\n\t\t\t\tvalue = jslet.parseDate(inputText, fldObj.displayFormat());\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\treturn this.checkValue(fldObj, value);\r\n\t},\r\n\r\n\t/**\r\n\t * Check the required field's value is empty or not\r\n\t * \r\n\t * @param {jslet.data.Field} fldObj Field Object\r\n\t * @param {Object} value field value.\r\n\t * @return {String} If input text is valid, return null, otherwise return error message.\r\n\t */\r\n\tcheckRequired: function(fldObj, value) {\r\n\t\tif (fldObj.required()) {\r\n\t\t\tvar valid = true;\r\n\t\t\tif (value === null || value === undefined) {\r\n\t\t\t\tvalid = false;\r\n\t\t\t}\r\n\t\t\tif(valid && jslet.isString(value) && jQuery.trim(value).length === 0) {\r\n\t\t\t\tvalid = false;\r\n\t\t\t}\r\n\t\t\tif(valid && jslet.isArray(value) && value.length === 0) {\r\n\t\t\t\tvalid = false;\r\n\t\t\t}\r\n\t\t\tif(fldObj.getType() === jslet.data.DataType.BOOLEAN && !value) {\r\n\t\t\t\tvalid = false;\r\n\t\t\t}\r\n\t\t\tif(!valid) {\r\n\t\t\t\treturn jslet.formatString(jslet.locale.Dataset.fieldValueRequired, [fldObj.label()]);\r\n\t\t\t} else {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Check the specified field value is valid or not\r\n\t * It will check required, range and custom validation\r\n\t * \r\n\t * @param {jslet.data.Field} fldObj Field Object\r\n\t * @param {Object} value field value. \r\n\t * @return {String} If input text is valid, return null, otherwise return error message.\r\n\t */\r\n\tcheckValue: function(fldObj, value) {\r\n\t\tvar fldType = fldObj.getType();\r\n\t\t//Check range\r\n\t\tvar fldRange = fldObj.dataRange(),\r\n\t\t\thasLookup = fldObj.lookup()? true: false;\r\n\t\t\r\n\t\tif (hasLookup) {//lookup field need compare code value of the Lookup\r\n\t\t\tvalue = fldObj.dataset().getFieldText(fldObj.name(), true);\r\n\t\t}\r\n\t\t\t\r\n\t\tif (fldRange) {\r\n\t\t\tvar min = fldRange.min,\r\n\t\t\t\tstrMin = min,\r\n\t\t\t\tmax = fldRange.max,\r\n\t\t\t\tstrMax = max;\r\n\t\t\tvar fmt = fldObj.displayFormat();\r\n\t\t\t\r\n\t\t\tif (fldType == jslet.data.DataType.DATE) {\r\n\t\t\t\tif (min) {\r\n\t\t\t\t\tstrMin = jslet.formatDate(min, fmt);\r\n\t\t\t\t}\r\n\t\t\t\tif (max) {\r\n\t\t\t\t\tstrMax = jslet.formatDate(max, fmt);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (!hasLookup && fldType == jslet.data.DataType.NUMBER) {\r\n\t\t\t\tstrMin = jslet.formatNumber(min, fmt);\r\n\t\t\t\tstrMax = jslet.formatNumber(max, fmt);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (min !== undefined && max !== undefined && (value < min || value > max)) {\r\n\t\t\t\treturn jslet.formatString(jslet.locale.Dataset.notInRange, [strMin, strMax]);\r\n\t\t\t}\r\n\t\t\tif (min !== undefined && max === undefined && value < min) {\r\n\t\t\t\treturn jslet.formatString(jslet.locale.Dataset.moreThanValue, [strMin]);\r\n\t\t\t}\r\n\t\t\tif (min === undefined && max !== undefined && value > max) {\r\n\t\t\t\treturn jslet.formatString(jslet.locale.Dataset.lessThanValue, [strMax]);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\t//Check unique in local data, if need check at server side, use 'customValidator' instead.\r\n\t\tif(fldObj.unique()) {\r\n\t\t\tvar currDs = fldObj.dataset(),\r\n\t\t\t\tdataList = currDs.dataList();\r\n\t\t\t\r\n\t\t\tif(value !== null && value !== undefined && dataList && dataList.length > 1) {\r\n\t\t\t\tvar currRec = currDs.getRecord(), \r\n\t\t\t\t\tfldName = fldObj.name(),\r\n\t\t\t\t\trec;\r\n\t\t\t\tfor(var i = 0, len = dataList.length; i < len; i++) {\r\n\t\t\t\t\trec = dataList[i];\r\n\t\t\t\t\tif(rec === currRec) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(rec[fldName] == value) {\r\n\t\t\t\t\t\treturn jslet.locale.Dataset.notUnique;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t//Customized validation\r\n\t\tif (fldObj.customValidator()) {\r\n\t\t\treturn fldObj.customValidator().call(fldObj.dataset(), fldObj, value);\r\n\t\t}\r\n\t\t\r\n\t\treturn null;\r\n\t}\r\n};\r\n\r\n/*Start of field value converter*/\r\njslet.data.FieldValueConverter = jslet.Class.create({\r\n\tclassName: 'jslet.data.FieldValueConverter',\r\n\t\r\n\ttextToValue: function(fldObj, inputText) {\r\n\t\tvar value = inputText;\r\n\t\treturn value;\r\n\t},\r\n\t\r\n\tvalueToText: function(fldObj, value, isEditing) {\r\n\t\tvar text = value;\r\n\t\treturn text;\r\n\t}\r\n});\r\njslet.data.FieldValueConverter.className = 'jslet.data.FieldValueConverter';\r\n\r\njslet.data.NumberValueConverter = jslet.Class.create(jslet.data.FieldValueConverter, {\r\n\ttextToValue: function(fldObj, inputText) {\r\n\t\tvar value = null;\r\n\t\tif (inputText) {\r\n\t\t\tif (fldObj.scale() === 0) {\r\n\t\t\t\tvalue = parseInt(inputText);\r\n\t\t\t} else {\r\n\t\t\t\tvalue = parseFloat(inputText);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn value;\r\n\t},\r\n\r\n\tvalueToText: function(fldObj, value, isEditing) {\r\n\t\tvar Z = this;\r\n\t\tif (fldObj.unitConverted()) {\r\n\t\t\tvalue = value * Z._unitConvertFactor;\r\n\t\t}\r\n\r\n\t\tif (!isEditing) {\r\n\t\t\tvar rtnText = jslet.formatNumber(value, fldObj.displayFormat());\r\n\t\t\tif (fldObj.unitConverted() && Z._unitName) {\r\n\t\t\t\trtnText += Z._unitName;\r\n\t\t\t}\r\n\t\t\treturn rtnText;\r\n\t\t} else {\r\n\t\t\treturn value;\r\n\t\t}\r\n\t}\r\n});\r\n\r\njslet.data.DateValueConverter = jslet.Class.create(jslet.data.FieldValueConverter, {\r\n\ttextToValue: function(fldObj, inputText) {\r\n\t\tvar value = jslet.parseDate(inputText, fldObj.displayFormat());\r\n\t\treturn value; \r\n\t},\r\n\t\r\n\tvalueToText: function(fldObj, value, isEditing) {\r\n\t\tif (!(value instanceof Date)) {\r\n\t\t\tthrow new Error(jslet.formatString(jslet.locale.Dataset.invalidDateFieldValue, [fldObj.name()]));\r\n\t\t}\r\n\r\n\t\treturn value ? jslet.formatDate(value, fldObj.displayFormat()): '';\r\n\t}\r\n});\r\n\r\njslet.data.StringValueConverter = jslet.Class.create(jslet.data.FieldValueConverter, {\r\n\ttextToValue: function(fldObj, inputText) {\r\n\t\tvar value = inputText;\r\n\t\tif (fldObj.antiXss()) {\r\n\t\t\tvalue = jslet.htmlEncode(value);\r\n\t\t}\r\n\t\treturn value;\r\n\t}\r\n});\r\n\r\njslet.data.BooleanValueConverter = jslet.Class.create(jslet.data.FieldValueConverter, {\r\n\ttextToValue: function(fldObj, inputText) {\r\n\t\tif(!inputText) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\treturn inputText.toLowerCase() == 'true';\r\n\t},\r\n\t\r\n\tvalueToText: function(fldObj, value, isEditing) {\r\n\t\treturn value ? fldObj.trueText(): fldObj.falseText();\r\n\t}\r\n});\r\n\r\njslet.data.LookupValueConverter = jslet.Class.create(jslet.data.FieldValueConverter, {\r\n\ttextToValue: function(fldObj, inputText, valueIndex) {\r\n\t\tif(!inputText) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tvar value = '',\r\n\t\t\tlkFldObj = fldObj.lookup(),\r\n\t\t\tlkDs = lkFldObj.dataset();\r\n\t\t\r\n\t\tvalue = lkDs._convertFieldValue(\r\n\t\t\t\tlkFldObj.codeField(), inputText, lkFldObj.keyField());\r\n\t\tif (value === null) {\r\n\t\t\tvar invalidMsg = jslet.formatString(jslet.locale.Dataset.valueNotFound);\r\n\t\t\tfldObj.dataset().setFieldError(fldObj.name(), invalidMsg, valueIndex, inputText);\r\n\t\t\tlkDs.first();\r\n\t\t\treturn undefined;\r\n\t\t}\r\n\t\tif(fldObj.valueStyle() === jslet.data.FieldValueStyle.NORMAL) {\r\n\t\t\tvar fieldMap = lkFldObj.returnFieldMap(),\r\n\t\t\t\tlookupDs = lkFldObj.dataset();\r\n\t\t\tmainDs = this;\r\n\t\t\tif(lookupDs.findByKey(value)) {\r\n\t\t\t\tvar fldName, lkFldName;\r\n\t\t\t\tfor(var fldName in fieldMap) {\r\n\t\t\t\t\tlkFldName = fieldMap[fldName];\r\n\t\t\t\t\tmainDs.setFieldValue(fldName, lookupDs.getFieldValue(lkFldName));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn value;\r\n\t},\r\n\t\r\n\tvalueToText: function(fldObj, value, isEditing) {\r\n\t\tvar lkFldObj = fldObj.lookup(),\r\n\t\t\tlkds = lkFldObj.dataset(),\r\n\t\t\tresult;\r\n\t\tif (!isEditing) {\r\n\t\t\tresult = lkds._convertFieldValue(lkFldObj.keyField(), value,\r\n\t\t\t\t\tlkFldObj.displayFields());\r\n\t\t} else {\r\n\t\t\tresult = lkds._convertFieldValue(lkFldObj.keyField(), value, \r\n\t\t\t\t\t'[' + lkFldObj.codeField() + ']');\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n});\r\n\r\njslet.data._valueConverters = {};\r\njslet.data._valueConverters[jslet.data.DataType.NUMBER] = new jslet.data.NumberValueConverter();\r\njslet.data._valueConverters[jslet.data.DataType.STRING] = new jslet.data.StringValueConverter();\r\njslet.data._valueConverters[jslet.data.DataType.DATE] = new jslet.data.DateValueConverter();\r\njslet.data._valueConverters[jslet.data.DataType.BOOLEAN] = new jslet.data.BooleanValueConverter();\r\n\r\njslet.data._valueConverters.lookup = new jslet.data.LookupValueConverter();\r\n\r\n/**\r\n * Get appropriate field value converter.\r\n * \r\n * @param {jslet.data.Field} fldObj field object.\r\n * \r\n * @return {jslet.data.FieldValueConverter} field value converter;\r\n */\r\njslet.data.getValueConverter = function(fldObj) {\r\n\tif(fldObj.lookup()) {\r\n\t\treturn jslet.data._valueConverters.lookup;\r\n\t}\r\n\t\r\n\treturn jslet.data._valueConverters[fldObj.getType()];\r\n};\r\n/* End of field value converter */\r\n\r\n/**\r\n * Convert dataset record to json.\r\n * \r\n * @param {Array of Object} records Dataset records, required.\r\n * @param {Array of String} excludeFields Excluded field names,optional.\r\n * \r\n * @return {String} Json String. \r\n */\r\njslet.data.record2Json = function(records, excludeFields) {\r\n\tif(!window.JSON || !JSON) {\r\n\t\talert('Your browser does not support JSON!');\r\n\t\treturn;\r\n\t}\r\n\tif(excludeFields) {\r\n\t\tjslet.Checker.test('record2Json#excludeFields', excludeFields).isArray();\t\t\r\n\t}\r\n\t\r\n\tfunction record2JsonFilter(key, value) {\r\n\t\tif(key == '_jl_') {\r\n\t\t\treturn undefined;\r\n\t\t}\r\n\t\tif(excludeFields) {\r\n\t\t\tvar fldName;\r\n\t\t\tfor(var i = 0, len = excludeFields.length; i < len; i++) {\r\n\t\t\t\tfldName = excludeFields[i];\r\n\t\t\t\tif(key == fldName) {\r\n\t\t\t\t\treturn undefined;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn value;\t\t\r\n\t}\r\n\t\r\n\treturn JSON.stringify(records, record2JsonFilter);\r\n};\r\n\r\njslet.data.getRecInfo = function(record) {\r\n\tif(!record) {\r\n\t\treturn null;\r\n\t}\r\n\tvar recInfo = record._jl_;\r\n\tif(!recInfo) {\r\n\t\trecInfo = {};\r\n\t\trecord._jl_ = recInfo;\r\n\t}\r\n\treturn recInfo;\r\n}\r\n\r\n/*Field value cache manager*/\r\njslet.data.FieldValueCache = {\r\n\t\r\n\tput: function(record, fieldName, value, valueIndex) {\r\n\t\tvar recInfo = jslet.data.getRecInfo(record), \r\n\t\t\tcacheObj = recInfo.cache;\r\n\t\tif(!cacheObj) {\r\n\t\t\tcacheObj = {};\r\n\t\t\trecord._jl_.cache = cacheObj;\r\n\t\t}\r\n\t\tif(valueIndex || valueIndex === 0) {\r\n\t\t\tvar fldCacheObj = cacheObj[fieldName];\r\n\t\t\tif(!fldCacheObj || !jslet.isObject(fldCacheObj)){\r\n\t\t\t\tfldCacheObj = {};\r\n\t\t\t\tcacheObj[fieldName] = fldCacheObj;\r\n\t\t\t}\r\n\t\t\tfldCacheObj[valueIndex+\"\"] = value;\r\n\t\t} else {\r\n\t\t\tcacheObj[fieldName] = value;\r\n\t\t}\r\n\t},\r\n\t\r\n\tget: function(record, fieldName, valueIndex) {\r\n\t\tvar recInfo = jslet.data.getRecInfo(record), \r\n\t\t\tcacheObj = recInfo.cache;\r\n\t\tif(cacheObj) {\r\n\t\t\tif(valueIndex || valueIndex === 0) {\r\n\t\t\t\tvar fldCacheObj = cacheObj[fieldName];\r\n\t\t\t\tif(fldCacheObj && jslet.isObject(fldCacheObj)){\r\n\t\t\t\t\treturn fldCacheObj[valueIndex+\"\"];\r\n\t\t\t\t}\r\n\t\t\t\treturn undefined;\r\n\t\t\t} else {\r\n\t\t\t\treturn cacheObj[fieldName];\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\treturn undefined;\r\n\t\t}\r\n\t},\r\n\t\r\n\tclear: function(record, fieldName) {\r\n\t\tvar recInfo = jslet.data.getRecInfo(record), \r\n\t\t\tcacheObj = recInfo.cache;\r\n\t\tif(cacheObj) {\r\n\t\t\tdelete cacheObj[fieldName];\r\n\t\t}\r\n\t},\r\n\t\r\n\tclearAll: function(dataset, fieldName) {\r\n\t\tvar dataList = dataset.dataList();\r\n\t\tif(!dataList) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar rec, cacheObj, recInfo;\r\n\t\tfor(var i = 0, len = dataList.length; i < len; i++) {\r\n\t\t\trec = dataList[i];\r\n\t\t\tvar recInfo = jslet.data.getRecInfo(rec), \r\n\t\t\t\tcacheObj = recInfo.cache;\r\n\t\t\tif(cacheObj) {\r\n\t\t\t\tdelete cacheObj[fieldName];\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\tremoveCache: function(record) {\r\n\t\tvar recInfo = jslet.data.getRecInfo(record);\r\n\t\tdelete recInfo['cache'];\r\n\t},\r\n\t\r\n\tremoveAllCache: function(dataset) {\r\n\t\tvar dataList = dataset.dataList();\r\n\t\tif(!dataList) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar rec, cacheObj, recInfo;\r\n\t\tfor(var i = 0, len = dataList.length; i < len; i++) {\r\n\t\t\trec = dataList[i];\r\n\t\t\tif(!rec) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\trecInfo = jslet.data.getRecInfo(rec); \r\n\t\t\tdelete recInfo['cache'];\r\n\t\t}\r\n\t}\r\n};\r\n/*End of field value cache manager*/\r\n\r\n/*Field value cache manager*/\r\njslet.data.FieldError = {\r\n\t\r\n\tput: function(record, fldName, errorMsg, valueIndex, inputText) {\r\n\t\tif(!errorMsg) {\r\n\t\t\tjslet.data.FieldError.clear(record, fldName, valueIndex);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar recInfo = jslet.data.getRecInfo(record), \r\n\t\t\terrObj = recInfo.error;\r\n\t\tif(!errObj) {\r\n\t\t\terrObj = {};\r\n\t\t\trecInfo.error = errObj;\r\n\t\t}\r\n\t\tvar fldErrObj = errObj[fldName];\r\n\t\tif(!fldErrObj) {\r\n\t\t\tfldErrObj = {};\r\n\t\t\terrObj[fldName] = fldErrObj;\r\n\t\t}\r\n\t\tvar errMsgObj = {message: errorMsg};\r\n\t\tif(inputText !== undefined) {\r\n\t\t\terrMsgObj.inputText = inputText;\r\n\t\t}\r\n\t\tif(!valueIndex) {\r\n\t\t\tvalueIndex = 0;\r\n\t\t}\r\n\t\tfldErrObj[valueIndex+\"\"] = errMsgObj;\r\n\t},\r\n\t\r\n\tputDetailError: function(record, fldName, errorCount) {\r\n\t\tvar recInfo = jslet.data.getRecInfo(record), \r\n\t\terrObj = recInfo.error;\r\n\t\tif(!errObj) {\r\n\t\t\terrObj = {};\r\n\t\t\trecInfo.error = errObj;\r\n\t\t}\r\n\t\tvar fldErrObj = errObj[fldName];\r\n\t\tif(!fldErrObj) {\r\n\t\t\tfldErrObj = {};\r\n\t\t\terrObj[fldName] = fldErrObj;\r\n\t\t}\r\n\t\tif(!valueIndex) {\r\n\t\t\tvalueIndex = 0;\r\n\t\t}\r\n\t\tvar errMsgObj = fldErrObj[valueIndex+\"\"];\r\n\t\tif(!errMsgObj) {\r\n\t\t\terrMsgObj = {errorCount: 0};\r\n\t\t\tfldErrObj[valueIndex+\"\"] = errMsgObj;\r\n\t\t}\r\n\t\terrMsgObj.errorCount += errorCount;\r\n\t\tif(errMsgObj.errorCount <= 0) {\r\n\t\t\tjslet.data.FieldError.clear(record, fldName);\r\n\t\t}\r\n\t\t\r\n\t},\r\n\t\r\n\tget: function(record, fldName, valueIndex) {\r\n\t\tvar recInfo = jslet.data.getRecInfo(record), \r\n\t\t\terrObj = recInfo.error;\r\n\t\tif(errObj) {\r\n\t\t\tvar fldErrObj = errObj[fldName];\r\n\t\t\tif(!fldErrObj) {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t\tif(!valueIndex) {\r\n\t\t\t\tvalueIndex = 0;\r\n\t\t\t}\r\n\t\t\treturn fldErrObj[valueIndex+\"\"];\r\n\t\t} else {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t},\r\n\t\r\n\tclear: function(record, fldName, valueIndex) {\r\n\t\tvar recInfo = jslet.data.getRecInfo(record), \r\n\t\t\terrObj = recInfo.error;\r\n\t\tif(errObj) {\r\n\t\t\tvar fldErrObj = errObj[fldName];\r\n\t\t\tif(!fldErrObj) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif(!valueIndex) {\r\n\t\t\t\tvalueIndex = 0;\r\n\t\t\t}\r\n\t\t\tdelete fldErrObj[valueIndex+\"\"];\r\n\t\t\tvar found = false;\r\n\t\t\tfor(var idx in fldErrObj) {\r\n\t\t\t\tfoutnd = true;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tif(!found) {\r\n\t\t\t\tdelete errObj[fldName];\r\n\t\t\t} \r\n\t\t}\r\n\t},\r\n\t\r\n\texistFieldError: function(record, fldName, valueIndex) {\r\n\t\tvar recInfo = jslet.data.getRecInfo(record), \r\n\t\terrObj = recInfo.error;\r\n\t\tif(errObj) {\r\n\t\t\tvar fldErrObj = errObj[fldName];\r\n\t\t\tif(!fldErrObj){\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tif(!valueIndex) {\r\n\t\t\t\tvalueIndex = 0;\r\n\t\t\t}\r\n\t\t\treturn fldErrObj[valueIndex+\"\"] ? true: false;\r\n\t\t}\r\n\t\treturn false;\r\n\t},\r\n\t\r\n\texistRecordError: function(record) {\r\n\t\tvar recInfo = jslet.data.getRecInfo(record);\r\n\t\tif(!recInfo) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tvar errObj = recInfo.error;\r\n\t\tif(errObj) {\r\n\t\t\tfor(var fldName in errObj) {\r\n\t\t\t\tif(errObj[fldName]) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t},\r\n\t\r\n\tclearFieldError: function(dataset, fldName) {\r\n\t\tvar dataList = dataset.dataList();\r\n\t\tif(!dataList) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar rec, errObj, recInfo;\r\n\t\tfor(var i = 0, len = dataList.length; i < len; i++) {\r\n\t\t\trec = dataList[i];\r\n\t\t\tvar recInfo = jslet.data.getRecInfo(rec), \r\n\t\t\t\terrObj = recInfo.error;\r\n\t\t\tif(errObj) {\r\n\t\t\t\tdelete errObj[fldName];\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\tclearRecordError: function(record) {\r\n\t\tvar recInfo = jslet.data.getRecInfo(record);\r\n\t\tif(recInfo) {\r\n\t\t\tdelete recInfo['error'];\r\n\t\t}\r\n\t},\r\n\t\r\n\tclearDatasetError: function(dataset) {\r\n\t\tvar dataList = dataset.dataList();\r\n\t\tif(!dataList) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar rec, errObj, recInfo;\r\n\t\tfor(var i = 0, len = dataList.length; i < len; i++) {\r\n\t\t\trec = dataList[i];\r\n\t\t\trecInfo = jslet.data.getRecInfo(rec); \r\n\t\t\tdelete recInfo['error'];\r\n\t\t}\r\n\t}\r\n};\r\n/*End of field value error manager*/\r\n\r\njslet.data.DatasetRelationManager = function() {\r\n\tvar relations= [];\r\n\t\r\n\t/**\r\n\t * Add dataset relation.\r\n\t * \r\n\t * @param {String} hostDsName host dataset name;\r\n\t * @param {String} hostFldName field name of host dataset;\r\n\t * @param {String} lookupOrDetailDsName lookup or detail dataset name;\r\n\t * @param {jslet.data.DatasetType} relationType, optional value: jslet.data.DatasetType.LOOKUP, jslet.data.DatasetType.DETAIL\r\n\t */\r\n\tthis.addRelation = function(hostDsName, hostFldName, lookupOrDetailDsName, relationType) {\r\n\t\tfor(var i = 0, len = relations.length; i < len; i++) {\r\n\t\t\tvar relation = relations[i];\r\n\t\t\tif(relation.hostDataset == hostDsName && \r\n\t\t\t\trelation.hostField == hostFldName && \r\n\t\t\t\trelation.lookupDataset == lookupOrDetailDsName) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\trelations.push({hostDataset: hostDsName, hostField: hostFldName, lookupOrDetailDataset: lookupOrDetailDsName, relationType: relationType});\r\n\t\t//If reation type is DETAIL, set 'datasetField' property of detail dataset.\r\n\t\tif(relationType == jslet.data.DatasetType.DETAIL) {\r\n\t\t\tvar detailDs = jslet.data.getDataset(lookupOrDetailDsName);\r\n\t\t\tif(detailDs) {\r\n\t\t\t\tvar fldObj = this.getHostFieldObject(lookupOrDetailDsName);\r\n\t\t\t\tif(fldObj) {\r\n\t\t\t\t\tdetailDs.datasetField(fldObj);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\t\r\n\tthis.removeRelation = function(hostDsName, hostFldName, lookupOrDetailDsName) {\r\n\t\tfor(var i = relations.length - 1; i >= 0; i--) {\r\n\t\t\tvar relation = relations[i];\r\n\t\t\tif(relation.hostDataset == hostDsName && \r\n\t\t\t\trelation.hostField == hostFldName && \r\n\t\t\t\trelation.lookupOrDetailDataset == lookupOrDetailDsName) {\r\n\t\t\t\trelations.splice(i,1);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\t\r\n\tthis.removeDataset = function(datasetName) {\r\n\t\tfor(var i = relations.length - 1; i >= 0; i--) {\r\n\t\t\tvar relation = relations[i];\r\n\t\t\tif(relation.hostDataset == datasetName || relation.lookupOrDetailDataset == datasetName) {\r\n\t\t\t\trelations.splice(i,1);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\t\r\n\tthis.changeDatasetName = function(oldName, newName) {\r\n\t\tif(!oldName || !newName) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tfor(var i = 0, len = relations.length; i < len; i++) {\r\n\t\t\tvar relation = relations[i];\r\n\t\t\tif(relation.hostDataset == oldName) {\r\n\t\t\t\trelation.hostDataset = newName;\r\n\t\t\t}\r\n\t\t\tif(relation.lookupOrDetailDataset == oldName) {\r\n\t\t\t\trelation.lookupOrDetailDataset = newName;\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\t\r\n\tthis.refreshLookupHostDataset = function(lookupDsName) {\r\n\t\tvar relation, hostDataset;\r\n\t\tfor(var i = 0, len = relations.length; i < len; i++) {\r\n\t\t\trelation = relations[i];\r\n\t\t\tif(relation.lookupOrDetailDataset == lookupDsName &&\r\n\t\t\t\trelation.relationType == jslet.data.DatasetType.LOOKUP) {\r\n\t\t\t\thostDataset = jslet.data.getDataset(relation.hostDataset);\r\n\t\t\t\tif(hostDataset) {\r\n\t\t\t\t\thostDataset.handleLookupDatasetChanged(relation.hostField);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthrow new Error('NOT found Host dataset: ' + relation.hostDataset);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\t\r\n\tthis.getHostFieldObject = function(lookupOrDetailDsName) {\r\n\t\tvar relation, hostDataset;\r\n\t\tfor(var i = 0, len = relations.length; i < len; i++) {\r\n\t\t\trelation = relations[i];\r\n\t\t\tif(relation.lookupOrDetailDataset == lookupOrDetailDsName &&\r\n\t\t\t\trelation.relationType == jslet.data.DatasetType.DETAIL) {\r\n\t\t\t\thostDataset = jslet.data.getDataset(relation.hostDataset);\r\n\t\t\t\tif(hostDataset) {\r\n\t\t\t\t\treturn hostDataset.getField(relation.hostField);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthrow new Error('NOT found Host dataset: ' + relation.hostDataset);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} //end for i\t\r\n\t}\r\n};\r\njslet.data.datasetRelationManager = new jslet.data.DatasetRelationManager();\r\n\r\njslet.data.convertDateFieldValue = function(dataset, records) {\r\n\tvar Z = dataset;\r\n\tif(!records) {\r\n\t\trecords = Z.dataList();\r\n\t}\r\n\tif (!records || records.length === 0) {\r\n\t\treturn;\r\n\t}\r\n\r\n\tvar dateFlds = [], subFlds = [],\r\n\t\tfields = Z.getNormalFields(),\r\n\t\tfldObj;\r\n\tfor (var i = 0, len = fields.length; i < len; i++) {\r\n\t\tfldObj = fields[i];\r\n\t\tif (fldObj.getType() == jslet.data.DataType.DATE) {\r\n\t\t\tdateFlds.push(fldObj.name());\r\n\t\t}\r\n\t\tif (fldObj.getType() == jslet.data.DataType.DATASET) {\r\n\t\t\tsubFlds.push(fldObj);\r\n\t\t}\r\n\t}\r\n\tif (dateFlds.length === 0 && subFlds.length === 0) {\r\n\t\treturn;\r\n\t}\r\n\r\n\tvar rec, fname, value,\r\n\t\tfcnt = dateFlds.length,\r\n\t\tsubCnt = subFlds.length;\r\n\tfor (var i = 0, recCnt = records.length; i < recCnt; i++) {\r\n\t\trec = records[i];\r\n\t\tfor (var j = 0; j < fcnt; j++) {\r\n\t\t\tfname = dateFlds[j];\r\n\t\t\tvalue = rec[fname];\r\n\t\t\tif (!jslet.isDate(value)) {\r\n\t\t\t\tvalue = jslet.parseDate(value,'yyyy-MM-ddThh:mm:ss');\r\n\t\t\t\tif (value) {\r\n\t\t\t\t\trec[fname] = value;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthrow new Error(jslet.formatString(jslet.locale.Dataset.invalidDateFieldValue,[fldName]));\r\n\t\t\t\t}\r\n\t\t\t} //end if\r\n\t\t} //end for j\r\n\t\tfor(var j = 0; j < subCnt; j++) {\r\n\t\t\tfldObj = subFlds[j];\r\n\t\t\tfname = fldObj.name();\r\n\t\t\tjslet.data.convertDateFieldValue(fldObj.subDataset(), rec[fname]);\r\n\t\t}\r\n\t} //end for i\r\n\t\r\n}\r\n\r\njslet.emptyPromise = {\r\n\tdone: function(callBackFn) {\r\n\t\tif(callBackFn) {\r\n\t\t\tcallBackFn();\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\tfail: function(callBackFn) {\r\n\t\tif(callBackFn) {\r\n\t\t\tcallBackFn();\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\talways: function(callBackFn) {\r\n\t\tif(callBackFn) {\r\n\t\t\tcallBackFn();\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n}\r\n\r\njslet.data.displayOrderComparator = function(fldObj1, fldObj2) {\r\n\treturn fldObj1.displayOrder() - fldObj2.displayOrder();\r\n}\r\n\r\n/**\r\n * Data selection class.\r\n */\r\njslet.data.DataSelection = function(dataset) {\r\n\tthis._dataset = dataset;\r\n\tthis._selection = [];\r\n\tthis._onChanged;\r\n}\r\n\r\njslet.data.DataSelection.prototype = {\r\n\t/**\r\n\t * Select all data.\r\n\t * \r\n\t * @param {String[]} fields An array of field name to be selected.\r\n\t * @param {Boolean} fireEvent Identify firing event or not.\r\n\t */\r\n\tselectAll: function(fields, fireEvent) {\r\n\t\tjslet.Checker.test('DataSelection.add#fields', fields).isArray();\r\n\t\tthis.removeAll();\r\n\t\tif(!fields) {\r\n\t\t\tvar arrFldObj = this._dataset.getNormalFields(), fldName;\r\n\t\t\tfields = [];\r\n\t\t\tfor(var i = 0, len = arrFldObj.length; i < len; i++) {\r\n\t\t\t\tfldName = arrFldObj[i].name();\r\n\t\t\t\tfields.push(fldName);\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.add(0, this._dataset.recordCount() - 1, fields, fireEvent)\r\n\t},\r\n\t\r\n\t/**\r\n\t * Remove all selected data.\r\n\t */\r\n\tremoveAll: function() {\r\n\t\tthis._selection = [];\r\n\t},\r\n\t\r\n\t/**\r\n\t * Add data into selection.\r\n\t * \r\n\t * @param {Integer} startRecno The start recno to be selected.\r\n\t * @param {Integer} endRecno The end recno to be selected.\r\n\t * @param {String[]} fields An array of field name to be selected.\r\n\t * @param {Boolean} fireEvent Identify firing event or not.\r\n\t */\r\n\tadd: function(startRecno, endRecno, fields, fireEvent) {\r\n\t\tjslet.Checker.test('DataSelection.add#startRecno', startRecno).required().isNumber();\r\n\t\tjslet.Checker.test('DataSelection.add#endRecno', endRecno).required().isNumber();\r\n\t\tjslet.Checker.test('DataSelection.add#fields', fields).required().isArray();\r\n\r\n\t\tif(endRecno === undefined) {\r\n\t\t\tendRecno = startRecno;\r\n\t\t}\r\n\t\tvar fldName;\r\n\t\tfor(var recno = startRecno; recno <= endRecno; recno++) {\r\n\t\t\tfor(var i = 0, len = fields.length; i < len; i++) {\r\n\t\t\t\tfldName = fields[i];\r\n\t\t\t\tthis._selectCell(recno, fldName, true);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(fireEvent && this._onChanged) {\r\n\t\t\tthis._onChanged(startRecno, endRecno, fields, true);\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Unselect data.\r\n\t * \r\n\t * @param {Integer} startRecno The start recno to be unselected.\r\n\t * @param {Integer} endRecno The end recno to be selected.\r\n\t * @param {String[]} fields An array of field name to be unselected.\r\n\t * @param {Boolean} fireEvent Identify firing event or not.\r\n\t */\r\n\tremove: function(startRecno, endRecno, fields, fireEvent) {\r\n\t\tjslet.Checker.test('DataSelection.remove#startRecno', startRecno).required().isNumber();\r\n\t\tjslet.Checker.test('DataSelection.remove#endRecno', endRecno).required().isNumber();\r\n\t\tjslet.Checker.test('DataSelection.remove#fields', fields).required().isArray();\r\n\r\n\t\tif(endRecno === undefined) {\r\n\t\t\tendRecno = startRecno;\r\n\t\t}\r\n\t\tif(startRecno > endRecno) {\r\n\t\t\tvar tmp = startRecno;\r\n\t\t\tstartRecno = endRecno;\r\n\t\t\tendRecno = tmp;\r\n\t\t}\r\n\t\tvar fldName;\r\n\t\tfor(var recno = startRecno; recno <= endRecno; recno++) {\r\n\t\t\tfor(var i = 0, len = fields.length; i < len; i++) {\r\n\t\t\t\tfldName = fields[i];\r\n\t\t\t\tthis._selectCell(recno, fldName, false);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(fireEvent && this._onChanged) {\r\n\t\t\tthis._onChanged(startRecno, endRecno, fields, false);\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Fired when the selection area is changed.\r\n\t * \r\n\t * @param {Function} onChanged The event handler, format:\r\n\t * \tfunction(startRecno, endRecno, fields, selected) {\r\n\t * \t\t//startRecno - Integer, start recno;\r\n\t * \t\t//endRecno - Integer, end recno;\r\n\t * \t\t//fields - String[], field names;\r\n\t * \t\t//selected - Boolean, selected or not;\t\r\n\t * \t}\r\n\t * \t\r\n\t */\r\n\tonChanged: function(onChanged) {\r\n\t\tif(onChanged === undefined) {\r\n\t\t\treturn this._onChanged;\r\n\t\t}\r\n\t\tjslet.Checker.test('DataSelection.onChanged', onChanged).isFunction();\r\n\t\tthis._onChanged = onChanged;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Check the specified cell is selected or not.\r\n\t * \r\n\t * @param {Integer} recno Record no.\r\n\t * @param {String} fldName Field name.\r\n\t * \r\n\t * @return {Boolean}\r\n\t */\r\n\tisSelected: function(recno, fldName) {\r\n\t\tjslet.Checker.test('DataSelection.isSelected#recno', recno).required().isNumber();\r\n\t\tjslet.Checker.test('DataSelection.isSelected#fldName', fldName).required().isString();\r\n\t\tvar selObj;\r\n\t\tfor(var i = 0, len = this._selection.length; i < len; i++) {\r\n\t\t\tselObj = this._selection[i];\r\n\t\t\tif(selObj._recno_ === recno && selObj[fldName]) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get selected text.\r\n\t * \r\n\t * @param {String} seperator Seperator for fields.\r\n\t * \r\n\t * @return {String}\r\n\t */\r\n\tgetSelectionText: function(seperator) {\r\n\t\tif(!seperator) {\r\n\t\t\tseperator = '\\t';\r\n\t\t}\r\n\t\tvar dataset = this._dataset,\r\n\t\t\tresult = [], \r\n\t\t\tcontext = dataset.startSilenceMove(),\r\n\t\t\tfields = dataset.getNormalFields(),\r\n\t\t\tfldCnt = fields.length,\r\n\t\t\tfldName, textRec = '', fldObj, text;\r\n\t\ttry {\r\n\t\t\tdataset.first();\r\n\t\t\twhile(!dataset.isEof()) { \r\n\t\t\t\tfor(var i = 0; i < fldCnt; i++) {\r\n\t\t\t\t\tfldObj = fields[i];\r\n\t\t\t\t\tfldName = fldObj.name();\r\n\t\t\t\t\tif(this.isSelected(dataset.recno(), fldName)) {\r\n\t\t\t\t\t\t//If Number field does not have lookup field, return field value, not field text. \r\n\t\t\t\t\t\t//Example: 'amount' field\r\n\t\t\t\t\t\tif(fldObj.getType() === 'N' && !fldObj.lookup()) {\r\n\t\t\t\t\t\t\ttext = fldObj.getValue();\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\ttext = dataset.getFieldText(fldName);\r\n\t\t\t\t\t\t\tif(text === null || text === undefined) {\r\n\t\t\t\t\t\t\t\ttext = '';\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\ttextRec += text + seperator; \r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif(textRec) {\r\n\t\t\t\t\tresult.push(textRec);\r\n\t\t\t\t}\r\n\t\t\t\ttextRec = '';\r\n\t\t\t\tdataset.next(); \r\n\t\t\t} \r\n\t\t} finally { \r\n\t\t\tdataset.endSilenceMove(context); \r\n\t\t}\r\n\t\tif(result.length > 0) {\r\n\t\t\treturn result.join('\\n');\r\n\t\t} else {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t},\r\n\t\r\n\t_selectCell: function(recno, fldName, selected) {\r\n\t\tvar selObj\r\n\t\t\tfound = false;\r\n\t\tfor(var i = 0, len = this._selection.length; i < len; i++) {\r\n\t\t\tselObj = this._selection[i];\r\n\t\t\tif(selObj._recno_ === recno) {\r\n\t\t\t\tfound = true;\r\n\t\t\t\tselObj[fldName] = selected;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(selected && !found) {\r\n\t\t\tselObj = {_recno_: recno};\r\n\t\t\tselObj[fldName] = true;\r\n\t\t\tthis._selection.push(selObj);\r\n\t\t}\r\n\t}\r\n}\r\n\r\njslet.data.GlobalDataHandler = function() {\r\n\tvar Z = this;\r\n\tZ._datasetMetaChanged = null;\r\n\tZ._fieldMetaChanged = null;\r\n\tZ._fieldValueChanged = null;\r\n}\r\n\r\njslet.data.GlobalDataHandler.prototype = {\r\n\t\t\r\n\t/**\r\n\t * Fired when dataset created.\r\n\t *  Pattern: \r\n\t *\tfunction(dataset}{}\r\n\t *  \t//dataset:{jslet.data.Dataset} Dataset Object\r\n\t *  \r\n\t * @param {Function or undefined} datasetCreated dataset created event handler.\r\n\t * @return {this or Function}\r\n\t */\r\n\tdatasetCreated: function(datasetCreated) {\r\n\t\tvar Z = this;\r\n\t\tif(datasetCreated === undefined) {\r\n\t\t\treturn Z._datasetCreated;\r\n\t\t}\r\n\t\tjslet.Checker.test('globalDataHandler.datasetCreated', datasetCreated).isFunction();\r\n\t\tZ._datasetCreated = datasetCreated;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Fired when dataset meta is changed.\r\n\t *  Pattern: \r\n\t *\tfunction(dataset, metaName}{}\r\n\t *  \t//dataset:{jslet.data.Dataset} Dataset Object\r\n\t *  \t//metaName: {String} dataset's meta name\r\n\t *  \r\n\t * @param {Function or undefined} datasetMetaChanged dataset meta changed event handler.\r\n\t * @return {this or Function}\r\n\t */\r\n\tdatasetMetaChanged: function(datasetMetaChanged) {\r\n\t\tvar Z = this;\r\n\t\tif(datasetMetaChanged === undefined) {\r\n\t\t\treturn Z._datasetMetaChanged;\r\n\t\t}\r\n\t\tjslet.Checker.test('globalDataHandler.datasetMetaChanged', datasetMetaChanged).isFunction();\r\n\t\tZ._datasetMetaChanged = datasetMetaChanged;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Fired when field meta is changed.\r\n\t *  Pattern: \r\n\t *\tfunction(dataset, fieldName, metaName}{}\r\n\t *  \t//dataset:{jslet.data.Dataset} Dataset Object\r\n\t *  \t//fieldName: {String} field name\r\n\t *  \t//metaName: {String} dataset's meta name\r\n\t *  \r\n\t * @param {Function or undefined} fieldMetaChanged dataset meta changed event handler.\r\n\t * @return {this or Function}\r\n\t */\r\n\tfieldMetaChanged: function(fieldMetaChanged) {\r\n\t\tvar Z = this;\r\n\t\tif(fieldMetaChanged === undefined) {\r\n\t\t\treturn Z._fieldMetaChanged;\r\n\t\t}\r\n\t\tjslet.Checker.test('globalDataHandler.fieldMetaChanged', fieldMetaChanged).isFunction();\r\n\t\tZ._fieldMetaChanged = fieldMetaChanged;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Fired when field value is changed.\r\n\t *  Pattern: \r\n\t *\tfunction(dataset, metaName}{}\r\n\t *  \t//dataset:{jslet.data.Dataset} Dataset Object\r\n\t *  \t//fieldName: {String} field name\r\n\t *  \t//fieldValue: {Object} field value\r\n\t *  \t//valueIndex: {Integer} value index\r\n\t *  \r\n\t * @param {Function or undefined} fieldValueChanged field value changed event handler.\r\n\t * @return {this or Function}\r\n\t */\r\n\tfieldValueChanged: function(fieldValueChanged) {\r\n\t\tvar Z = this;\r\n\t\tif(fieldValueChanged === undefined) {\r\n\t\t\treturn Z._fieldValueChanged;\r\n\t\t}\r\n\t\tjslet.Checker.test('globalDataHandler.fieldValueChanged', fieldValueChanged).isFunction();\r\n\t\tZ._fieldValueChanged = fieldValueChanged;\r\n\t}\r\n\t\r\n}\r\n\r\njslet.data.globalDataHandler = new jslet.data.GlobalDataHandler();\r\n/* ========================================================================\r\n * Jslet framework: jslet.dataset.js\r\n *\r\n * Copyright (c) 2014 Jslet Group(https://github.com/jslet/jslet/)\r\n * Licensed under MIT (https://github.com/jslet/jslet/LICENSE.txt)\r\n * ======================================================================== */\r\n\r\n/**\r\n * @class Dataset\r\n * \r\n * @param {String} name dataset's name that must be unique in jslet.data.dataModule variable.\r\n */\r\njslet.data.Dataset = function (name) {\r\n\t\r\n\tvar Z = this;\r\n\tZ._name = null; //Dataset name\r\n\tZ._recordClass = jslet.global.defaultRecordClass; //Record class, used for serialized/deserialize\r\n\tZ._dataList = null; //Array of data records\r\n\tZ._oriDataList = null;\r\n\tZ._fields = []; //Array of jslet.data.Field\r\n\tZ._oriFields = null;\r\n\t\r\n\tZ._normalFields = []; //Array of jslet.data.Field except the fields with children.\r\n\tZ._recno = -1;\r\n\tZ._filteredRecnoArray = null;\r\n\r\n\tZ._unitConvertFactor = 1;\r\n\tZ._unitName = null;\r\n\tZ._aborted = false;\r\n\r\n\tZ._status = 0; // dataset status, optional values: 0:browse;1:created;2:updated;3:deleted;\r\n\tZ._subDatasetFields = null; //Array of dataset field object\r\n\t\r\n\tZ._fixedFilter = null;\t\r\n\tZ._filter = null;\r\n\tZ._filtered = false;\r\n\tZ._innerFilter = null; //inner variable\r\n\tZ._findCondition = null;\r\n\tZ._innerFindCondition = null; //inner variable\r\n\r\n\tZ._innerFormularFields = null; //inner variable\r\n\r\n\tZ._bof = false;\r\n\tZ._eof = false;\r\n\tZ._igoreEvent = false;\r\n\tZ._logChanges = true;\r\n\r\n\tZ._modiObject = null;\r\n\tZ._inputtingRecord = {};\r\n\tZ._lockCount = 0;\r\n\r\n\tZ._fixedIndexFields = null;\r\n\tZ._innerFixedIndexFields = [];\r\n\tZ._indexFields = '';\r\n\tZ._innerIndexFields = [];\r\n\tZ._sortingFields = null;\r\n\r\n\tZ._convertDestFields = null;\r\n\tZ._innerConvertDestFields = null;\r\n\r\n\tZ._masterDataset = null;\r\n\tZ._detailDatasets = null; // array\r\n\r\n\tZ._datasetField = null; //jslet.data.Field \r\n\r\n\tZ._linkedControls = []; //Array of DBControl except DBLabel\r\n\tZ._linkedLabels = []; //Array of DBLabel\r\n\tZ._silence = 0;\r\n\tZ._keyField = null;\r\n\tZ._codeField = null;\r\n\tZ._nameField = null;\r\n\tZ._parentField = null;\r\n\tZ._levelOrderField = null;\r\n\tZ._selectField = null;\r\n\t\r\n\tZ._contextRules = null;\r\n\tZ._contextRuleEngine = null;\r\n\tZ._contextRuleEnabled = false;\r\n\r\n\tZ._dataProvider = jslet.data.DataProvider ? new jslet.data.DataProvider() : null;\r\n\r\n\tZ._queryCriteria = null; //String query parameters \r\n\tZ._queryUrl = null; //String query URL \r\n\tZ._submitUrl = null; //String submit URL\r\n\tZ._pageSize = 500;\r\n\tZ._pageNo = 0;  \r\n\tZ._pageCount = 0;\r\n\t//The following attributes are used for private.\r\n\tZ._ignoreFilter = false;\r\n\tZ._ignoreFilterRecno = 0;\r\n\t\r\n\tZ._fieldValidator = new jslet.data.FieldValidator();\r\n\t\r\n\tZ._onFieldChanged = null;  \r\n\t\r\n\tZ._onCheckSelectable = null;\r\n\t\r\n\tZ._datasetListener = null; //\r\n\t\r\n\tZ._designMode = false;\r\n\t\r\n\tZ._autoShowError = true;\r\n\tZ._autoRefreshHostDataset = false;\r\n\tZ._readOnly = false;\r\n\tZ._aggradedValues = null;\r\n\tZ._afterScrollDebounce = jslet.debounce(Z._innerAfterScrollDebounce, 30);\r\n\tZ._onlyChangedSubmitted = false;\r\n\tZ.selection = new jslet.data.DataSelection(Z);\r\n\tZ._changeLog = new jslet.data.ChangeLog(Z);\r\n\tZ._dataTransformer = new jslet.data.DataTransformer(Z);\r\n\tZ._followedValue = null;\r\n\r\n\tZ._lastFindingValue = null;\r\n\tZ._inContextRule = false;\r\n\t\r\n\tZ._errRecordCount = 0;\r\n\tthis.name(name);\r\n};\r\njslet.data.Dataset.className = 'jslet.data.Dataset';\r\n\r\njslet.data.Dataset.prototype = {\r\n\r\n\tclassName: jslet.data.Dataset.className,\r\n\t/**\r\n\t* Set dataset's name.\r\n\t* \r\n\t* @param {String} name Dataset's name that must be unique in jslet.data.dataModule variable.\r\n\t* @return {String or this}\r\n\t*/\r\n\tname: function(name) {\r\n\t\tvar Z = this;\r\n\t\tif(name === undefined) {\r\n\t\t\treturn Z._name;\r\n\t\t}\r\n\t\tjslet.Checker.test('Dataset.name', name).required().isString();\r\n\t\tname = jQuery.trim(name);\r\n\t\t\r\n\t\tvar dsName = this._name;\r\n\t\tif (dsName) {\r\n\t\t\tjslet.data.dataModule.unset(dsName);\r\n\t\t\tjslet.data.datasetRelationManager.changeDatasetName(dsName, name);\r\n\t\t}\r\n\t\tjslet.data.dataModule.unset(name);\r\n\t\tjslet.data.dataModule.set(name, this);\r\n\t\tthis._name = name;\r\n\t\tZ._datasetField = jslet.data.datasetRelationManager.getHostFieldObject(name); //jslet.data.Field \r\n\t\treturn this;\r\n\t},\r\n\t\t\r\n\t/**\r\n\t* Set dataset's record class, recordClass is the server entity class quantified name.\r\n\t* It's used for automated serialization.\r\n\t* \r\n\t* @param {String} clazz Server entity class name.\r\n\t* @return {String or this}\r\n\t*/\r\n\trecordClass: function(clazz) {\r\n\t\tvar Z = this;\r\n\t\tif (clazz === undefined) {\r\n\t\t\treturn Z._recordClass;\r\n\t\t}\r\n\t\tjslet.Checker.test('Dataset.recordClass', clazz).isString();\r\n\t\tZ._recordClass = clazz ? clazz.trim() : null;\r\n\t\treturn this;\r\n\t},\r\n\t\t\r\n\t/**\r\n\t* Clone this dataset's structure and return new dataset object..\r\n\t* \r\n\t* @param {String} newDsName New dataset's name.\r\n\t* @param {Array of String} fieldNames a list of field names which will be cloned to new dataset.\r\n\t* \r\n\t* @return {jslet.data.Dataset} Cloned dataset object\r\n\t*/\r\n\tclone: function (newDsName, fieldNames) {\r\n\t\tvar Z = this;\r\n\t\tif (!newDsName) {\r\n\t\t\tnewDsName = Z._name + '_clone';\r\n\t\t}\r\n\t\tvar result = new jslet.data.Dataset(newDsName);\r\n\t\tresult._datasetListener = Z._datasetListener;\r\n\r\n\t\tresult._unitConvertFactor = Z._unitConvertFactor;\r\n\t\tresult._unitName = Z._unitName;\r\n\r\n\t\tresult._fixedFilter = Z._fixedFilter;\r\n\t\tresult._filter = Z._filter;\r\n\t\tresult._filtered = Z._filtered;\r\n\t\tresult._logChanges = Z._logChanges;\r\n\t\tresult._fixedIndexFields = Z._fixedIndexFields;\r\n\t\tresult._indexFields = Z._indexFields;\r\n\t\tresult._onlyChangedSubmitted = Z._onlyChangedSubmitted;\r\n\t\t\r\n\t\tvar keyFldName = Z._keyField,\r\n\t\t\tcodeFldName = Z._codeField,\r\n\t\t\tnameFldName = Z._nameField,\r\n\t\t\tparentFldName = Z._parentField,\r\n\t\t\tlevelOrderField = Z._levelOrderField,\r\n\t\t\tselectFldName = Z._selectField;\r\n\t\tif (fieldNames) {\r\n\t\t\tkeyFldName = keyFldName && fieldNames.indexOf(keyFldName) >= 0 ? keyFldName: null;\r\n\t\t\tcodeFldName = codeFldName && fieldNames.indexOf(codeFldName) >= 0 ? codeFldName: null;\r\n\t\t\tnameFldName = nameFldName && fieldNames.indexOf(nameFldName) >= 0 ? nameFldName: null;\r\n\t\t\tparentFldName = parentFldName && fieldNames.indexOf(parentFldName) >= 0 ? parentFldName: null;\r\n\t\t\tlevelOrderField = levelOrderField && fieldNames.indexOf(levelOrderField) >= 0 ? levelOrderField: null;\r\n\t\t\tselectFldName = selectFldName && fieldNames.indexOf(selectFldName) >= 0 ? selectFldName: null;\r\n\t\t}\r\n\t\tresult._keyField = keyFldName;\r\n\t\tresult._codeField = codeFldName;\r\n\t\tresult._nameField = nameFldName;\r\n\t\tresult._parentField = parentFldName;\r\n\t\tresult._levelOrderField = levelOrderField;\r\n\t\tresult._selectField = selectFldName;\r\n\r\n\t\tresult._contextRules = Z._contextRules;\r\n\t\tvar fldObj, fldName;\r\n\t\tfor(var i = 0, cnt = Z._fields.length; i < cnt; i++) {\r\n\t\t\tfldObj = Z._fields[i];\r\n\t\t\tfldName = fldObj.name();\r\n\t\t\tif (fieldNames) {\r\n\t\t\t\tif (fieldNames.indexOf(fldName) < 0) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tresult.addField(fldObj.clone(fldName, result));\r\n\t\t}\r\n\t\treturn result;\r\n\t},\r\n\r\n\t/**\r\n\t * Clone one record to another\r\n\t * \r\n\t * @param {Plan Object} srcRecord source record\r\n\t * @param {Plan Object} destRecord destination record\r\n\t */\r\n\tcloneRecord: function(srcRecord, destRecord) {\r\n\t\tvar result = destRecord || {}, \r\n\t\t\tfldName, fldObj, fldValue, newValue, \r\n\t\t\tarrFieldObj = this.getNormalFields();\r\n\r\n\t\tfor(var i = 0, len = arrFieldObj.length; i < len; i++) {\r\n\t\t\tfldObj = arrFieldObj[i];\r\n\t\t\tfldName = fldObj.name();\r\n\t\t\tfldValue = srcRecord[fldName];\r\n\t\t\tif(fldValue === undefined) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif(fldValue && jslet.isArray(fldValue)) {\r\n\t\t\t\tnewValue = [];\r\n\t\t\t\tfor(var j = 0, cnt = fldValue.length; j < cnt; j++) {\r\n\t\t\t\t\tnewValue.push(fldValue[j]);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tnewValue = fldValue;\r\n\t\t\t}\r\n\t\t\tresult[fldName] = newValue;\r\n\t\t}\r\n\t\tjslet.data.FieldValueCache.removeCache(result);\r\n\t\treturn result;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Add specified fields of source dataset into this dataset.\r\n\t * \r\n\t * @param {jslet.data.Dataset} srcDataset New dataset's name.\r\n\t * @param {Array of String} fieldNames a list of field names which will be copied to this dataset.\r\n\t */\r\n\taddFieldFromDataset: function(srcDataset, fieldNames) {\r\n\t\tjslet.Checker.test('Dataset.addFieldFromDataset#srcDataset', srcDataset).required().isClass(jslet.data.Dataset.className);\r\n\t\tjslet.Checker.test('Dataset.addFieldFromDataset#fieldNames', fieldNames).isArray();\r\n\t\tvar fldObj, fldName, \r\n\t\t\tsrcFields = srcDataset.getFields();\r\n\t\tfor(var i = 0, cnt = srcFields.length; i < cnt; i++) {\r\n\t\t\tfldObj = srcFields[i];\r\n\t\t\tfldName = fldObj.name();\r\n\t\t\tif (fieldNames) {\r\n\t\t\t\tif (fieldNames.indexOf(fldName) < 0) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.addField(fldObj.clone(fldName, this));\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * Set or get dataset is readonly or not.\r\n\t * \r\n\t * @param {Boolean} readOnly.\r\n\t * @return {Boolean or this}\r\n\t */\r\n\treadOnly: function(readOnly) {\r\n\t\tvar Z = this;\r\n\t\tif (readOnly === undefined) {\r\n\t\t\treturn Z._readOnly;\r\n\t\t}\r\n\t\t\r\n\t\tZ._readOnly = readOnly? true: false;\r\n\t\tvar fields = Z.getNormalFields(),\r\n\t\t\tfldObj;\r\n\t\tfor(var i = 0, len = fields.length; i < len; i++) {\r\n\t\t\tfldObj = fields[i];\r\n\t\t\tfldObj._fireMetaChangedEvent('readOnly', true);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Only submit the changed record to server.\r\n\t * \r\n\t * @param {Boolean} onlyChangedSubmitted.\r\n\t * @return {Boolean or this}\r\n\t */\r\n\tonlyChangedSubmitted: function(onlyChangedSubmitted) {\r\n\t\tif(onlyChangedSubmitted === undefined) {\r\n\t\t\treturn this._onlyChangedSubmitted;\r\n\t\t}\r\n\t\tthis._onlyChangedSubmitted = onlyChangedSubmitted? true: false;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Set or get page size.\r\n\t * \r\n\t * @param {Integer} pageSize.\r\n\t * @return {Integer or this}\r\n\t */\r\n\tpageSize: function(pageSize) {\r\n\t\tif (pageSize === undefined) {\r\n\t\t\treturn this._pageSize;\r\n\t\t}\r\n\t\t\r\n\t\tjslet.Checker.test('Dataset.pageSize#pageSize', pageSize).isGTZero();\r\n\t\tthis._pageSize = pageSize;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Set or get page number.\r\n\t * \r\n\t * @param {Integer} pageNo.\r\n\t * @return {Integer or this}\r\n\t */\r\n\tpageNo: function(pageNo) {\r\n\t\tif (pageNo === undefined) {\r\n\t\t\treturn this._pageNo;\r\n\t\t}\r\n\t\t\r\n\t\tjslet.Checker.test('Dataset.pageNo#pageNo', pageNo).isGTZero();\r\n\t\tthis._pageNo = pageNo;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get page count.\r\n\t * \r\n\t * @return {Integer}\r\n\t */\r\n\tpageCount: function() {\r\n\t\treturn this._pageCount;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Identify whether dataset is in desin mode.\r\n\t * \r\n\t * @param {boolean} designMode.\r\n\t * @return {boolean or this}\r\n\t */\r\n\tdesignMode: function(designMode) {\r\n\t\tif (designMode === undefined) {\r\n\t\t\treturn this._designMode;\r\n\t\t}\r\n\t\t\r\n\t\tthis._designMode = designMode ? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Identify whether alerting the error message when confirm or apply to server.\r\n\t * \r\n\t * @param {boolean} autoShowError.\r\n\t * @return {boolean or this}\r\n\t */\r\n\tautoShowError: function(autoShowError) {\r\n\t\tif (autoShowError === undefined) {\r\n\t\t\treturn this._autoShowError;\r\n\t\t}\r\n\t\t\r\n\t\tthis._autoShowError = autoShowError ? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Update the host dataset or not if this dataset is a lookup dataset and its data has changed.\r\n\t * If true, all datasets which host this dataset as a lookup dataset will be refreshed.\r\n\t * \r\n\t * @param {boolean} flag.\r\n\t * @return {boolean or this}\r\n\t */\r\n\tautoRefreshHostDataset: function(flag) {\r\n\t\tif(flag === undefined) {\r\n\t\t\treturn this._autoRefreshHostDataset;\r\n\t\t}\r\n\t\tthis._autoRefreshHostDataset = flag ? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Set unit converting factor.\r\n\t * \r\n\t * @param {Double} factor When changed this value, the field's display value will be changed by 'fldValue/factor'.\r\n\t * @param {String} unitName Unit name that displays after field value.\r\n\t * @return {Double or this}\r\n\t */\r\n\tunitConvertFactor: function (factor, unitName) {\r\n\t\tvar Z = this;\r\n\t\tif (arguments.length === 0) {\r\n\t\t\treturn Z._unitConvertFactor;\r\n\t\t}\r\n\t\t\r\n\t\tjslet.Checker.test('Dataset.unitConvertFactor#factor', factor).isGTZero();\r\n\t\tjslet.Checker.test('Dataset.unitConvertFactor#unitName', unitName).isString();\r\n\t\tif (factor > 0) {\r\n\t\t\tZ._unitConvertFactor = factor;\r\n\t\t}\r\n\t\telse{\r\n\t\t\tZ._unitConvertFactor = 1;\r\n\t\t}\r\n\r\n\t\tZ._unitName = unitName;\r\n\t\tfor (var i = 0, cnt = Z._normalFields.length, fldObj; i < cnt; i++) {\r\n\t\t\tfldObj = Z._normalFields[i];\r\n\t\t\tif (fldObj.getType() == jslet.data.DataType.NUMBER && fldObj.unitConverted()) {\r\n\t\t\t\tvar fldName = fldObj.name();\r\n\t\t\t\tjslet.data.FieldValueCache.clearAll(Z, fldName);\r\n\t\t\t\tvar evt = jslet.data.RefreshEvent.updateColumnEvent(fldName);\r\n\t\t\t\tZ.refreshControl(evt);\r\n\t\t\t}\r\n\t\t} //end for\r\n\t\treturn Z;\r\n\t},\r\n\r\n\t/**\r\n\t * Set or get dataset event listener.\r\n\t * Pattern:\r\n\t * function(eventType, dataset) {}\r\n\t * //eventType: jslet.data.DatasetEvent\r\n\t * //dataset: jslet.data.Dataset\r\n\t * \r\n\t * Example:\r\n\t * <pre><code>\r\n\t *   dsFoo.datasetListener(function(eventType, dataset) {\r\n\t *\t\tconsole.log(eventType);\r\n\t *   });\r\n\t * </code></pre>\r\n\t * \r\n\t * @param {Function} listener Dataset event listener\r\n\t * @return {Function or this}\r\n\t */\r\n\tdatasetListener: function(listener) {\r\n\t\tif (arguments.length === 0) {\r\n\t\t\treturn this._datasetListener;\r\n\t\t}\r\n\t\t\r\n\t\tthis._datasetListener = listener;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Fired when check a record if it's selectable or not.\r\n\t * Pattern:\r\n\t *   function() {}\r\n\t *   //return: Boolean, true - record can be selected, false - otherwise.\r\n\t */\r\n\tonCheckSelectable: function(onCheckSelectable) {\r\n\t\tif (onCheckSelectable === undefined) {\r\n\t\t\treturn this._onCheckSelectable;\r\n\t\t}\r\n\t\t\r\n\t\tthis._onCheckSelectable = onCheckSelectable;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\tfieldValidator: function() {\r\n\t\treturn this._fieldValidator;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Set or get dataset onFieldChanged event handler.\r\n\t * Pattern:\r\n\t * function(fldName, value, valueIndex) {}\r\n\t * //fldName: {String} field name\r\n\t * //value: {Object} field value\r\n\t * //valueIndex: {Integer} value index, has value when field value style is BETWEEN or MULTIPLE.\r\n\t * \r\n\t * Example:\r\n\t * <pre><code>\r\n\t *   dsFoo.onFieldChanged(function(fldName, value, valueIndex) {\r\n\t *\t\t\r\n\t *   });\r\n\t * </code></pre>\r\n\t * \r\n\t * @param {Function} onFieldChanged Dataset on field change event handler\r\n\t * @return {Function or this}\r\n\t */\r\n\tonFieldChanged: function(onFieldChanged) {\r\n\t\tif (onFieldChanged === undefined) {\r\n\t\t\treturn this._onFieldChanged;\r\n\t\t}\r\n\t\t\r\n\t\tthis._onFieldChanged = onFieldChanged;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @deprecated\r\n\t * Use onFieldChanged instead.\r\n\t */\r\n\tonFieldChange: function(onFieldChanged) {\r\n\t\tif (onFieldChanged === undefined) {\r\n\t\t\treturn this._onFieldChanged;\r\n\t\t}\r\n\t\t\r\n\t\tthis._onFieldChanged = onFieldChanged;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get dataset fields.\r\n\t * @return {Array of jslet.data.Field}\r\n\t */\r\n\tgetFields: function () {\r\n\t\treturn this._fields;\r\n\t},\r\n\r\n\t/**\r\n\t * Get fields except the fields with children.\r\n\t * @return {Array of jslet.data.Field}\r\n\t */\r\n\tgetNormalFields: function() {\r\n\t\treturn this._normalFields;\r\n\t},\r\n\t\r\n\tgetEditableFields: function() {\r\n\t\tvar fields = this._normalFields,\r\n\t\t\tfldObj,\r\n\t\t\tresult = [];\r\n\t\t\r\n\t\tfor(var i = 0, len = fields.length; i < len; i++) {\r\n\t\t\tfldObj = fields[i];\r\n\t\t\tif(fldObj.visible() && !fldObj.disabled() && !fldObj.readOnly()) {\r\n\t\t\t\tresult.push(fldObj.name());\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn result;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Set the specified fields to be visible, others to be hidden.\r\n\t * \r\n\t * Example:\r\n\t * <pre><code>\r\n\t *   dsFoo.setVisibleFields(['field1', 'field3']);\r\n\t * </code></pre>\r\n\t * \r\n\t * @param {String[]} fieldNameArray array of field name\r\n\t */\r\n\tsetVisibleFields: function(fieldNameArray) {\r\n\t\tjslet.Checker.test('Dataset.setVisibleFields#fieldNameArray', fieldNameArray).isArray();\r\n\t\tthis._travelField(this._fields, function(fldObj) {\r\n\t\t\tfldObj.visible(false);\r\n\t\t\treturn false; //Identify if cancel traveling or not\r\n\t\t});\r\n\t\tif(!fieldNameArray) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tfor(var i = 0, len = fieldNameArray.length; i < len; i++) {\r\n\t\t\tvar fldName = jQuery.trim(fieldNameArray[i]);\r\n\t\t\tvar fldObj = this.getField(fldName);\r\n\t\t\tif(fldObj) {\r\n\t\t\t\tfldObj.visible(true);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @private\r\n\t */\r\n\t_travelField: function(fields, callBackFn) {\r\n\t\tif (!callBackFn || !fields) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar isBreak = false;\r\n\t\tfor(var i = 0, len = fields.length; i < len; i++) {\r\n\t\t\tvar fldObj = fields[i];\r\n\t\t\tisBreak = callBackFn(fldObj);\r\n\t\t\tif (isBreak) {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tvar children = fldObj.children();\r\n\t\t\tif(children && children.length > 0) {\r\n\t\t\t\tisBreak = this._travelField(fldObj.children(), callBackFn);\r\n\t\t\t\tif (isBreak) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn isBreak;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @private\r\n\t */\r\n\t_cacheNormalFields: function() {\r\n\t\tvar arrFields = this._normalFields = [];\r\n\t\tthis._travelField(this._fields, function(fldObj) {\r\n\t\t\tvar children = fldObj.children();\r\n\t\t\tif(!children || children.length === 0) {\r\n\t\t\t\tarrFields.push(fldObj);\r\n\t\t\t}\r\n\t\t\treturn false; //Identify if cancel traveling or not\r\n\t\t});\r\n\t},\r\n\t\r\n\t/**\r\n\t * Set or get datasetField object, use internally.\r\n\t * \r\n\t * @param {Field} datasetField, \"dataset field\" in master dataset.\r\n\t * @return {jslet.data.Field or this}\r\n\t */\r\n\tdatasetField: function(fldObj) {\r\n\t\tif (fldObj === undefined) {\r\n\t\t\treturn this._datasetField;\r\n\t\t}\r\n\t\tjslet.Checker.test('Dataset.datasetField#fldObj', fldObj).isClass(jslet.data.Field.className);\r\n\t\tthis._datasetField = fldObj;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t* Add a new field object.\r\n\t* \r\n\t* @param {jslet.data.Field} fldObj: field object.\r\n\t*/\r\n\taddField: function (fldObj) {\r\n\t\tjslet.Checker.test('Dataset.addField#fldObj', fldObj).required().isClass(jslet.data.Field.className);\r\n\t\tvar Z = this,\r\n\t\t\tfldName = fldObj.name();\r\n\t\tif(Z.getField(fldName)) {\r\n\t\t\tZ.removeField(fldName);\r\n\t\t}\r\n\t\tZ._fields.push(fldObj);\r\n\t\tfldObj.dataset(Z);\r\n\t\tvar dispOrder = fldObj.displayOrder(); \r\n\t\tif (dispOrder) {\r\n\t\t\tZ._fields.sort(jslet.data.displayOrderComparator);\r\n\t\t} else {\r\n\t\t\tfldObj.displayOrder(Z._fields.length - 1);\r\n\t\t}\r\n\t\tif (fldObj.getType() == jslet.data.DataType.DATASET) {\r\n\t\t\tif (!Z._subDatasetFields) {\r\n\t\t\t\tZ._subDatasetFields = [];\r\n\t\t\t}\r\n\t\t\tZ._subDatasetFields.push(fldObj);\r\n\t\t}\r\n\t\t\r\n\t\tZ._cacheNormalFields();\r\n\t\t\r\n\t\tfunction addFormulaField(fldObj) {\r\n\t\t\tvar children = fldObj.children();\r\n\t\t\tif(!children || children.length === 0) {\r\n\t\t\t\tZ.addInnerFormulaField(fldObj.name(), fldObj.formula());\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tfor(var i = 0, len = children.length; i < len; i++) {\r\n\t\t\t\taddFormulaField(children[i]);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\taddFormulaField(fldObj);\r\n\t\treturn Z;\r\n\t},\r\n\t\r\n\trefreshDisplayOrder: function() {\r\n\t\tthis._fields.sort(jslet.data.displayOrderComparator);\r\n\t\tthis._cacheNormalFields();\r\n\t},\r\n\t\r\n\tmoveField: function(fromFldName, toFldName) {\r\n\t\tvar Z = this,\r\n\t\t\tfromFldObj = Z.getField(fromFldName),\r\n\t\t\ttoFldObj = Z.getField(toFldName),\r\n\t\t\tfromParent = fromFldObj.parent(),\r\n\t\t\ttoParent = toFldObj.parent();\r\n\t\tif(!fromFldObj || !toFldObj || fromParent != toParent) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar fields;\r\n\t\tif(fromParent) {\r\n\t\t\tfields = fromParent.children();\r\n\t\t} else {\r\n\t\t\tfields = Z._fields;\r\n\t\t}\r\n\t\tvar fldObj, fldName,\r\n\t\t\tfromOrder = fromFldObj.displayOrder(),\r\n\t\t\ttoOrder = toFldObj.displayOrder(),\r\n\t\t\tfromIndex = fields.indexOf(fromFldObj),\r\n\t\t\ttoIndex = fields.indexOf(toFldObj),\r\n\t\t\toldDesignMode = Z.designMode();\r\n\t\tZ.designMode(false);\r\n\t\ttry {\r\n\t\t\tfromFldObj.displayOrder(toFldObj.displayOrder());\r\n\t\t\tif(fromIndex < toIndex) {\r\n\t\t\t\tfor(var i = fromIndex + 1; i <= toIndex; i++) {\r\n\t\t\t\t\tfldObj = fields[i];\r\n\t\t\t\t\tfldObj.displayOrder(fldObj.displayOrder() - 1);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tfor(var i = toIndex; i < fromIndex; i++) {\r\n\t\t\t\t\tfldObj = fields[i];\r\n\t\t\t\t\tfldObj.displayOrder(fldObj.displayOrder() + 1);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} finally {\r\n\t\t\tZ.designMode(oldDesignMode);\r\n\t\t}\r\n\t\tZ.refreshDisplayOrder();\r\n\t\tif(Z.designMode()) {\r\n\t\t\tvar handler = jslet.data.globalDataHandler.fieldMetaChanged();\r\n\t\t\tif(handler) {\r\n\t\t\t\thandler.call(this, Z, null, 'displayOrder');\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * Remove field by field name.\r\n\t * \r\n\t * @param {String} fldName: field name.\r\n\t */\r\n\tremoveField: function (fldName) {\r\n\t\tjslet.Checker.test('Dataset.removeField#fldName', fldName).required().isString();\r\n\t\tfldName = jQuery.trim(fldName);\r\n\t\tvar Z = this,\r\n\t\t\tfldObj = Z.getField(fldName);\r\n\t\tif (fldObj) {\r\n\t\t\tif (fldObj.getType() == jslet.data.DataType.DATASET) {\r\n\t\t\t\tvar k = Z._subDatasetFields.indexOf(fldObj);\r\n\t\t\t\tif (k >= 0) {\r\n\t\t\t\t\tZ._subDatasetFields.splice(k, 1);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tvar i = Z._fields.indexOf(fldObj);\r\n\t\t\tZ._fields.splice(i, 1);\r\n\t\t\tfldObj.dataset(null);\r\n\t\t\tZ.removeInnerFormulaField(fldName);\r\n\t\t\tZ._cacheNormalFields();\r\n\t\t\tjslet.data.FieldValueCache.clearAll(Z, fldName);\r\n\r\n\t\t\tfunction removeFormulaField(fldObj) {\r\n\t\t\t\tvar children = fldObj.children();\r\n\t\t\t\tif(!children || children.length === 0) {\r\n\t\t\t\t\tZ.removeInnerFormulaField(fldObj.name());\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tfor(var i = 0, len = children.length; i < len; i++) {\r\n\t\t\t\t\tremoveFormulaField(children[i]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tremoveFormulaField(fldObj);\r\n\t\t\t\r\n\t\t}\r\n\t\treturn Z;\r\n\t},\r\n\r\n\t/**\r\n\t * Get field object by name.\r\n\t * \r\n\t * @param {String} fldName: field name.\r\n\t * @return jslet.data.Field\r\n\t */\r\n\tgetField: function (fldName) {\r\n\t\tjslet.Checker.test('Dataset.getField#fldName', fldName).isString().required();\r\n\t\tfldName = jQuery.trim(fldName);\r\n\r\n\t\tvar arrField = fldName.split('.'), fldName1 = arrField[0];\r\n\t\tvar fldObj = null;\r\n\t\tthis._travelField(this._fields, function(fldObj1) {\r\n\t\t\tvar cancelTravel = false;\r\n\t\t\tif (fldObj1.name() == fldName1) {\r\n\t\t\t\tfldObj = fldObj1;\r\n\t\t\t\tcancelTravel = true;\r\n\t\t\t}\r\n\t\t\treturn cancelTravel; //Identify if cancel traveling or not\r\n\t\t});\r\n\r\n\t\tif (!fldObj) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\t\r\n\t\tif (arrField.length == 1) {\r\n\t\t\treturn fldObj;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tarrField.splice(0, 1);\r\n\t\t\tvar lkf = fldObj.lookup();//Lookup dataset\r\n\t\t\tif (lkf) {\r\n\t\t\t\tvar lkds = lkf.dataset();\r\n\t\t\t\tif (lkds) {\r\n\t\t\t\t\treturn lkds.getField(arrField.join('.'));\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tvar subDs = fldObj.subDataset(); //Detail dataset\r\n\t\t\t\tif(subDs) {\r\n\t\t\t\t\treturn subDs.getField(arrField.join('.'));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t},\r\n\r\n\t/**\r\n\t * Get field object by name.\r\n\t * \r\n\t * @param {String} fldName: field name.\r\n\t * @return jslet.data.Field\r\n\t */\r\n\tgetTopField: function (fldName) {\r\n\t\tjslet.Checker.test('Dataset.getField#fldName', fldName).isString().required();\r\n\t\tfldName = jQuery.trim(fldName);\r\n\t\t\r\n\t\tvar fldObj = this.getField(fldName);\r\n\t\tif (fldObj) {\r\n\t\t\twhile(true) {\r\n\t\t\t\tif (fldObj.parent() === null) {\r\n\t\t\t\t\treturn fldObj;\r\n\t\t\t\t}\r\n\t\t\t\tfldObj = fldObj.parent();\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @Private,Sort function.\r\n\t * \r\n\t * @param {Object} rec1: dataset record.\r\n\t * @param {Object} rec2: dataset record.\r\n\t */\r\n\tsortFunc: function (rec1, rec2) {\r\n\t\tvar dsObj = jslet.temp.sortDataset;\r\n\t\t\r\n\t\tvar indexFlds = dsObj._sortingFields,\r\n\t\t\tstrFields = [],\r\n\t\t\tfname, idxFldCfg;\r\n\t\tfor (var i = 0, cnt = indexFlds.length; i < cnt; i++) {\r\n\t\t\tidxFldCfg = indexFlds[i];\r\n\t\t\tfname = idxFldCfg.fieldName;\r\n\t\t\tif(idxFldCfg.useTextToSort || dsObj.getField(fname).getType() === jslet.data.DataType.STRING) {\r\n\t\t\t\tstrFields.push(fname);\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar  v1, v2, flag = 1;\r\n\t\tfor (var i = 0, cnt = indexFlds.length; i < cnt; i++) {\r\n\t\t\tidxFldCfg = indexFlds[i];\r\n\t\t\tfname = idxFldCfg.fieldName;\r\n\t\t\tif(idxFldCfg.useTextToSort) {\r\n\t\t\t\tv1 = dsObj.getFieldTextByRecord(rec1, fname);\r\n\t\t\t\tv2 = dsObj.getFieldTextByRecord(rec2, fname);\r\n\t\t\t} else {\r\n\t\t\t\tv1 = dsObj.getFieldValueByRecord(rec1, fname);\r\n\t\t\t\tv2 = dsObj.getFieldValueByRecord(rec2, fname);\r\n\t\t\t}\r\n\t\t\tif (v1 == v2) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif (v1 !== null && v2 !== null) {\r\n\t\t\t\tif(strFields.indexOf(fname) >= 0) {\r\n\t\t\t\t\tv1 = v1.toLowerCase();\r\n\t\t\t\t\tv2 = v2.toLowerCase();\r\n\t\t\t\t\tflag = (v1.localeCompare(v2) < 0? -1: 1);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tflag = (v1 < v2 ? -1: 1);\r\n\t\t\t\t}\r\n\t\t\t} else if (v1 === null && v2 !== null) {\r\n\t\t\t\tflag = -1;\r\n\t\t\t} else {\r\n\t\t\t\tif (v1 !== null && v2 === null) {\r\n\t\t\t\t\tflag = 1;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn flag * idxFldCfg.order;\r\n\t\t} //end for\r\n\t\treturn 0;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Set fixed index fields, field names separated by comma(',')\r\n\t * \r\n\t * @param {String} indFlds: fixed index field name.\r\n\t * @return {String or this}\r\n\t */\r\n\tfixedIndexFields: function (fixedIndexFields) {\r\n\t\tvar Z = this;\r\n\t\tif (fixedIndexFields === undefined) {\r\n\t\t\treturn Z._fixedIndexFields;\r\n\t\t}\r\n\t\t\r\n\t\tjslet.Checker.test('Dataset.fixedIndexFields', fixedIndexFields).isString();\r\n\t\t\r\n\t\tZ._fixedIndexFields = fixedIndexFields;\r\n\t\tZ._innerFixedIndexFields = fixedIndexFields? Z._parseIndexFields(fixedIndexFields): [];\r\n\t\tvar idxFld, fixedIdxFld;\r\n\t\tfor(var i = Z._innerIndexFields.length - 1; i>=0; i--) {\r\n\t\t\tidxFld = Z._innerIndexFields[i];\r\n\t\t\tfor(var j = 0, len = Z._innerFixedIndexFields.length; j < len; j++) {\r\n\t\t\t\tfixedIdxFld = Z._innerFixedIndexFields[j];\r\n\t\t\t\tif(idxFld.fieldName === fixedIdxFld.fieldName) {\r\n\t\t\t\t\tZ._innerIndexFields.splice(i, 1);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tZ._sortByFields();\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Set index fields, field names separated by comma(',')\r\n\t * \r\n\t * @param {String} indFlds: index field name.\r\n\t * @return {String or this}\r\n\t */\r\n\tindexFields: function (indFlds) {\r\n\t\tvar Z = this;\r\n\t\tif (indFlds === undefined) {\r\n\t\t\treturn Z._indexFields;\r\n\t\t}\r\n\t\t\r\n\t\tjslet.Checker.test('Dataset.indexFields', indFlds).isString();\r\n\t\tindFlds = jQuery.trim(indFlds);\r\n\t\tif(!indFlds && !Z._indexFields && !Z._fixedIndexFields) {\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tZ._indexFields = indFlds;\r\n\t\tZ._innerIndexFields = indFlds? Z._parseIndexFields(indFlds): [];\r\n\t\tvar idxFld, fixedIdxFld;\r\n\t\tfor(var i = Z._innerIndexFields.length - 1; i>=0; i--) {\r\n\t\t\tidxFld = Z._innerIndexFields[i];\r\n\t\t\tfor(var j = 0, len = Z._innerFixedIndexFields.length; j < len; j++) {\r\n\t\t\t\tfixedIdxFld = Z._innerFixedIndexFields[j];\r\n\t\t\t\tif(idxFld.fieldName === fixedIdxFld.fieldName) {\r\n\t\t\t\t\tfixedIdxFld.order = idxFld.order;\r\n\t\t\t\t\tZ._innerIndexFields.splice(i, 1);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tZ._sortByFields();\r\n\t\treturn this;\r\n\t},\r\n\r\n\tmergedIndexFields: function() {\r\n\t\tvar Z = this,\r\n\t\t\tresult = [];\r\n\t\tfor(var i = 0, len = Z._innerFixedIndexFields.length; i < len; i++) {\r\n\t\t\tresult.push(Z._innerFixedIndexFields[i]);\r\n\t\t}\r\n\t\tfor(var i = 0, len = Z._innerIndexFields.length; i < len; i++) {\r\n\t\t\tresult.push(Z._innerIndexFields[i]);\r\n\t\t}\r\n\t\treturn result;\r\n\t},\r\n\t\r\n\ttoggleIndexField: function(fldName, emptyIndexFields) {\r\n\t\tvar Z = this,\r\n\t\t\tidxFld, \r\n\t\t\tfound = false;\r\n\t\t//Check fixed index fields\r\n\t\tfor(var i = Z._innerFixedIndexFields.length - 1; i>=0; i--) {\r\n\t\t\tidxFld = Z._innerFixedIndexFields[i];\r\n\t\t\tif(idxFld.fieldName === fldName) {\r\n\t\t\t\tidxFld.order = (idxFld.order === 1 ? -1: 1);\r\n\t\t\t\tfound = true;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(found) {\r\n\t\t\tif(emptyIndexFields) {\r\n\t\t\t\tZ._innerIndexFields = [];\r\n\t\t\t}\r\n\t\t\tZ._sortByFields();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t//Check index fields\r\n\t\tfound = false;\r\n\t\tfor(var i = Z._innerIndexFields.length - 1; i>=0; i--) {\r\n\t\t\tidxFld = Z._innerIndexFields[i];\r\n\t\t\tif(idxFld.fieldName === fldName) {\r\n\t\t\t\tidxFld.order = (idxFld.order === 1 ? -1: 1);\r\n\t\t\t\tfound = true;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(found) {\r\n\t\t\tif(emptyIndexFields) {\r\n\t\t\t\tZ._innerIndexFields = [];\r\n\t\t\t\tZ._innerIndexFields.push(idxFld);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif(emptyIndexFields) {\r\n\t\t\t\tZ._innerIndexFields = [];\r\n\t\t\t}\r\n\t\t\tidxFld = {fieldName: fldName, order: 1};\r\n\t\t\tZ._innerIndexFields.push(idxFld);\r\n\t\t}\r\n\t\tZ._sortByFields();\r\n\t},\r\n\t\r\n\t_parseIndexFields: function(indexFields) {\r\n\t\tvar arrFields = indexFields.split(','), \r\n\t\t\tfname, fldObj, arrFName, indexNameObj, \r\n\t\t\torder = 1;//asce\r\n\t\tvar result = [];\r\n\t\tfor (i = 0, cnt = arrFields.length; i < cnt; i++) {\r\n\t\t\tfname = jQuery.trim(arrFields[i]);\r\n\t\t\tarrFName = fname.split(' ');\r\n\t\t\tif (arrFName.length == 1) {\r\n\t\t\t\torder = 1;\r\n\t\t\t} else if (arrFName[1].toLowerCase() == 'asce') {\r\n\t\t\t\torder = 1; //asce\r\n\t\t\t} else {\r\n\t\t\t\torder = -1; //desc\r\n\t\t\t}\r\n\t\t\tresult.push({fieldName: arrFName[0], order: order});\r\n\t\t} //end for\r\n\t\treturn result;\r\n\t},\r\n\t\r\n\t_sortByFields: function() {\r\n\t\tvar Z = this;\r\n\t\tif (!Z.hasRecord()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tZ.selection.removeAll();\r\n\r\n\t\tZ._sortingFields = [];\r\n\t\tvar idxFld;\r\n\t\tfor (var i = 0, cnt = Z._innerFixedIndexFields.length; i < cnt; i++) {\r\n\t\t\tidxFld = Z._innerFixedIndexFields[i];\r\n\t\t\tZ._createIndexCfg(idxFld.fieldName, idxFld.order);\r\n\t\t} //end for\r\n\t\tfor (var i = 0, cnt = Z._innerIndexFields.length; i < cnt; i++) {\r\n\t\t\tidxFld = Z._innerIndexFields[i];\r\n\t\t\tZ._createIndexCfg(idxFld.fieldName, idxFld.order);\r\n\t\t} //end for\r\n\r\n\t\tvar currRec = Z.getRecord(), \r\n\t\tflag = Z.isContextRuleEnabled();\r\n\t\tif (flag) {\r\n\t\t\tZ.disableContextRule();\r\n\t\t}\r\n\t\tZ.disableControls();\r\n\t\tjslet.temp.sortDataset = Z;\r\n\t\ttry {\r\n\t\t\tZ.dataList().sort(Z.sortFunc);\r\n\t\t\tZ._refreshInnerRecno();\r\n\t\t} finally {\r\n\t\t\tjslet.temp.sortDataset = null;\r\n\t\t\tZ.moveToRecord(currRec);\r\n\t\t\tif (flag) {\r\n\t\t\t\tZ.enableContextRule();\r\n\t\t\t}\r\n\t\t\tZ.enableControls();\r\n\t\t}\t\t\r\n\t},\r\n\t\r\n\t/**\r\n\t * @private\r\n\t */\r\n\t_createIndexCfg: function(fname, order) {\r\n\t\tvar Z = this,\r\n\t\t\tfldObj = fname;\r\n\t\tif(jslet.isString(fname)) {\r\n\t\t\tfldObj = Z.getField(fname);\r\n\t\t}\r\n\t\tif (!fldObj) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(fldObj.dataset() !== Z) {\r\n\t\t\tZ._combineIndexCfg(fname, order);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar children = fldObj.children();\r\n\t\tif (!children || children.length === 0) {\r\n\t\t\tvar useTextToSort = true;\r\n\t\t\tif(fldObj.getType() === 'N' && !fldObj.lookup()) {\r\n\t\t\t\tuseTextToSort = false;\r\n\t\t\t}\r\n\t\t\tZ._combineIndexCfg(fldObj.name(), order, useTextToSort);\r\n\t\t} else {\r\n\t\t\tfor(var k = 0, childCnt = children.length; k < childCnt; k++) {\r\n\t\t\t\tZ._createIndexCfg(children[k], order);\r\n\t\t\t}\r\n\t\t}\t\t\r\n\t},\r\n\t\r\n\t/**\r\n\t * @private\r\n\t */\r\n\t_combineIndexCfg: function(fldName, order, useTextToSort) {\r\n\t\tfor(var i = 0, len = this._sortingFields.length; i < len; i++) {\r\n\t\t\tif (this._sortingFields[i].fieldName == fldName) {\r\n\t\t\t\tthis._sortingFields.splice(i,1);//remove duplicated field\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar indexNameObj = {\r\n\t\t\t\tfieldName: fldName,\r\n\t\t\t\torder: order,\r\n\t\t\t\tuseTextToSort: useTextToSort\r\n\t\t\t};\r\n\t\tthis._sortingFields.push(indexNameObj);\r\n\t},\r\n\t\r\n\t_getWholeFilter: function() {\r\n\t\tvar Z = this, \r\n\t\t\tresult = Z._fixedFilter;\r\n\t\tif(result) {\r\n\t\t\tif(Z._filter) {\r\n\t\t\t\treturn '(' + result + ') && (' + Z._filter + ')';\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tresult = Z._filter;\r\n\t\t}\r\n\t\treturn result;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Set or get dataset fixed filter expression\r\n\t * Fixed filter is the global filter expression for dataset.\r\n\t * <pre><code>\r\n\t *   dsFoo.fixedFilter('[age] > 20');\r\n\t * </code></pre>\r\n\t * \r\n\t * @param {String} fixedFilter: fixed filter expression.\r\n\t * @return {String or this}\r\n\t */\r\n\tfixedFilter: function (fixedFilter) {\r\n\t\tvar Z = this;\r\n\t\tif (fixedFilter === undefined) {\r\n\t\t\treturn Z._fixedFilter;\r\n\t\t}\r\n\t\t\r\n\t\tjslet.Checker.test('dataset.fixedFilter', fixedFilter).isString();\r\n\t\tif(fixedFilter) {\r\n\t\t\tfixedFilter = jQuery.trim(fixedFilter);\r\n\t\t}\r\n\t\tvar oldFilter = Z._getWholeFilter();\r\n\t\tZ._fixedFilter = fixedFilter;\r\n\t\tvar newFilter = Z._getWholeFilter();\r\n\t\t\r\n\t\tif (!newFilter) {\r\n\t\t\tZ._innerFilter = null;\r\n\t\t\tZ._filtered = false;\r\n\t\t\tZ._filteredRecnoArray = null;\r\n\t\t} else {\r\n\t\t\tif(oldFilter == newFilter) {\r\n\t\t\t\treturn this;\r\n\t\t\t} else {\r\n\t\t\t\tZ._innerFilter = new jslet.Expression(Z, newFilter);\r\n\t\t\t}\r\n\t\t}\r\n\t\tZ._doFilterChanged();\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Set or get dataset filter expression\r\n\t * Filter can work depending on property: filtered, filtered must be true.\r\n\t * <pre><code>\r\n\t *   dsFoo.filter('[name] like \"Bob%\"');\r\n\t *   dsFoo.filter('[age] > 20');\r\n\t * </code></pre>\r\n\t * \r\n\t * @param {String} filterExpr: filter expression.\r\n\t * @return {String or this}\r\n\t */\r\n\tfilter: function (filterExpr) {\r\n\t\tvar Z = this;\r\n\t\tif (filterExpr === undefined) {\r\n\t\t\treturn Z._filter;\r\n\t\t}\r\n\t\t\r\n\t\tjslet.Checker.test('dataset.filter#filterExpr', filterExpr).isString();\r\n\t\tif(filterExpr) {\r\n\t\t\tfilterExpr = jQuery.trim(filterExpr);\r\n\t\t}\r\n\r\n\t\tvar oldFilter = Z._getWholeFilter();\r\n\t\tZ._filter = filterExpr;\r\n\t\tvar newFilter = Z._getWholeFilter();\r\n\t\t\r\n\t\tif (!newFilter) {\r\n\t\t\tZ._innerFilter = null;\r\n\t\t\tZ._filtered = false;\r\n\t\t\tZ._filteredRecnoArray = null;\r\n\t\t} else {\r\n\t\t\tif(oldFilter == newFilter) {\r\n\t\t\t\treturn this;\r\n\t\t\t} else {\r\n\t\t\t\tZ._innerFilter = new jslet.Expression(Z, newFilter);\r\n\t\t\t}\r\n\t\t}\r\n\t\tZ._doFilterChanged();\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Set or get filtered flag\r\n\t * Only filtered is true, the filter can work\r\n\t * \r\n\t * @param {Boolean} afiltered: filter flag.\r\n\t * @return {Boolean or this}\r\n\t */\r\n\tfiltered: function (afiltered) {\r\n\t\tvar Z = this;\r\n\t\tif (afiltered === undefined) {\r\n\t\t\treturn Z._filtered;\r\n\t\t}\r\n\t\t\r\n\t\tvar oldFilter = Z._getWholeFilter(), \r\n\t\t\toldFiltered = Z._filtered;\r\n\t\tif (afiltered && !oldFilter) {\r\n\t\t\tZ._filtered = false;\r\n\t\t} else {\r\n\t\t\tZ._filtered = afiltered ? true: false;\r\n\t\t}\r\n\r\n\t\tif(oldFiltered == Z._filtered) {\r\n\t\t\treturn this;\r\n\t\t}\r\n\t\tthis._doFilterChanged();\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t_doFilterChanged: function() {\r\n\t\tvar Z = this;\r\n\t\tZ.selection.removeAll();\r\n\t\tZ.disableControls();\r\n\t\ttry {\r\n\t\t\tif (!Z._filtered) {\r\n\t\t\t\tZ._filteredRecnoArray = null;\r\n\t\t\t} else {\r\n\t\t\t\tZ._refreshInnerRecno();\r\n\t\t\t}\r\n\t\t\tZ.first();\r\n\t\t\tZ.calcAggradedValue();\t\t\r\n\t\t}\r\n\t\tfinally {\r\n\t\t\tZ.enableControls();\r\n\t\t}\r\n\t\tZ.refreshLookupHostDataset();\r\n\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @private, filter data\r\n\t */\r\n\t_filterData: function () {\r\n\t\tvar Z = this,\r\n\t\t \tfilter = Z._getWholeFilter();\r\n\t\tif (!Z._filtered || !filter || \r\n\t\t\t\tZ._status == jslet.data.DataSetStatus.INSERT || \r\n\t\t\t\tZ._status == jslet.data.DataSetStatus.UPDATE) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tvar result = Z._innerFilter.eval();\r\n\t\treturn result;\r\n\t},\r\n\r\n\t/**\r\n\t * @private\r\n\t */\r\n\t_refreshInnerRecno: function () {\r\n\t\tvar Z = this;\r\n\t\tif (!Z.hasData()) {\r\n\t\t\tZ._filteredRecnoArray = null;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tZ._filteredRecnoArray = null;\r\n\t\tvar tempRecno = [];\r\n\t\tvar oldRecno = Z._recno;\r\n\t\ttry {\r\n\t\t\tfor (var i = 0, cnt = Z.dataList().length; i < cnt; i++) {\r\n\t\t\t\tZ._recno = i;\r\n\t\t\t\tif (Z._filterData()) {\r\n\t\t\t\t\ttempRecno.push(i);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tfinally {\r\n\t\t\tZ._recno = oldRecno;\r\n\t\t}\r\n\t\tZ._filteredRecnoArray = tempRecno;\r\n\t},\r\n\r\n\t_innerAfterScrollDebounce: function() {\r\n\t\tvar Z = this,\r\n\t\t\teventFunc = jslet.getFunction(Z._datasetListener);\r\n\t\tif(eventFunc) {\r\n\t\t\teventFunc.call(Z, jslet.data.DatasetEvent.AFTERSCROLL);\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @private\r\n\t */\r\n\t_fireDatasetEvent: function (evtType) {\r\n\t\tvar Z = this;\r\n\t\tif (Z._silence || Z._igoreEvent || !Z._datasetListener) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(evtType == jslet.data.DatasetEvent.AFTERSCROLL) {\r\n\t\t\tZ._afterScrollDebounce.call(Z);\r\n\t\t} else {\r\n\t\t\tvar eventFunc = jslet.getFunction(Z._datasetListener);\r\n\t\t\tif(eventFunc) {\r\n\t\t\t\teventFunc.call(Z, evtType);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Get record count\r\n\t * \r\n\t * @return {Integer}\r\n\t */\r\n\trecordCount: function () {\r\n\t\tvar records = this.dataList();\r\n\t\tif (records) {\r\n\t\t\tif (!this._filteredRecnoArray) {\r\n\t\t\t\treturn records.length;\r\n\t\t\t} else {\r\n\t\t\t\treturn this._filteredRecnoArray.length;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn 0;\r\n\t},\r\n\r\n\thasRecord: function () {\r\n\t\treturn this.recordCount() > 0;\r\n\t},\r\n\t\r\n\thasData: function() {\r\n\t\tvar records = this.dataList();\r\n\t\treturn records && records.length > 0;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Set or get record number\r\n\t * \r\n\t * @param {Integer}record number\r\n\t * @return {Integer or this}\r\n\t */\r\n\trecno: function (recno) {\r\n\t\tvar Z = this;\r\n\t\tif (recno === undefined) {\r\n\t\t\treturn Z._recno;\r\n\t\t}\r\n\t\tjslet.Checker.test('dataset.recno#recno', recno).isGTEZero();\r\n\t\trecno = parseInt(recno);\r\n\t\tif(!Z.hasRecord()) {\r\n\t\t\tZ._bof = Z._eof = true;\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\t\r\n\t\tif (recno == Z._recno) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tZ.confirm();\r\n\t\tZ._gotoRecno(recno);\r\n\t\tZ._bof = Z._eof = false;\r\n\t\treturn true;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Set record number silently, it will not fire any event.\r\n\t * \r\n\t * @param {Integer}recno - record number\r\n\t */\r\n\trecnoSilence: function (recno) {\r\n\t\tvar Z = this;\r\n\t\tif (recno === undefined) {\r\n\t\t\treturn Z._recno;\r\n\t\t}\r\n\t\tZ._recno = recno;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * @private\r\n\t * Goto specified record number(Private)\r\n\t * \r\n\t * @param {Integer}recno - record number\r\n\t */\r\n\t_gotoRecno: function (recno) {\r\n\t\tvar Z = this,\r\n\t\t\trecCnt = Z.recordCount();\r\n\t\tif(recCnt == 0) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tif (recno >= recCnt) {\r\n\t\t\trecno = recCnt - 1;\r\n\t\t} else if (recno < 0) {\r\n\t\t\trecno = 0;\r\n\t\t}\r\n\t\t\r\n\t\tif (Z._recno == recno) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tvar evt;\r\n\t\tif (!Z._silence) {\r\n\t\t\tZ._aborted = false;\r\n\t\t\ttry {\r\n\t\t\t\tZ._fireDatasetEvent(jslet.data.DatasetEvent.BEFORESCROLL);\r\n\t\t\t\tif (Z._aborted) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t} finally {\r\n\t\t\t\tZ._aborted = false;\r\n\t\t\t}\r\n\t\t\tif (!Z._lockCount) {\r\n\t\t\t\tevt = jslet.data.RefreshEvent.beforeScrollEvent(Z._recno);\r\n\t\t\t\tZ.refreshControl(evt);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar preno = Z._recno;\r\n\t\tZ._recno = recno;\r\n\t\t\r\n\t\tif (Z._recno != preno && Z._subDatasetFields && Z._subDatasetFields.length > 0) {\r\n\t\t\tvar fldObj, subds;\r\n\t\t\tfor (var i = 0, len = Z._subDatasetFields.length; i < len; i++) {\r\n\t\t\t\tfldObj = Z._subDatasetFields[i];\r\n\t\t\t\tsubds = fldObj.subDataset();\r\n\t\t\t\tif (subds) {\r\n\t\t\t\t\tsubds._initialize(true);\r\n\t\t\t\t}\r\n\t\t\t} //end for\r\n\t\t} //end if\r\n\t\tif (!Z._silence) {\r\n\t\t\tif (Z._contextRuleEnabled) {\r\n\t\t\t\tthis.calcContextRule();\r\n\t\t\t}\r\n\t\t\tZ._fireDatasetEvent(jslet.data.DatasetEvent.AFTERSCROLL);\r\n\t\t\tif (!Z._lockCount) {\r\n\t\t\t\tevt = jslet.data.RefreshEvent.scrollEvent(Z._recno, preno);\r\n\t\t\t\tZ.refreshControl(evt);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn true;\r\n\t},\r\n\r\n\t/**\r\n\t * Abort insert/update/delete action before insert/update/delete.\r\n\t * \r\n\t */\r\n\tabort: function () {\r\n\t\tthis._aborted = true;\r\n\t},\r\n\r\n\t/**\r\n\t * Get aborted status.\r\n\t * \r\n\t * @return {Boolean}\r\n\t */\r\n\taborted: function() {\r\n\t\treturn this._aborted;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @private\r\n\t * Move cursor back to startRecno(Private)\r\n\t * \r\n\t * @param {Integer}startRecno - record number\r\n\t */\r\n\t_moveCursor: function (recno) {\r\n\t\tvar Z = this;\r\n\t\tZ.confirm();\r\n\t\tZ._gotoRecno(recno);\r\n\t},\r\n\r\n\t/**\r\n\t * Move record cursor by record object\r\n\t * \r\n\t * @param {Object}recordObj - record object\r\n\t * @return {Boolean} true - Move successfully, false otherwise. \r\n\t */\r\n\tmoveToRecord: function (recordObj) {\r\n\t\tvar Z = this;\r\n\t\tZ.confirm();\r\n\t\tif (!Z.hasRecord() || !recordObj) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tjslet.Checker.test('dataset.moveToRecord#recordObj', recordObj).isObject();\r\n\t\tvar k = Z.dataList().indexOf(recordObj);\r\n\t\tif (k < 0) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tif (Z._filteredRecnoArray) {\r\n\t\t\tk = Z._filteredRecnoArray.indexOf(k);\r\n\t\t\tif (k < 0) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\t\tZ._gotoRecno(k);\r\n\t\treturn true;\r\n\t},\r\n\r\n\t/**\r\n\t * @private\r\n\t */\r\n\tstartSilenceMove: function (notLogPos) {\r\n\t\tvar Z = this;\r\n\t\tvar context = {};\r\n\t\tif (!notLogPos) {\r\n\t\t\tcontext.recno = Z._recno;\r\n\t\t} else {\r\n\t\t\tcontext.recno = -999;\r\n\t\t}\r\n\r\n\t\tZ._silence++;\r\n\t\treturn context;\r\n\t},\r\n\r\n\t/**\r\n\t * @private\r\n\t */\r\n\tendSilenceMove: function (context) {\r\n\t\tvar Z = this;\r\n\t\tif (context.recno != -999 && context.recno != Z._recno) {\r\n\t\t\tZ._gotoRecno(context.recno);\r\n\t\t}\r\n\t\tZ._silence--;\r\n\t},\r\n\r\n\t/**\r\n\t * Check dataset cursor at the last record\r\n\t * \r\n\t * @return {Boolean}\r\n\t */\r\n\tisBof: function () {\r\n\t\treturn this._bof;\r\n\t},\r\n\r\n\t/**\r\n\t * Check dataset cursor at the first record\r\n\t * \r\n\t * @return {Boolean}\r\n\t */\r\n\tisEof: function () {\r\n\t\treturn this._eof;\r\n\t},\r\n\r\n\t/**\r\n\t * Move cursor to first record\r\n\t */\r\n\tfirst: function () {\r\n\t\tvar Z = this;\r\n\t\tif(!Z.hasRecord()) {\r\n\t\t\tZ._bof = Z._eof = true;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tZ._moveCursor(0);\r\n\t\tZ._bof = Z._eof = false;\r\n\t},\r\n\r\n\t/**\r\n\t * Move cursor to last record\r\n\t */\r\n\tnext: function () {\r\n\t\tvar Z = this;\r\n\t\tvar recCnt = Z.recordCount();\r\n\t\tif(recCnt === 0) {\r\n\t\t\tZ._bof = Z._eof = true;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(Z._recno == recCnt - 1) {\r\n\t\t\tZ._bof = false;\r\n\t\t\tZ._eof = true;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tZ._bof = Z._eof = false;\r\n\t\tZ._moveCursor(Z._recno + 1);\r\n\t},\r\n\r\n\t/**\r\n\t * Move cursor to prior record\r\n\t */\r\n\tprior: function () {\r\n\t\tvar Z = this;\r\n\t\tif(!Z.hasRecord()) {\r\n\t\t\tZ._bof = Z._eof = true;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(Z._recno === 0) {\r\n\t\t\tZ._bof = true;\r\n\t\t\tZ._eof = false;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tZ._bof = Z._eof = false;\r\n\t\tZ._moveCursor(Z._recno - 1);\r\n\t},\r\n\r\n\t/**\r\n\t * Move cursor to next record\r\n\t */\r\n\tlast: function () {\r\n\t\tvar Z = this;\r\n\t\tif(!Z.hasRecord()) {\r\n\t\t\tZ._bof = Z._eof = true;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tZ._bof = Z._eof = false;\r\n\t\tZ._moveCursor(Z.recordCount() - 1);\r\n\t\tZ._bof = Z._eof = false;\r\n\t},\r\n\r\n\t/**\r\n\t * @private\r\n\t * Check dataset status and cancel dataset \r\n\t */\r\n\tcheckStatusByCancel: function () {\r\n\t\tif (this._status != jslet.data.DataSetStatus.BROWSE) {\r\n\t\t\tthis.cancel();\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Insert child record by parentId, and move cursor to the newly record.\r\n\t * \r\n\t * @param {Object} parentId - key value of parent record\r\n\t */\r\n\tinsertChild: function (parentId) {\r\n\t\tvar Z = this;\r\n\t\tif (!Z._parentField || !Z.keyField()) {\r\n\t\t\tthrow new Error('parentField and keyField not set,use insertRecord() instead!');\r\n\t\t}\r\n\r\n\t\tif (!Z.hasRecord()) {\r\n\t\t\tZ.innerInsert();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar context = Z.startSilenceMove(true);\r\n\t\ttry {\r\n\t\t\tZ.expanded(true);\r\n\t\t\tif (parentId) {\r\n\t\t\t\tif (!Z.findByKey(parentId)) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tparentId = Z.keyValue();\r\n\t\t\t}\r\n\r\n\t\t\tvar pfldname = Z.parentField(), \r\n\t\t\t\tparentParentId = Z.getFieldValue(pfldname);\r\n\t\t\twhile (true) {\r\n\t\t\t\tZ.next();\r\n\t\t\t\tif (Z.isEof()) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tif (parentParentId == Z.getFieldValue(pfldname)) {\r\n\t\t\t\t\tZ.prior();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} finally {\r\n\t\t\tZ.endSilenceMove(context);\r\n\t\t}\r\n\r\n\t\tZ.innerInsert(function (newRec) {\r\n\t\t\tnewRec[Z._parentField] = parentId;\r\n\t\t});\r\n\t},\r\n\r\n\t/**\r\n\t * Insert sibling record of current record, and move cursor to the newly record.\r\n\t */\r\n\tinsertSibling: function () {\r\n\t\tvar Z = this;\r\n\t\tif (!Z._parentField || !Z._keyField) {\r\n\t\t\tthrow new Error('parentField and keyField not set,use insertRecord() instead!');\r\n\t\t}\r\n\r\n\t\tif (!Z.hasRecord()) {\r\n\t\t\tZ.innerInsert();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar parentId = Z.getFieldValue(Z.parentField()),\r\n\t\t\tcontext = Z.startSilenceMove(true),\r\n\t\t\tfound = false,\r\n\t\t\tparentKeys = [],\r\n\t\t\tcurrPKey, lastPKey = prePKey = Z.keyValue();\r\n\t\ttry {\r\n\t\t\tZ.next();\r\n\t\t\twhile (!Z.isEof()) {\r\n\t\t\t\tcurrPKey = Z.parentValue();\r\n\t\t\t\tif(currPKey == prePKey) {\r\n\t\t\t\t\tparentKeys.push(prePKey);\r\n\t\t\t\t\tlastPKey = prePKey;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif(lastPKey != currPKey) {\r\n\t\t\t\t\t\tif(parentKeys.indexOf(currPKey) < 0) {\r\n\t\t\t\t\t\t\tZ.prior();\r\n\t\t\t\t\t\t\tfound = true;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tprePKey = currPKey;\r\n\t\t\t\tZ.next();\r\n\t\t\t}\r\n\t\t\tif (!found) {\r\n\t\t\t\tZ.last();\r\n\t\t\t}\r\n\t\t} finally {\r\n\t\t\tZ.endSilenceMove(context);\r\n\t\t}\r\n\r\n\t\tZ.innerInsert(function (newRec) {\r\n\t\t\tnewRec[Z._parentField] = parentId;\r\n\t\t});\r\n\t},\r\n\r\n\t/**\r\n\t * Insert record after current record, and move cursor to the newly record.\r\n\t */\r\n\tinsertRecord: function () {\r\n\t\tvar Z = this;\r\n\t\tZ.confirm();\r\n\r\n\t\tZ.innerInsert();\r\n\t},\r\n\r\n\t/**\r\n\t * Add record after last record, and move cursor to the newly record.\r\n\t */\r\n\tappendRecord: function () {\r\n\t\tvar Z = this;\r\n\t\tZ.confirm();\r\n\r\n\t\tZ._silence++;\r\n\t\ttry {\r\n\t\t\tZ.last();\r\n\t\t} finally {\r\n\t\t\tZ._silence--;\r\n\t\t}\r\n\t\tZ.insertRecord();\r\n\t},\r\n\r\n\t/**\r\n\t * @private\r\n\t */\r\n\tstatus: function(status) {\r\n\t\tif(status === undefined) {\r\n\t\t\treturn this._status;\r\n\t\t}\r\n\t\tthis._status = status;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\texpanded: function(expanded) {\r\n\t\tthis.expandedByRecno(this.recno(), expanded);\r\n\t},\r\n\t\r\n\texpandedByRecno: function(recno, expanded) {\r\n\t\tjslet.Checker.test('dataset.expandedByRecno', recno).required().isNumber();\r\n\t\tvar record = this.getRecord(recno);\r\n\t\tvar recInfo = jslet.data.getRecInfo(record);\r\n\t\tif(expanded === undefined) {\r\n\t\t\tvar result = recInfo && recInfo.expanded;\r\n\t\t\treturn result? true: false;\r\n\t\t}\r\n\t\tif(recInfo == null) {\r\n\t\t\treturn this;\r\n\t\t}\r\n\t\trecInfo.expanded = expanded;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @private\r\n\t */\r\n\tchangedStatus: function(status) {\r\n\t\tvar record = this.getRecord();\r\n\t\tif(!record) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tvar recInfo = jslet.data.getRecInfo(record);\t\t\r\n\t\tif(status === undefined) {\r\n\t\t\tif(!recInfo) {\r\n\t\t\t\treturn jslet.data.DataSetStatus.BROWSE;\r\n\t\t\t}\r\n\t\t\treturn recInfo.status;\r\n\t\t}\r\n\t\tvar\toldStatus = recInfo.status;\r\n\t\tif(status === jslet.data.DataSetStatus.DELETE) {\r\n\t\t\trecInfo.status = status;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(oldStatus === jslet.data.DataSetStatus.INSERT) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(oldStatus != status) {\r\n\t\t\tif(this._contextRuleEngine) {\r\n\t\t\t\tthis._contextRuleEngine.evalStatus();\r\n\t\t\t}\r\n\t\t\trecInfo.status = status;\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @Private\r\n\t */\r\n\tinnerInsert: function (beforeInsertFn) {\r\n\t\tvar Z = this;\r\n\t\tZ.confirm();\r\n\r\n\t\tZ.selection.removeAll();\r\n\t\tvar mfld = Z._datasetField, mds = null;\r\n\t\tif (mfld) {\r\n\t\t\tmds = mfld.dataset();\r\n\t\t\tif (!mds.hasRecord()) {\r\n\t\t\t\tthrow new Error(jslet.locale.Dataset.insertMasterFirst);\r\n\t\t\t}\r\n\t\t\tmds.editRecord();\r\n\t\t}\r\n\r\n\t\tZ._aborted = false;\r\n\t\ttry {\r\n\t\t\tZ._fireDatasetEvent(jslet.data.DatasetEvent.BEFOREINSERT);\r\n\t\t\tif (Z._aborted) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t} finally {\r\n\t\t\tZ._aborted = false;\r\n\t\t}\r\n\r\n\t\tvar records = Z.dataList();\r\n\t\tif (records === null) {\r\n\t\t\trecords = [];\r\n\t\t\tZ.dataList(records);\r\n\t\t}\r\n\t\tvar preRecno = Z.recno(), k;\r\n\t\tif (Z.hasRecord()) {\r\n\t\t\tk = records.indexOf(this.getRecord()) + 1;\r\n\t\t} else {\r\n\t\t\tk = 0;\r\n\t\t}\r\n\r\n\t\tvar newRecord = {};\r\n\t\trecords.splice(k, 0, newRecord);\r\n\r\n\t\tif (Z._filteredRecnoArray && Z._filteredRecnoArray.length > 0) {\r\n\t\t\tfor (var i = Z._filteredRecnoArray.length - 1; i >= 0; i--) {\r\n\t\t\t\tif (Z._filteredRecnoArray[i] < k) {\r\n\t\t\t\t\tZ._filteredRecnoArray.splice(i + 1, 0, k);\r\n\t\t\t\t\tZ._recno = k;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tZ._filteredRecnoArray[i] += 1;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tZ._recno = k;\r\n\t\t}\r\n\t\t\r\n\t\tZ.status(jslet.data.DataSetStatus.INSERT);\r\n\t\tZ.changedStatus(jslet.data.DataSetStatus.INSERT);\r\n\t\tZ._calcDefaultValue();\r\n\t\tif (beforeInsertFn) {\r\n\t\t\tbeforeInsertFn(newRecord);\r\n\t\t}\r\n\r\n\t\t//calc other fields' range to use context rule\r\n\t\tif (Z._contextRuleEnabled) {\r\n\t\t\tZ.calcContextRule();\r\n\t\t}\r\n\r\n\t\tZ._fireDatasetEvent(jslet.data.DatasetEvent.AFTERINSERT);\r\n\t\tZ._fireDatasetEvent(jslet.data.DatasetEvent.AFTERSCROLL);\r\n\t\tvar evt = jslet.data.RefreshEvent.insertEvent(preRecno, Z.recno(), Z._recno < Z.recordCount() - 1);\r\n\t\tZ.refreshControl(evt);\r\n\t},\r\n\r\n\t/**\r\n\t * Insert all records of source dataset into current dataset;\r\n\t * Source dataset's structure must be same as current dataset \r\n\t * \r\n\t * @param {Integer}srcDataset - source dataset\r\n\t */\r\n\tinsertDataset: function (srcDataset) {\r\n\t\tvar Z = this;\r\n\t\tvar oldFiltered = Z.filtered();\r\n\t\tvar thisContext = Z.startSilenceMove(true);\r\n\t\tvar srcContext = srcDataset.startSilenceMove(true), rec;\r\n\t\ttry {\r\n\t\t\tZ.filtered(false);\r\n\t\t\tsrcDataset.first();\r\n\t\t\twhile (!srcDataset.isEof()) {\r\n\t\t\t\tZ.insertRecord();\r\n\t\t\t\tZ.cloneRecord(srcDataset.getRecord(), Z.getRecord());\r\n\t\t\t\tZ.confirm();\r\n\t\t\t\tsrcDataset.next();\r\n\t\t\t}\r\n\t\t} finally {\r\n\t\t\tsrcDataset.endSilenceMove(srcContext);\r\n\t\t\tZ.filtered(oldFiltered);\r\n\t\t\tZ.endSilenceMove(thisContext);\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Append all records of source dataset into current dataset;\r\n\t * Source dataset's structure must be same as current dataset \r\n\t * \r\n\t * @param {Integer}srcDataset - source dataset\r\n\t */\r\n\tappendDataset: function (srcDataset) {\r\n\t\tvar Z = this;\r\n\t\tZ._silence++;\r\n\t\ttry {\r\n\t\t\tZ.last();\r\n\t\t} finally {\r\n\t\t\tZ._silence--;\r\n\t\t}\r\n\t\tZ.insertDataset(srcDataset);\r\n\t},\r\n\r\n\t/**\r\n\t * Append records into dataset.\r\n\t * \r\n\t * @param {Array} records An array of object which need to append to dataset\r\n\t * @param {Boolean} replaceExists true - replace the record if it exists, false - skip to append if it exists. \r\n\t */\r\n\tbatchAppendRecords: function(records, replaceExists) {\r\n\t\tjslet.Checker.test('dataset.records', records).required().isArray();\r\n\t\tvar Z = this;\r\n\t\tZ.confirm();\r\n\t\t\r\n\t\tZ.selection.removeAll();\r\n\t\tZ.disableControls();\r\n\t\ttry{\r\n\t\t\tvar keyField = Z.keyField(), rec, found,\r\n\t\t\t\tkeyValue;\r\n\t\t\tfor(var i = 0, len = records.length; i < len; i++) {\r\n\t\t\t\trec = records[i];\r\n\t\t\t\tfound = false;\r\n\t\t\t\tif(keyField) {\r\n\t\t\t\t\tkeyValue = rec[keyField];\r\n\t\t\t\t\tif(keyValue && Z.findByKey(keyValue)) {\r\n\t\t\t\t\t\tfound = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif(found) {\r\n\t\t\t\t\tif(replaceExists) {\r\n\t\t\t\t\t\tZ.editRecord();\r\n\t\t\t\t\t\tZ.cloneRecord(rec, Z.getRecord());\r\n\t\t\t\t\t\tZ.confirm();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tZ.appendRecord();\r\n\t\t\t\t\tZ.cloneRecord(rec, Z.getRecord());\r\n\t\t\t\t\tZ.confirm();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} finally {\r\n\t\t\tZ.enableControls();\r\n\t\t\tZ.refreshControl(jslet.data.RefreshEvent._updateAllEvent);\r\n\t\t\tZ.refreshLookupHostDataset();\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @rivate\r\n\t * Calculate default value.\r\n\t */\r\n\t_calcDefaultValue: function () {\r\n\t\tvar Z = this, fldObj, expr, value, fldName;\r\n\t\tfor (var i = 0, fldcnt = Z._normalFields.length; i < fldcnt; i++) {\r\n\t\t\tfldObj = Z._normalFields[i];\r\n\t\t\tfldName = fldObj.name();\r\n\t\t\tif (fldObj.getType() == jslet.data.DataType.DATASET) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(fldObj.valueFollow() && Z._followedValue) {\r\n\t\t\t\tvar fValue = Z._followedValue[fldName];\r\n\t\t\t\tif(fValue !== undefined) {\r\n\t\t\t\t\tfldObj.setValue(fValue);\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tvalue = fldObj.defaultValue();\r\n\t\t\tif (value === undefined || value === null || value === '') {\r\n\t\t\t\texpr = fldObj.defaultExpr();\r\n\t\t\t\tif (!expr) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tvalue = window.eval(expr);\r\n\t\t\t} else {\r\n\t\t\t\tif(fldObj.getType() === jslet.data.DataType.NUMBER) {\r\n\t\t\t\t\tvalue = fldObj.scale() > 0 ? parseFloat(value): parseInt(value);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tvar valueStyle = fldObj.valueStyle();\r\n\t\t\tif(value && jslet.isDate(value)) {\r\n\t\t\t\tvalue = new Date(value.getTime());\r\n\t\t\t}\r\n\t\t\tif(valueStyle == jslet.data.FieldValueStyle.BETWEEN) {\r\n\t\t\t\tif(value) {\r\n\t\t\t\t\tvalue = [value, value];\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvalue = [null, null];\r\n\t\t\t\t}\r\n\t\t\t} else if(valueStyle == jslet.data.FieldValueStyle.MULTIPLE) {\r\n\t\t\t\tvalue = [value];\r\n\t\t\t}\r\n\t\t\tZ.setFieldValue(fldName, value);\t\t\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * @rivate\r\n\t * Calculate default value.\r\n\t */\r\n\tcheckAggraded: function(fldName) {\r\n\t\tvar Z = this,\r\n\t\t\tfldObj;\r\n\t\tif(fldName) {\r\n\t\t\tfldObj = Z.getField(fldName);\r\n\t\t\treturn fldObj.aggraded();\r\n\t\t}\r\n\t\tvar fields = Z.getNormalFields();\r\n\t\tfor(var i = 0, len = fields.length; i< len; i++) {\r\n\t\t\tfldObj = fields[i];\r\n\t\t\tif(fldObj.aggraded()) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t},\r\n\t\r\n\t/**\r\n\t * \r\n\t * Calculate aggraded value.\r\n\t */\r\n\tcalcAggradedValue: function(fldName) {\r\n\t\tvar Z = this;\r\n\t\tif(!Z.checkAggraded(fldName)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar fields = Z.getNormalFields(), \r\n\t\t\tfldObj, aggradedBy,\r\n\t\t\taggradedFields = [],\r\n\t\t\tarrAggradeBy = [],\r\n\t\t\taggradedValues = null;\r\n\t\tfor(var i = 0, len = fields.length; i< len; i++) {\r\n\t\t\tfldObj = fields[i];\r\n\t\t\tif(fldObj.aggraded()) {\r\n\t\t\t\taggradedBy = fldObj.aggradedBy();\r\n\t\t\t\tif(fldObj.getType() !== jslet.data.DataType.NUMBER && !aggradedBy) {\r\n\t\t\t\t\tif(!aggradedValues) {\r\n\t\t\t\t\t\taggradedValues = {};\r\n\t\t\t\t\t}\r\n\t\t\t\t\taggradedValues[fldObj.name()] = {count: Z.recordCount(), sum: 0};\r\n\t\t\t\t} else {\r\n\t\t\t\t\taggradedFields.push(fldObj);\r\n\t\t\t\t}\r\n\t\t\t\tif(aggradedBy && arrAggradeBy.indexOf(aggradedBy) === -1) {\r\n\t\t\t\t\tarrAggradeBy.push({aggradedBy: aggradedBy, values: [], exists: false});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(aggradedFields.length === 0) {\r\n\t\t\tZ.aggradedValues(aggradedValues);\t\t\t\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(!aggradedValues) {\r\n\t\t\taggradedValues = {};\r\n\t\t}\r\n\t\t\r\n\t\tfunction getAggradeByValue(aggradedBy) {\r\n\t\t\tif(aggradedBy.indexOf(',') < 0) {\r\n\t\t\t\treturn Z.getFieldValue(aggradedBy);\r\n\t\t\t}\r\n\t\t\tvar fieldNames = aggradedBy.split(',');\r\n\t\t\tvar values = [];\r\n\t\t\tfor(var i = 0, len = fieldNames.length; i < len; i++) {\r\n\t\t\t\tvalues.push(Z.getFieldValue(fieldNames[i]));\r\n\t\t\t}\r\n\t\t\treturn values.join(',')\r\n\t\t}\r\n\t\t\r\n\t\tfunction updateAggrByValues(arrAggradeBy) {\r\n\t\t\tvar aggrByObj, \r\n\t\t\t\taggrByValue,\r\n\t\t\t\tarrAggrByValues;\t\t\t\r\n\t\t\tfor(var i = 0, len = arrAggradeBy.length; i < len; i++) {\r\n\t\t\t\taggrByObj = arrAggradeBy[i];\r\n\t\t\t\tarrAggrByValues = aggrByObj.values;\r\n\t\t\t\taggrByValue = getAggradeByValue(aggrByObj.aggradedBy);\r\n\t\t\t\tif(arrAggrByValues.indexOf(aggrByValue) < 0) {\r\n\t\t\t\t\tarrAggrByValues.push(aggrByValue);\r\n\t\t\t\t\taggrByObj.exists = false;\r\n\t\t\t\t} else {\r\n\t\t\t\t\taggrByObj.exists = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tfunction existAggrBy(arrAggradeBy, aggradedBy) {\r\n\t\t\tvar aggrByObj;\t\t\t\r\n\t\t\tfor(var i = 0, len = arrAggradeBy.length; i < len; i++) {\r\n\t\t\t\taggrByObj = arrAggradeBy[i];\r\n\t\t\t\tif(aggrByObj.aggradedBy == aggradedBy) {\r\n\t\t\t\t\treturn aggrByObj.exists;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tconsole.warn('Not found aggradedBy value!');\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\t\r\n\t\tvar oldRecno = Z.recnoSilence(),\r\n\t\t\tfldCnt = aggradedFields.length, \r\n\t\t\tfldName, value, totalValue,\r\n\t\t\taggradedValueObj;\r\n\t\ttry{\r\n\t\t\tfor(var k = 0, recCnt = Z.recordCount(); k < recCnt; k++) {\r\n\t\t\t\tZ.recnoSilence(k);\r\n\t\t\t\tupdateAggrByValues(arrAggradeBy);\r\n\t\t\t\t\r\n\t\t\t\tfor(var i = 0; i < fldCnt; i++) {\r\n\t\t\t\t\tfldObj = aggradedFields[i];\r\n\t\t\t\t\tfldName = fldObj.name();\r\n\t\t\t\t\taggradedBy = fldObj.aggradedBy();\r\n\t\t\t\t\tif(aggradedBy && existAggrBy(arrAggradeBy, aggradedBy)) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t\taggradedValueObj = aggradedValues[fldName];\r\n\t\t\t\t\tif(!aggradedValueObj) {\r\n\t\t\t\t\t\taggradedValueObj = {count: 0, sum: 0};\r\n\t\t\t\t\t\taggradedValues[fldName] = aggradedValueObj; \r\n\t\t\t\t\t}\r\n\t\t\t\t\taggradedValueObj.count = aggradedValueObj.count + 1;\r\n\t\t\t\t\tif(fldObj.getType() === jslet.data.DataType.NUMBER) {\r\n\t\t\t\t\t\tvalue = Z.getFieldValue(fldName) || 0;\r\n\t\t\t\t\t\tif(jslet.isString(value)) {\r\n\t\t\t\t\t\t\tthrow new Error('Field: ' + fldName + ' requires Number value!');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\taggradedValueObj.sum = aggradedValueObj.sum + value;\r\n\t\t\t\t\t}\r\n\t\t\t\t} //end for i\r\n\t\t\t} //end for k\r\n\t\t}finally{\r\n\t\t\tZ.recnoSilence(oldRecno);\r\n\t\t}\r\n\t\tvar scale;\r\n\t\tfor(var i = 0; i < fldCnt; i++) {\r\n\t\t\tfldObj = aggradedFields[i];\r\n\t\t\tfldName = fldObj.name();\r\n\t\t\tscale = fldObj.scale() || 0;\r\n\t\t\taggradedValueObj = aggradedValues[fldName];\r\n\t\t\tif(!aggradedValueObj ) {\r\n\t\t\t\taggradedValueObj = {count: 0, sum: 0};\r\n\t\t\t\taggradedValues[fldName] = aggradedValueObj;\r\n\t\t\t}\r\n\t\t\tvar sumValue = aggradedValueObj.sum;\r\n\t\t\tif(sumValue) {\r\n\t\t\t\tvar pow = Math.pow(10, scale);\r\n\t\t\t\tsumValue = Math.round(sumValue * pow) / pow;\r\n\t\t\t\taggradedValueObj.sum = sumValue;\r\n\t\t\t}\r\n\t\t} //end for i\r\n\t\tZ.aggradedValues(aggradedValues);\t\t\t\r\n\t},\r\n\t\r\n\taggradedValues: function(aggradedValues) {\r\n\t\tvar Z = this;\r\n\t\tif(aggradedValues === undefined) {\r\n\t\t\treturn Z._aggradedValues;\r\n\t\t}\r\n\t\tvar Z = this;\r\n\t\tZ._aggradedValues = aggradedValues;\r\n\t\tif(!Z._aggradedValues && !aggradedValues) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tevt = jslet.data.RefreshEvent.aggradedEvent();\r\n\t\tZ.refreshControl(evt);\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get record object by record number.\r\n\t * \r\n\t * @param {Integer} recno Record Number.\r\n\t * @return {Object} Dataset record.\r\n\t */\r\n\tgetRecord: function (recno) {\r\n\t\tvar Z = this, k;\r\n\t\tif(!Z.hasData()) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tvar records = Z.dataList();\r\n\t\t//Used to convert field value for performance purpose. \r\n\t\tif(Z._ignoreFilter) {\r\n\t\t\treturn records[Z._ignoreFilterRecno || 0];\r\n\t\t}\r\n\t\t\r\n\t\tif (Z.recordCount() === 0) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tif (recno === undefined || recno === null) {\r\n\t\t\trecno = Z._recno >= 0 ? Z._recno : 0;\r\n\t\t} else {\r\n\t\t\tif (recno < 0 || recno >= Z.recordCount()) {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tif (Z._filteredRecnoArray) {\r\n\t\t\tk = Z._filteredRecnoArray[recno];\r\n\t\t} else {\r\n\t\t\tk = recno;\r\n\t\t}\r\n\r\n\t\treturn records[k];\r\n\t},\r\n\r\n\t/**\r\n\t * @private\r\n\t */\r\n\tgetRelativeRecord: function (delta) {\r\n\t\treturn this.getRecord(this._recno + delta);\r\n\t},\r\n\r\n\t/**\r\n\t * @private\r\n\t */\r\n\tisSameAsPrevious: function (fldName) {\r\n\t\tvar Z = this,\r\n\t\t\tpreRec = Z.getRelativeRecord(-1);\r\n\t\tif (!preRec) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tvar currRec = Z.getRecord(),\r\n\t\t\tpreValue = preRec[fldName],\r\n\t\t\tcurrValue = currRec[fldName],\r\n\t\t\tisSame = false;\r\n\t\tif(!preValue && preValue !== 0 && !currValue && currValue !== 0) {\r\n\t\t\tisSame = true;\r\n\t\t} else if(preValue && currValue) {\r\n\t\t\tif(jslet.isDate(preValue)) { //Date time comparing\r\n\t\t\t\tisSame = (preValue.getTime() == currValue.getTime());\r\n\t\t\t} else {\r\n\t\t\t\tisSame = (preValue == currValue);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(!isSame) {\r\n\t\t\treturn isSame;\r\n\t\t}\r\n\t\tvar\tfldObj = Z.getField(fldName),\r\n\t\t\tmergeSameBy = fldObj.mergeSameBy();\r\n\t\tif(mergeSameBy) {\r\n\t\t\tvar arrFlds = mergeSameBy.split(','), groupFldName;\r\n\t\t\tfor(var i = 0, len = arrFlds.length; i < len; i++) {\r\n\t\t\t\tgroupFldName = jQuery.trim(arrFlds[i]);\r\n\t\t\t\tif(preRec[groupFldName] != currRec[groupFldName]) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn isSame;\r\n\t},\r\n\r\n\t/**\r\n\t * Check the current record has child records or not\r\n\t * \r\n\t * @return {Boolean}\r\n\t */\r\n\thasChildren: function () {\r\n\t\tvar Z = this;\r\n\t\tif (!Z._parentField) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tvar context = Z.startSilenceMove();\r\n\t\tvar keyValue = Z.keyValue();\r\n\t\ttry {\r\n\t\t\tZ.next();\r\n\t\t\tif (!Z.isEof()) {\r\n\t\t\t\tvar pValue = Z.parentValue();\r\n\t\t\t\tif (pValue == keyValue) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t} finally {\r\n\t\t\tZ.endSilenceMove(context);\r\n\t\t}\r\n\t},\r\n\t\r\n\t/** \r\n\t* Iterate the child records of current record, and run the specified callback function. \r\n\t* Example: \r\n\t* \r\n\t* dataset.iterateChildren(function(){\r\n\t* \tvar fldValue = this.getFieldValue('xxx');\r\n\t* \tthis.setFieldValue('xxx', fldValue);\r\n\t* }); \r\n\t* \r\n\t*/ \r\n\titerateChildren: function() {\r\n\t\t\r\n\t},\r\n\t\r\n\t/**\r\n\t * Update record and send dataset to update status.\r\n\t * You can use cancel() or confirm() method to return browse status.\r\n\t */\r\n\teditRecord: function () {\r\n\t\tvar Z = this;\r\n\t\tif (Z._status == jslet.data.DataSetStatus.UPDATE ||\r\n\t\t\tZ._status == jslet.data.DataSetStatus.INSERT) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tZ.selection.removeAll();\r\n\t\tif (!Z.hasRecord()) {\r\n\t\t\tZ.insertRecord();\r\n\t\t} else {\r\n\t\t\tZ._aborted = false;\r\n\t\t\ttry {\r\n\t\t\t\tZ._fireDatasetEvent(jslet.data.DatasetEvent.BEFOREUPDATE);\r\n\t\t\t\tif (Z._aborted) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t} finally {\r\n\t\t\t\tZ._aborted = false;\r\n\t\t\t}\r\n\r\n\t\t\tZ._modiObject = {};\r\n\t\t\tjQuery.extend(Z._modiObject, Z.getRecord());\r\n\t\t\tvar mfld = Z._datasetField;\r\n\t\t\tif (mfld && mfld.dataset()) {\r\n\t\t\t\tmfld.dataset().editRecord();\r\n\t\t\t}\r\n\r\n\t\t\tZ.status(jslet.data.DataSetStatus.UPDATE);\r\n//\t\t\tZ.changedStatus(jslet.data.DataSetStatus.UPDATE);\r\n\t\t\tZ._fireDatasetEvent(jslet.data.DatasetEvent.AFTERUPDATE);\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Delete record\r\n\t */\r\n\tdeleteRecord: function () {\r\n\t\tvar Z = this;\r\n\t\tvar recCnt = Z.recordCount();\r\n\t\tif (recCnt === 0 || Z.changedStatus() === jslet.data.DataSetStatus.DELETE) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tZ.selection.removeAll();\r\n\t\tif (Z._status == jslet.data.DataSetStatus.INSERT) {\r\n\t\t\tZ.cancel();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tZ._silence++;\r\n\t\ttry {\r\n\t\t\tZ.checkStatusByCancel();\r\n\t\t} finally {\r\n\t\t\tZ._silence--;\r\n\t\t}\r\n\r\n\t\tif (Z.hasChildren()) {\r\n\t\t\tjslet.showInfo(jslet.locale.Dataset.cannotDelParent);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tZ._aborted = false;\r\n\t\ttry {\r\n\t\t\tZ._fireDatasetEvent(jslet.data.DatasetEvent.BEFOREDELETE);\r\n\t\t\tif (Z._aborted) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t} finally {\r\n\t\t\tZ._aborted = false;\r\n\t\t}\r\n\t\tvar preRecno = Z.recno(), \r\n\t\t\tisLast = preRecno == (recCnt - 1), \r\n\t\t\tk = Z._recno;\r\n\t\tif(Z.changedStatus() === jslet.data.DataSetStatus.INSERT) {\r\n\t\t\tZ._changeLog.unlog();\r\n\t\t} else {\r\n\t\t\tZ.changedStatus(jslet.data.DataSetStatus.DELETE);\r\n\t\t\tZ._changeLog.log();\r\n\t\t}\r\n\t\tZ.dataList().splice(k, 1);\r\n\t\tZ._refreshInnerRecno();\r\n\t\t\r\n\t\tvar mfld = Z._datasetField;\r\n\t\tif (mfld && mfld.dataset()) {\r\n\t\t\tmfld.dataset().editRecord();\r\n\t\t}\r\n\r\n\t\tZ.status(jslet.data.DataSetStatus.BROWSE);\r\n\t\t\r\n\t\tif (isLast) {\r\n\t\t\tZ._silence++;\r\n\t\t\ttry {\r\n\t\t\t\tZ.prior();\r\n\t\t\t} finally {\r\n\t\t\t\tZ._silence--;\r\n\t\t\t}\r\n\t\t}\r\n\t\tZ.calcAggradedValue();\r\n\t\tvar evt = jslet.data.RefreshEvent.deleteEvent(preRecno);\r\n\t\tZ.refreshControl(evt);\r\n\t\t\r\n\t\tZ._fireDatasetEvent(jslet.data.DatasetEvent.AFTERSCROLL);\t\r\n\t\tZ.refreshLookupHostDataset();\r\n\t\tvar detailFields = Z._subDatasetFields;\r\n\t\tif(detailFields) {\r\n\t\t\tvar subFldObj, subDs;\r\n\t\t\tfor(var i = 0, len = detailFields.length; i < len; i++) {\r\n\t\t\t\tsubFldObj = detailFields[i];\r\n\t\t\t\tsubDs = subFldObj.subDataset();\r\n\t\t\t\tif(subDs) {\r\n\t\t\t\t\tsubDs.refreshControl();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (Z.isBof() && Z.isEof()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tevt = jslet.data.RefreshEvent.scrollEvent(Z._recno);\r\n\t\tZ.refreshControl(evt);\r\n\t\t\r\n\t},\r\n\r\n\t/**\r\n\t * Delete all selected records;\r\n\t */\r\n\tdeleteSelected: function() {\r\n\t\tvar Z = this, \r\n\t\t\trecords = Z.selectedRecords(),\r\n\t\t\trecObj;\r\n\t\tZ.disableControls();\r\n\t\ttry {\r\n\t\t\tfor(var i = records.length - 1; i >= 0; i--) {\r\n\t\t\t\trecObj = records[i];\r\n\t\t\t\tZ.moveToRecord(recObj);\r\n\t\t\t\tZ.deleteRecord();\r\n\t\t\t}\r\n\t\t} finally {\r\n\t\t\tZ.enableControls();\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @private\r\n\t */\r\n\t_innerValidateData: function () {\r\n\t\tvar Z = this;\r\n\t\tif (Z._status == jslet.data.DataSetStatus.BROWSE || Z.recordCount() === 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar fldObj, fldName, fldValue, invalidMsg, firstInvalidField = null;\r\n\r\n\t\tfor (var i = 0, cnt = Z._normalFields.length; i < cnt; i++) {\r\n\t\t\tfldObj = Z._normalFields[i];\r\n\t\t\tif (fldObj.disabled() || fldObj.readOnly() || !fldObj.visible()) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tfldName = fldObj.name();\r\n\t\t\tfldValue = Z.getFieldValue(fldName);\r\n\t\t\tif(fldObj.valueStyle() == jslet.data.FieldValueStyle.NORMAL && Z.existFieldError(fldName)) {\r\n\t\t\t\tinvalidMsg = Z._fieldValidator.checkRequired(fldObj, fldValue);\r\n\t\t\t\tinvalidMsg = invalidMsg || Z._fieldValidator.checkValue(fldObj, fldValue);\r\n\t\t\t\tif (invalidMsg) {\r\n\t\t\t\t\tZ.setFieldError(fldName, invalidMsg);\r\n\t\t\t\t\tif(!firstInvalidField) {\r\n\t\t\t\t\t\tfirstInvalidField = fldName;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tinvalidMsg = Z._fieldValidator.checkRequired(fldObj, fldValue);\r\n\t\t\t\tif (invalidMsg) {\r\n\t\t\t\t\tZ.setFieldError(fldName, invalidMsg)\r\n\t\t\t\t\tif(!firstInvalidField) {\r\n\t\t\t\t\t\tfirstInvalidField = fldName;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif(fldObj.valueStyle() == jslet.data.FieldValueStyle.BETWEEN) {\r\n\t\t\t\t\tvar v1 = null, v2 = null;\r\n\t\t\t\t\tif(fldValue && fldValue.length === 2) {\r\n\t\t\t\t\t\tv1 = fldValue[0];\r\n\t\t\t\t\t\tv2 = fldValue[1];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(v1 && v2) {\r\n\t\t\t\t\t\tinvalidMsg = null;\r\n\t\t\t\t\t\tif(jslet.isDate(v1) && v1.getTime() > v2.getTime() || v1 > v2) {\r\n\t\t\t\t\t\t\tinvalidMsg = jslet.locale.Dataset.betwwenInvalid;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (invalidMsg) {\r\n\t\t\t\t\t\t\tZ.setFieldError(fldName, invalidMsg, 0);\r\n\t\t\t\t\t\t\tif(!firstInvalidField) {\r\n\t\t\t\t\t\t\t\tfirstInvalidField = fldName;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif(fldValue) {\r\n\t\t\t\t\tvar recObj = Z.getRecord();\r\n\t\t\t\t\tfor(var k = 0, len = fldValue.length; k < len; k++) {\r\n\t\t\t\t\t\tif(Z.existFieldError(fldName, k)) {\r\n\t\t\t\t\t\t\tinvalidMsg = invalidMsg || Z._fieldValidator.checkValue(fldObj, fldValue);\r\n\t\t\t\t\t\t\tif (invalidMsg) {\r\n\t\t\t\t\t\t\t\tZ.setFieldError(fldName, invalidMsg, k)\r\n\t\t\t\t\t\t\t\tif(!firstInvalidField) {\r\n\t\t\t\t\t\t\t\t\tfirstInvalidField = fldName;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} //end for k\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t} //end for i\r\n\t\tif(firstInvalidField) {\r\n\t\t\tZ.focusEditControl(firstInvalidField);\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * @private\r\n\t */\r\n\terrorMessage: function(errMessage) {\r\n\t\tvar evt = jslet.data.RefreshEvent.errorEvent(errMessage || '');\r\n\t\tthis.refreshControl(evt);\r\n\t},\r\n\t\r\n\taddFieldError: function(fldName, errorMsg, valueIndex, inputText) {\r\n\t\tjslet.data.FieldError.put(this.getRecord(), fldName, errorMsg, valueIndex, inputText);\r\n\t},\r\n\t\r\n\taddDetailFieldError: function(fldName, errorCount) {\r\n\t\tjslet.data.putDetailError.put(this.getRecord(), fldName, errorCount);\r\n\t},\r\n\t\r\n\texistRecordError: function(recno) {\r\n\t\treturn jslet.data.FieldError.existRecordError(this.getRecord(recno));\r\n\t},\r\n\t\r\n\tcheckAndShowError: function() {\r\n\t\tvar Z = this;\r\n\t\tif(Z.existDatasetError()) {\r\n\t\t\tif (Z._autoShowError) {\r\n\t\t\t\tjslet.showError(jslet.locale.Dataset.cannotConfirm, null, 2000);\r\n\t\t\t} else {\r\n\t\t\t\tconsole.warn(jslet.locale.Dataset.cannotConfirm);\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t},\r\n\t\r\n\texistDatasetError: function() {\r\n\t\tvar Z = this, isError = false,\r\n\t\t\tdataList = Z.dataList();\r\n\t\tif(!dataList) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tfor(var i = 0, len = dataList.length; i < len; i++) {\r\n\t\t\tisError = jslet.data.FieldError.existRecordError(dataList[i]);\r\n\t\t\tif(isError) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Confirm insert or update\r\n\t */\r\n\tconfirm: function () {\r\n\t\tvar Z = this;\r\n\t\tif (Z._status == jslet.data.DataSetStatus.BROWSE) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tZ._fireDatasetEvent(jslet.data.DatasetEvent.BEFORECONFIRM);\r\n\t\tZ._innerValidateData();\r\n\t\tZ._confirmSubDataset();\r\n\r\n\t\tif(Z.status() == jslet.data.DataSetStatus.UPDATE) {\r\n\t\t\tZ.changedStatus(jslet.data.DataSetStatus.UPDATE);\r\n\t\t}\r\n\t\t\r\n\t\tvar evt, hasError = Z.existRecordError();\r\n\t\tvar rec = Z.getRecord();\r\n\t\tZ._modiObject = null;\r\n\t\tZ.status(jslet.data.DataSetStatus.BROWSE);\r\n\t\tif(!hasError) {\r\n\t\t\tZ._changeLog.log();\r\n\t\t}\r\n\t\tZ._fireDatasetEvent(jslet.data.DatasetEvent.AFTERCONFIRM);\r\n\t\tZ.calcAggradedValue();\r\n\t\tevt = jslet.data.RefreshEvent.updateRecordEvent();\r\n\t\tZ.refreshControl(evt);\r\n\t\tif(hasError) {\r\n\t\t\tZ.errorMessage(jslet.locale.Dataset.cannotConfirm);\t\t\t\r\n\t\t} else {\r\n\t\t\tjslet.data.FieldError.clearRecordError(Z.getRecord());\r\n\t\t\tZ.errorMessage();\r\n\t\t}\r\n\t\tvar masterFld = Z._datasetField;\r\n\t\tif (masterFld) {\r\n\t\t\tvar masterDs = masterFld.dataset();\r\n\t\t\tvar masterFldName = masterFld.name();\r\n\t\t\tif(hasError) {\r\n\t\t\t\tmasterDs.addFieldError(masterFldName, 'Detail Dataset Error');\r\n\t\t\t} else {\r\n\t\t\t\tmasterDs.addFieldError(masterFldName, null);\r\n\t\t\t}\r\n\t\t\tmasterDs.refreshControl(evt);\r\n\t\t}\r\n\r\n\t\treturn !hasError;\r\n\t},\r\n\r\n\t/*\r\n\t * @private\r\n\t */\r\n\t_confirmSubDataset: function() {\r\n\t\tvar Z = this,\r\n\t\t\tfldObj, \r\n\t\t\tsubDatasets = [],\r\n\t\t\tsubFields = [];\r\n\t\tfor (var i = 0, len = Z._normalFields.length; i < len; i++) {\r\n\t\t\tfldObj = Z._normalFields[i];\r\n\t\t\tif(fldObj.getType() === jslet.data.DataType.DATASET) {\r\n\t\t\t\tsubDatasets.push(fldObj.subDataset());\r\n\t\t\t\tsubFields.push(fldObj.name());\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar subDs, oldShowError;\r\n\t\tfor(var i = 0, len = subDatasets.length; i < len; i++) {\r\n\t\t\tsubDs = subDatasets[i];\r\n\t\t\tsubDs.confirm();\r\n\t\t\tif(subDs.existDatasetError()) {\r\n\t\t\t\tZ.addFieldError(subFields[i], 'Detail Dataset Error');\r\n\t\t\t} else {\r\n\t\t\t\tZ.addFieldError(subFields[i], null);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * Cancel insert or update\r\n\t */\r\n\tcancel: function () {\r\n\t\tvar Z = this;\r\n\t\tif (Z._status == jslet.data.DataSetStatus.BROWSE) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (Z.recordCount() === 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tZ._aborted = false;\r\n\t\ttry {\r\n\t\t\tZ._fireDatasetEvent(jslet.data.DatasetEvent.BEFORECANCEL);\r\n\t\t\tif (Z._aborted) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t} finally {\r\n\t\t\tZ._aborted = false;\r\n\t\t}\r\n//\t\tvar rec = Z.getRecord();\r\n//\t\tjslet.data.FieldError.clearRecordError(rec);\r\n\t\t Z._cancelSubDataset();\r\n\t\t var evt, \r\n\t\t\tk = Z._recno,\r\n\t\t\trecords = Z.dataList();\r\n\t\tif (Z._status == jslet.data.DataSetStatus.INSERT) {\r\n\t\t\tZ.selection.removeAll();\r\n\t\t\tvar no = Z.recno();\r\n\t\t\trecords.splice(k, 1);\r\n\t\t\tZ._refreshInnerRecno();\r\n\t\t\tif(no >= Z.recordCount()) {\r\n\t\t\t\tZ._recno = Z.recordCount() - 1;\r\n\t\t\t}\r\n\t\t\tZ.calcAggradedValue();\t\t\r\n\t\t\tevt = jslet.data.RefreshEvent.deleteEvent(no);\r\n\t\t\tZ.refreshControl(evt);\r\n\t\t\tZ.status(jslet.data.DataSetStatus.BROWSE);\r\n\t\t\tZ._fireDatasetEvent(jslet.data.DatasetEvent.AFTERSCROLL);\r\n\t\t\tevt = jslet.data.RefreshEvent.scrollEvent(Z._recno); \r\n\t\t\tZ.refreshControl(evt); \r\n\t\t\treturn;\r\n\t\t} else {\r\n\t\t\tif (Z._filteredRecnoArray) {\r\n\t\t\t\tk = Z._filteredRecnoArray[Z._recno];\r\n\t\t\t}\r\n//\t\t\tjslet.data.FieldValueCache.removeCache(Z._modiObject);\r\n\t\t\trecords[k] = Z._modiObject;\r\n\t\t\tZ._modiObject = null;\t\r\n\t\t}\r\n\r\n\t\tZ.calcAggradedValue();\t\t\r\n\t\tZ.status(jslet.data.DataSetStatus.BROWSE);\r\n//\t\tZ.changedStatus(jslet.data.DataSetStatus.BROWSE);\r\n\t\tZ._fireDatasetEvent(jslet.data.DatasetEvent.AFTERCANCEL);\r\n//\t\tZ._fireDatasetEvent(jslet.data.DatasetEvent.AFTERSCROLL);\r\n\r\n\t\tevt = jslet.data.RefreshEvent.updateRecordEvent();\r\n\t\tZ.refreshControl(evt);\r\n\t},\r\n\r\n\trestore: function() {\r\n\t\t\r\n\t},\r\n\t\r\n    /*\r\n     * @private\r\n     */\r\n    _cancelSubDataset: function() {\r\n        var Z = this,\r\n            fldObj, \r\n            subDatasets = [];\r\n        for (var i = 0, len = Z._normalFields.length; i < len; i++) {\r\n            fldObj = Z._normalFields[i];\r\n            if(fldObj.getType() === jslet.data.DataType.DATASET) {\r\n                subDatasets.push(fldObj.subDataset());\r\n            }\r\n        }\r\n        var subDs;\r\n        for(var i = 0, len = subDatasets.length; i < len; i++) {\r\n            subDs = subDatasets[i];\r\n            subDs.cancel();\r\n        }\r\n    },\r\n     \r\n\t/**\r\n\t * Set or get logChanges\r\n\t * if NOT need send changes to Server, can set logChanges to false  \r\n\t * \r\n\t * @param {Boolean} logChanges\r\n\t */\r\n\tlogChanges: function (logChanges) {\r\n\t\tif (logChanges === undefined) {\r\n\t\t\treturn this._logChanges;\r\n\t\t}\r\n\r\n\t\tthis._logChanges = logChanges;\r\n\t},\r\n\r\n\t/**\r\n\t * Disable refreshing controls, you often use it in a batch operation;\r\n\t * After batch operating, use enableControls()\r\n\t */\r\n\tdisableControls: function () {\r\n\t\tthis._lockCount++;\r\n\t\tvar fldObj, subDs;\r\n\t\tfor (var i = 0, cnt = this._normalFields.length; i < cnt; i++) {\r\n\t\t\tfldObj = this._normalFields[i];\r\n\t\t\tsubDs = fldObj.subDataset();\r\n\t\t\tif (subDs !== null) {\t\t\t\t\r\n\t\t\t\tsubDs.disableControls();\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Enable refreshing controls.\r\n\t * \r\n\t * @param {Boolean} refreshCtrl true - Refresh control immediately, false - Otherwise.\r\n\t */\r\n\tenableControls: function (needRefreshCtrl) {\r\n\t\tif (this._lockCount > 0) {\r\n\t\t\tthis._lockCount--;\r\n\t\t}\r\n\t\tif (!needRefreshCtrl) {\r\n\t\t\tthis.refreshControl();\r\n\t\t}\r\n\r\n\t\tvar fldObj, subDs;\r\n\t\tfor (var i = 0, cnt = this._normalFields.length; i < cnt; i++) {\r\n\t\t\tfldObj = this._normalFields[i];\r\n\t\t\tsubDs = fldObj.subDataset();\r\n\t\t\tif (subDs !== null) {\t\t\t\t\r\n\t\t\t\tsubDs.enableControls();\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Check the specified field which value is valid.\r\n\t * \r\n\t * @param fldName {String} - field name;\r\n\t * @param valueIndex {Integer} - value index.\r\n\t * @return {Boolean} true - exists invalid data.\r\n\t */\r\n\texistFieldError: function(fldName, valueIndex) {\r\n\t\tif (this.recordCount() === 0) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tvar currRec = this.getRecord();\r\n\t\tif (!currRec) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\treturn jslet.data.FieldError.existFieldError(currRec, fldName, valueIndex);\r\n\t},\r\n\t\r\n\tgetFieldError: function(fldName, valueIndex) {\r\n\t\treturn this.getFieldErrorByRecno(null, fldName, valueIndex);\r\n\t},\r\n\t\r\n\tgetFieldErrorByRecno: function(recno, fldName, valueIndex) {\r\n\t\tif (this.recordCount() === 0) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tvar currRec = this.getRecord(recno);\r\n\t\tif (!currRec) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\treturn jslet.data.FieldError.get(currRec, fldName, valueIndex);\r\n\t},\r\n\t\r\n\tsetFieldError: function(fldName, errorMsg, valueIndex, inputText) {\r\n\t\tvar Z = this;\r\n\t\tif (Z.recordCount() === 0) {\r\n\t\t\treturn Z;\r\n\t\t}\r\n\r\n\t\tvar currRec = Z.getRecord();\r\n\t\tif (!currRec) {\r\n\t\t\treturn Z;\r\n\t\t}\r\n\t\tjslet.data.FieldError.put(currRec, fldName, errorMsg, valueIndex, inputText);\r\n\t\treturn this;\r\n\t},\r\n\t\t\r\n\t/**\r\n\t * Get field value of specified record number\r\n\t * \r\n\t * @param {Object} recno - specified record number\r\n\t * @param {String} fldName - field name\r\n\t * @return {Object} field value\r\n\t */\r\n\tgetFieldValueByRecno: function(recno, fldName, valueIndex) {\r\n\t\tvar dataRec = this.getRecord(recno);\r\n\t\tif(!dataRec) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\treturn this.getFieldValueByRecord(dataRec, fldName, valueIndex);\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get field value of specified record\r\n\t * \r\n\t * @param {Object} dataRec - specified record\r\n\t * @param {String} fldName - field name\r\n\t * @return {Object} field value\r\n\t */\r\n\tgetFieldValueByRecord: function (dataRec, fldName, valueIndex) {\r\n\t\tvar Z = this;\r\n\t\tif (Z.recordCount() === 0) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tif (!dataRec) {\r\n\t\t\tdataRec = Z.getRecord();\r\n\t\t}\r\n\r\n\t\tvar k = fldName.indexOf('.'), \r\n\t\t\tsubfldName, fldValue = null,\r\n\t\t\tfldObj = Z.getField(fldName),\r\n\t\t\tvalue, lkds;\r\n\t\tif (k > 0) { //field chain\r\n\t\t\tsubfldName = fldName.substr(0, k);\r\n\t\t\tfldObj = Z.getField(subfldName);\r\n\t\t\tvar lkf = fldObj.lookup(),\r\n\t\t\t\tsubDs = fldObj.subDataset();\r\n\t\t\t\r\n\t\t\tif (!lkf && !subDs) {\r\n\t\t\t\tthrow new Error(jslet.formatString(jslet.locale.Dataset.lookupNotFound, [subfldName]));\r\n\t\t\t}\r\n\t\t\tif(lkf) {\r\n\t\t\t\tvalue = dataRec[subfldName];\r\n\t\t\t\tlkds = lkf.dataset();\r\n\t\t\t\tif(value === undefined || value === null || value === '') {\r\n\t\t\t\t\tfldValue = null;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (lkds.findByField(lkds.keyField(), value)) {\r\n\t\t\t\t\t\tfldValue = lkds.getFieldValue(fldName.substr(k + 1));\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthrow new Error(jslet.formatString(jslet.locale.Dataset.valueNotFound,\r\n\t\t\t\t\t\t\t\t\t[lkds.name(),lkds.keyField(), value]));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tfldValue = subDs.getFieldValue(fldName.substr(k + 1));\r\n\t\t\t}\r\n\t\t\t\r\n\t\t} else { //single field\r\n\t\t\tif (!fldObj) {\r\n\t\t\t\tthrow new Error(jslet.formatString(jslet.locale.Dataset.fieldNotFound, [fldName]));\r\n\t\t\t}\r\n\t\t\tvar formula = fldObj.formula();\r\n\t\t\tif (!formula) {\r\n\t\t\t\tvalue = dataRec[fldName];\r\n\t\t\t\tfldValue = value !== undefined ? value :null;\r\n\t\t\t} else {\r\n\t\t\t\tif(dataRec[fldName] === undefined) {\r\n\t\t\t\t\tfldValue = Z._calcFormula(dataRec, fldName);\r\n\t\t\t\t\tdataRec[fldName] = fldValue;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvalue = dataRec[fldName];\r\n\t\t\t\t\tfldValue = value !== undefined ? value :null;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif(!fldObj.valueStyle() || valueIndex === undefined) { //jslet.data.FieldValueStyle.NORMAL\r\n\t\t\tif(fldObj.getType() === jslet.data.DataType.BOOLEAN) {\r\n\t\t\t\treturn fldValue === fldObj.trueValue();\r\n\t\t\t}\r\n\t\t\treturn fldValue;\r\n\t\t}\r\n\t\treturn jslet.getArrayValue(fldValue, valueIndex);\r\n\t},\r\n\r\n\t/**\r\n\t * Get field value of current record\r\n\t * \r\n\t * @param {String} fldName - field name\r\n\t * @param {Integer or undefined} valueIndex get the specified value if a field has multiple values.\r\n\t *\t\tif valueIndex is not specified, all values(Array of value) will return.\r\n\t * @return {Object}\r\n\t */\r\n\tgetFieldValue: function (fldName, valueIndex) {\r\n\t\tif (this.recordCount() === 0) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tvar currRec = this.getRecord();\r\n\t\tif (!currRec) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\treturn this.getFieldValueByRecord(currRec, fldName, valueIndex);\r\n\t},\r\n\r\n\t/**\r\n\t * Set field value of current record.\r\n\t * \r\n\t * @param {String} fldName - field name\r\n\t * @param {Object} value - field value\r\n\t * @param {Integer or undefined} valueIndex set the specified value if a field has multiple values.\r\n\t *\t\tif valueIndex is not specified, Array of value will be set.\r\n\t * @return {this}\r\n\t */\r\n\tsetFieldValue: function (fldName, value, valueIndex) {\r\n\t\tvar Z = this,\r\n\t\t\tfldObj = Z.getField(fldName);\r\n\t\tif(Z._status == jslet.data.DataSetStatus.BROWSE) {\r\n\t\t\tZ.editRecord();\r\n\t\t}\r\n\t\tvar currRec = Z.getRecord();\r\n\t\tif(!fldObj.valueStyle() || valueIndex === undefined) { //jslet.data.FieldValueStyle.NORMAL\r\n\t\t\tif(value && fldObj.getType() === jslet.data.DataType.NUMBER && !jslet.isArray(value)) {\r\n\t\t\t\tvalue = fldObj.scale() > 0 ? parseFloat(value): parseInt(value);\r\n\t\t\t}\r\n\t\t\tvar realValue = value;\r\n\t\t\tif(fldObj.getType() === jslet.data.DataType.BOOLEAN) {\r\n\t\t\t\tif(value) {\r\n\t\t\t\t\trealValue = fldObj.trueValue();\r\n\t\t\t\t} else {\r\n\t\t\t\t\trealValue = fldObj.falseValue();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tcurrRec[fldName] = realValue;\r\n\t\t\tif (fldObj.getType() == jslet.data.DataType.DATASET) {//dataset field\r\n\t\t\t\treturn this;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tvar arrValue = currRec[fldName];\r\n\t\t\tif(!arrValue || !jslet.isArray(arrValue)) {\r\n\t\t\t\tarrValue = [];\r\n\t\t\t\tcurrRec[fldName] = arrValue;\r\n\t\t\t}\r\n\t\t\tvar len = arrValue.length;\r\n\t\t\tif(valueIndex < len) {\r\n\t\t\t\tarrValue[valueIndex] = value;\r\n\t\t\t} else {\r\n\t\t\t\tfor(var i = len; i < valueIndex; i++) {\r\n\t\t\t\t\tarrValue.push(null);\r\n\t\t\t\t}\r\n\t\t\t\tarrValue.push(value);\r\n\t\t\t}\r\n\t\t}\r\n\t\tZ.setFieldError(fldName, null, valueIndex);\r\n\t\tif (Z._onFieldChanged) {\r\n\t\t\tvar eventFunc = jslet.getFunction(Z._onFieldChanged);\r\n\t\t\tif(eventFunc) {\r\n\t\t\t\teventFunc.call(Z, fldName, value, valueIndex);\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar globalHandler = jslet.data.globalDataHandler.fieldValueChanged();\r\n\t\tif(globalHandler) {\r\n\t\t\tglobalHandler.call(Z, Z, fldName, value, valueIndex);\r\n\t\t}\r\n\r\n\t\tif(fldObj.valueFollow()) {\r\n\t\t\tif(!Z._followedValue) {\r\n\t\t\t\tZ._followedValue = {};\r\n\t\t\t}\r\n\t\t\tZ._followedValue[fldName] = value;\r\n\t\t}\r\n\t\t//calc other fields' range to use context rule\r\n\t\tif (Z._contextRuleEnabled) {\r\n\t\t\tZ.calcContextRule(fldName);\r\n\t\t}\t\r\n\t\tjslet.data.FieldValueCache.clear(Z.getRecord(), fldName);\r\n\t\tvar evt = jslet.data.RefreshEvent.updateRecordEvent(fldName);\r\n\t\tZ.refreshControl(evt);\r\n\t\tZ.updateFormula(fldName);\r\n\t\tZ.calcAggradedValue(fldName);\r\n\t\treturn this;\r\n\t},\r\n\r\n\t_calcFormulaRelation: function() {\r\n\t\tvar Z = this;\r\n\t\tif(!Z._innerFormularFields) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar fields = Z._innerFormularFields.keys(),\r\n\t\t\tfldName, formulaFields, formulaFldName, fldObj;\r\n\t\tvar relation = new jslet.SimpleMap();\r\n\t\tfor(var i = 0, len = fields.length; i < len; i++) {\r\n\t\t\tfldName = fields[i];\r\n\t\t\tvar evaluator = Z._innerFormularFields.get(fldName);\r\n\t\t\tformulaFields = evaluator.mainFields();\r\n\t\t\trelation.set(fldName, formulaFields);\r\n\t\t} //end for i\r\n\t\tZ._innerFormulaRelation = relation.count() > 0? relation: null;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @rivate\r\n\t */\r\n\taddInnerFormulaField: function(fldName, formula) {\r\n\t\tvar Z = this;\r\n\t\tif(!formula) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (!Z._innerFormularFields) {\r\n\t\t\tZ._innerFormularFields = new jslet.SimpleMap();\r\n\t\t}\r\n\t\tevaluator = new jslet.Expression(Z, formula);\r\n\t\tZ._innerFormularFields.set(fldName, evaluator);\r\n\t\tZ._calcFormulaRelation();\r\n\t},\r\n\t\r\n\t/**\r\n\t * @rivate\r\n\t */\r\n\tremoveInnerFormulaField: function (fldName) {\r\n\t\tif (this._innerFormularFields) {\r\n\t\t\tthis._innerFormularFields.unset(fldName);\r\n\t\t\tthis._calcFormulaRelation();\r\n\t\t}\r\n\t},\r\n\r\n\t_calcFormula: function(currRec, fldName) {\r\n\t\tvar Z = this,\r\n\t\t\tevaluator = Z._innerFormularFields.get(fldName),\r\n\t\t\tresult = null;\r\n\t\tif(evaluator) {\r\n\t\t\tevaluator.context.dataRec = currRec;\r\n\t\t\tresult = evaluator.eval();\r\n\t\t}\r\n\t\treturn result;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @private\r\n\t */\r\n\tupdateFormula: function (changedFldName) {\r\n\t\tvar Z = this;\r\n\t\tif(!Z._innerFormulaRelation) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar fmlFields = Z._innerFormulaRelation.keys(),\r\n\t\t\tfmlFldName, fields, fldObj,\r\n\t\t\tcurrRec = this.getRecord();\r\n\t\tfor(var i = 0, len = fmlFields.length; i < len; i++) {\r\n\t\t\tfmlFldName = fmlFields[i];\r\n\t\t\tfields = Z._innerFormulaRelation.get(fmlFldName);\r\n\t\t\tfldObj = Z.getField(fmlFldName);\r\n\t\t\tif(!fields || fields.length === 0) {\r\n\t\t\t\tfldObj.setValue(Z._calcFormula(currRec, fmlFldName));\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tvar found = false;\r\n\t\t\tfor(var j = 0, cnt = fields.length; j < cnt; j++) {\r\n\t\t\t\tif(fields[j] == changedFldName) {\r\n\t\t\t\t\tfound = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(found) {\r\n\t\t\t\tfldObj.setValue(Z._calcFormula(currRec, fmlFldName));\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get field display text. \r\n\t * \r\n\t * @param {String} fldName Field name\r\n\t * @param {Boolean} isEditing In edit mode or not, if in edit mode, return 'Input Text', else return 'Display Text'\r\n\t * @param {Integer} valueIndex identify which item will get if the field has multiple values.\r\n\t * @return {String} \r\n\t */\r\n\tgetFieldText: function (fldName, isEditing, valueIndex) {\r\n\t\tif (this.recordCount() === 0) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tvar currRec = this.getRecord();\r\n\t\tif (!currRec) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\treturn this.getFieldTextByRecord(currRec, fldName, isEditing, valueIndex);\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get field display text by record number.\r\n\t * \r\n\t * @param {Object} recno - record number.\r\n\t * @param {String} fldName - Field name\r\n\t * @param {Boolean} isEditing - In edit mode or not, if in edit mode, return 'Input Text', else return 'Display Text'\r\n\t * @param {Integer} valueIndex - identify which item will get if the field has multiple values.\r\n\t * @return {String} \r\n\t */\r\n\tgetFieldTextByRecno: function (recno, fldName, isEditing, valueIndex) {\r\n\t\tvar dataRec = this.getRecord(recno);\r\n\t\tif(!dataRec) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\treturn this.getFieldTextByRecord(dataRec, fldName, isEditing, valueIndex);\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get field display text by data record.\r\n\t * \r\n\t * @param {Object} dataRec - data record.\r\n\t * @param {String} fldName - Field name\r\n\t * @param {Boolean} isEditing - In edit mode or not, if in edit mode, return 'Input Text', else return 'Display Text'\r\n\t * @param {Integer} valueIndex - identify which item will get if the field has multiple values.\r\n\t * @return {String} \r\n\t */\r\n\tgetFieldTextByRecord: function (dataRec, fldName, isEditing, valueIndex) {\r\n\t\tvar Z = this;\r\n\t\tif (Z.recordCount() === 0) {\r\n\t\t\treturn '';\r\n\t\t}\r\n\t\tvar currRec = dataRec, \r\n\t\t\tk = fldName.indexOf('.'), \r\n\t\t\tfldObj, value;\r\n\t\tif (k > 0) { //Field chain\r\n\t\t\tvar subFldName = fldName.substr(0, k);\r\n\t\t\tfldName = fldName.substr(k + 1);\r\n\t\t\tfldObj = Z.getField(subFldName);\r\n\t\t\tif (!fldObj) {\r\n\t\t\t\tthrow new Error(jslet.formatString(jslet.locale.Dataset.fieldNotFound, [fldName]));\r\n\t\t\t}\r\n\t\t\tvar lkf = fldObj.lookup(),\r\n\t\t\t\tsubDs = fldObj.subDataset();\r\n\t\t\tif (!lkf && !subDs) {\r\n\t\t\t\tthrow new Error(jslet.formatString(jslet.locale.Dataset.lookupNotFound, [fldName]));\r\n\t\t\t}\r\n\t\t\tif(lkf) {\r\n\t\t\t\tvalue = currRec[subFldName];\r\n\t\t\t\tif (value === null || value === undefined) {\r\n\t\t\t\t\treturn '';\r\n\t\t\t\t}\r\n\t\t\t\tvar lkds = lkf.dataset();\r\n\t\t\t\tif (lkds.findByField(lkds.keyField(), value)) {\r\n\t\t\t\t\tif (fldName.indexOf('.') > 0) {\r\n\t\t\t\t\t\treturn lkds.getFieldValue(fldName);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\treturn lkds.getFieldText(fldName, isEditing, valueIndex);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthrow new Error(jslet.formatString(jslet.locale.Dataset.valueNotFound,\r\n\t\t\t\t\t\t\t[lkds.name(), lkds.keyField(), value]));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\t//Can't use it in sort function.\r\n\t\t\t\treturn subDs.getFieldText(fldName, isEditing, valueIndex);\r\n\t\t\t}\r\n\t\t}\r\n\t\t//Not field chain\r\n\t\tfldObj = Z.getField(fldName);\r\n\t\tif (!fldObj) {\r\n\t\t\tthrow new Error(jslet.formatString(jslet.locale.Dataset.lookupNotFound, [fldName]));\r\n\t\t}\r\n\t\tif (fldObj.getType() == jslet.data.DataType.DATASET) {\r\n\t\t\treturn '[dataset]';\r\n\t\t}\r\n\t\tvar valueStyle = fldObj.valueStyle(),\r\n\t\t\tresult = [];\r\n\t\tif(valueStyle == jslet.data.FieldValueStyle.BETWEEN && valueIndex === undefined)\r\n\t\t{\r\n\t\t\tvar minVal = Z.getFieldTextByRecord(currRec, fldName, isEditing, 0),\r\n\t\t\t\tmaxVal = Z.getFieldTextByRecord(currRec, fldName, isEditing, 1);\r\n\t\t\tif(!isEditing && !minVal && !maxVal){\r\n\t\t\t\treturn '';\r\n\t\t\t}\r\n\t\t\tresult.push(minVal);\r\n\t\t\tif(isEditing) {\r\n\t\t\t\tresult.push(jslet.global.valueSeparator);\r\n\t\t\t} else {\r\n\t\t\t\tresult.push(jslet.locale.Dataset.betweenLabel);\r\n\t\t\t}\r\n\t\t\tresult.push(maxVal);\r\n\t\t\treturn result.join('');\r\n\t\t}\r\n\t\t\r\n\t\tif(valueStyle == jslet.data.FieldValueStyle.MULTIPLE && valueIndex === undefined)\r\n\t\t{\r\n\t\t\tvar arrValues = Z.getFieldValue(fldName), \r\n\t\t\t\tlen = 0;\r\n\t\t\tif(arrValues && jslet.isArray(arrValues)) {\r\n\t\t\t\tlen = arrValues.length - 1;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tfor(var i = 0; i <= len; i++) {\r\n\t\t\t\tresult.push(Z.getFieldTextByRecord(currRec, fldName, isEditing, i));\r\n\t\t\t\tif(i < len) {\r\n\t\t\t\t\tresult.push(jslet.global.valueSeparator);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn result.join('');\r\n\t\t}\r\n\t\t//Get cached display value if exists.\r\n\t\tif(!isEditing) {\r\n\t\t\tvar cacheValue = jslet.data.FieldValueCache.get(currRec, fldName, valueIndex);\r\n\t\t\tif(cacheValue !== undefined) {\r\n\t\t\t\treturn cacheValue;\r\n\t\t\t}\r\n\t\t}\r\n\t\tvalue = Z.getFieldValueByRecord(currRec, fldName, valueIndex);\r\n\t\tif (value === null || value === undefined) {\r\n\t\t\tvar fixedValue = fldObj.fixedValue();\r\n\t\t\tif(fixedValue) {\r\n\t\t\t\treturn fixedValue;\r\n\t\t\t}\r\n\t\t\treturn '';\r\n\t\t}\r\n\r\n\t\tvar convert = fldObj.customValueConverter() || jslet.data.getValueConverter(fldObj);\r\n\t\tif(!convert) {\r\n\t\t\tthrow new Error('Can\\'t find any field value converter!');\r\n\t\t}\r\n\t\tvar text = convert.valueToText.call(Z, fldObj, value, isEditing);\r\n\t\t//Put display value into cache\r\n\t\tif(!isEditing) {\r\n\t\t\tjslet.data.FieldValueCache.put(currRec, fldName, text, valueIndex);\r\n\t\t}\r\n\t\treturn text;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @private\r\n\t */\r\n\tsetFieldValueLength: function(fldObj, valueLength) {\r\n\t\tif(!fldObj.valueStyle()) { //jslet.data.FieldValueStyle.NORMAL\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar value = this.getFieldValue(fldObj.name());\r\n\t\tif(value && jslet.isArray(value)) {\r\n\t\t\tvalue.length = valueLength;\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * Set field value by input value. There are two forms to use:\r\n\t *   1. setFieldText(fldName, inputText, valueIndex)\r\n\t *   2. setFieldText(fldName, inputText, keyValue, displayValue, valueIndex)\r\n\t *   \r\n\t * @param {String} fldName - field name\r\n\t * @param {String} inputText - String value inputed by user\r\n\t * @param {Object} keyValue - key value\r\n\t * @param {String} displayValue - display value\r\n\t * @param {Integer} valueIndex identify which item will set if the field has multiple values.\r\n\t */\r\n\tsetFieldText: function (fldName, inputText, valueIndex) {\r\n\t\tvar Z = this,\r\n\t\tfldObj = Z.getField(fldName);\r\n\t\tif (fldObj === null) {\r\n\t\t\tthrow new Error(jslet.formatString(jslet.locale.Dataset.fieldNotFound, [fldName]));\r\n\t\t}\r\n\t\tvar fType = fldObj.getType();\r\n\t\tif (fType == jslet.data.DataType.DATASET) {\r\n\t\t\tthrow new Error(jslet.formatString(jslet.locale.Dataset.datasetFieldNotBeSetValue, [fldName]));\r\n\t\t}\r\n\t\tvar convert = fldObj.customValueConverter() || jslet.data.getValueConverter(fldObj);\r\n\t\tif(!convert) {\r\n\t\t\tthrow new Error('Can\\'t find any field value converter!');\r\n\t\t}\r\n\t\t\r\n\t\tvar value = Z._textToValue(fldObj, inputText, valueIndex);\r\n\t\tif(value !== undefined) {\r\n\t\t\tZ.setFieldValue(fldName, value, valueIndex);\r\n\t\t}\r\n\t},\r\n\r\n\t_textToValue: function(fldObj, inputText, valueIndex) {\r\n\t\tvar Z = this,\r\n\t\t\tfType = fldObj.getType();\r\n\t\t\r\n\t\tif((fldObj.valueStyle() === jslet.data.FieldValueStyle.BETWEEN ||\r\n\t\t\tfldObj.valueStyle() === jslet.data.FieldValueStyle.MULTIPLE)\t\t\t\t\r\n\t\t\t\t&& valueIndex === undefined) {\r\n\t\t\t//Set an array value\r\n\t\t\tif(!jslet.isArray(inputText)) {\r\n\t\t\t\tinputText = inputText.split(jslet.global.valueSeparator);\r\n\t\t\t}\r\n\t\t\tvar len = inputText.length, \r\n\t\t\t\tvalues = [], value,\r\n\t\t\t\tinvalid = false;\r\n\t\t\tfor(var k = 0; k < len; k++ ) {\r\n\t\t\t\tvalue = Z._textToValue(fldObj, inputText[k], k);\r\n\t\t\t\tif(value === undefined) {\r\n\t\t\t\t\tinvalid = true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif(!invalid) {\r\n\t\t\t\t\t\tvalues.push(value);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(!invalid) {\r\n\t\t\t\treturn values;\r\n\t\t\t}\r\n\t\t\treturn undefined;\r\n\t\t}\r\n\t\tvar invalidMsg = Z._fieldValidator.checkInputText(fldObj, inputText);\r\n\t\tif (invalidMsg) {\r\n\t\t\tZ.setFieldError(fldObj.name(), invalidMsg, valueIndex, inputText);\r\n\t\t\treturn undefined;\r\n\t\t} else {\r\n\t\t\tZ.setFieldError(fldObj.name(), null, valueIndex);\r\n\t\t}\r\n\t\t\r\n\t\tvar convert = fldObj.customValueConverter() || jslet.data.getValueConverter(fldObj);\r\n\t\tvar value = convert.textToValue.call(Z, fldObj, inputText, valueIndex);\r\n\t\treturn value;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get key value of current record\r\n\t * \r\n\t * @return {Object} Key value\r\n\t */\r\n\tkeyValue: function () {\r\n\t\tif (!this._keyField || this.recordCount() === 0) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\treturn this.getFieldValue(this._keyField);\r\n\t},\r\n\r\n\t/**\r\n\t * Get parent record key value of current record\r\n\t * \r\n\t * @return {Object} Parent record key value.\r\n\t */\r\n\tparentValue: function () {\r\n\t\tif (!this._parentField || this.recordCount() === 0) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\treturn this.getFieldValue(this._parentField);\r\n\t},\r\n\r\n\t/**\r\n\t * Find record with specified condition\r\n\t * if found, then move cursor to that record\r\n\t * <pre><code>\r\n\t *   dsFoo.find('[name] like \"Bob%\"');\r\n\t *   dsFoo.find('[age] > 20');\r\n\t * </code></pre>\r\n\t * @param {String} condition condition expression.\r\n\t * @param {Boolean} fromCurrentPosition Identify whether finding data from current position or not.\r\n\t * @return {Boolean} \r\n\t */\r\n\tfind: function (condition, fromCurrentPosition) {\r\n\t\tvar Z = this;\r\n\t\tif (Z.recordCount() === 0) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tZ.confirm();\r\n\t\tif (condition === null) {\r\n\t\t\tZ._findCondition = null;\r\n\t\t\tZ._innerFindCondition = null;\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif (condition != Z._findCondition) {\r\n\t\t\tZ._innerFindCondition = new jslet.Expression(this, condition);\r\n\t\t}\r\n\t\tif (Z._innerFindCondition.eval()) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tZ._silence++;\r\n\t\tvar foundRecno = -1, \r\n\t\t\toldRecno = Z._recno;\r\n\t\ttry {\r\n\t\t\tif(!fromCurrentPosition) {\r\n\t\t\t\tZ.first();\r\n\t\t\t}\r\n\t\t\twhile (!Z.isEof()) {\r\n\t\t\t\tif (Z._innerFindCondition.eval()) {\r\n\t\t\t\t\tfoundRecno = Z._recno;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tZ.next();\r\n\t\t\t}\r\n\t\t} finally {\r\n\t\t\tZ._silence--;\r\n\t\t\tZ._recno = oldRecno;\r\n\t\t}\r\n\t\tif (foundRecno >= 0) {// can fire scroll event\r\n\t\t\tZ._gotoRecno(foundRecno);\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t},\r\n\r\n\t/**\r\n\t * Find record with specified field name and value\r\n\t * \r\n\t * @param {String} fldName - field name\r\n\t * @param {Object} findingValue - finding value\r\n\t * @param {Boolean} fromCurrentPosition Identify whether finding data from current position or not.\r\n\t * @param {Boolean} findingByText - Identify whether finding data with field text, default is with field value\r\n\t * @param {String} matchType null or undefined - match whole value, 'first' - match first, 'last' - match last, 'any' - match any\r\n\t * @return {Boolean} \r\n\t */\r\n\tfindByField: function (fldName, findingValue, fromCurrentPosition, findingByText, matchType) {\r\n\t\tvar Z = this,\r\n\t\t\tfldObj = Z.getField(fldName);\r\n\t\tif(!fldObj) {\r\n\t\t\tthrow new Error('Field name: ' + fldName + ' NOT Found!');\r\n\t\t}\r\n\t\tZ.confirm();\r\n\t\t\r\n\t\tfunction matchValue(matchType, value, findingValue) {\r\n\t\t\tif(!matchType) {\r\n\t\t\t\treturn value == findingValue;\r\n\t\t\t}\r\n\t\t\tif(matchType == 'first') {\r\n\t\t\t\treturn jslet.like(value, findingValue + '%');\r\n\t\t\t}\r\n\t\t\tif(matchType == 'any') {\r\n\t\t\t\treturn jslet.like(value, '%' + findingValue + '%');\r\n\t\t\t}\r\n\t\t\tif(matchType == 'last') {\r\n\t\t\t\treturn jslet.like(value, '%' + findingValue);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tvar byText = true;\r\n\t\tif(fldObj.getType() === 'N' && !fldObj.lookup()) {\r\n\t\t\tbyText = false;\r\n\t\t}\r\n\t\tvar value, i;\r\n\t\tif(Z._ignoreFilter) {\r\n\t\t\tif(!Z.hasData()) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tvar records = Z.dataList(),\r\n\t\t\t\tlen = records.length,\r\n\t\t\t\tdataRec;\r\n\t\t\tvar start = 0;\r\n\t\t\tif(fromCurrentPosition) {\r\n\t\t\t\tvar currRec = Z.getRecord();\r\n\t\t\t\tif(Z._lastFindingValue && Z._lastFindingValue === findingValue) {\r\n\t\t\t\t\tstart = records.indexOf(currRec) + 1;\r\n\t\t\t\t}\r\n\t\t\t\tZ._lastFindingValue = findingValue;\r\n\t\t\t}\r\n\t\t\tfor(i = start; i < len; i++) {\r\n\t\t\t\tdataRec = records[i];\r\n\t\t\t\tif(findingByText && byText) {\r\n\t\t\t\t\tvalue = Z.getFieldTextByRecord(dataRec, fldName);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvalue = Z.getFieldValueByRecord(dataRec, fldName);\r\n\t\t\t\t}\r\n\t\t\t\tif (matchValue(matchType, value, findingValue)) {\r\n\t\t\t\t\tZ._ignoreFilterRecno = i;\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tif (Z.recordCount() === 0) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tvar foundRecno = -1, oldRecno = Z.recno();\r\n\t\ttry {\r\n\t\t\tvar cnt = Z.recordCount(),\r\n\t\t\t\tstart = 0;\r\n\t\t\tif(fromCurrentPosition) {\r\n\t\t\t\tstart = Z.recno();\r\n\t\t\t\tif(Z._lastFindingValue && Z._lastFindingValue === findingValue) {\r\n\t\t\t\t\tstart =  Z.recno() + 1;\r\n\t\t\t\t}\r\n\t\t\t\tZ._lastFindingValue = findingValue;\r\n\t\t\t}\r\n\t\t\tfor (i = start; i < cnt; i++) {\r\n\t\t\t\tZ.recnoSilence(i);\r\n\t\t\t\tif(findingByText && byText) {\r\n\t\t\t\t\tvalue = Z.getFieldText(fldName);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvalue = Z.getFieldValue(fldName);\r\n\t\t\t\t}\r\n\t\t\t\tif (matchValue(matchType, value, findingValue)) {\r\n\t\t\t\t\tfoundRecno = Z._recno;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} finally {\r\n\t\t\tZ.recnoSilence(oldRecno);\r\n\t\t}\r\n\t\tif (foundRecno >= 0) {// can fire scroll event\r\n\t\t\tZ._gotoRecno(foundRecno);\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t},\r\n\r\n\t/**\r\n\t * Find record with key value.\r\n\t * \r\n\t * @param {Object} keyValue Key value.\r\n\t * @return {Boolean}\r\n\t */\r\n\tfindByKey: function (keyValue) {\r\n\t\tvar keyField = this.keyField();\r\n\t\tif (!keyField) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\treturn this.findByField(keyField, keyValue);\r\n\t},\r\n\r\n\t/**\r\n\t * Find record and return specified field value\r\n\t * \r\n\t * @param {String} fldName - field name\r\n\t * @param {Object} findingValue - finding field value\r\n\t * @param {String} returnFieldName - return value field name\r\n\t * @return {Object} \r\n\t */\r\n\tlookup: function (fldName, findingValue, returnFieldName) {\r\n\t\tif (this.findByField(fldName, findingValue)) {\r\n\t\t\treturn this.getFieldValue(returnFieldName);\r\n\t\t} else {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t},\r\n\r\n\tlookupByKey: function(keyValue, returnFldName) {\r\n\t\tif (this.findByKey(keyValue)) {\r\n\t\t\treturn this.getFieldValue(returnFldName);\r\n\t\t} else {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * Copy dataset's data. Example:\r\n\t * <pre><code>\r\n\t * var list = dsFoo.copyDataset(true);\r\n\t * \r\n\t * </code></pre>\r\n\t * \r\n\t * @param {Boolean} underCurrentFilter - if true, copy data under dataset's {@link}filter\r\n\t * @return {Object[]} Array of records. \r\n\t */\r\n\tcopyDataset: function (underCurrentFilter) {\r\n\t\tvar Z = this;\r\n\t\tif (Z.recordCount() === 0) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tvar result = [];\r\n\r\n\t\tif ((!underCurrentFilter || !Z._filtered)) {\r\n\t\t\treturn Z.dataList().slice(0);\r\n\t\t}\r\n\r\n\t\tvar foundRecno = -1, \r\n\t\t\toldRecno = Z._recno, \r\n\t\t\toldFiltered = Z._filtered;\r\n\t\tif (!underCurrentFilter) {\r\n\t\t\tZ._filtered = false;\r\n\t\t}\r\n\r\n\t\tZ._silence++;\r\n\t\ttry {\r\n\t\t\tZ.first();\r\n\t\t\twhile (!Z.isEof()) {\r\n\t\t\t\tresult.push(Z.getRecord());\r\n\t\t\t\tZ.next();\r\n\t\t\t}\r\n\t\t} finally {\r\n\t\t\tZ._silence--;\r\n\t\t\tZ._recno = oldRecno;\r\n\t\t\tif (!underCurrentFilter) {\r\n\t\t\t\tZ._filtered = oldFiltered;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn result;\r\n\t},\r\n\r\n\t/**\r\n\t * Set or get 'key' field name\r\n\t * \r\n\t * @param {String} keyFldName Key field name.\r\n\t * @return {String or this}\r\n\t */\r\n\tkeyField: function (keyFldName) {\r\n\t\tif (keyFldName === undefined) {\r\n\t\t\treturn this._keyField;\r\n\t\t}\r\n\t\tjslet.Checker.test('Dataset.keyField', keyFldName).isString();\r\n\t\tthis._keyField = jQuery.trim(keyFldName);\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Set or get 'code' field name\r\n\t * \r\n\t * @param {String} codeFldName Code field name.\r\n\t * @return {String or this}\r\n\t */\r\n\tcodeField: function (codeFldName) {\r\n\t\tif (codeFldName === undefined) {\r\n\t\t\treturn this._codeField;\r\n\t\t}\r\n\t\t\r\n\t\tjslet.Checker.test('Dataset.codeField', codeFldName).isString();\r\n\t\tthis._codeField = jQuery.trim(codeFldName);\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Set or get 'name' field name\r\n\t * \r\n\t * @param {String} nameFldName Name field name\r\n\t * @return {String or this}\r\n\t */\r\n\tnameField: function (nameFldName) {\r\n\t\tif (nameFldName === undefined) {\r\n\t\t\treturn this._nameField;\r\n\t\t}\r\n\t\t\r\n\t\tjslet.Checker.test('Dataset.nameField', nameFldName).isString();\r\n\t\tthis._nameField = jQuery.trim(nameFldName);\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Set or get 'parent' field name\r\n\t * \r\n\t * @param {String} parentFldName Parent field name.\r\n\t * @return {String or this}\r\n\t */\r\n\tparentField: function (parentFldName) {\r\n\t\tif (parentFldName === undefined) {\r\n\t\t\treturn this._parentField;\r\n\t\t}\r\n\t\t\r\n\t\tjslet.Checker.test('Dataset.parentField', parentFldName).isString();\r\n\t\tthis._parentField = jQuery.trim(parentFldName);\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\tlevelOrderField: function(fldName) {\r\n\t\tif (fldName === undefined) {\r\n\t\t\treturn this._levelOrderField;\r\n\t\t}\r\n\t\t\r\n\t\tjslet.Checker.test('Dataset.levelOrderField', fldName).isString();\r\n\t\tthis._levelOrderField = jQuery.trim(fldName);\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Set or get 'select' field name. \"Select field\" is a field to store the selected state of a record. \r\n\t * \r\n\t * @param {String} parentFldName Parent field name.\r\n\t * @return {String or this}\r\n\t */\r\n\tselectField: function (selectFldName) {\r\n\t\tif (selectFldName === undefined) {\r\n\t\t\treturn this._selectField;\r\n\t\t}\r\n\t\t\r\n\t\tjslet.Checker.test('Dataset.selectField', selectFldName).isString();\r\n\t\tthis._selectField = jQuery.trim(selectFldName);\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @private\r\n\t */\r\n\t_convertFieldValue: function (srcField, srcValues, destFields) {\r\n\t\tvar Z = this;\r\n\r\n\t\tif (destFields === null) {\r\n\t\t\tthrow new Error('NOT set destFields in method: ConvertFieldValue');\r\n\t\t}\r\n\t\tvar isExpr = destFields.indexOf('[') > -1;\r\n\t\tif (isExpr) {\r\n\t\t\tif (destFields != Z._convertDestFields) {\r\n\t\t\t\tZ._innerConvertDestFields = new jslet.Expression(this,\r\n\t\t\t\t\t\tdestFields);\r\n\t\t\t\tZ._convertDestFields = destFields;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (typeof (srcValues) != 'string') {\r\n\t\t\tsrcValues += '';\r\n\t\t}\r\n\t\tvar separator = jslet.global.valueSeparator;\r\n\t\tvar values = srcValues.split(separator), valueCnt = values.length - 1;\r\n\t\tZ._ignoreFilter = true;\r\n\t\ttry {\r\n\t\t\tif (valueCnt === 0) {\r\n\t\t\t\tif (!Z.findByField(srcField, values[0])) {\r\n\t\t\t\t\treturn null;\r\n\t\t\t\t\t//throw new Error(jslet.formatString(jslet.locale.Dataset.valueNotFound,[Z._name, srcField, values[0]]));\r\n\t\t\t\t}\r\n\t\t\t\tif (isExpr) {\r\n\t\t\t\t\treturn Z._innerConvertDestFields.eval();\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn Z.getFieldValue(destFields);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\r\n\t\t\tvar fldcnt, destValue = '';\r\n\t\t\tfor (var i = 0; i <= valueCnt; i++) {\r\n\t\t\t\tif (!Z.findByField(srcField, values[i])) {\r\n\t\t\t\t\treturn null;\r\n\t\t\t\t}\r\n\t\t\t\tif (isExpr) {\r\n\t\t\t\t\tdestValue += Z._innerConvertDestFields.eval();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdestValue += Z.getFieldValue(destFields);\r\n\t\t\t\t}\r\n\t\t\t\tif (i != valueCnt) {\r\n\t\t\t\t\tdestValue += separator;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn destValue;\r\n\t\t} finally {\r\n\t\t\tZ._ignoreFilter = false;\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Set or get context rule\r\n\t * \r\n\t * @param {jslet.data.ContextRule[]} contextRule Context rule;\r\n\t * @return {jslet.data.ContextRule[] or this}\r\n\t */\r\n\tcontextRules: function (rules) {\r\n\t\tif (rules === undefined) {\r\n\t\t\treturn this._contextRules;\r\n\t\t}\r\n\t\tif(jslet.isString(rules)) {\r\n\t\t\trules = rules? jslet.JSON.parse(rules): null;\r\n\t\t}\r\n\t\tjslet.Checker.test('Dataset.contextRules', rules).isArray();\r\n\t\tif(!rules || rules.length === 0) {\r\n\t\t\tthis._contextRules = null;\r\n\t\t\tthis._contextRuleEngine = null;\r\n\t\t} else {\r\n\t\t\tvar ruleObj;\r\n\t\t\tfor(var i = 0, len = rules.length; i < len; i++) {\r\n\t\t\t\truleObj = rules[i];\r\n\t\t\t\tif(!ruleObj.className || \r\n\t\t\t\t\t\truleObj.className != jslet.data.ContextRule.className) {\r\n\t\t\t\t\t\r\n\t\t\t\t\tjslet.Checker.test('Dataset.contextRules#ruleObj', ruleObj).isPlanObject();\r\n\t\t\t\t\trules[i] = jslet.data.createContextRule(ruleObj);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis._contextRules = rules;\r\n\t\t\tthis._contextRuleEngine = new jslet.data.ContextRuleEngine(this);\r\n\t\t\tthis._contextRuleEngine.compile();\r\n\t\t\tthis.enableContextRule();\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Disable context rule\r\n\t */\r\n\tdisableContextRule: function () {\r\n\t\tthis._contextRuleEnabled = false;\r\n//\t\tthis.restoreContextRule();\r\n\t},\r\n\r\n\t/**\r\n\t * Enable context rule, any context rule will be calculated.\r\n\t */\r\n\tenableContextRule: function () {\r\n\t\tthis._contextRuleEnabled = true;\r\n\t\tthis.calcContextRule();\r\n\t},\r\n\r\n\t/**\r\n\t * Check context rule enable or not.\r\n\t * \r\n\t * @return {Boolean}\r\n\t */\r\n\tisContextRuleEnabled: function () {\r\n\t\treturn this._contextRuleEnabled;\r\n\t},\r\n\r\n\t/**\r\n\t * @private\r\n\t */\r\n\tcalcContextRule: function (changedField) {\r\n\t\tvar Z = this;\r\n\t\tif(Z.recordCount() === 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tif(Z._contextRuleEngine) {\r\n\t\t\tZ._inContextRule = true;\r\n\t\t\ttry {\r\n\t\t\t\tif(!changedField) {\r\n\t\t\t\t\tZ._contextRuleEngine.evalStatus();\r\n\t\t\t\t}\r\n\t\t\t\tZ._contextRuleEngine.evalRule(changedField);\r\n\t\t\t} finally {\r\n\t\t\t\tZ._inContextRule = false;\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Check current record if it's selectable.\r\n\t */\r\n\tcheckSelectable: function (recno) {\r\n\t\tif(this.recordCount() === 0) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tif(this._onCheckSelectable) {\r\n\t\t\tvar eventFunc = jslet.getFunction(this._onCheckSelectable);\r\n\t\t\tif(eventFunc) {\r\n\t\t\t\treturn eventFunc.call(this, recno);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn true;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get or set selected state of current record.\r\n\t */\r\n\tselected: function (selected) {\r\n\t\tvar Z = this;\r\n\t\tvar selFld = Z._selectField || jslet.global.selectStateField,\r\n\t\t\trec = Z.getRecord();\r\n\t\t\r\n\t\tif(selected === undefined) {\r\n\t\t\treturn rec && rec[selFld];\r\n\t\t}\r\n\t\t\r\n\t\tif(rec) {\r\n\t\t\tif(Z.checkSelectable()) {\r\n\t\t\t\tZ._aborted = false;\r\n\t\t\t\ttry {\r\n\t\t\t\t\tZ._fireDatasetEvent(jslet.data.DatasetEvent.BEFORESELECT);\r\n\t\t\t\t\tif (Z._aborted) {\r\n\t\t\t\t\t\treturn Z;\r\n\t\t\t\t\t}\r\n\t\t\t\t} finally {\r\n\t\t\t\t\tZ._aborted = false;\r\n\t\t\t\t}\r\n\t\t\t\trec[selFld] = selected;\r\n\t\t\t\tZ._fireDatasetEvent(jslet.data.DatasetEvent.AFTERSELECT);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn Z;\r\n\t},\r\n\t\r\n\tselectedByRecno: function(recno) {\r\n\t\tvar Z = this,\r\n\t\t\tselFld = Z._selectField || jslet.global.selectStateField,\r\n\t\t\trec = Z.getRecord(recno);\r\n\t\t\r\n\t\treturn rec && rec[selFld];\r\n\t},\r\n\t\r\n\t/**\r\n\t * Select/unselect all records.\r\n\t * \r\n\t * @param {Boolean}selected  true - select records, false otherwise.\r\n\t * @param {Function)onSelectAll Select event handler.\r\n\t *\tPattern: function(dataset, Selected}{}\r\n\t *\t//dataset: jslet.data.Dataset\r\n\t *\t//Selected: Boolean\r\n\t *\t//return: true - allow user to select, false - otherwise.\r\n\r\n\t * @param {Boolean}noRefresh Refresh controls or not.\r\n\t */\r\n\tselectAll: function (selected, onSelectAll, noRefresh) {\r\n\t\tvar Z = this;\r\n\t\tif (Z.recordCount() === 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tjslet.Checker.test('Dataset.selectAll#onSelectAll', onSelectAll).isFunction();\r\n\t\tvar oldRecno = Z.recno();\r\n\t\ttry {\r\n\t\t\tfor (var i = 0, cnt = Z.recordCount(); i < cnt; i++) {\r\n\t\t\t\tZ.recnoSilence(i);\r\n\r\n\t\t\t\tif (onSelectAll) {\r\n\t\t\t\t\tvar flag = onSelectAll(this, selected);\r\n\t\t\t\t\tif (flag !== undefined && !flag) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tZ.selected(selected);\r\n\t\t\t}\r\n\t\t} finally {\r\n\t\t\tZ.recnoSilence(oldRecno);\r\n\t\t}\r\n\t\tif (!noRefresh) {\r\n\t\t\tvar evt = jslet.data.RefreshEvent.selectAllEvent(selected);\r\n\t\t\tZ.refreshControl(evt);\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Select/unselect record by key value.\r\n\t * \r\n\t * @param {Boolean} selected true - select records, false otherwise.\r\n\t * @param {Object) keyValue Key value.\r\n\t * @param {Boolean} noRefresh Refresh controls or not.\r\n\t */\r\n\tselectByKeyValue: function (selected, keyValue, noRefresh) {\r\n\t\tvar Z = this,\r\n\t\t\toldRecno = Z.recno(),\r\n\t\t\tcnt = Z.recordCount(),\r\n\t\t\tv, changedRecNum = [];\r\n\t\ttry {\r\n\t\t\tfor (var i = 0; i < cnt; i++) {\r\n\t\t\t\tZ.recnoSilence(i);\r\n\t\t\t\tv = Z.getFieldValue(Z._keyField);\r\n\t\t\t\tif (v == keyValue) {\r\n\t\t\t\t\tZ.selected(selected);\r\n\t\t\t\t\tchangedRecNum.push(i);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t} //end for\r\n\t\t} finally {\r\n\t\t\tZ.recnoSilence(oldRecno);\r\n\t\t}\r\n\t\tif (!noRefresh) {\r\n\t\t\tvar evt = jslet.data.RefreshEvent.selectRecordEvent(changedRecNum, selected);\r\n\t\t\tZ.refreshControl(evt);\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Select current record or not.\r\n\t * If 'selectBy' is not empty, select all records which value of 'selectBy' field is same as the current record.\r\n\t * <pre><code>\r\n\t * dsEmployee.select(true, 'gender');\r\n\t * //if the 'gender' of current value is female, all female employees will be selected.  \r\n\t * </code></pre>\r\n\t * \r\n\t * @param {Boolean}selected - true: select records, false:unselect records\r\n\t * @param {String)selectBy - field names, multiple fields concatenated with ',' \r\n\t */\r\n\tselect: function (selected, selectBy) {\r\n\t\tvar Z = this;\r\n\t\tif (Z.recordCount() === 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar changedRecNum = [];\r\n\t\tif (!selectBy) {\r\n\t\t\tZ.selected(selected);\r\n\t\t\tchangedRecNum.push(Z.recno());\r\n\t\t} else {\r\n\t\t\tvar arrFlds = selectBy.split(','), \r\n\t\t\t\tarrValues = [], i, \r\n\t\t\t\tfldCnt = arrFlds.length;\r\n\t\t\tfor (i = 0; i < fldCnt; i++) {\r\n\t\t\t\tarrValues[i] = Z.getFieldValue(arrFlds[i]);\r\n\t\t\t}\r\n\t\t\tvar v, preRecno = Z.recno(), flag;\r\n\t\t\ttry {\r\n\t\t\t\tfor (var k = 0, recCnt = Z.recordCount(); k < recCnt; k++) {\r\n\t\t\t\t\tZ.recnoSilence(k);\r\n\t\t\t\t\tflag = 1;\r\n\t\t\t\t\tfor (i = 0; i < fldCnt; i++) {\r\n\t\t\t\t\t\tv = Z.getFieldValue(arrFlds[i]);\r\n\t\t\t\t\t\tif (v != arrValues[i]) {\r\n\t\t\t\t\t\t\tflag = 0;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (flag) {\r\n\t\t\t\t\t\tZ.selected(selected);\r\n\t\t\t\t\t\tchangedRecNum.push(Z.recno());\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} finally {\r\n\t\t\t\tZ.recnoSilence(preRecno);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar evt = jslet.data.RefreshEvent.selectRecordEvent(changedRecNum, selected);\r\n\t\tZ.refreshControl(evt);\r\n\t},\r\n\r\n\t/**\r\n\t * Set or get data provider\r\n\t * \r\n\t * @param {jslet.data.Provider} provider - data provider\r\n\t * @return {jslet.data.Provider or this}\r\n\t */\r\n\tdataProvider: function (provider) {\r\n\t\tif (provider === undefined) {\r\n\t\t\treturn this._dataProvider;\r\n\t\t}\r\n\t\tthis._dataProvider = provider;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @private\r\n\t */\r\n\t_checkDataProvider: function () {\r\n\t\tif (!this._dataProvider) {\r\n\t\t\tthrow new Error('DataProvider required, use: yourDataset.dataProvider(yourDataProvider);');\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Get selected records\r\n\t * \r\n\t * @return {Object[]} Array of records\r\n\t */\r\n\tselectedRecords: function () {\r\n\t\tvar Z = this;\r\n\t\tif (!Z.hasRecord()) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tvar preRecno = Z.recno(), result = [];\r\n\t\ttry {\r\n\t\t\tfor (var k = 0, recCnt = Z.recordCount(); k < recCnt; k++) {\r\n\t\t\t\tZ.recnoSilence(k);\r\n\t\t\t\tif(Z.selected()) {\r\n\t\t\t\t\tresult.push(Z.getRecord());\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} finally {\r\n\t\t\tZ.recnoSilence(preRecno);\r\n\t\t}\r\n\t\t\r\n\t\treturn result;\r\n\t},\r\n\r\n\t/**\r\n\t * Get key values of selected records.\r\n\t * \r\n\t * @return {Object[]} Array of selected record key values\r\n\t */\r\n\tselectedKeyValues: function () {\r\n\t\tvar oldRecno = this.recno(), result = [];\r\n\t\ttry {\r\n\t\t\tfor (var i = 0, cnt = this.recordCount(); i < cnt; i++) {\r\n\t\t\t\tthis.recnoSilence(i);\r\n\t\t\t\tvar state = this.selected();\r\n\t\t\t\tif (state && state !== 2) { // 2: partial select\r\n\t\t\t\t\tresult.push(this.getFieldValue(this._keyField));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} finally {\r\n\t\t\tthis.recnoSilence(oldRecno);\r\n\t\t}\r\n\t\tif (result.length > 0) {\r\n\t\t\treturn result;\r\n\t\t} else {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t},\r\n\r\n\tqueryUrl: function(url) {\r\n\t\tif(url === undefined) {\r\n\t\t\treturn this._queryUrl;\r\n\t\t}\r\n\t\tjslet.Checker.test('Dataset.queryUrl', url).isString();\r\n\t\tthis._queryUrl = jQuery.trim(url);\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Query data from server. Example:\r\n\t * <pre><code>\r\n\t * dsEmployee.queryUrl('../getemployee.do');\r\n\t * var criteria = {name:'Bob', age:25};\r\n\t * dsEmployee.query(condition);\r\n\t * </code></pre>\r\n\t * @param {Plan Object or jslet.data.Dataset} criteria Condition should be a JSON object or criteria dataset.\r\n\t */\r\n\tquery: function (criteria) {\r\n\t\tif(criteria && criteria instanceof jslet.data.Dataset) {\r\n\t\t\tvar criteriaDataset = criteria;\r\n\t\t\tcriteriaDataset.confirm();\r\n\t\t\tif(criteriaDataset.checkAndShowError()) {\r\n\t\t\t\treturn jslet.emptyPromise;\r\n\t\t\t}\r\n\t\t\tcriteria = criteriaDataset.getRecord();\r\n\t\t}\r\n\t\tthis._queryCriteria = criteria;\r\n\t\treturn this.requery();\r\n\t},\r\n\r\n\t_doQuerySuccess: function(result, dataset) {\r\n\t\tvar Z = dataset;\r\n\t\tif (!result) {\r\n\t\t\tZ.dataList([]);\r\n\t\t\tif(result && result.info) {\r\n\t\t\t\tjslet.showInfo(result.info);\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar mainData = result.main;\r\n\t\tif (mainData) {\r\n\t\t\tZ.dataList(mainData);\r\n\t\t}\r\n\t\tvar extraData = result.extraEntities;\r\n\t\tif(extraData) {\r\n\t\t\tvar dsName, ds;\r\n\t\t\tfor (var dsName in extraData) {\r\n\t\t\t\tds = jslet.data.getDataset(dsName);\r\n\t\t\t\tif (ds) {\r\n\t\t\t\t\tds.dataList(extraData[dsName]);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconsole.warn(dsName + ' is returned from server, but this datase does not exist!');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (result.pageNo) {\r\n\t\t\tZ._pageNo = result.pageNo;\r\n\t\t}\r\n\t\tif (result.pageCount) {\r\n\t\t\tZ._pageCount = result.pageCount;\r\n\t\t}\r\n\r\n\t\tvar evt = jslet.data.RefreshEvent.changePageEvent();\r\n\t\tZ.refreshControl(evt);\r\n\t\tif(result && result.info) {\r\n\t\t\tjslet.showInfo(result.info);\r\n\t\t}\r\n\t},\r\n\t\r\n\t_doApplyError: function(result, dataset) {\r\n\t\tvar Z = dataset,\r\n\t\t\terrCode = result.errorCode,\r\n\t\t\terrMsg = result.errorMessage;\r\n\t\tif(jslet.global.serverErrorHandler) {\r\n\t\t\tvar catched = jslet.global.serverErrorHandler(errCode, errMsg);\r\n\t\t\tif(catched) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\terrMsg = errMsg + \"[\" + errCode + \"]\";\r\n\t\tZ.errorMessage(errMsg);\r\n\t\tif(Z._autoShowError) {\r\n\t\t\tjslet.showError(errMsg);\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * Send request to refresh with current condition.\r\n\t */\r\n\trequery: function () {\r\n\t\tvar Z = this;\r\n\t\tZ._checkDataProvider();\r\n\r\n\t\tif(!this._queryUrl) {\r\n\t\t\tthrow new Error('QueryUrl required! Use: yourDataset.queryUrl(yourUrl)');\r\n\t\t}\r\n\t\tif(Z._querying) { //Avoid duplicate submitting\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tZ._querying = true;\r\n\t\ttry {\r\n\t\t\tvar reqData = {};\r\n\t\t\tif(Z._pageNo > 0) {\r\n\t\t\t\treqData.pageNo = Z._pageNo;\r\n\t\t\t\treqData.pageSize = Z._pageSize;\r\n\t\t\t}\r\n\t\t\tvar criteria = Z._queryCriteria;\r\n\t\t\tif(criteria) {\r\n\t\t\t\tif(jslet.isArray(criteria)) {\r\n\t\t\t\t\treqData.criteria = criteria;\r\n\t\t\t\t} else {\r\n\t\t\t\t\treqData.simpleCriteria = criteria;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(Z.csrfToken) {\r\n\t\t\t\treqData.csrfToken = Z.csrfToken;\r\n\t\t\t}\r\n\t\t\tvar reqData = jslet.data.record2Json(reqData);\r\n\t\t\tvar url = Z._queryUrl;\r\n\t\t\treturn Z._dataProvider.sendRequest(Z, url, reqData)\r\n\t\t\t.done(Z._doQuerySuccess)\r\n\t\t\t.fail(Z._doApplyError)\r\n\t\t\t.always(function(){Z._querying = false})\r\n\t\t} catch(e) {\r\n\t\t\tZ._querying = false\r\n\t\t}\r\n\t},\r\n\r\n\t_setChangedState: function(flag, chgRecs, pendingRecs) {\r\n\t\tif(!chgRecs || chgRecs.length === 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar result = this._addRecordClassFlag(chgRecs, flag, this._recordClass || jslet.global.defaultRecordClass);\r\n\t\tfor(var i = 0, len = result.length; i < len; i++) {\r\n\t\t\tpendingRecs.push(result[i]);\r\n\t\t}\r\n\t},\r\n\r\n\t_addRecordClassFlag: function(records, changeFlag, recClazz) {\r\n\t\tvar fields = this.getFields(),\r\n\t\t\tfldObj,\r\n\t\t\tsubRecordClass = null;\r\n\t\t\r\n\t\tfor(var i = 0, len = fields.length; i < len; i++) {\r\n\t\t\tfldObj = fields[i];\r\n\t\t\tif(fldObj.getType() === jslet.data.DataType.DATASET) {\r\n\t\t\t\tif(!subRecordClass) {\r\n\t\t\t\t\tsubRecordClass = {};\r\n\t\t\t\t}\r\n\t\t\t\tsubRecordClass[fldObj.name()] = fldObj.subDataset().recordClass();\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar result = [], rec, pRec, subRecClazz;\r\n\t\tfor (var i = 0, cnt = records.length; i < cnt; i++) {\r\n\t\t\trec = records[i];\r\n\t\t\tpRec = {};\r\n\t\t\tif(recClazz) {\r\n\t\t\t\tpRec[\"@type\"] = recClazz;\r\n\t\t\t}\r\n\t\t\trec[jslet.global.changeStateField] = changeFlag + i;\r\n\t\t\tvar fldValue;\r\n\t\t\tfor(var prop in rec) {\r\n\t\t\t\tfldValue = rec[prop];\r\n\t\t\t\tif(fldValue && subRecordClass) {\r\n\t\t\t\t\tsubRecClazz = subRecordClass[prop];\r\n\t\t\t\t\tif(subRecClazz) {\r\n\t\t\t\t\t\tfldValue = this._addRecordClassFlag(fldValue, changeFlag, subRecClazz);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tpRec[prop] = fldValue;\r\n\t\t\t}\r\n\t\t\tresult.push(pRec);\r\n\t\t}\r\n\t\treturn result;\r\n\t},\r\n\t\r\n\t_doSaveSuccess: function(result, dataset) {\r\n\t\tif (!result) {\r\n\t\t\tif(result && result.info) {\r\n\t\t\t\tjslet.showInfo(result.info);\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar mainData = result.main;\r\n\t\tvar Z = dataset;\r\n\t\tZ._dataTransformer.refreshSubmittedData(mainData);\r\n\r\n\t\tZ.calcAggradedValue();\r\n\t\tZ.selection.removeAll();\r\n\t\t\r\n\t\tZ.refreshControl();\r\n\t\tZ.refreshLookupHostDataset();\r\n\t\tif(result && result.info) {\r\n\t\t\tjslet.showInfo(result.info);\r\n\t\t}\r\n\t},\r\n\t\r\n\tsubmitUrl: function(url) {\r\n\t\tif(url === undefined) {\r\n\t\t\treturn this._submitUrl;\r\n\t\t}\r\n\r\n\t\tjslet.Checker.test('Dataset.submitUrl', url).isString();\r\n\t\tthis._submitUrl = jQuery.trim(url);\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Identify dataset has changed records.\r\n\t */\r\n\thasChangedData: function() {\r\n\t\tvar Z = this;\r\n\t\tZ.confirm();\r\n\t\tvar dataList = Z.dataList(), record, recInfo;\r\n\t\tif(!dataList) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tfor(var i = 0, len = dataList.length; i < len; i++) {\r\n\t\t\trecord = dataList[i];\r\n\t\t\trecInfo = jslet.data.getRecInfo(record);\r\n\t\t\treturn recInfo && recInfo.status && recInfo.status !== jslet.data.DataSetStatus.BROWSE;\r\n\t\t}\r\n\t\treturn false;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Submit changed data to server. \r\n\t * If server side save data successfully and return the changed data, Jslet can refresh the local data automatically.\r\n\t * \r\n\t * Cause key value is probably generated at server side(like sequence), we need an extra field which store an unique value to update the key value,\r\n\t * this extra field is named '_s_', its value will start a letter 'i', 'u' or 'd', and follow a sequence number, like: i1, i2, u1, u2, d1, d3,....\r\n\t * You don't care about it in client side, it is generated by Jslet automatically.\r\n\t * \r\n\t * At server side, you can use the leading letter to distinguish which action will be sent to DB('i' for insert, 'u' for update and 'd' for delete)\r\n\t * If the records need be changed in server(like sequence key or other calculated fields), you should return them back.Notice:\r\n\t * you need not to change this value of extra field: '_s_', just return it. Example:\r\n\t * <pre><code>\r\n\t * dsFoo.insertRecord();\r\n\t * dsFoo.setFieldValue('name','Bob');\r\n\t * dsFoo.setFieldValue('code','A01');\r\n\t * dsFoo.confirm();\r\n\t * dsFoo.submitUrl('../foo_save.do');\r\n\t * dsFoo.submit();\r\n\t * </code></pre>\r\n\t * \r\n\t * @param {Object} extraInfo extraInfo to send to server\r\n\t * @param {Array of String} excludeFields Array of field names which need not be sent to server;\r\n\t */\r\n\tsubmit: function(extraInfo, excludeFields) {\r\n\t\tvar Z = this;\r\n\t\tZ.confirm();\r\n\t\tif(Z.checkAndShowError()) {\r\n\t\t\treturn jslet.emptyPromise;\r\n\t\t}\r\n\t\tZ._checkDataProvider();\r\n\r\n\t\tif(!Z._submitUrl) {\r\n\t\t\tthrow new Error('SubmitUrl required! Use: yourDataset.submitUrl(yourUrl)');\r\n\t\t}\r\n\t\tvar changedRecs = Z._dataTransformer.getSubmittingChanged();\r\n\t\tif (!changedRecs || changedRecs.length === 0) {\r\n\t\t\tjslet.showInfo(jslet.locale.Dataset.noDataSubmit);\r\n\t\t\treturn jslet.emptyPromise;\r\n\t\t}\r\n\t\tif(Z._submitting) { //Avoid duplicate submitting\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tZ._submitting = true;\r\n\t\ttry {\r\n\t\t\tvar reqData = {main: changedRecs};\r\n\t\t\tif(extraInfo) {\r\n\t\t\t\treqData.extraInfo = extraInfo;\r\n\t\t\t}\r\n\t\t\tif(Z.csrfToken) {\r\n\t\t\t\treqData.csrfToken = Z.csrfToken;\r\n\t\t\t}\r\n\t\t\treqData = jslet.data.record2Json(reqData, excludeFields);\r\n\t\t\tvar url = Z._submitUrl;\r\n\t\t\treturn Z._dataProvider.sendRequest(Z, url, reqData)\r\n\t\t\t.done(Z._doSaveSuccess)\r\n\t\t\t.fail(Z._doApplyError)\r\n\t\t\t.always(function(){\r\n\t\t\t\tZ._submitting = false;\r\n\t\t\t});\r\n\t\t} catch(e) {\r\n\t\t\tZ._submitting = false\r\n\t\t}\r\n\t},\r\n\t\r\n\t_doSubmitSelectedSuccess: function(result, dataset) {\r\n\t\tif(!result) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar mainData = result.main;\r\n\t\tif (!mainData || mainData.length === 0) {\r\n\t\t\tif(result.info) {\r\n\t\t\t\tjslet.showInfo(result.info);\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar Z = dataset,\r\n\t\t\tdeleteOnSuccess = Z._deleteOnSuccess_,\r\n\t\t\tarrRecs = Z.selectedRecords() || [],\r\n\t\t\ti, k,\r\n\t\t\trecords = Z.dataList();\r\n\t\tZ.selection.removeAll();\r\n\t\tif(deleteOnSuccess) {\r\n\t\t\tfor(i = arrRecs.length; i >= 0; i--) {\r\n\t\t\t\trec = arrRecs[i];\r\n\t\t\t\tk = records.indexOf(rec);\r\n\t\t\t\trecords.splice(k, 1);\r\n\t\t\t}\r\n\t\t\tZ._refreshInnerRecno();\r\n\t\t} else {\r\n\t\t\tvar newRec, oldRec, len;\r\n\t\t\tZ._dataTransformer.refreshSubmittedData(mainData);\r\n\t\t}\r\n\t\tZ.calcAggradedValue();\r\n\t\tZ.refreshControl();\r\n\t\tZ.refreshLookupHostDataset();\r\n\t\tif(result && result.info) {\r\n\t\t\tjslet.showInfo(result.info);\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * Send selected data to server whether or not the records have been changed. \r\n\t * Under some special scenarios, we need send user selected record to server to process. \r\n\t * Sever side need not send back the processed records. Example:\r\n\t * \r\n\t * <pre><code>\r\n\t * //Audit the selected records, if successful, delete the selected records.\r\n\t * dsFoo.submitSelected('../foo_audit.do', true);\r\n\t * \r\n\t * </code></pre>\r\n\t * @param {String} url Url\r\n\t * @param {Boolean} deleteOnSuccess If processing successfully at server side, delete the selected record or not.\r\n\t * @param {Object} extraInfo extraInfo\r\n\t * @param {Array of String} excludeFields Array of field names which need not be sent to server;\r\n\t */\r\n\tsubmitSelected: function (url, deleteOnSuccess, extraInfo, excludeFields) {\r\n\t\tvar Z = this;\r\n\t\tZ.confirm();\r\n\t\tif(Z.checkAndShowError()) {\r\n\t\t\treturn jslet.emptyPromise;\r\n\t\t}\r\n\t\tZ._checkDataProvider();\r\n\t\tif(!url) {\r\n\t\t\tthrow new Error('Url required! Use: yourDataset.submitSelected(yourUrl)');\r\n\t\t}\r\n\t\tif(Z._submitting) { //Avoid duplicate submitting\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tZ._submitting = true;\r\n\t\ttry {\r\n\t\t\tvar changedRecs = Z._dataTransformer.getSubmittingSelected() || [];\r\n\t\r\n\t\t\tZ._deleteOnSuccess_ = deleteOnSuccess;\r\n\t\t\tvar reqData = {main: changedRecs};\r\n\t\t\tif(Z.csrfToken) {\r\n\t\t\t\treqData.csrfToken = Z.csrfToken;\r\n\t\t\t}\r\n\t\t\tif(extraInfo) {\r\n\t\t\t\treqData.extraInfo = extraInfo;\r\n\t\t\t}\r\n\t\t\treqData = jslet.data.record2Json(reqData, excludeFields);\r\n\t\t\treturn Z._dataProvider.sendRequest(Z, url, reqData)\r\n\t\t\t.done(Z._doSubmitSelectedSuccess)\r\n\t\t\t.fail(Z._doApplyError)\r\n\t\t\t.always(function(){\r\n\t\t\t\tZ._submitting = false;\r\n\t\t\t});\r\n\t\t} catch(e) {\r\n\t\t\tZ._submitting = false\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * @private\r\n\t */\r\n\t_refreshInnerControl: function (updateEvt) {\r\n\t\tvar i, cnt, ctrl;\r\n\t\tif (updateEvt.eventType == jslet.data.RefreshEvent.UPDATEALL || \r\n\t\t\t\tupdateEvt.eventType == jslet.data.RefreshEvent.CHANGEMETA) {\r\n\t\t\tcnt = this._linkedLabels.length;\r\n\t\t\tfor (i = 0; i < cnt; i++) {\r\n\t\t\t\tctrl = this._linkedLabels[i];\r\n\t\t\t\tif (ctrl.refreshControl) {\r\n\t\t\t\t\tctrl.refreshControl(updateEvt);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tcnt = this._linkedControls.length;\r\n\t\tfor (i = 0; i < cnt; i++) {\r\n\t\t\tctrl = this._linkedControls[i];\r\n\t\t\tif (ctrl.refreshControl) {\r\n\t\t\t\tctrl.refreshControl(updateEvt);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Focus on the edit control that link specified field name.\r\n\t * \r\n\t * @param {String} fldName Field name\r\n\t */\r\n\tfocusEditControl: function (fldName) {\r\n\t\tvar Z = this,\r\n\t\t\tctrl, el, fldObj;\r\n\t\tfor (var i = Z._linkedControls.length - 1; i >= 0; i--) {\r\n\t\t\tctrl = Z._linkedControls[i];\r\n\t\t\tif(!ctrl.field) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif (ctrl.field() == fldName) {\r\n\t\t\t\tfldObj = Z.getField(fldName);\r\n\t\t\t\tif(!fldObj || !fldObj.visible() || fldObj.disabled()|| !ctrl.isActiveRecord()) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tel = ctrl.el;\r\n\t\t\t\tif (el.focus) {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tel.focus();\r\n\t\t\t\t\t\tif(ctrl.selectText) {\r\n\t\t\t\t\t\t\tctrl.selectText();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t} catch (e) {\r\n\t\t\t\t\t\tconsole.warn('Can\\' focus into a disabled control!');\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} //end if\r\n\t\t} //end for\r\n\t},\r\n\r\n\t/**\r\n\t * Refresh whole field.\r\n\t * \r\n\t * @param {String} fldName field name.\r\n\t */\r\n\trefreshField: function(fldName) {\r\n\t\tthis.refreshControl(jslet.data.RefreshEvent.updateColumnEvent(fldName));\r\n\t},\r\n\t\r\n\t/**\r\n\t * Refresh lookup field.\r\n\t * \r\n\t * @param {String} fldName field name.\r\n\t * @param {Integer} recno (Optional) if recno >=0, only refresh the current record control specified by 'recno', otherwise refresh whole field. \r\n\t */\r\n\trefreshLookupField: function(fldName, recno) {\r\n\t\tvar lookupEvt;\r\n\t\tif(recno === undefined) {\r\n\t\t\tlookupEvt = jslet.data.RefreshEvent.lookupEvent(fldName);\r\n\t\t} else {\r\n\t\t\tlookupEvt = jslet.data.RefreshEvent.lookupEvent(fldName, recno);\r\n\t\t}\r\n\t\tthis.refreshControl(lookupEvt);\r\n\t},\r\n\t\r\n\t/**\r\n\t * @private \r\n\t */\r\n\trefreshControl: function (updateEvt) {\r\n\t\tif (this._lockCount) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (!updateEvt) {\r\n\t\t\tupdateEvt = jslet.data.RefreshEvent.updateAllEvent();\r\n\t\t}\r\n\t\tthis._refreshInnerControl(updateEvt);\r\n\t},\r\n\r\n\t/**\r\n\t * @private \r\n\t */\r\n\taddLinkedControl: function (linkedControl) {\r\n\t\tif (linkedControl.isLabel) {\r\n\t\t\tthis._linkedLabels.push(linkedControl);\r\n\t\t} else {\r\n\t\t\tthis._linkedControls.push(linkedControl);\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * @private \r\n\t */\r\n\tremoveLinkedControl: function (linkedControl) {\r\n\t\tvar arrCtrls = linkedControl.isLabel ? this._linkedLabels : this._linkedControls;\r\n\t\t\r\n\t\tvar k = arrCtrls.indexOf(linkedControl);\r\n\t\tif (k >= 0) {\r\n\t\t\tarrCtrls.splice(k, 1);\r\n\t\t}\r\n\t},\r\n\r\n\trefreshLookupHostDataset: function() {\r\n\t\tif(this._autoRefreshHostDataset) {\r\n\t\t\tjslet.data.datasetRelationManager.refreshLookupHostDataset(this._name);\r\n\t\t}\r\n\t},\r\n\t\r\n\thandleLookupDatasetChanged: function(fldName) {\r\n\t\tvar Z = this;\r\n\t\tif(Z._inContextRule) {\r\n\t\t\tZ.refreshLookupField(fldName, Z.recno());\r\n\t\t} else {\r\n\t\t\tjslet.data.FieldValueCache.clearAll(Z, fldName);\r\n\t\t\tZ.refreshLookupField(fldName);\r\n\t\t}\r\n\t\t//Don't use the following code, is will cause DBAutoComplete control issues.\r\n\t\t//this.refreshControl(jslet.data.RefreshEvent.updateColumnEvent(fldName));\r\n\t},\r\n\t\r\n\t/**\r\n\t * Export data with CSV format.\r\n\t * \r\n\t * Export option pattern:\r\n\t * {exportHeader: true|false, //export with field labels\r\n\t *  exportDisplayValue: true|false, //true: export display value of field, false: export actual value of field\r\n\t *  onlySelected: true|false, //export selected records or not\r\n\t *  includeFields: ['fldName1', 'fldName2',...], //Array of field names which to be exported\r\n\t *  excludeFields: ['fldName1', 'fldName2',...]  //Array of field names which not to be exported\r\n\t *  }\r\n\t *  \r\n\t * @param exportOption {PlanObject} export options\r\n\t * \r\n\t * @return {String} Csv Text. \r\n\t */\r\n\texportCsv: function(exportOption) {\r\n\t\tvar Z = this;\r\n\t\tZ.confirm();\r\n\t\tif(Z.existDatasetError()) {\r\n\t\t\tconsole.warn(jslet.locale.Dataset.cannotConfirm);\r\n\t\t}\r\n\r\n\t\tvar exportHeader = true,\r\n\t\t\texportDisplayValue = true,\r\n\t\t\tonlySelected = false,\r\n\t\t\tincludeFields = null,\r\n\t\t\texcludeFields = null;\r\n\t\t\r\n\t\tif(exportOption && jQuery.isPlainObject(exportOption)) {\r\n\t\t\tif(exportOption.exportHeader !== undefined) {\r\n\t\t\t\texportHeader = exportOption.exportHeader? true: false;\r\n\t\t\t}\r\n\t\t\tif(exportOption.exportDisplayValue !== undefined) {\r\n\t\t\t\texportDisplayValue = exportOption.exportDisplayValue? true: false;\r\n\t\t\t}\r\n\t\t\tif(exportOption.onlySelected !== undefined) {\r\n\t\t\t\tonlySelected = exportOption.onlySelected? true: false;\r\n\t\t\t}\r\n\t\t\tif(exportOption.includeFields !== undefined) {\r\n\t\t\t\tincludeFields = exportOption.includeFields;\r\n\t\t\t\tjslet.Checker.test('Dataset.exportCsv#exportOption.includeFields', includeFields).isArray();\r\n\t\t\t}\r\n\t\t\tif(exportOption.excludeFields !== undefined) {\r\n\t\t\t\texcludeFields = exportOption.excludeFields;\r\n\t\t\t\tjslet.Checker.test('Dataset.exportCsv#exportOption.excludeFields', excludeFields).isArray();\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar fldSeperator = ',', surround='\"';\r\n\t\tvar context = Z.startSilenceMove();\r\n\t\ttry{\r\n\t\t\tZ.first();\r\n\t\t\tvar result = [], \r\n\t\t\t\tarrRec, \r\n\t\t\t\tfldCnt = Z._normalFields.length, \r\n\t\t\t\tfldObj, fldName, value, i,\r\n\t\t\t\texportFields = [];\r\n\t\t\tfor(i = 0; i < fldCnt; i++) {\r\n\t\t\t\tfldObj = Z._normalFields[i];\r\n\t\t\t\tfldName = fldObj.name();\r\n\t\t\t\tif(includeFields && includeFields.length > 0) {\r\n\t\t\t\t\tif(includeFields.indexOf(fldName) < 0) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif(!fldObj.visible()) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif(excludeFields && excludeFields.length > 0) {\r\n\t\t\t\t\tif(excludeFields.indexOf(fldName) >= 0) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t} \r\n\t\t\t\t\r\n\t\t\t\texportFields.push(fldObj);\r\n\t\t\t}\r\n\t\t\tfldCnt = exportFields.length;\r\n\t\t\tif (exportHeader) {\r\n\t\t\t\tarrRec = [];\r\n\t\t\t\tfor(i = 0; i < fldCnt; i++) {\r\n\t\t\t\t\tfldObj = exportFields[i];\r\n\t\t\t\t\tfldName = fldObj.label() || fldObj.name();\r\n\t\t\t\t\tfldName = surround + fldName + surround;\r\n\t\t\t\t\tarrRec.push(fldName);\r\n\t\t\t\t}\r\n\t\t\t\tresult.push(arrRec.join(fldSeperator));\r\n\t\t\t}\r\n\t\t\twhile(!Z.isEof()) {\r\n\t\t\t\tif (onlySelected && !Z.selected()) {\r\n\t\t\t\t\tZ.next();\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tarrRec = [];\r\n\t\t\t\tfor(i = 0; i < fldCnt; i++) {\r\n\t\t\t\t\tfldObj = exportFields[i];\r\n\t\t\t\t\tfldName = fldObj.name();\r\n\t\t\t\t\tif (exportDisplayValue) {\r\n\t\t\t\t\t\t//If Number field does not have lookup field, return field value, not field text. \r\n\t\t\t\t\t\t//Example: 'amount' field\r\n\t\t\t\t\t\tif(fldObj.getType() === 'N' && !fldObj.lookup()) {\r\n\t\t\t\t\t\t\tvalue = Z.getFieldValue(fldName);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tvalue = Z.getFieldText(fldName);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tvalue = Z.getFieldValue(fldName);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (!value && value !== 0) {\r\n\t\t\t\t\t\tvalue = '';\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tvalue += '';\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvalue = value.replace(/\"/,'');\r\n\t\t\t\t\tvalue = surround + value + surround;\r\n\t\t\t\t\tarrRec.push(value);\r\n\t\t\t\t}\r\n\t\t\t\tresult.push(arrRec.join(fldSeperator));\r\n\t\t\t\tZ.next();\r\n\t\t\t}\r\n\t\t\treturn result.join('\\n');\r\n\t\t}finally{\r\n\t\t\tZ.endSilenceMove(context);\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Export data to CSV file.\r\n\t * \r\n\t * @param {fileName}fileName - CSV file name.\r\n\t * @param {String}includeFieldLabel - export with field labels, can be null  \r\n\t * @param {Boolean}dispValue - true: export display value of field, false: export actual value of field \r\n\t * @param {Boolean}onlySelected - export selected records or not.\r\n\t * @param {String[]} onlyFields - specified the field name to export.\r\n\t */\r\n\texportCsvFile: function(fileName, includeFieldLabel, dispValue, onlySelected, onlyFields) {\r\n\t\tjslet.Checker.test('Dataset.exportCsvFile#fileName', fileName).required().isString();\r\n    \tvar str = this.exportCsv(includeFieldLabel, dispValue, onlySelected, onlyFields);\r\n        var a = document.createElement('a');\r\n\t\t\r\n        var blob = new Blob([str], {'type': 'text\\/csv'});\r\n        a.href = window.URL.createObjectURL(blob);\r\n        a.download = fileName;\r\n        a.click();\r\n    },\r\n    \r\n\t/** \r\n\t* Get filtered data list. \r\n\t* \r\n\t*/ \r\n\tfilteredDataList: function() { \r\n\t\tvar Z= this, \r\n\t\t\tresult = [], \r\n\t\t\toldRecno = Z.recnoSilence(); \r\n\t\tZ.confirm();\r\n\t\ttry { \r\n\t\t\tfor(var i = 0, len = Z.recordCount(); i < len; i++) {\r\n\t\t\t\tZ.recnoSilence(i); \r\n\t\t\t\tresult.push(Z.getRecord()); \r\n\t\t\t} \r\n\t\t} finally { \r\n\t\t\tZ.recnoSilence(oldRecno); \r\n\t\t} \r\n\t\treturn result; \r\n\t}, \r\n\r\n\t/** \r\n\t* Iterate the whole dataset, and run the specified callback function. \r\n\t* Example: \r\n\t* \r\n\t* dataset.iterate(function(){\r\n\t* \tvar fldValue = this.getFieldValue('xxx');\r\n\t* \tthis.setFieldValue('xxx', fldValue);\r\n\t* }); \r\n\t* \r\n\t*/ \r\n\titerate: function(callBackFn, startRecno, endRecno) { \r\n\t\tjslet.Checker.test('Dataset.iterate#callBackFn', callBackFn).required().isFunction(); \r\n\t\tvar Z= this, \r\n\t\t\tresult = [], \r\n\t\t\tcontext = Z.startSilenceMove(); \r\n\t\ttry{\r\n\t\t\tstartRecno = startRecno || 0;\r\n\t\t\tif(endRecno !== 0 && !endRecno) {\r\n\t\t\t\tendRecno = Z.recordCount() - 1;\r\n\t\t\t}\r\n\t\t\tfor(var k = startRecno; k <= endRecno; k++) {\r\n\t\t\t\tZ.recno(k);\r\n\t\t\t\tif(callBackFn) { \r\n\t\t\t\t\tcallBackFn.call(Z); \r\n\t\t\t\t} \r\n\t\t\t} \r\n\t\t}finally{ \r\n\t\t\tZ.endSilenceMove(context); \r\n\t\t} \r\n\t\treturn result; \r\n\t}, \r\n\t\r\n\t/**\r\n\t * Set or get raw data list\r\n\t * \r\n\t * @param {Object[]} datalst - raw data list\r\n\t */\r\n\tdataList: function (datalst) {\r\n\t\tvar Z = this;\r\n\t\tif (datalst === undefined) {\r\n\t\t\tif(Z._datasetField) {\r\n\t\t\t\treturn Z._datasetField.getValue();\r\n\t\t\t}\r\n\t\t\treturn Z._dataList;\r\n\t\t}\r\n\t\tjslet.Checker.test('Dataset.dataList', datalst).isArray();\r\n\t\tif(Z._datasetField) {\r\n\t\t\tif(datalst === null) {\r\n\t\t\t\tdatalst = [];\r\n\t\t\t}\r\n\t\t\tZ._datasetField.setValue(datalst);\r\n\t\t} else {\r\n\t\t\tZ._dataList = datalst;\r\n\t\t}\r\n\t\tZ._initialize();\r\n\t\tvar fields = Z._subDatasetFields;\r\n\t\tif(fields) {\r\n\t\t\tvar fldObj, subDs;\r\n\t\t\tfor(var i = 0, len = fields.length; i < len; i++) {\r\n\t\t\t\tfldObj = fields[i];\r\n\t\t\t\tsubDs = fldObj.subDataset();\r\n\t\t\t\tif(subDs) {\r\n\t\t\t\t\tsubDs.confirm();\r\n\t\t\t\t\tsubDs._initialize();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t_initialize: function(isDetailDs) {\r\n\t\tvar Z = this;\r\n\t\tif(!isDetailDs) { //Master dataset\r\n\t\t\tjslet.data.FieldValueCache.removeAllCache(Z);\r\n\t\t\tjslet.data.FieldError.clearDatasetError(Z);\r\n\t\t\tjslet.data.convertDateFieldValue(Z);\r\n\t\t\tZ._changeLog.clear();\r\n\t\t}\r\n\t\tZ.status(jslet.data.DataSetStatus.BROWSE);\r\n\t\tZ._recno = -1;\r\n\t\tZ.indexFields(Z.indexFields());\r\n\t\tZ.filter(null);\r\n\t\tif(Z.filtered() || Z.fixedFilter()) {\r\n\t\t\tZ._doFilterChanged();\t\t\t\r\n\t\t}\r\n\t\tZ.first();\r\n\t\tZ.calcAggradedValue();\t\r\n\t\tZ.refreshControl(jslet.data.RefreshEvent._updateAllEvent);\r\n\t\tZ.refreshLookupHostDataset();\r\n\t},\r\n\t\r\n\t/**\r\n\t * Return dataset data with field text, field text is formatted or calculated field value.\r\n\t * You can use them to do your special processing like: use them in jquery template.\r\n\t */\r\n\ttextList: function() {\r\n\t\tvar Z = this;\r\n\t\tZ.confirm();\r\n\t\t\r\n\t\tvar\toldRecno = Z.recno(), \r\n\t\t\tresult = [],\r\n\t\t\tfldCnt = Z._normalFields.length,\r\n\t\t\tfldObj, fldName, textValue, textRec;\r\n\t\ttry {\r\n\t\t\tfor (var i = 0, cnt = Z.recordCount(); i < cnt; i++) {\r\n\t\t\t\tZ.recnoSilence(i);\r\n\t\t\t\ttextRec = {};\r\n\t\t\t\tfor(var j = 0; j < fldCnt; j++) {\r\n\t\t\t\t\tfldObj = Z._normalFields[j];\r\n\t\t\t\t\tfldName = fldObj.name();\r\n\t\t\t\t\ttextValue = Z.getFieldText(fldName);\r\n\t\t\t\t\ttextRec[fldName] = textValue;\r\n\t\t\t\t}\r\n\t\t\t\tresult.push(textRec);\r\n\t\t\t}\r\n\t\t\treturn result;\r\n\t\t} finally {\r\n\t\t\tthis.recnoSilence(oldRecno);\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * Export dataset snapshot. Dataset snapshot can be used for making a backup when inputing a lot of data. \r\n\t * \r\n\t * @return {Object} Dataset snapshot.\r\n\t */\r\n\texportSnapshot: function() {\r\n\t\tvar Z = this,\r\n\t\t\tmainDs = {name: Z.name(), recno: Z.recno(), status: Z.status(), dataList: Z.dataList(), changedRecords: Z._changeLog._changedRecords};\r\n\t\tvar indexFields = Z.indexFields();\r\n\t\tif(indexFields) {\r\n\t\t\tmainDs.indexFields = indexFields;\r\n\t\t}\r\n\t\tvar filter = Z.filter();\r\n\t\tif(filter) {\r\n\t\t\tmainDs.filter = filter;\r\n\t\t\tmainDs.filtered = Z.filtered();\r\n\t\t}\r\n\t\tvar result = {master: mainDs};\r\n\t\tvar details = null, detail;\r\n\t\tvar detailFields = Z._subDatasetFields;\r\n\t\tif(detailFields) {\r\n\t\t\tvar subFldObj, subDs;\r\n\t\t\tfor(var i = 0, len = detailFields.length; i < len; i++) {\r\n\t\t\t\tsubFldObj = detailFields[i];\r\n\t\t\t\tsubDs = subFldObj.subDataset();\r\n\t\t\t\tif(subDs) {\r\n\t\t\t\t\tif(!details) {\r\n\t\t\t\t\t\tdetails = [];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tdetail = {name: subDs.name(), recno: subDs.recno(), status: subDs.status()};\r\n\t\t\t\t\tindexFields = subDs.indexFields();\r\n\t\t\t\t\tif(indexFields) {\r\n\t\t\t\t\t\tsubDs.indexFields = indexFields;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfilter = subDs.filter();\r\n\t\t\t\t\tif(filter) {\r\n\t\t\t\t\t\tsubDs.filter = filter;\r\n\t\t\t\t\t\tsubDs.filtered = subDs.filtered();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tdetails.push(detail);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(details) {\r\n\t\t\tresult.details = details;\r\n\t\t}\r\n\t\t\r\n\t\treturn result;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Import a dataset snapshot.\r\n\t * \r\n\t * @param {Object} snapshot Dataset snapshot.\r\n\t */\r\n\timportSnapshot: function(snapshot) {\r\n\t\tjslet.Checker.test('Dataset.importSnapshot#snapshot', snapshot).required().isPlanObject();\r\n\t\tvar master = snapshot.master;\r\n\t\tjslet.Checker.test('Dataset.importSnapshot#snapshot.master', master).required().isPlanObject();\r\n\t\tvar Z = this,\r\n\t\t\tdsName = master.name;\r\n\t\tif(dsName != Z._name) {\r\n\t\t\tthrow new Error('Snapshot does not match the current dataset name!');\r\n\t\t}\r\n\t\tZ._dataList = master.dataList;\r\n\t\tZ._changeLog._changedRecords = master.changedRecords;\r\n\t\tif(master.indexFields !== undefined) {\r\n\t\t\tZ.indexFields(master.indexFields);\r\n\t\t}\r\n\t\tif(master.filter != undefined) {\r\n\t\t\tZ.filter(master.filter);\r\n\t\t\tZ.filtered(master.filtered);\r\n\t\t}\r\n\t\tif(master.recno >= 0) {\r\n\t\t\tZ._silence++;\r\n\t\t\ttry {\r\n\t\t\t\tZ.recno(master.recno);\r\n\t\t\t} finally {\r\n\t\t\t\tZ._silence--;\r\n\t\t\t}\r\n\t\t}\r\n\t\tZ.refreshControl();\r\n\t\tvar details = snapshot.details;\r\n\t\tif(!details || details.length === 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar detail, subDs;\r\n\t\tfor(var i = 0, len = details.length; i < len; i++) {\r\n\t\t\tdetail = details[i];\r\n\t\t\tsubDs = jslet.data.getDataset(detail.name);\r\n\t\t\tif(subDs) {\r\n\t\t\t\tif(detail.indexFields !== undefined) {\r\n\t\t\t\t\tsubDs.indexFields(detail.indexFields);\r\n\t\t\t\t}\r\n\t\t\t\tif(detail.filter !== undefined) {\r\n\t\t\t\t\tsubDs.filter(detail.filter);\r\n\t\t\t\t\tsubDs.filtered(detail.filtered);\r\n\t\t\t\t}\r\n\t\t\t\tif(detail.recno >= 0) {\r\n\t\t\t\t\tsubDs._silence++;\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tsubDs.recno(detail.recno);\r\n\t\t\t\t\t} finally {\r\n\t\t\t\t\t\tsubDs._silence--;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tsubDs.refreshControl();\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\tdestroy: function () {\r\n\t\tvar Z = this;\r\n\t\tZ._masterDataset = null;\r\n\t\tZ._detailDatasets = null;\r\n\t\tZ._fields = null;\r\n\t\tZ._linkedControls = null;\r\n\t\tZ._innerFilter = null;\r\n\t\tZ._innerFindCondition = null;\r\n\t\tZ._sortingFields = null;\r\n\t\tZ._innerFormularFields = null;\r\n\t\tZ._datasetField = null;\r\n\t\t\r\n\t\tjslet.data.dataModule.unset(Z._name);\r\n\t\tjslet.data.datasetRelationManager.removeDataset(Z._name);\t\t\r\n\t}\r\n\t\r\n};\r\n// end Dataset\r\n\r\n/**\r\n * Create Enum Dataset. Example:\r\n * <pre><code>\r\n * var dsGender = jslet.data.createEnumDataset('gender', 'F:Female,M:Male');\r\n * dsGender.getFieldValue('code');//return 'F'\r\n * dsGender.getFieldValue('name');//return 'Female'\r\n * dsGender.next();\r\n * dsGender.getFieldValue('code');//return 'M'\r\n * dsGender.getFieldValue('name');//return 'Male'\r\n * </code></pre>\r\n * \r\n * @param {String} dsName dataset name;  \r\n * @param {String or Object} enumStrOrObject a string or an object which stores enumeration data; if it's a string, the format must be:<code>:<name>,<code>:<name>\r\n * @return {jslet.data.Dataset}\r\n */\r\njslet.data.createEnumDataset = function(dsName, enumStrOrObj) {\r\n\tjslet.Checker.test('createEnumDataset#enumStrOrObj', enumStrOrObj).required();\r\n\t\t\r\n\tvar dsObj = new jslet.data.Dataset(dsName);\r\n\tdsObj.addField(jslet.data.createStringField('code', 10));\r\n\tdsObj.addField(jslet.data.createStringField('name', 20));\r\n\r\n\tdsObj.keyField('code');\r\n\tdsObj.codeField('code');\r\n\tdsObj.nameField('name');\r\n\r\n\tvar dataList = [];\r\n\tif(jslet.isString(enumStrOrObj)) {\r\n\t\tvar enumStr = jQuery.trim(enumStrOrObj);\r\n\t\tvar recs = enumStr.split(','), recstr;\r\n\t\tfor (var i = 0, cnt = recs.length; i < cnt; i++) {\r\n\t\t\trecstr = jQuery.trim(recs[i]);\r\n\t\t\trec = recstr.split(':');\r\n\t\r\n\t\t\tdataList[dataList.length] = {\r\n\t\t\t\t'code' : jQuery.trim(rec[0]),\r\n\t\t\t\t'name' : jQuery.trim(rec[1])\r\n\t\t\t};\r\n\t\t}\r\n\t} else {\r\n\t\tfor(var key in enumStrOrObj) {\r\n\t\t\tdataList[dataList.length] = {code: key, name: enumStrOrObj[key]};\r\n\t\t}\r\n\t}\r\n\tdsObj.dataList(dataList);\r\n\tdsObj.indexFields('code');\r\n\treturn dsObj;\r\n};\r\n\r\n/**\r\n * Create dataset with field configurations. Example:\r\n * <pre><code>\r\n *   var fldCfg = [{\r\n *     name: 'deptid',\r\n *     type: 'S',\r\n *     length: 10,\r\n *     label: 'ID'\r\n *   }, {\r\n *     name: 'name',\r\n *     type: 'S',\r\n *     length: 20,\r\n *     label: 'Dept. Name'\r\n *   }];\r\n *   var dsCfg = {keyField: 'deptid', codeField: 'deptid', nameField: 'name'};\r\n *   var dsDepartment = jslet.data.createDataset('department', fldCfg, dsCfg);\r\n * </code></pre>\r\n * \r\n * @param {String} dsName - dataset name\r\n * @param {jslet.data.Field[]} field configuration\r\n * @param {Object} dsCfg - dataset configuration\r\n * @return {jslet.data.Dataset}\r\n */\r\njslet.data.createDataset = function(dsName, fieldConfig, dsCfg) {\r\n\tjslet.Checker.test('createDataset#fieldConfig', fieldConfig).required().isArray();\r\n\tjslet.Checker.test('Dataset.createDataset#datasetCfg', dsCfg).isPlanObject();\r\n\tvar dsObj = new jslet.data.Dataset(dsName),\r\n\t\tfldObj, \r\n\t\tfldCfg;\r\n\tfor (var i = 0, cnt = fieldConfig.length; i < cnt; i++) {\r\n\t\tfldCfg = fieldConfig[i];\r\n\t\tjslet.Checker.test('Dataset.createDataset#fieldCfg', fldCfg).isPlanObject();\r\n\t\t\r\n\t\tfldCfg.dsName = dsName;\r\n\t\tfldObj = jslet.data.createField(fldCfg);\r\n\t\tdsObj.addField(fldObj);\r\n\t}\r\n\t\r\n\tfunction setPropValue(propName) {\r\n\t\tvar propValue = dsCfg[propName];\r\n\t\tif(propValue === undefined) {\r\n\t\t\tpropValue = dsCfg[propName.toLowerCase()];\r\n\t\t}\r\n\t\tif (propValue !== undefined) {\r\n\t\t\tdsObj[propName](propValue);\r\n\t\t}\r\n\t}\r\n\t\r\n\tfunction setIntPropValue(propName) {\r\n\t\tvar propValue = dsCfg[propName];\r\n\t\tif(propValue === undefined) {\r\n\t\t\tpropValue = dsCfg[propName.toLowerCase()];\r\n\t\t}\r\n\t\tif (propValue !== undefined) {\r\n\t\t\tdsObj[propName](parseInt(propValue));\r\n\t\t}\r\n\t}\r\n\t\r\n\tfunction setBooleanPropValue(propName) {\r\n\t\tvar propValue = dsCfg[propName];\r\n\t\tif(propValue === undefined) {\r\n\t\t\tpropValue = dsCfg[propName.toLowerCase()];\r\n\t\t}\r\n\t\tif (propValue !== undefined) {\r\n\t\t\tif(jslet.isString(propValue)) {\r\n\t\t\t\tif(propValue) {\r\n\t\t\t\t\tpropValue = propValue != '0' && propValue != 'false';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tdsObj[propName](propValue? true: false);\r\n\t\t}\r\n\t}\r\n\t\r\n\tif(dsCfg) {\r\n\t\tsetPropValue('keyField');\r\n\t\tsetPropValue('codeField');\r\n\t\tsetPropValue('nameField');\r\n\t\tsetPropValue('parentField');\r\n\t\tsetPropValue('levelOrderField');\r\n\t\tsetPropValue('selectField');\r\n\t\tsetPropValue('recordClass');\r\n\r\n\t\tsetPropValue('queryUrl');\r\n\t\tsetPropValue('submitUrl');\r\n\t\tsetIntPropValue('pageNo');\r\n\t\tsetIntPropValue('pageSize');\r\n\t\tsetPropValue('fixedIndexFields');\r\n\t\tsetPropValue('indexFields');\r\n\t\tsetPropValue('fixedFilter');\r\n\t\tsetPropValue('filter');\r\n\t\tsetBooleanPropValue('filtered');\r\n\t\tsetBooleanPropValue('autoShowError');\r\n\t\tsetBooleanPropValue('autoRefreshHostDataset');\r\n\t\tsetBooleanPropValue('readOnly');\r\n\t\tsetBooleanPropValue('logChanges');\r\n\t\tsetPropValue('datasetListener');\r\n\t\tsetPropValue('onFieldChange');\r\n\t\tsetPropValue('onCheckSelectable');\r\n\t\tsetPropValue('contextRules');\r\n\t}\r\n\tvar globalHandler = jslet.data.globalDataHandler.datasetCreated();\r\n\tif(globalHandler) {\r\n\t\tglobalHandler(dsObj);\r\n\t}\r\n\treturn dsObj;\r\n};\r\n\r\n//\r\n//jslet.data.createCrossDataset = function(sourceDataset, labelField, valueField, crossDsName) {\r\n//\tif(!crossDsName) { \r\n//\t\tcrossDsName = sourceDataset.name()+'_cross'; \r\n//\t} \r\n//\tjslet.Checker.test('createCrossDataset#labelField', labelField).required().isString();\r\n//\tjslet.Checker.test('createCrossDataset#valueField', valueField).required().isString();\r\n//\r\n//\tif(jslet.isString(sourceDataset)) {\r\n//\t\tsourceDataset = jslet.data.getDataset(sourceDataset);\r\n//\t}\r\n//\tjslet.Checker.test('createCrossDataset#sourceDataset', sourceDataset).required().isClass(jslet.data.Dataset.className);\r\n//\t\r\n//\tvar lblFldObj = sourceDataset.getField(labelField);\r\n//\tif(!lblFldObj) {\r\n//\t\tthrow new Error('Not found field: ' + labelField);\r\n//\t}\r\n//\tvar lblLkFld = lblFldObj.lookup(); \r\n//\tif(!lblLkFld) { \r\n//\t\tthrow new Error(sourceDataset.name() + '.' + labelField + ' must have lookup dataset!'); \r\n//\t} \r\n//\tvar valueFldObj = sourceDataset.getField(valueField); \r\n//\tif(!valeFldObj) {\r\n//\t\tthrow new Error('Not found field: ' + valeFldObj);\r\n//\t}\r\n//\tif(valeFldObj.getType() != jslet.data.DataType.NUMBER) {\r\n//\t\thasTotalField = false;\r\n//\t}\r\n//\t\r\n//\tvar labelFldNames = labelField.split(',');\r\n//\t\t\r\n//\t{name: '', horiFields:[{field:'', subTotal: false, showAll:false}, \r\n//\t           vertFields:[{field:'', subTotal: false, showAll:false}], \r\n//\t           cellFields:'',\r\n//\t           totalPosition: 'before/after',\r\n//\t           indent: true}\r\n//\t\r\n//\t\r\n//}\r\n\r\njslet.data.ChangeLog = function(dataset) {\r\n\tthis._dataset = dataset;\r\n\tthis._changedRecords = null;\r\n}\r\n\r\njslet.data.ChangeLog.prototype = {\r\n\tchangedRecords: function(changedRecords) {\r\n\t\tif(changedRecords === undefined) {\r\n\t\t\treturn this._changedRecords;\r\n\t\t}\r\n\t\tthis._changedRecords = changedRecords;\r\n\t},\r\n\t\r\n\tlog: function(recObj) {\r\n\t\tif(!this._dataset.logChanges()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(!recObj) {\r\n\t\t\trecObj = this._dataset.getRecord();\r\n\t\t}\r\n\t\tvar recInfo = jslet.data.getRecInfo(recObj);\r\n\t\tif(!recInfo.status) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar chgRecords = this._getChangedRecords();\r\n\t\tif(chgRecords.indexOf(recObj) < 0) {\r\n\t\t\tchgRecords.push(recObj);\r\n\t\t}\r\n\t},\r\n\t\r\n\tunlog: function(recObj) {\r\n\t\tif(!this._dataset.logChanges()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(!recObj) {\r\n\t\t\trecObj = this._dataset.getRecord();\r\n\t\t}\r\n\t\tvar chgRecords = this._getChangedRecords(recObj);\r\n\t\tvar k = chgRecords.indexOf(recObj);\r\n\t\tif(k >= 0) {\r\n\t\t\tchgRecords.splice(k, 1);\r\n\t\t}\r\n\t},\r\n\t\r\n\tclear: function() {\r\n\t\tthis._changedRecords = null;\r\n\t},\r\n\t\r\n\t_getChangedRecords: function() {\r\n\t\tvar dsObj = this._dataset;\r\n\t\tvar masterFldObj = dsObj.datasetField(),\r\n\t\t  \tchgRecords;\r\n\t\tif(masterFldObj) {\r\n\t\t\tvar masterFldName = masterFldObj.name(),\r\n\t\t\t\tmasterDsObj = masterFldObj.dataset();\r\n\t\t\t\tmasterRecInfo = jslet.data.getRecInfo(masterDsObj.getRecord());\r\n\t\t\t\tif(!masterRecInfo.subLog) {\r\n\t\t\t\t\tmasterRecInfo.subLog = {};\r\n\t\t\t\t}\r\n\t\t\t\tchgRecords = masterRecInfo.subLog[masterFldName];\r\n\t\t\t\tif(!chgRecords) {\r\n\t\t\t\t\tchgRecords = [];\r\n\t\t\t\t\tmasterRecInfo.subLog[masterFldName] = chgRecords;\r\n\t\t\t\t}\r\n\t\t} else {\r\n\t\t\tif(!this._changedRecords) {\r\n\t\t\t\tthis._changedRecords = [];\r\n\t\t\t}\r\n\t\t\tchgRecords = this._changedRecords;\r\n\t\t}\r\n\t\treturn chgRecords;\r\n\t}\r\n\t\r\n}\r\n\r\njslet.data.DataTransformer = function(dataset) {\r\n\tthis._dataset = dataset;\r\n}\r\n\r\njslet.data.DataTransformer.prototype = {\r\n\t\t\r\n\thasChangedData: function() {\r\n\t\tvar chgRecList = this._dataset._changeLog._changedRecords;\r\n\t\tif(!chgRecList || chgRecList.length === 0) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\treturn true;\r\n\t},\r\n\t\r\n\tgetSubmittingChanged: function() {\r\n\t\tvar chgRecList = this._dataset._changeLog._changedRecords;\r\n\t\tif(!chgRecList || chgRecList.length === 0) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tvar result = this._convert(this._dataset, chgRecList);\r\n\t\treturn result;\r\n\t},\r\n\t\r\n\tgetSubmittingSelected: function() {\r\n\t\tvar chgRecList = this._dataset.selectedRecords();\r\n\t\tif(!chgRecList || chgRecList.length === 0) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tvar result = this._convert(this._dataset, chgRecList, true);\r\n\t\treturn result;\r\n\t},\r\n\t\r\n\t_convert: function(dsObj, chgRecList, submitAllSubData) {\r\n\t\tif(!chgRecList || chgRecList.length === 0) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tvar chgRec, recInfo, status, newRec,\r\n\t\t\trecClazz = dsObj._recordClass || jslet.global.defaultRecordClass,\r\n\t\t\tresult = [],\r\n\t\t\tsubLog;\r\n\t\tfor(var i = 0, len = chgRecList.length; i < len; i++) {\r\n\t\t\tchgRec = chgRecList[i];\r\n\t\t\trecInfo = jslet.data.getRecInfo(chgRec);\r\n\t\t\tnewRec = {};\r\n\t\t\tif(recClazz) {\r\n\t\t\t\tnewRec[\"@type\"] = recClazz;\r\n\t\t\t}\r\n\t\t\tsubLog = recInfo.subLog;\r\n\t\t\tchgRec[jslet.global.changeStateField] = this._getStatusPrefix(recInfo.status) + i;\r\n\t\t\tvar fldObj, subList;\r\n\t\t\tfor(var fldName in chgRec) {\r\n\t\t\t\tif(fldName === '_jl_') {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tfldObj = dsObj.getField(fldName);\r\n\t\t\t\tif(fldObj && fldObj.getType() === jslet.data.DataType.DATASET) {\r\n\t\t\t\t\tvar subDsObj = fldObj.subDataset();\r\n\t\t\t\t\tif(submitAllSubData === undefined) {\r\n\t\t\t\t\t\tsubmitAllSubData = !subDsObj._onlyChangedSubmitted;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvar allList = chgRec[fldName];\r\n\t\t\t\t\tif(!submitAllSubData) { //add deleted record\r\n\t\t\t\t\t\tvar subChgList = subLog? subLog[fldName]: null;\r\n\t\t\t\t\t\tif(subChgList) {\r\n\t\t\t\t\t\t\tvar subChgRec, subRecInfo;\r\n\t\t\t\t\t\t\tfor(var k = 0, chgLen = subChgList.length; k < chgLen; k++) {\r\n\t\t\t\t\t\t\t\tsubChgRec = subChgList[k];\r\n\t\t\t\t\t\t\t\tsubRecInfo = jslet.data.getRecInfo(subChgRec);\r\n\t\t\t\t\t\t\t\tif(subRecInfo && subRecInfo.status === jslet.data.DataSetStatus.DELETE) {\r\n\t\t\t\t\t\t\t\t\tallList.push(subChgRec);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tsubList = this._convert(subDsObj, allList);\r\n\t\t\t\t\tif(subList) {\r\n\t\t\t\t\t\tnewRec[fldName] = subList;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tnewRec[fldName] = chgRec[fldName];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tresult.push(newRec);\r\n\t\t}\r\n\t\treturn result;\r\n\t},\r\n\t\r\n\t_getStatusPrefix: function(status) {\r\n\t\treturn  status === jslet.data.DataSetStatus.INSERT ? 'i' : \r\n\t\t\t(status === jslet.data.DataSetStatus.UPDATE? 'u':\r\n\t\t\t status === jslet.data.DataSetStatus.DELETE? 'd':'s');\r\n\t},\r\n\t\t\t\r\n\trefreshSubmittedData: function(submittedData) {\r\n\t\tif(!submittedData || submittedData.length === 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis._refreshDataset(this._dataset, submittedData);\r\n\t},\r\n\t\r\n\t_refreshDataset: function(dsObj, submittedData, isDetailDataset) {\r\n\t\tif(!submittedData || submittedData.length === 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(!isDetailDataset) {\r\n\t\t\tjslet.data.convertDateFieldValue(dsObj, submittedData);\r\n\t\t}\r\n\t\tvar masterFldObj = dsObj.datasetField(), chgLogs;\r\n\t\tif(!masterFldObj) {\r\n\t\t\tchgLogs = dsObj._changeLog._changedRecords;\r\n\t\t} else {\r\n\t\t\tvar masterRec = masterFldObj.dataset().getRecord();\r\n\t\t\tvar masterRecInfo = jslet.data.getRecInfo(masterRec);\r\n\t\t\tchgLogs = masterRecInfo.subLog? masterRecInfo.subLog[masterFldObj.name()]: null;\r\n\t\t}\r\n\r\n\t\tvar newRec, oldRec, flag;\r\n\t\tfor(var i = 0, len = submittedData.length; i < len; i++) {\r\n\t\t\tnewRec = submittedData[i];\r\n\t\t\tif(!newRec) {\r\n\t\t\t\tconsole.warn('The return record exists null. Please check it.');\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tthis._refreshRecord(dsObj, newRec, chgLogs);\r\n\t\t}\r\n\t},\r\n\t\t\r\n\t_refreshRecord: function(dsObj, newRec, chgLogs) {\r\n\t\tvar recState = newRec[jslet.global.changeStateField];\r\n\t\tif(!recState) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(chgLogs && recState.charAt(0) == 'd') {\r\n\t\t\tfor(var i = 0, len = chgLogs.length; i < len; i++) {\r\n\t\t\t\tif(recState == chgLogs[i][jslet.global.changeStateField]) {\r\n\t\t\t\t\tchgLogs.splice(i, 1);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar oldRec, fldObj,\r\n\t\t\trecords = dsObj.dataList() || [];\r\n\t\tfor(var i = records.length - 1; i >= 0; i--) {\r\n\t\t\toldRec = records[i];\r\n\t\t\tif(oldRec[jslet.global.changeStateField] != recState) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tfor(var fldName in newRec) {\r\n\t\t\t\tif(!fldName) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tfldObj = dsObj.getField(fldName);\r\n\t\t\t\tif(fldObj && fldObj.subDataset()) {\r\n\t\t\t\t\tthis._refreshDataset(fldObj.subDataset(), newRec[fldName], true);\r\n\t\t\t\t} else {\r\n\t\t\t\t\toldRec[fldName] = newRec[fldName];\r\n\t\t\t\t}\r\n\t\t\t} // end for fldName\r\n\t\t\tif(chgLogs) {\r\n\t\t\t\tfor(var i = 0, len = chgLogs.length; i < len; i++) {\r\n\t\t\t\t\tif(recState == chgLogs[i][jslet.global.changeStateField]) {\r\n\t\t\t\t\t\tchgLogs.splice(i, 1);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\toldRec[jslet.global.changeStateField] = null;\r\n\t\t\tvar recInfo = jslet.data.getRecInfo(oldRec);\r\n\t\t\tif(recInfo && recInfo.status) {\r\n\t\t\t\trecInfo.status = 0;\r\n\t\t\t}\r\n\t\t\tjslet.data.FieldValueCache.removeCache(oldRec);\r\n\t\t} // end for i\r\n\t}\r\n\t\r\n}\r\n/* ========================================================================\r\n * Jslet framework: jslet.expression.js\r\n *\r\n * Copyright (c) 2014 Jslet Group(https://github.com/jslet/jslet/)\r\n * Licensed under MIT (https://github.com/jslet/jslet/LICENSE.txt)\r\n * ======================================================================== */\r\n\r\n/**\r\n * @class Expression. Example:\r\n * <pre><code>\r\n * var expr = new jslet.Expression(dsEmployee, '[name] == \"Bob\"');\r\n * expr.eval();//return true or false\r\n * \r\n * </code></pre>\r\n * \r\n * @param {jselt.data.Dataset} dataset dataset that use to evalute.\r\n * @param {String} expre Expression\r\n */\r\njslet.Expression = function(dataset, expr) {\r\n\tjslet.Checker.test('jslet.Expression#dataset', dataset).required();\r\n\tjslet.Checker.test('jslet.Expression#expr', expr).required().isString();\r\n\tthis._fields = [];\r\n\tthis._otherDatasetFields = [];\r\n\tthis._expr = expr;\r\n\tthis._parsedExpr = '';\r\n\tif (typeof dataset == 'string') {\r\n\t\tthis._dataset = jslet.data.getDataset(dataset);\r\n\t\tif (!this._dataset) {\r\n\t\t\tthrow new Error(jslet.formatString(jslet.locale.Dataset.datasetNotFound, [dsName]));\r\n\t\t}\r\n\t}else{\r\n\t\tjslet.Checker.test('jslet.Expression#dataset', dataset).isClass(jslet.data.Dataset.className);\r\n\t\tthis._dataset = dataset;\r\n\t}\r\n\t\r\n\tthis.context = {mainds: dataset};\r\n\tthis.parse();\r\n};\r\n\r\njslet.Expression.prototype = {\r\n\t_ParserPattern: /\\[[_a-zA-Z][\\.!\\w]*(,\\d){0,1}]/gim,\r\n\t\r\n\tparse: function() {\r\n\t\t\r\n\t\tvar start = 0, end, k, \r\n\t\t\tdsName, fldName, \r\n\t\t\totherDs, stag, dsObj,\r\n\t\t\ttmpExpr = [], \r\n\t\t\tvalueIndex = null;\r\n\t\tthis._ParserPattern.lastIndex = 0;\r\n\t\twhile ((stag = this._ParserPattern.exec(this._expr)) !== null) {\r\n\t\t\tfldName = stag[0];\r\n\r\n\t\t\tif (!fldName || fldName.endsWith('(')) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tdsName = null;\r\n\t\t\tfldName = fldName.substr(1, fldName.length - 2);\r\n\t\t\tk = fldName.indexOf(',');\r\n\t\t\tif(k > 0) {\r\n\t\t\t\tvalueIndex = parseInt(fldName.substr(k + 1));\r\n\t\t\t\tif(isNaN(valueIndex)) {\r\n\t\t\t\t\tvalueIndex = null;\r\n\t\t\t\t}\r\n\t\t\t\tfldName = fldName.substr(0, k);\r\n\t\t\t}\r\n\t\t\tk = fldName.indexOf('!');\r\n\t\t\tif (k > 0) {\r\n\t\t\t\tdsName = fldName.substr(0, k);\r\n\t\t\t\tfldName = fldName.substr(k + 1);\r\n\t\t\t}\r\n\r\n\t\t\tend = stag.index;\r\n\t\t\tdsObj = this._dataset;\r\n\t\t\tif(dsName) {\r\n\t\t\t\totherDs = jslet.data.dataModule.get(dsName);\r\n\t\t\t\tif (!otherDs) {\r\n\t\t\t\t\tthrow new Error(jslet.formatString(jslet.locale.Dataset.datasetNotFound, [dsName]));\r\n\t\t\t\t}\r\n\t\t\t\tthis.context[dsName] = otherDs;\r\n\t\t\t\tdsObj = otherDs;\r\n\t\t\t}\r\n\r\n\t\t\tif (!dsName) {\r\n\t\t\t\ttmpExpr.push(this._expr.substring(start, end));\r\n\t\t\t\ttmpExpr.push('context.mainds.getFieldValueByRecord(context.dataRec, \"');\r\n\t\t\t\tthis._fields.push(fldName);\r\n\t\t\t} else {\r\n\t\t\t\ttmpExpr.push(this._expr.substring(start, end));\r\n\t\t\t\ttmpExpr.push('context.');\r\n\t\t\t\ttmpExpr.push(dsName);\r\n\t\t\t\ttmpExpr.push('.getFieldValue(\"');\r\n\t\t\t\tthis._otherDatasetFields.push({\r\n\t\t\t\t\t\t\tdataset : dsName,\r\n\t\t\t\t\t\t\tfieldName : fldName\r\n\t\t\t\t\t\t});\r\n\t\t\t}\r\n\t\t\ttmpExpr.push(fldName);\r\n\t\t\ttmpExpr.push('\"');\r\n\t\t\tif(valueIndex !== null) {\r\n\t\t\t\ttmpExpr.push(',');\r\n\t\t\t\ttmpExpr.push(valueIndex);\r\n\t\t\t}\r\n\t\t\ttmpExpr.push(')');\r\n\t\t\t\r\n\t\t\tstart = end + stag[0].length;\r\n\t\t}//end while\r\n\t\ttmpExpr.push(this._expr.substr(start));\r\n\t\tthis._parsedExpr = tmpExpr.join('');\r\n\t}, //end function\r\n\r\n\t/**\r\n\t * Get fields included in the expression.\r\n\t * \r\n\t * @return {Array of String}\r\n\t */\r\n\tmainFields: function() {\r\n\t\treturn this._fields;\r\n\t},\r\n\r\n\t/**\r\n\t * Get fields of other dataset included in the expression.\r\n\t * Other dataset fields are identified with 'datasetName!fieldName', like: department!deptName\r\n\t * \r\n\t * @return {Array of Object} the return value like:[{dataset : 'dsName', fieldName: 'fldName'}]\r\n\t */\r\n\totherDatasetFields: function() {\r\n\t\treturn this._otherDatasetFields;\r\n\t},\r\n\r\n\t/**\r\n\t * Evaluate the expression.\r\n\t * \r\n\t * @param {Object} dataRec Data record object, this argument is used in parsedExpr \r\n\t * @return {Object} The value of Expression.\r\n\t */\r\n\teval: function() {\r\n\t\tvar context = this.context;\r\n\t\tcontext.mainds = this._dataset;\r\n\t\treturn eval(this._parsedExpr);\r\n\t},\r\n\t\r\n\tdestroy: function() {\r\n\t\tthis._dataset = null;\r\n\t\tthis._fields = null;\r\n\t\tthis._otherDatasetFields = [];\r\n\t\tthis._parsedExpr = null;\r\n\t\tthis._expr = null;\r\n\t\tthis.context = null;\r\n\t}\r\n\r\n\t\r\n};\r\n\r\n\r\n/* ========================================================================\r\n * Jslet framework: jslet.field.js\r\n *\r\n * Copyright (c) 2014 Jslet Group(https://github.com/jslet/jslet/)\r\n * Licensed under MIT (https://github.com/jslet/jslet/LICENSE.txt)\r\n * ======================================================================== */\r\n\r\n/**\r\n * @class Field \r\n * \r\n * @param {String} fieldName Field name\r\n * @param {jslet.data.DataType} dataType Data type of field\r\n */\r\njslet.data.Field = function (fieldName, dataType) {\r\n\tjslet.Checker.test('Field#fieldName', fieldName).isString();\r\n\tfieldName = jQuery.trim(fieldName);\r\n\tjslet.Checker.test('Field#fieldName', fieldName).required();\r\n\tjslet.Checker.test('Field#dataType', dataType).isString().required();\r\n\r\n\tvar Z = this;\r\n\tZ._dataset = null;\r\n\tZ._dsName = null;\r\n\tZ._displayOrder = 0;\r\n\tZ._tabIndex = null;\r\n\tZ._fieldName = fieldName;\r\n\tZ._dataType = dataType;\r\n\tZ._length = 0;\r\n\tZ._scale = 0;\r\n\tZ._unique = false;\r\n\t\r\n\tZ._defaultExpr = null;\r\n\tZ._defaultValue = null;\r\n\tZ._label = null;\r\n\tZ._tip = null;\r\n\tZ._message = null;\r\n\tZ._displayWidth = 0;\r\n\tZ._editMask = null;\r\n\tZ._displayFormat = null;\r\n\tZ._dateFormat = null;\r\n\tZ._formula = null;\r\n\tZ._readOnly = false;\r\n\tZ._visible = true;\r\n\tZ._disabled = false;\r\n\tZ._customValueConverter = null;\r\n\tZ._unitConverted = false;\r\n\r\n\tZ._lookup = null;\r\n\t\r\n\tZ._displayControl = null;\r\n\tZ._editControl = null;\r\n\tZ._subDataset = null;\r\n\tZ._urlExpr = null;\r\n\tZ._innerUrlExpr = null;\r\n\tZ._urlTarget = null;\r\n\tZ._valueStyle = jslet.data.FieldValueStyle.NORMAL; //0 - Normal, 1 - Between style value, 2 - Multiple value\r\n\tZ._valueCountLimit = 0;\r\n\tZ._required = false;\r\n\tZ._nullText = jslet.locale.Dataset.nullText;\r\n\tZ._dataRange= null;\r\n\tZ._regularExpr = null;\r\n\tZ._antiXss = true;\r\n\tZ._customValidator = null;\r\n\tZ._validChars = null; //Array of characters\r\n\tZ._dateChar = null;\r\n\tZ._dateRegular = null;\r\n\tZ._parent = null; //parent field object\r\n\tZ._children = null; //child field object\r\n\tZ._trueValue = true;\r\n\tZ._falseValue = false;\r\n\tZ._trueText = null;\r\n\tZ._falseText = null;\r\n\tZ._mergeSame = false;\r\n\tZ._mergeSameBy = null;\r\n\tZ._fixedValue = null;\r\n\tZ._valueFollow = false;\r\n\tZ._aggraded = false; //optional value: sum, count, avg\r\n\tZ._aggradedBy = null;\r\n\t\r\n\tZ._crossSource = null;\r\n};\r\n\r\njslet.data.Field.className = 'jslet.data.Field';\r\n\r\njslet.data.Field.prototype = {\r\n\tclassName: jslet.data.Field.className,\r\n\t\r\n\t/**\r\n\t * {jslet.data.Dataset}\r\n\t */\r\n\tdataset: function (dataset) {\r\n\t\tvar Z = this;\r\n\t\tif (dataset === undefined) {\r\n\t\t\tif(Z._parent) {\r\n\t\t\t\treturn Z._parent.dataset();\r\n\t\t\t}\r\n\t\t\treturn Z._dataset;\r\n\t\t}\r\n\t\t\r\n\t\tif(jslet.isString(dataset)) {\r\n\t\t\tdataset = jslet.data.getDataset(dataset); \r\n\t\t} else {\r\n\t\t\tjslet.Checker.test('Field.dataset', dataset).isClass(jslet.data.Dataset.className);\r\n\t\t}\r\n\t\tif(dataset) {\r\n\t\t\tZ._dsName = dataset.name();\r\n\t\t}\r\n\t\tZ._removeRelation();\r\n\t\tZ._dataset = dataset;\r\n\t\tZ._clearFieldCache();\r\n\t\tZ._addRelation();\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get or set field name\r\n\t * \r\n\t * @param {String or undefined} fldName Field name.\r\n\t * @return {String}\r\n\t */\r\n\tname: function () {\r\n\t\tif(arguments.length >0) {\r\n\t\t\talert(\"Can't change field name!\");\r\n\t\t}\r\n\t\treturn this._fieldName;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set field label.\r\n\t * \r\n\t * @param {String or undefined} label Field label.\r\n\t * @return {String or this}\r\n\t */\r\n\tlabel: function (label) {\r\n\t\tvar Z = this;\r\n\t\tif (label === undefined) {\r\n\t\t\treturn Z._label || Z._fieldName;\r\n\t\t}\r\n\t\tjslet.Checker.test('Field.label', label).isString();\r\n\t\tZ._label = label;\r\n\t\tZ._fireMetaChangedEvent('label');\r\n\t\tZ._fireGlobalMetaChangedEvent('label');\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set field tip.\r\n\t * \r\n\t * @param {String or undefined} tip Field tip.\r\n\t * @return {String or this}\r\n\t */\r\n\ttip: function(tip) {\r\n\t\tvar Z = this;\r\n\t\tif (tip === undefined) {\r\n\t\t\treturn Z._tip;\r\n\t\t}\r\n\t\tjslet.Checker.test('Field.tip', tip).isString();\r\n\t\tZ._tip = tip;\r\n\t\tZ._fireMetaChangedEvent('tip');\r\n\t\tZ._fireGlobalMetaChangedEvent('tip');\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get field data type.\r\n\t * \r\n\t * @param {jslet.data.DataType}\r\n\t */\r\n\tgetType: function () {\r\n\t\treturn this._dataType;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set parent field object.\r\n\t * \r\n\t * @param {jslet.data.Field or undefined} parent Parent field object.\r\n\t * @return {jslet.data.Field or this}\r\n\t */\r\n\tparent: function (parent) {\r\n\t\tvar Z = this;\r\n\t\tif (parent === undefined) {\r\n\t\t\treturn Z._parent;\r\n\t\t}\r\n\t\tjslet.Checker.test('Field.parent', parent).isClass(this.className);\r\n\t\tZ._parent = parent;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set child fields of this field.\r\n\t * \r\n\t * @param {jslet.data.Field[] or undefined} children Child field object.\r\n\t * @return {jslet.data.Field or this}\r\n\t */\r\n\tchildren: function (children) {\r\n\t\tvar Z = this;\r\n\t\tif (children === undefined) {\r\n\t\t\treturn Z._children;\r\n\t\t}\r\n\t\tjslet.Checker.test('Field.children', children).isArray();\r\n\t\tfor(var i = 0, len = children.length; i < len; i++) {\r\n\t\t\tjslet.Checker.test('Field.children#childField', children[i]).isClass(this.className);\r\n\t\t}\r\n\t\tZ._children = children;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get or set field display order.\r\n\t * Dataset uses this property to resolve field order.\r\n\t * \r\n\t * @param {Integer or undefined} displayOrder Field display order.\r\n\t * @return {Integer or this}\r\n\t */\r\n\tdisplayOrder: function (displayOrder) {\r\n\t\tvar Z = this;\r\n\t\tif (displayOrder === undefined) {\r\n\t\t\treturn Z._displayOrder;\r\n\t\t}\r\n\t\tjslet.Checker.test('Field.displayOrder', displayOrder).isNumber();\r\n\t\tZ._displayOrder = parseInt(displayOrder);\r\n\t\tZ._fireGlobalMetaChangedEvent('displayOrder');\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set the edit control tab index of this field.\r\n\t * \r\n\t * @param {Integer or undefined} tabIndex the edit control tab index of this field.\r\n\t * @return {Integer or this}\r\n\t */\r\n\ttabIndex: function(tabIndex) {\r\n\t\tvar Z = this;\r\n\t\tif (tabIndex === undefined) {\r\n\t\t\treturn Z._tabIndex;\r\n\t\t}\r\n\t\tjslet.Checker.test('Field.tabIndex', tabIndex).isNumber();\r\n\t\tZ._tabIndex = parseInt(tabIndex);\r\n\t\tZ._fireMetaChangedEvent('tabIndex');\r\n\t\tZ._fireGlobalMetaChangedEvent('tabIndex');\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get or set field stored length.\r\n\t * If it's a database field, it's usually same as the length of database.  \r\n\t * \r\n\t * @param {Integer or undefined} len Field stored length.\r\n\t * @return {Integer or this}\r\n\t */\r\n\tlength: function (len) {\r\n\t\tvar Z = this;\r\n\t\tif (len === undefined) {\r\n\t\t\treturn Z._length;\r\n\t\t}\r\n\t\tjslet.Checker.test('Field.length', len).isGTEZero();\r\n\t\tZ._length = parseInt(len);\r\n\t\tZ._fireGlobalMetaChangedEvent('length');\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get edit length.\r\n\t * Edit length is used in editor to input data.\r\n\t * \r\n\t * @return {Integer}\r\n\t */\r\n\tgetEditLength: function () {\r\n\t\tvar Z = this;\r\n\t\tif (Z._lookup) {\r\n\t\t\tvar codeFld = Z._lookup.codeField();\r\n\t\t\tvar lkds = Z._lookup.dataset();\r\n\t\t\tif (lkds && codeFld) {\r\n\t\t\t\tvar lkf = lkds.getField(codeFld);\r\n\t\t\t\tif (lkf) {\r\n\t\t\t\t\treturn lkf.getEditLength();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(Z._dataType === jslet.data.DataType.NUMBER && Z._scale > 0) {\r\n\t\t\treturn Z._length + 1; // 1 for decimal point\r\n\t\t}\r\n\t\treturn Z._length > 0 ? Z._length : 10;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set field decimal length.\r\n\t * \r\n\t * @param {Integer or undefined} scale Field decimal length.\r\n\t * @return {Integer or this}\r\n\t */\r\n\tscale: function (scale) {\r\n\t\tvar Z = this;\r\n\t\tif (scale === undefined) {\r\n\t\t\treturn Z._scale;\r\n\t\t}\r\n\t\tjslet.Checker.test('Field.scale', scale).isGTEZero();\r\n\t\tZ._scale = parseInt(scale);\r\n\t\tZ._fireGlobalMetaChangedEvent('scale');\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set field alignment.\r\n\t * \r\n\t * @param {String or undefined} alignment Field alignment.\r\n\t * @return {String or this}\r\n\t */\r\n\talignment: function (alignment) {\r\n\t\tvar Z = this;\r\n\t\tif (alignment === undefined){\r\n\t\t\tif(Z._alignment) {\r\n\t\t\t\treturn Z._alignment;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(Z._lookup) {\r\n\t\t\t\treturn 'left';\r\n\t\t\t}\r\n\t\t\tif(Z._dataType == jslet.data.DataType.NUMBER) {\r\n\t\t\t\treturn 'right';\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(Z._dataType == jslet.data.DataType.BOOLEAN) {\r\n\t\t\t\treturn 'center';\r\n\t\t\t}\r\n\t\t\treturn 'left';\r\n\t\t}\r\n\t\t\r\n\t\tjslet.Checker.test('Field.alignment', alignment).isString();\r\n\t\tZ._alignment = jQuery.trim(alignment);\r\n\t\tZ._fireColumnUpdatedEvent();\r\n\t\tZ._fireGlobalMetaChangedEvent('alignment');\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set the display text if the field value is null.\r\n\t * \r\n\t * @param {String or undefined} nullText Field null text.\r\n\t * @return {String or this}\r\n\t */\r\n\tnullText: function (nullText) {\r\n\t\tvar Z = this;\r\n\t\tif (nullText === undefined) {\r\n\t\t\treturn Z._nullText;\r\n\t\t}\r\n\t\tjslet.Checker.test('Field.nullText', nullText).isString();\r\n\t\tnullText = jQuery.trim(nullText);\r\n\t\tZ._nullText = nullText;\r\n\t\tZ._clearFieldCache();\r\n\t\tZ._fireColumnUpdatedEvent();\r\n\t\tZ._fireGlobalMetaChangedEvent('nullText');\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set field display width.\r\n\t * Display width is usually used in DBTable column.\r\n\t * \r\n\t * @param {Integer or undefined} displayWidth Field display width.\r\n\t * @return {Integer or this}\r\n\t */\r\n\tdisplayWidth: function (displayWidth) {\r\n\t\tvar Z = this;\r\n\t\tif (displayWidth === undefined){\r\n\t\t\tif (Z._displayWidth <= 0) {\r\n\t\t\t\treturn Z._length > 0 ? Z._length : 12;\r\n\t\t\t} else {\r\n\t\t\t\treturn Z._displayWidth;\r\n\t\t\t}\r\n\t\t}\r\n\t\tjslet.Checker.test('Field.displayWidth', displayWidth).isGTEZero();\r\n\t\tZ._displayWidth = parseInt(displayWidth);\r\n\t\tZ._fireGlobalMetaChangedEvent('displayWidth');\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get or set field default expression.\r\n\t * This expression will be calculated when inserting a record.\r\n\t * \r\n\t * @param {String or undefined} defaultExpr Field default expression.\r\n\t * @return {String or this}\r\n\t */\r\n\tdefaultExpr: function (defaultExpr) {\r\n\t\tvar Z = this;\r\n\t\tif (defaultExpr === undefined) {\r\n\t\t\treturn Z._defaultExpr;\r\n\t\t}\r\n\t\tjslet.Checker.test('Field.defaultExpr', defaultExpr).isString();\r\n\t\tZ._defaultExpr = defaultExpr;\r\n\t\tZ._fireGlobalMetaChangedEvent('defaultExpr');\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set field display format.\r\n\t * For number field like: #,##0.00\r\n\t * For date field like: yyyy/MM/dd\r\n\t * \r\n\t * @param {String or undefined} format Field display format.\r\n\t * @return {String or this}\r\n\t */\r\n\tdisplayFormat: function (format) {\r\n\t\tvar Z = this;\r\n\t\tif (format === undefined) {\r\n\t\t\tif (Z._displayFormat) {\r\n\t\t\t\treturn Z._displayFormat;\r\n\t\t\t} else {\r\n\t\t\t\tif (Z._dataType == jslet.data.DataType.DATE) {\r\n\t\t\t\t\treturn jslet.locale.Date.format;\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn Z._displayFormat;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tjslet.Checker.test('Field.displayFormat', format).isString();\r\n\t\tZ._displayFormat = jQuery.trim(format);\r\n\t\tZ._dateFormat = null;\r\n\t\tZ._dateChar = null;\r\n\t\tZ._dateRegular = null;\r\n\t\tZ._clearFieldCache();\t\t\r\n\t\tZ._fireColumnUpdatedEvent();\r\n\t\tZ._fireGlobalMetaChangedEvent('displayFormat');\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set field default value.\r\n\t * The data type of default value must be same as Field's.\r\n\t * Example:\r\n\t *   Number field: fldObj.defauleValue(100);\r\n\t *   Date field: fldObj.defaultValue(new Date());\r\n\t *   String field: fldObj.defaultValue('test');\r\n\t * \r\n\t * @param {Object or undefined} dftValue Field default value.\r\n\t * @return {Object or this}\r\n\t */\r\n\tdefaultValue: function (dftValue) {\r\n\t\tvar Z = this;\r\n\t\tif (dftValue === undefined) {\r\n\t\t\treturn Z._defaultValue;\r\n\t\t}\r\n\t\tjslet.Checker.test('Field.defaultValue', Z.dftValue).isDataType(Z._dateType);\r\n\t\tZ._defaultValue = dftValue;\r\n\t\tZ._fireGlobalMetaChangedEvent('defaultValue');\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set field is unique or not.\r\n\t * \r\n\t * @param {Boolean or undefined} unique Field is unique or not.\r\n\t * @return {Boolean or this}\r\n\t */\r\n\tunique: function (unique) {\r\n\t\tvar Z = this;\r\n\t\tif (unique === undefined) {\r\n\t\t\treturn Z._unique;\r\n\t\t}\r\n\t\tZ._unique = unique ? true: false;\r\n\t\tZ._fireGlobalMetaChangedEvent('unique');\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get or set field is required or not.\r\n\t * \r\n\t * @param {Boolean or undefined} required Field is required or not.\r\n\t * @return {Boolean or this}\r\n\t */\r\n\trequired: function (required) {\r\n\t\tvar Z = this;\r\n\t\tif (required === undefined) {\r\n\t\t\treturn Z._required;\r\n\t\t}\r\n\t\tZ._required = required ? true: false;\r\n\t\tZ._fireMetaChangedEvent('required');\r\n\t\tZ._fireGlobalMetaChangedEvent('required');\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get or set field edit mask.\r\n\t * \r\n\t * @param {jslet.data.EditMask or undefined} mask Field edit mask.\r\n\t * @return {jslet.data.EditMask or this}\r\n\t */\r\n\teditMask: function (mask) {\r\n\t\tvar Z = this;\r\n\t\tif (mask === undefined) {\r\n\t\t\treturn Z._editMask;\r\n\t\t}\r\n\t\tif(mask) {\r\n\t\t\tif (jslet.isString(mask)) {\r\n\t\t\t\tmask = {mask: mask,keepChar:true};\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tmask = null;\r\n\t\t}\r\n\t\tZ._editMask = mask;\r\n\t\tZ._clearFieldCache();\t\t\r\n\t\tZ._fireMetaChangedEvent('editMask');\r\n\t\tZ._fireGlobalMetaChangedEvent('required');\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\tdateFormat: function(){\r\n\t\tvar Z = this;\r\n\t\tif (Z._dateFormat) {\r\n\t\t\treturn Z._dateFormat;\r\n\t\t}\r\n\t\tif (this.getType() != jslet.data.DataType.DATE) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tvar displayFmt = this.displayFormat().toUpperCase();\r\n\t\tZ._dateFormat = '';\r\n\t\tvar c;\r\n\t\tfor(var i = 0, len = displayFmt.length; i < len; i++){\r\n\t\t\tc = displayFmt.charAt(i);\r\n\t\t\tif ('YMD'.indexOf(c) < 0) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif (Z._dateFormat.indexOf(c) < 0) {\r\n\t\t\t\tZ._dateFormat += c;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn Z._dateFormat;\r\n\t},\r\n\t\r\n\tdateSeparator: function(){\r\n\t\tvar Z = this;\r\n\t\tif (Z._dateChar) {\r\n\t\t\treturn Z._dateChar;\r\n\t\t}\r\n\t\tif (this.getType() != jslet.data.DataType.DATE) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tvar displayFmt = this.displayFormat().toUpperCase();\r\n\t\tfor(var i = 0, c, len = displayFmt.length; i < len; i++){\r\n\t\t\tc = displayFmt.charAt(i);\r\n\t\t\tif ('YMD'.indexOf(c) < 0){\r\n\t\t\t\tZ._dateChar = c;\r\n\t\t\t\treturn c;\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\tdateRegular: function(){\r\n\t\tvar Z = this;\r\n\t\tif (Z._dateRegular) {\r\n\t\t\treturn Z._dateRegular;\r\n\t\t}\r\n\t\tvar dateFmt = this.dateFormat(),\r\n\t\t\tdateSeparator = this.dateSeparator(),\r\n\t\t\tresult = ['^'];\r\n\t\tfor(var i = 0, c; i < dateFmt.length; i++){\r\n\t\t\tif (i > 0){\r\n\t\t\t\tresult.push('\\\\');\r\n\t\t\t\tresult.push(dateSeparator);\r\n\t\t\t}\r\n\t\t\tc = dateFmt.charAt(i);\r\n\t\t\tif (c == 'Y') {\r\n\t\t\t\tresult.push('(\\\\d{4}|\\\\d{2})');\r\n\t\t\t} else if (c == 'M'){\r\n\t\t\t\tresult.push('(0?[1-9]|1[012])');\r\n\t\t\t} else {\r\n\t\t\t\tresult.push('(0?[1-9]|[12][0-9]|3[01])');\r\n\t\t\t}\r\n\t\t}\r\n\t\tresult.push('(\\\\s+\\\\d{2}:\\\\d{2}:\\\\d{2}(\\\\.\\\\d{3}){0,1}){0,1}');\r\n\t\tresult.push('$');\r\n\t\tZ._dateRegular = {expr: new RegExp(result.join(''), 'gim'), message: jslet.locale.Dataset.invalidDate};\r\n\t\treturn Z._dateRegular;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get or set field formula. Example: \r\n\t * <pre><code>\r\n\t *  fldObj.formula('[price]*[num]');\r\n\t * </code></pre>\r\n\t * \r\n\t * @param {String or undefined} formula Field formula.\r\n\t * @return {String or this}\r\n\t */\r\n\tformula: function (formula) {\r\n\t\tvar Z = this;\r\n\t\tif (formula === undefined) {\r\n\t\t\treturn Z._formula;\r\n\t\t}\r\n\t\t\r\n\t\tjslet.Checker.test('Field.formula', formula).isString();\r\n\t\tZ._formula = jQuery.trim(formula);\r\n\t\tZ._clearFieldCache();\r\n\t\tvar dataset = Z.dataset(); \r\n\t\tif (dataset) {\r\n\t\t\tdataset.removeInnerFormulaField(Z._fieldName);\r\n\t\t\tdataset.addInnerFormulaField(Z._fieldName, Z._formula);\t\t\r\n\t\t\tZ._fireColumnUpdatedEvent();\r\n\t\t}\r\n\t\tZ._fireGlobalMetaChangedEvent('formula');\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set field is visible or not.\r\n\t * \r\n\t * @param {Boolean or undefined} visible Field is visible or not.\r\n\t * @return {Boolean or this}\r\n\t */\r\n\tvisible: function (visible) {\r\n\t\tvar Z = this;\r\n\t\tif (visible === undefined){\r\n\t\t\tif (Z._visible){\r\n\t\t\t\tvar p = this.parent();\r\n\t\t\t\twhile(p){\r\n\t\t\t\t\tif (!p.visible()) { //if parent is invisible\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tp = p.parent();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn Z._visible;\r\n\t\t}\r\n\t\tZ._visible = visible ? true: false;\r\n\t\tZ._fireMetaChangedEvent('visible');\r\n\t\tZ._fireGlobalMetaChangedEvent('visible');\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set field is disabled or not.\r\n\t * \r\n\t * @param {Boolean or undefined} disabled Field is disabled or not.\r\n\t * @return {Boolean or this}\r\n\t */\r\n\tdisabled: function (disabled) {\r\n\t\tvar Z = this;\r\n\t\tif (disabled === undefined) {\r\n\t\t\treturn Z._disabled;\r\n\t\t}\r\n\t\tZ._disabled = disabled ? true: false;\r\n\t\tZ._fireMetaChangedEvent('disabled');\r\n\t\tZ._fireGlobalMetaChangedEvent('disabled');\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set field is readOnly or not.\r\n\t * \r\n\t * @param {Boolean or undefined} readOnly Field is readOnly or not.\r\n\t * @return {Boolean or this}\r\n\t */\r\n\treadOnly: function (readOnly) {\r\n\t\tvar Z = this;\r\n\t\tif (readOnly === undefined){\r\n\t\t\tif (Z._dataType == jslet.data.DataType.DATASET) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\tvar children = Z.children();\r\n\t\t\tif (children && children.length === 0) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t\treturn Z._readOnly || Z._dataset.readOnly();\r\n\t\t}\r\n\t\t\r\n\t\tZ._readOnly = readOnly? true: false;\r\n\t\tZ._fireMetaChangedEvent('readOnly');\r\n\t\tZ._fireGlobalMetaChangedEvent('readOnly');\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\tfieldReadOnly: function() {\r\n\t\tvar Z = this;\r\n\t\tif (Z._dataType == jslet.data.DataType.DATASET) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tvar children = Z.children();\r\n\t\tif (children && children.length === 0) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\treturn Z._readOnly;\r\n\t},\r\n\t\r\n\tfieldDisabled: function() {\r\n\t\treturn this._disabled;\r\n\t},\r\n\t\r\n\t_fireGlobalMetaChangedEvent: function(metaName) {\r\n\t\tvar ds = this.dataset();\r\n\t\tif (ds && ds.designMode()) {\r\n\t\t\tvar handler = jslet.data.globalDataHandler.fieldMetaChanged();\r\n\t\t\tif(handler) {\r\n\t\t\t\thandler.call(this, ds, this._fieldName, metaName)\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\t_fireMetaChangedEvent: function(metaName, changeAllRows) {\r\n\t\tvar ds = this.dataset();\r\n\t\tif (ds) {\r\n\t\t\tvar evt = jslet.data.RefreshEvent.changeMetaEvent(metaName, this._fieldName, changeAllRows);\r\n\t\t\tds.refreshControl(evt);\r\n\t\t}\r\n\t},\r\n\t\r\n\t_fireColumnUpdatedEvent: function() {\r\n\t\tvar ds = this.dataset();\r\n\t\tif (ds) {\r\n\t\t\tvar evt = jslet.data.RefreshEvent.updateColumnEvent(this._fieldName);\r\n\t\t\tds.refreshControl(evt);\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get or set if field participates unit converting.\r\n\t * \r\n\t * @param {Boolean or undefined} unitConverted .\r\n\t * @return {Boolean or this}\r\n\t */\r\n\tunitConverted: function (unitConverted) {\r\n\t\tvar Z = this;\r\n\t\tif (unitConverted === undefined) {\r\n\t\t\treturn Z._dataType == jslet.data.DataType.NUMBER? Z._unitConverted:false;\r\n\t\t}\r\n\t\tZ._unitConverted = unitConverted ? true : false;\r\n\t\tvar ds = this.dataset();\r\n\t\tZ._clearFieldCache();\t\t\r\n\t\tif (Z._dataType == jslet.data.DataType.NUMBER && ds && ds.unitConvertFactor() != 1) {\r\n\t\t\tZ._fireColumnUpdatedEvent();\r\n\t\t}\r\n\t\tZ._fireGlobalMetaChangedEvent('unitConverted');\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set value style of this field. Optional value: 0 - Normal, 1 - Between style, 2 - Multiple value\r\n\t * \r\n\t * @param {Integer or undefined} mvalueStyle.\r\n\t * @return {Integer or this}\r\n\t */\r\n\tvalueStyle: function (mvalueStyle) {\r\n\t\tvar Z = this;\r\n\t\tif (mvalueStyle === undefined) {\r\n\t\t\tif(Z._dataType == jslet.data.DataType.DATASET ||  \r\n\t\t\t\t\tZ._children && Z._children.length > 0) \r\n\t\t\t\treturn jslet.data.FieldValueStyle.NORMAL;\r\n\t\t\t\r\n\t\t\treturn Z._valueStyle;\r\n\t\t}\r\n\r\n\t\tif(mvalueStyle) {\r\n\t\t\tmvalueStyle = parseInt(mvalueStyle);\r\n\t\t} else {\r\n\t\t\tmvalueStyle = 0;\r\n\t\t}\r\n\t\tjslet.Checker.test('Field.valueStyle', mvalueStyle).isNumber().inArray([0,1,2]);\r\n\t\tZ._valueStyle = mvalueStyle;\r\n\t\tZ._clearFieldCache();\t\t\r\n\t\tZ._fireColumnUpdatedEvent();\r\n\t\tZ._fireGlobalMetaChangedEvent('valueStyle');\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set allowed count when valueStyle is multiple.\r\n\t * \r\n\t * @param {String or undefined} count.\r\n\t * @return {String or this}\r\n\t */\r\n\tvalueCountLimit: function (count) {\r\n\t\tvar Z = this;\r\n\t\tif (count === undefined) {\r\n\t\t\treturn Z._valueCountLimit;\r\n\t\t}\r\n\t\tif(count) {\r\n\t\t\tjslet.Checker.test('Field.valueCountLimit', count).isNumber();\r\n\t\t} else {\r\n\t\t\tcount = 0;\r\n\t\t}\r\n\t\tZ._valueCountLimit = parseInt(count);\r\n\t\tZ._fireGlobalMetaChangedEvent('valueCountLimit');\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set field display control. It is similar as DBControl configuration.\r\n\t * Here you need not set 'dataset' and 'field' property.   \r\n\t * Example:\r\n\t * <pre><code>\r\n\t * //Normal DBControl configuration\r\n\t * //var normalCtrlCfg = {type:\"DBSpinEdit\",dataset:\"employee\",field:\"age\",minValue:10,maxValue:100,step:5};\r\n\t * \r\n\t * var displayCtrlCfg = {type:\"DBSpinEdit\",minValue:10,maxValue:100,step:5};\r\n\t * fldObj.displayControl(displayCtrlCfg);\r\n\t * </code></pre>\r\n\t * \r\n\t * @param {DBControl Config or String} dispCtrl If String, it will convert to DBControl Config.\r\n\t * @return {DBControl Config or this}\r\n\t */\r\n\tdisplayControl: function (dispCtrl) {\r\n\t\tvar Z = this;\r\n\t\tif (dispCtrl === undefined){\r\n\t\t\tif (Z._dataType == jslet.data.DataType.BOOLEAN && !Z._displayControl) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\ttype: 'dbcheckbox'\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\treturn Z._displayControl;\r\n\t\t}\r\n\t\t \r\n\t\tZ._displayControl = (typeof (Z._fieldName) == 'string') ? { type: dispCtrl } : dispCtrl;\r\n\t\tZ._fireGlobalMetaChangedEvent('displayControl');\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set field edit control. It is similar as DBControl configuration.\r\n\t * Here you need not set 'dataset' and 'field' property.   \r\n\t * Example:\r\n\t * <pre><code>\r\n\t * //Normal DBControl configuration\r\n\t * //var normalCtrlCfg = {type:\"DBSpinEdit\",dataset:\"employee\",field:\"age\",minValue:10,maxValue:100,step:5};\r\n\t * \r\n\t * var editCtrlCfg = {type:\"DBSpinEdit\",minValue:10,maxValue:100,step:5};\r\n\t * fldObj.displayControl(editCtrlCfg);\r\n\t * </code></pre>\r\n\t * \r\n\t * @param {DBControl Config or String} editCtrl If String, it will convert to DBControl Config.\r\n\t * @return {DBControl Config or this}\r\n\t */\r\n\teditControl: function (editCtrl) {\r\n\t\tvar Z = this;\r\n\t\tif (editCtrl=== undefined){\r\n\t\t\tif (Z._editControl) {\r\n\t\t\t\treturn Z._editControl;\r\n\t\t\t}\r\n\r\n\t\t\tif (Z._dataType == jslet.data.DataType.BOOLEAN) {\r\n\t\t\t\treturn {type: 'dbcheckbox'};\r\n\t\t\t}\r\n\t\t\tif (Z._dataType == jslet.data.DataType.DATE) {\r\n\t\t\t\treturn {type: 'dbdatepicker'};\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\treturn (Z._lookup !== null)? {type: 'dbselect'}:{type: 'dbtext'};\r\n\t\t}\r\n\t\tif(typeof (editCtrl) === 'string') {\r\n\t\t\teditCtrl = jQuery.trim(editCtrl);\r\n\t\t\tif(editCtrl) {\r\n\t\t\t\tif(editCtrl.indexOf(':') > 0) {\r\n\t\t\t\t\teditCtrl = jslet.JSON.parse(editCtrl);\r\n\t\t\t\t} else {\r\n\t\t\t\t\teditCtrl =  {type: editCtrl};\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\teditCtrl = null;\r\n\t\t\t}\r\n\t\t}\r\n\t\tZ._editControl = editCtrl;\r\n\t\tZ._fireMetaChangedEvent('editControl');\r\n\t\tZ._fireGlobalMetaChangedEvent('editControl');\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * {Event} Get customized field text.\r\n\t * Pattern: function(fieldName, value){}\r\n\t *   //fieldName: String, field name;\r\n\t *   //value: Object, field value, the value type depends on field type;\r\n\t *   //return: String, field text;\r\n\t */\r\n\tonCustomFormatFieldText: null, // (fieldName, value)\r\n\r\n\t_addRelation: function() {\r\n\t\tvar Z = this,\r\n\t\t\tlkDsName;\r\n\t\tif(!Z._dataset || (Z.getType() != jslet.data.DataType.DATASET && !Z._lookup)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tvar hostDs = Z._dataset.name(),\r\n\t\t\thostField = Z._fieldName,\r\n\t\t\trelationType;\r\n\t\tif(Z.getType() == jslet.data.DataType.DATASET) {\r\n\t\t\tif(Z._subDataset) {\r\n\t\t\t\tlkDsName = Z._getDatasetName(Z._subDataset);\r\n\t\t\t\trelationType = jslet.data.DatasetType.DETAIL;\r\n\t\t\t\tjslet.data.datasetRelationManager.addRelation(hostDs, hostField, lkDsName, relationType);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tlkDsName = Z._getDatasetName(Z._lookup._dataset);\r\n\t\t\trelationType = jslet.data.DatasetType.LOOKUP;\r\n\t\t\tjslet.data.datasetRelationManager.addRelation(hostDs, hostField, lkDsName, relationType);\r\n\t\t}\r\n\t},\r\n\t\r\n\t_removeRelation: function() {\r\n\t\tvar Z = this;\r\n\t\tif(!Z._dataset || (!Z._subDataset && !Z._lookup)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar hostDs = Z._dataset.name(),\r\n\t\t\thostField = Z._fieldName,\r\n\t\t\trelationType;\r\n\r\n\t\tif(Z._subDataset) {\r\n\t\t\tlkDsName = Z._getDatasetName(Z._subDataset);\r\n\t\t} else {\r\n\t\t\tlkDsName = Z._getDatasetName(Z._lookup._dataset);\r\n\t\t}\r\n\t\tjslet.data.datasetRelationManager.removeRelation(hostDs, hostField, lkDsName);\r\n\t},\r\n\t\t\r\n\t/**\r\n\t * Get or set lookup field object\r\n\t * \r\n\t * @param {jslet.data.FieldLookup or undefined} lkFld lookup field Object.\r\n\t * @return {jslet.data.FieldLookup or this}\r\n\t */\r\n\tlookup: function (lkFldObj) {\r\n\t\tvar Z = this;\r\n\t\tif (lkFldObj === undefined){\r\n\t\t\treturn Z._lookup;\r\n\t\t}\r\n\t\tjslet.Checker.test('Field.lookup', lkFldObj).isClass(jslet.data.FieldLookup.className);\t\t\r\n\t\tZ._removeRelation();\r\n\t\t\r\n\t\tZ._lookup = lkFldObj;\r\n\t\tif(lkFldObj) {\r\n\t\t\tlkFldObj.hostField(Z);\r\n\t\t\tZ._addRelation();\r\n\t\t}\r\n\t\tZ._clearFieldCache();\t\t\r\n\t\tZ._fireColumnUpdatedEvent();\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t_getDatasetName: function(dsObjOrName) {\r\n\t\treturn jslet.isString(dsObjOrName)? dsObjOrName: dsObjOrName.name();\r\n\t},\r\n\t\r\n\t_subDsParsed: false,\r\n\t\r\n\t/**\r\n\t * Set or get sub dataset.\r\n\t * \r\n\t * @param {jslet.data.Dataset or undefined} subdataset\r\n\t * @return {jslet.data.Dataset or this}\r\n\t */\r\n\tsubDataset: function (subdataset) {\r\n\t\tvar Z = this;\r\n\t\tif (subdataset === undefined) {\r\n\t\t\tif(!Z._subDsParsed && Z._subDataset) {\r\n\t\t\t\tZ.subDataset(Z._subDataset);\r\n\t\t\t\tif(!Z._subDsParsed) {\r\n\t\t\t\t\tthrow new Error(jslet.formatString(jslet.locale.Dataset.datasetNotFound, [Z._subDataset]));\r\n\t\t\t\t}\t\t\t\r\n\t\t\t}\r\n\t\t\treturn Z._subDataset;\r\n\t\t}\r\n\t\t\r\n\t\tvar oldSubDsName = Z._getDatasetName(Z._subDataset),\r\n\t\t \tnewSubDsName = Z._getDatasetName(subdataset),\r\n\t\t \tneedProcessRelation = (oldSubDsName != newSubDsName);\r\n\t\tvar subDsObj = subdataset;\r\n\t\tif (jslet.isString(subDsObj)) {\r\n\t\t\tsubDsObj = jslet.data.getDataset(subDsObj);\r\n\t\t\tif(!subDsObj && jslet.data.onCreatingDataset) {\r\n\t\t\t\tjslet.data.onCreatingDataset(subdataset, jslet.data.DatasetType.DETAIL, null, Z._dsName); //1 - sub dataset\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(needProcessRelation) {\r\n\t\t\tZ._removeRelation();\r\n\t\t}\r\n\t\tif(subDsObj) {\r\n\t\t\tjslet.Checker.test('Field.subDataset', subDsObj).isClass(jslet.data.Dataset.className);\t\t\r\n\t\t\tif (Z._subDataset && Z._subDataset.datasetField) {\r\n\t\t\t\tZ._subDataset.datasetField(null);\r\n\t\t\t}\r\n\t\t\tZ._subDataset = subDsObj;\r\n\t\t\tZ._subDsParsed = true;\r\n\t\t} else {\r\n\t\t\tZ._subDataset = subdataset;\r\n\t\t\tZ._subDsParsed = false;\r\n\t\t}\r\n\t\tif(needProcessRelation) {\r\n\t\t\tZ._addRelation();\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\turlExpr: function (urlExpr) {\r\n\t\tvar Z = this;\r\n\t\tif (urlExpr === undefined) {\r\n\t\t\treturn Z._urlExpr;\r\n\t\t}\r\n\r\n\t\tjslet.Checker.test('Field.urlExpr', urlExpr).isString();\r\n\t\tZ._urlExpr = jQuery.trim(urlExpr);\r\n\t\tZ._innerUrlExpr = null;\r\n\t\tZ._clearFieldCache();\t\t\r\n\t\tZ._fireColumnUpdatedEvent();\r\n\t\tZ._fireGlobalMetaChangedEvent('urlExpr');\r\n\t\treturn this;\r\n\t},\r\n\r\n\turlTarget: function (target) {\r\n\t\tvar Z = this;\r\n\t\tif (target === undefined){\r\n\t\t\treturn !Z._urlTarget ? jslet.data.Field.URLTARGETBLANK : Z._urlTarget;\r\n\t\t}\r\n\r\n\t\tjslet.Checker.test('Field.urlTarget', target).isString();\r\n\t\tZ._urlTarget = jQuery.trim(target);\r\n\t\tZ._clearFieldCache();\r\n\t\tZ._fireColumnUpdatedEvent();\r\n\t\tZ._fireGlobalMetaChangedEvent('urlTarget');\r\n\t\treturn this;\r\n\t},\r\n\r\n\tcalcUrl: function () {\r\n\t\tvar Z = this;\r\n\t\tif (!this.dataset() || !Z._urlExpr) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tif (!Z._innerUrlExpr) {\r\n\t\t\tZ._innerUrlExpr = new jslet.Expression(this.dataset(), Z._urlExpr);\r\n\t\t}\r\n\t\treturn Z._innerUrlExpr.eval();\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set if field need be anti-xss.\r\n\t * If true, field value will be encoded.\r\n\t * \r\n\t * @param {Boolean or undefined} isXss.\r\n\t * @return {Boolean or this}\r\n\t */\r\n\tantiXss: function(isXss){\r\n\t\tvar Z = this;\r\n\t\tif (isXss === undefined) {\r\n\t\t\treturn Z._antiXss;\r\n\t\t}\r\n\t\tZ._antiXss = isXss ? true: false;\r\n\t\tZ._fireGlobalMetaChangedEvent('antiXss');\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set field rang.\r\n\t * Range is an object as: {min: x, max: y}. Example:\r\n\t * <pre><code>\r\n\t *\t//For String field\r\n\t *\tvar range = {min: 'a', max: 'z'};\r\n\t *  //For Date field\r\n\t *\tvar range = {min: new Date(2000,1,1), max: new Date(2010,12,31)};\r\n\t *  //For Number field\r\n\t *\tvar range = {min: 0, max: 100};\r\n\t *  fldObj.dataRange(range);\r\n\t * </code></pre>\r\n\t * \r\n\t * @param {Range or Json String} range Field range;\r\n\t * @return {Range or this}\r\n\t */\r\n\tdataRange: function (range) {\r\n\t\tvar Z = this;\r\n\t\tif (range === undefined) {\r\n\t\t\treturn Z._dataRange;\r\n\t\t}\r\n\t\tif(range && jslet.isString(range)) {\r\n\t\t\trange = jslet.JSON.parse(range);\r\n\t\t}\r\n\t\tif(range) {\r\n\t\t\tjslet.Checker.test('Field.dataRange', range).isObject();\r\n\t\t\tif(range.min) {\r\n\t\t\t\tjslet.Checker.test('Field.dataRange.min', range.min).isDataType(Z._dateType);\r\n\t\t\t}\r\n\t\t\tif(range.max) {\r\n\t\t\t\tjslet.Checker.test('Field.dataRange.max', range.max).isDataType(Z._dateType);\r\n\t\t\t}\r\n\t\t}\r\n\t\tZ._dataRange = range;\r\n\t\tZ._fireGlobalMetaChangedEvent('dataRange');\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set regular expression.\r\n\t * You can specify your own validator with regular expression. If regular expression not specified, \r\n\t * The default regular expression for Date and Number field will be used. Example:\r\n\t * <pre><code>\r\n\t *\tfldObj.regularExpr(/(\\(\\d{3,4}\\)|\\d{3,4}-|\\s)?\\d{8}/ig, 'Invalid phone number!');//like: 0755-12345678\r\n\t * </code></pre>\r\n\t * \r\n\t * @param {String} expr Regular expression;\r\n\t * @param {String} message Message for invalid.\r\n\t * @return {Object} An object like: { expr: expr, message: message }\r\n\t */\r\n\tregularExpr: function (expr, message) {\r\n\t\tvar Z = this;\r\n\t\tvar argLen = arguments.length;\r\n\t\tif (argLen === 0){\r\n\t\t\treturn Z._regularExpr;\r\n\t\t}\r\n\t\t\r\n\t\tif (argLen == 1) {\r\n\t\t\tZ._regularExpr = expr;\r\n\t\t} else {\r\n\t\t\tZ._regularExpr = { expr: expr, message: message };\r\n\t\t}\r\n\t\tZ._fireGlobalMetaChangedEvent('regularExpr');\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t\r\n\t/**\r\n\t * Get or set customized field value converter.\r\n\t * \r\n\t * @param {jslet.data.FieldValueConverter} converter converter object, sub class of jslet.data.FieldValueConverter.\r\n\t */\r\n\tcustomValueConverter: function (converter) {\r\n\t\tvar Z = this;\r\n\t\tif (converter === undefined) {\r\n\t\t\treturn Z._customValueConverter;\r\n\t\t}\r\n\t\tZ._customValueConverter = converter;\r\n\t\tZ._clearFieldCache();\r\n\t\tZ._fireColumnUpdatedEvent();\r\n\t\tZ._fireGlobalMetaChangedEvent('customValueConverter');\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set customized validator.\r\n\t * \r\n\t * @param {Function} validator Validator function.\r\n\t * Pattern:\r\n\t *   function(fieldObj, fldValue){}\r\n\t *   //fieldObj: jslet.data.Field, Field object\r\n\t *   //fldValue: Object, Field value\r\n\t *   //return: String, if validate failed, return error message, otherwise return null; \r\n\t */\r\n\tcustomValidator: function (validator) {\r\n\t\tvar Z = this;\r\n\t\tif (validator === undefined) {\r\n\t\t\treturn Z._customValidator;\r\n\t\t}\r\n\t\tif(validator) {\r\n\t\t\tjslet.Checker.test('Field.customValidator', validator).isFunction();\r\n\t\t}\r\n\t\tZ._customValidator = validator;\r\n\t\tZ._fireGlobalMetaChangedEvent('customValidator');\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Valid characters for this field.\r\n\t */\r\n\tvalidChars: function(chars){\r\n\t\tvar Z = this;\r\n\t\tif (chars === undefined){\r\n\t\t\tif (Z._validChars) {\r\n\t\t\t\treturn Z._validChars;\r\n\t\t\t}\r\n\t\t\tif (Z._dataType == jslet.data.DataType.NUMBER){\r\n\t\t\t\treturn Z._scale ? '+-0123456789.' : '+-0123456789';\r\n\t\t\t}\r\n\t\t\tif (Z._dataType == jslet.data.DataType.DATE){\r\n\t\t\t\tvar displayFormat = Z.displayFormat();\r\n\t\t\t\tvar chars = '0123456789';\r\n\t\t\t\tfor(var i = 0, len = displayFormat.length; i < len; i++) {\r\n\t\t\t\t\tvar c = displayFormat.charAt(i);\r\n\t\t\t\t\tif(c === 'y' || c === 'M' || c === 'd' || c === 'h' || c === 'm' || c === 's') {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tchars += c;\r\n\t\t\t\t}\r\n\t\t\t\treturn chars;\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\t\r\n\t\tZ._validChars = chars;\r\n\t\tZ._fireGlobalMetaChangedEvent('validChars');\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Use for Boolean field, actual value for 'true'\r\n\t */\r\n\ttrueValue: function(value) {\r\n\t\tvar Z = this;\r\n\t\tif (value === undefined) {\r\n\t\t\treturn Z._trueValue;\r\n\t\t}\r\n\t\tZ._trueValue = value;\r\n\t\treturn this;\t\t\r\n\t},\r\n\t\r\n\t/**\r\n\t * Use for Boolean field, actual value for 'false'\r\n\t */\r\n\tfalseValue: function(value) {\r\n\t\tvar Z = this;\r\n\t\tif (value === undefined) {\r\n\t\t\treturn Z._falseValue;\r\n\t\t}\r\n\t\tZ._falseValue = value;\r\n\t\treturn this;\t\t\r\n\t},\r\n\t\r\n\t/**\r\n\t * Use for Boolean field, display text for 'true'\r\n\t */\r\n\ttrueText: function(trueText) {\r\n\t\tvar Z = this;\r\n\t\tif (trueText === undefined) {\r\n\t\t\treturn Z._trueText || jslet.locale.Dataset.trueText;\r\n\t\t}\r\n\t\tZ._trueText = trueText;\r\n\t\treturn this;\t\t\r\n\t},\r\n\t\r\n\t/**\r\n\t * Use for Boolean field, display text for 'false'\r\n\t */\r\n\tfalseText: function(falseText) {\r\n\t\tvar Z = this;\r\n\t\tif (falseText === undefined) {\r\n\t\t\treturn Z._falseText || jslet.locale.Dataset.falseText;\r\n\t\t}\r\n\t\tZ._falseText = falseText;\r\n\t\treturn this;\t\t\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get or set if the same field value will be merged.\r\n\t * \r\n\t * @param {Boolean or undefined} mergeSame.\r\n\t * @return {Boolean or this}\r\n\t */\r\n\tmergeSame: function(mergeSame){\r\n\t\tvar Z = this;\r\n\t\tif (mergeSame === undefined) {\r\n\t\t\treturn Z._mergeSame;\r\n\t\t}\r\n\t\tZ._mergeSame = mergeSame ? true: false;\r\n\t\tZ._fireGlobalMetaChangedEvent('mergeSame');\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set the field names to \"mergeSame\".\r\n\t * Multiple field names are separated by ','.\r\n\t * \r\n\t * @param {String or undefined} mergeSameBy.\r\n\t * @return {String or this}\r\n\t */\r\n\tmergeSameBy: function(mergeSameBy){\r\n\t\tvar Z = this;\r\n\t\tif (mergeSameBy === undefined) {\r\n\t\t\treturn Z._mergeSameBy;\r\n\t\t}\r\n\t\tjslet.Checker.test('Field.mergeSameBy', mergeSameBy).isString();\r\n\t\tZ._mergeSameBy = jQuery.trim(mergeSameBy);\r\n\t\tZ._fireGlobalMetaChangedEvent('mergeSameBy');\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get or set if the field is following the value which append before.\r\n\t * \r\n\t * @param {Boolean or undefined} valueFollow true - the default value is same as the value which appended before, false -otherwise.\r\n\t * @return {Boolean or this}\r\n\t */\r\n\tvalueFollow: function(valueFollow) {\r\n\t\tvar Z = this;\r\n\t\tif(valueFollow === undefined) {\r\n\t\t\treturn Z._valueFollow;\r\n\t\t}\r\n\t\tZ._valueFollow = valueFollow? true: false;\r\n\t\tif(!Z._valueFollow && Z._dataset) {\r\n\t\t\tZ._dataset._followedValue = null;\r\n\t\t}\r\n\t\tZ._fireGlobalMetaChangedEvent('valueFollow');\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set the type of aggraded value.\r\n\t * \r\n\t * @param {String or undefined} aggraded optional value is: count,sum,avg.\r\n\t * @return {String or this}\r\n\t */\r\n\taggraded: function (aggraded) {\r\n\t\tvar Z = this;\r\n\t\tif (aggraded === undefined){\r\n\t\t\treturn Z._aggraded;\r\n\t\t}\r\n\t\t\r\n\t\tZ._aggraded = aggraded? true: false;\r\n\t\tZ._fireGlobalMetaChangedEvent('aggraded');\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set the field names to aggrade field value. \r\n\t * Multiple field names are separated by ','.\r\n\t * \r\n\t * \r\n\t * @param {String or undefined} aggrBy.\r\n\t * @return {String or this}\r\n\t */\r\n\taggradedBy: function(aggradedBy){\r\n\t\tvar Z = this;\r\n\t\tif (aggradedBy === undefined) {\r\n\t\t\treturn Z._aggradedBy;\r\n\t\t}\r\n\t\tjslet.Checker.test('Field.aggradedBy', aggradedBy).isString();\r\n\t\tZ._aggradedBy = jQuery.trim(aggradedBy);\r\n\t\tZ._fireGlobalMetaChangedEvent('aggradedBy');\r\n\t\treturn this;\r\n\t},\r\n\r\n\tcrossSource: function(crossSource) {\r\n\t\tvar Z = this;\r\n\t\tif(crossSource === undefined) {\r\n\t\t\treturn Z._crossSource;\r\n\t\t}\r\n\t\tjslet.Checker.test('Field.crossSource', crossSource).isClass(jslet.data.CrossFieldSource.className);\r\n\t\tZ._crossSource = crossSource;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get or set fixed field value, if field value not specified, fixed field value used.\r\n\t * \r\n\t * @param {String or undefined} fixedValue.\r\n\t * @return {String or this}\r\n\t */\r\n\tfixedValue: function(fixedValue){\r\n\t\tvar Z = this;\r\n\t\tif (fixedValue === undefined) {\r\n\t\t\treturn Z._fixedValue;\r\n\t\t}\r\n\t\tjslet.Checker.test('Field.fixedValue', fixedValue).isString();\r\n\t\tZ._fixedValue = jQuery.trim(fixedValue);\r\n\t\tZ._fireGlobalMetaChangedEvent('fixedValue');\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\tgetValue: function(valueIndex) {\r\n\t\treturn this._dataset.getFieldValue(this._fieldName, valueIndex);\r\n\t},\r\n\t\r\n\tsetValue: function(value, valueIndex) {\r\n\t\tthis._dataset.setFieldValue(this._fieldName, value, valueIndex);\r\n\t},\r\n\r\n\tgetTextValue: function(isEditing, valueIndex) {\r\n\t\treturn this._dataset.getFieldText(this._fieldName, isEditing, valueIndex);\r\n\t},\r\n\t\r\n\tsetTextValue: function(value, valueIndex) {\r\n\t\tthis._dataset.setFieldText(this._fieldName, inputText, valueIndex);\r\n\t},\r\n\t\r\n\tclone: function(fldName, newDataset){\r\n\t\tvar Z = this;\r\n\t\tjslet.Checker.test('Field.clone#fldName', fldName).required().isString();\r\n\t\tvar result = new jslet.data.Field(fldName, Z._dataType);\r\n\t\tresult.dataset(newDataset ? newDataset : this.dataset());\r\n\t\tresult.length(Z._length);\r\n\t\tresult.scale(Z._scale);\r\n\t\tresult.alignment(Z._alignment);\r\n\t\tresult.defaultExpr(Z._defaultExpr);\r\n\t\tresult.defaultValue(Z._defaultValue);\r\n\t\tresult.label(Z._label);\r\n\t\tresult.tip(Z._tip);\r\n\t\tresult.displayWidth(Z._displayWidth);\r\n\t\tif (Z._editMask) {\r\n\t\t\tresult.editMask(Z._editMask.clone());\r\n\t\t}\r\n\t\tresult.displayOrder(Z._displayOrder);\r\n\t\tresult.tabIndex(Z._tabIndex);\r\n\t\tresult.displayFormat(Z._displayFormat);\r\n\t\tresult.dateFormat(Z._dateFormat);\r\n\t\tresult.formula(Z._formula);\r\n\t\tresult.unique(Z._unique);\r\n\t\tresult.required(Z._required);\r\n\t\tresult.readOnly(Z._readOnly);\r\n\t\tresult.visible(Z._visible);\r\n\t\tresult.disabled(Z._disabled);\r\n\t\tresult.unitConverted(Z._underted);\r\n\t\tif (Z._lookup) {\r\n\t\t\tresult.lookup(Z._lookup.clone());\r\n\t\t}\r\n\t\t\r\n\t\tresult.displayControl(Z._displayControl);\r\n\t\tresult.editControl(Z._editControl);\r\n\t\tresult.urlExpr(Z._urlExpr);\r\n\t\tresult.urlTarget(Z._urlTarget);\r\n\t\tresult.valueStyle(Z._valueStyle);\r\n\t\tresult.valueCountLimit(Z._valueCountLimit);\r\n\t\tresult.nullText(Z._nullText);\r\n\t\tresult.dataRange(Z._dataRange);\r\n\t\tif (Z._regularExpr) {\r\n\t\t\tresult.regularExpr(Z._regularExpr);\r\n\t\t}\r\n\t\tresult.antiXss(Z._antiXss);\r\n\t\tresult.customValidator(Z._customValidator);\r\n\t\tresult.customValueConverter(Z._customValueConverter);\r\n\t\tresult.validChars(Z._validChars);\r\n\t\tif (Z._parent) {\r\n\t\t\tresult.parent(Z._parent.clone(newDataset));\r\n\t\t}\r\n\t\tif (Z._children && Z._children.length > 0){\r\n\t\t\tvar childFlds = [];\r\n\t\t\tfor(var i = 0, cnt = Z._children.length; i < cnt; i++){\r\n\t\t\t\tchildFlds.push(Z._children[i].clone(newDataset));\r\n\t\t\t}\r\n\t\t\tresult.children(childFlds);\r\n\t\t}\r\n\t\t\r\n\t\tresult.mergeSame(Z._mergeSame);\r\n\t\tresult.mergeSameBy(Z._mergeSameBy);\r\n\t\tresult.fixedValue(Z._fixedValue);\r\n\t\t\r\n\t\tresult.valueFollow(Z._valueFollow);\r\n\t\tresult.aggraded(Z._aggraded);\r\n\t\tresult.aggradedBy(Z._aggradedBy);\r\n\r\n\t\tresult.trueValue(Z._trueValue);\r\n\t\tresult.falseValue(Z._falseValue);\r\n\t\tresult.trueText(Z._trueText);\r\n\t\tresult.falseText(Z._falseText);\r\n\r\n\t\treturn result;\r\n\t},\r\n\t\r\n\t_clearFieldCache: function() {\r\n\t\tvar Z = this;\r\n\t\tif(Z._dataset && Z._fieldName) {\r\n\t\t\tjslet.data.FieldValueCache.clearAll(Z._dataset, Z._fieldName);\r\n\t\t}\r\n\t}\r\n\t\r\n};\r\n\r\njslet.data.Field.URLTARGETBLANK = '_blank';\r\n\r\n/**\r\n * Create field object. Example:\r\n * <pre><code>\r\n * var fldObj = jslet.data.createField({name:'field1', type:'N', label: 'field1 label'});\r\n * </code></pre>\r\n * \r\n * @param {Json Object} fieldConfig A json object which property names are same as jslet.data.Field. Example: {name: 'xx', type: 'N', ...}\r\n * @param {jslet.data.Field} parent Parent field object.\r\n * @return {jslet.data.Field}\r\n */\r\njslet.data.createField = function (fieldConfig, parent) {\r\n\tjslet.Checker.test('createField#fieldConfig', fieldConfig).required().isObject();\r\n\tvar cfg = fieldConfig;\r\n\tif (!cfg.name) {\r\n\t\tthrow new Error('Property: name required!');\r\n\t}\r\n\tvar dtype = cfg.type;\r\n\tif (dtype === null) {\r\n\t\tdtype = jslet.data.DataType.STRING;\r\n\t} else {\r\n\t\tdtype = dtype.toUpperCase();\r\n\t\tif (dtype != jslet.data.DataType.STRING && \r\n\t\t\t\tdtype != jslet.data.DataType.NUMBER && \r\n\t\t\t\tdtype != jslet.data.DataType.DATE && \r\n\t\t\t\tdtype != jslet.data.DataType.BOOLEAN && \r\n\t\t\t\tdtype != jslet.data.DataType.CROSS && \r\n\t\t\t\tdtype != jslet.data.DataType.DATASET)\r\n\t\tdtype = jslet.data.DataType.STRING;\r\n\t}\r\n\r\n\tvar fldObj = new jslet.data.Field(cfg.shortName || cfg.name, dtype);\r\n\r\n\tif(fieldConfig.dsName) {\r\n\t\tfldObj._dsName = fieldConfig.dsName;\r\n\t}\r\n\tfunction setPropValue(propName) {\r\n\t\tvar propValue = cfg[propName];\r\n//\t\tif(propValue === undefined) {\r\n//\t\t\tpropValue = cfg[propName.toLowerCase()];\r\n//\t\t}\r\n\t\tif (propValue !== undefined) {\r\n\t\t\tfldObj[propName](propValue);\r\n\t\t}\r\n\t}\r\n\t\r\n\tfldObj.parent(parent);\r\n\tif(parent) {\r\n\t\tfldObj.dataset(parent.dataset());\r\n\t}\r\n\tif(cfg.crossSource) {\r\n \t\tvar crossSrc = jslet.data.createCrossFieldSource(cfg.crossSource);\r\n \t\tfldObj.crossSource(crossSrc);\r\n\t}\r\n\tsetPropValue('tabIndex');\r\n\tsetPropValue('displayOrder');\r\n\tsetPropValue('label');\r\n\tsetPropValue('tip');\r\n\r\n\tif (dtype == jslet.data.DataType.DATASET){\r\n\t\tvar subds = cfg.subDataset || cfg.subdataset;\r\n\t\tif (subds) {\r\n\t\t\tfldObj.subDataset(subds);\r\n\t\t} else {\r\n\t\t\tthrow new Error('subDataset NOT set when field data type is Dataset');\r\n\t\t}\r\n\t\tfldObj.visible(false);\r\n\t\treturn fldObj;\r\n\t}\r\n\t\r\n\tsetPropValue('visible');\r\n\r\n\tsetPropValue('unique');\r\n\tsetPropValue('required');\r\n\tsetPropValue('readOnly');\r\n\tsetPropValue('disabled');\r\n\tsetPropValue('length');\r\n\tsetPropValue('scale');\r\n\tsetPropValue('alignment');\r\n\tsetPropValue('formula');\r\n\tsetPropValue('defaultExpr');\r\n\tsetPropValue('defaultValue');\r\n\tsetPropValue('displayWidth');\r\n\tsetPropValue('editMask');\r\n\tsetPropValue('displayFormat');\r\n\tsetPropValue('nullText');\r\n\tsetPropValue('unitConverted');\r\n\tsetPropValue('editControl');\r\n\tsetPropValue('urlExpr');\r\n\tsetPropValue('urlTarget');\r\n\tsetPropValue('valueStyle');\r\n\t\r\n\tsetPropValue('valueCountLimit');\r\n\tsetPropValue('dataRange');\r\n\tsetPropValue('customValidator');\r\n\tsetPropValue('customValueConverter');\r\n\tsetPropValue('trueValue');\r\n\tsetPropValue('falseValue');\r\n\tsetPropValue('mergeSame');\r\n\tsetPropValue('mergeSameBy');\r\n\tsetPropValue('aggraded');\r\n\r\n\tsetPropValue('valueFollow');\r\n\tsetPropValue('aggradedBy');\r\n\tsetPropValue('mergeSameBy');\r\n\tsetPropValue('fixedValue');\r\n\tsetPropValue('antiXss');\r\n\tsetPropValue('validChars');\r\n\t\r\n\tsetPropValue('trueValue');\r\n\tsetPropValue('falseValue');\r\n\tsetPropValue('trueText');\r\n\tsetPropValue('falseText');\r\n\r\n\tvar regularExpr = cfg.regularExpr;\r\n\tvar regularMessage = cfg.regularMessage;\r\n\tif(regularExpr) {\r\n\t\tfldObj.regularExpr(regularExpr, regularMessage);\r\n\t}\r\n\t\r\n\tvar lkfCfg = cfg.lookup;\r\n\tif(lkfCfg === undefined) {\r\n\t\tvar lkDataset = cfg.lookupSource || cfg.lookupsource || cfg.lookupDataset || cfg.lookupdataset;\r\n\t\t\tlkParam = cfg.lookupParam || cfg.lookupparam,\r\n\t\t\trealDataset = cfg.realSource || cfg.realsource || cfg.realDataset || cfg.realdataset;\r\n\t\tif(lkDataset) {\r\n\t\t\tif(lkParam) {\r\n\t\t\t\tif (jslet.isString(lkParam)) {\r\n\t\t\t\t\tlkfCfg = jslet.JSON.parse(lkParam);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tlkfCfg = lkParam;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tlkfCfg = {};\r\n\t\t\t}\r\n\t\t\tlkfCfg.dataset = lkDataset;\r\n\t\t\tif(realDataset) {\r\n\t\t\t\tlkfCfg.realDataset = realDataset;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tif (lkfCfg !== undefined && lkfCfg) {\r\n\t\tif (jslet.isString(lkfCfg)) {\r\n\t\t\tlkfCfg = lkfCfg.trim();\r\n\t\t\tif(lkfCfg) {\r\n\t\t\t\tif(lkfCfg.trim().startsWith('{')) {\r\n\t\t\t\t\tlkfCfg = jslet.JSON.parse(lkfCfg);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tlkfCfg = {dataset: lkfCfg};\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tfldObj.lookup(jslet.data.createFieldLookup(lkfCfg, fldObj._dsName));\r\n\t}\r\n\tif (cfg.children){\r\n\t\tvar fldChildren = [], \r\n\t\t\tchildFldObj;\r\n\t\tfor(var i = 0, cnt = cfg.children.length; i < cnt; i++){\r\n\t\t\tchildFldObj = jslet.data.createField(cfg.children[i], fldObj);\r\n\t\t\tchildFldObj.displayOrder(i);\r\n\t\t\tfldChildren.push(childFldObj);\r\n\t\t}\r\n\t\tfldObj.children(fldChildren);\r\n\t\tfldObj.alignment('center');\r\n\t}\r\n\t\r\n\treturn fldObj;\r\n};\r\n\r\n/**\r\n * Create string field object.\r\n * \r\n * @param {String} fldName Field name.\r\n * @param {Integer} length Field length.\r\n * @param {jslet.data.Field} parent (Optional)Parent field object.\r\n * @return {jslet.data.Field}\r\n */\r\njslet.data.createStringField = function(fldName, length, parent) {\r\n\tvar fldObj = new jslet.data.Field(fldName, jslet.data.DataType.STRING, parent);\r\n\tfldObj.length(length);\r\n\treturn fldObj;\r\n};\r\n\r\n/**\r\n * Create number field object.\r\n * \r\n * @param {String} fldName Field name.\r\n * @param {Integer} length Field length.\r\n * @param {Integer} scale Field scale.\r\n * @param {jslet.data.Field} parent (Optional)Parent field object. It must be a 'Group' field.\r\n * @return {jslet.data.Field}\r\n */\r\njslet.data.createNumberField = function(fldName, length, scale, parent) {\r\n\tvar fldObj = new jslet.data.Field(fldName, jslet.data.DataType.NUMBER, parent);\r\n\tfldObj.length(length);\r\n\tfldObj.scale(scale);\r\n\treturn fldObj;\r\n};\r\n\r\n/**\r\n * Create boolean field object.\r\n * \r\n * @param {String} fldName Field name.\r\n * @param {jslet.data.Field} parent (Optional)Parent field object. It must be a 'Group' field.\r\n * @return {jslet.data.Field}\r\n */\r\njslet.data.createBooleanField = function(fldName, parent) {\r\n\treturn new jslet.data.Field(fldName, jslet.data.DataType.BOOLEAN, parent);\r\n};\r\n\r\n/**\r\n * Create date field object.\r\n * \r\n * @param {String} fldName Field name.\r\n * @param {jslet.data.Field} parent (Optional)Parent field object. It must be a 'Group' field.\r\n * @return {jslet.data.Field}\r\n */\r\njslet.data.createDateField = function(fldName, parent) {\r\n\tvar fldObj = new jslet.data.Field(fldName, jslet.data.DataType.DATE, parent);\r\n\treturn fldObj;\r\n};\r\n\r\n/**\r\n * Create dataset field object.\r\n * \r\n * @param {String} fldName Field name.\r\n * @param {jslet.data.Dataset} subDataset Detail dataset object.\r\n * @param {jslet.data.Field} parent (Optional)Parent field object. It must be a 'Group' field.\r\n * @return {jslet.data.Field}\r\n */\r\njslet.data.createDatasetField = function(fldName, subDataset, parent) {\r\n\tif (!subDataset) {\r\n\t\tthrow new Error('expected property:dataset in DatasetField!');\r\n\t}\r\n\tvar fldObj = new jslet.data.Field(fldName, jslet.data.DataType.DATASET, parent);\r\n\tfldObj.subDataset(subDataset);\r\n\tfldObj.visible(false);\r\n\treturn fldObj;\r\n};\r\n\r\n/**\r\n * Create group field object.\r\n * \r\n * @param {String} fldName Field name.\r\n * @param {String} fldName Field label.\r\n * @param {jslet.data.Field} parent (Optional)Parent field object. It must be a 'Group' field.\r\n * @return {jslet.data.Field}\r\n */\r\n//jslet.data.createGroupField = function(fldName, label, parent) {\r\n//\tvar fldObj = new jslet.data.Field(fldName, jslet.data.DataType.GROUP, parent);\r\n//\tfldObj.label(label);\r\n//\treturn fldObj;\r\n//};\r\n\r\njslet.data.createCrossField = function(fldName, crossSource, parent) {\r\n\tvar fldObj = new jslet.data.Field(fldName, jslet.data.DataType.CROSS, parent);\r\n\tfldObj.crossSource(crossSource);\r\n};\r\n\r\n/**\r\n * @class FieldLookup\r\n * \r\n * A lookup field represents a field value is from another dataset named \"Lookup Dataset\";\r\n */\r\njslet.data.FieldLookup = function() {\r\n\tvar Z = this;\r\n\tZ._hostDatasetName = null;\r\n\tZ._hostField = null;//The field which contains this lookup field object.\r\n\tZ._dataset = null;\r\n\tZ._realDataset = null;\r\n\tZ._dsParsed = false;\r\n\tZ._keyField = null;\r\n\tZ._codeField = null;\r\n\tZ._nameField = null;\r\n\tZ._codeFormat = null;\r\n\tZ._displayFields = null;\r\n\tZ._innerdisplayFields = null;\r\n\tZ._parentField = null;\r\n\tZ._onlyLeafLevel = true;\r\n\tZ._returnFieldMap = null;\r\n\tZ._editFilter = null;\r\n\tZ._editItemDisabled = false;\r\n};\r\njslet.data.FieldLookup.className = 'jslet.data.FieldLookup';\r\n\r\njslet.data.FieldLookup.prototype = {\r\n\tclassName: jslet.data.FieldLookup.className,\r\n\t\r\n\tclone: function(){\r\n\t\tvar Z = this, \r\n\t\t\tresult = new jslet.data.FieldLookup();\r\n\t\tresult.dataset(Z._dataset);\r\n\t\tresult.keyField(Z._keyField);\r\n\t\tresult.codeField(Z._codeField);\r\n\t\tresult.nameField(Z._nameField);\r\n\t\tresult.displayFields(Z._displayFields);\r\n\t\tresult.parentField(Z._parentField);\r\n\t\tresult.onlyLeafLevel(Z._onlyLeafLevel);\r\n\t\tresult.returnFieldMap(Z._returnFieldMap);\r\n\t\tresult.editFilter(Z._editFilter);\r\n\t\tresult.editItemDisabled(Z._editItemDisabled);\r\n\t\treturn result;\r\n\t},\r\n\t\r\n\thostField: function(fldObj) {\r\n\t\tvar Z = this;\r\n\t\tif (fldObj === undefined) {\r\n\t\t\treturn Z._hostField;\r\n\t\t}\r\n\t\tjslet.Checker.test('FieldLookup.hostField', fldObj).isClass(jslet.data.Field.className);\r\n\t\tZ._hostField = fldObj;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get or set lookup dataset.\r\n\t * \r\n\t * @param {jslet.data.Dataset or undefined} dataset Lookup dataset.\r\n\t * @return {jslet.data.Dataset or this}\r\n\t */\r\n\tdataset: function(lkdataset) {\r\n\t\tvar Z = this;\r\n\t\tif (lkdataset === undefined) {\r\n\t\t\tif(!Z._dsParsed) {\r\n\t\t\t\tZ.dataset(Z._dataset);\r\n\t\t\t\tif(!Z._dsParsed) {\r\n\t\t\t\t\tthrow new Error('Not found lookup dataset: ' + Z._dataset);\r\n\t\t\t\t}\t\t\t}\r\n\t\t\t\r\n\t\t\treturn Z._dataset;\r\n\t\t}\r\n\t\tvar lkDsName;\r\n\t\tif(lkdataset) {\r\n\t\t\tif (typeof(lkdataset) == 'string') {\r\n\t\t\t\tlkDsName = lkdataset;\r\n\t\t\t} else {\r\n\t\t\t\tlkDsName = lkdataset.name();\r\n\t\t\t}\r\n\t\t\tif(lkDsName == Z._hostDatasetName) {\r\n\t\t\t\tthrow new Error(jslet.locale.Dataset.LookupDatasetNotSameAsHost);\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar lkDsObj = lkdataset;\r\n\t\tif (typeof(lkDsObj) == 'string') {\r\n\t\t\tlkDsObj = jslet.data.getDataset(lkDsObj);\r\n\t\t\tif(!lkDsObj && jslet.data.onCreatingDataset) {\r\n\t\t\t\tjslet.data.onCreatingDataset(lkdataset, jslet.data.DatasetType.LOOKUP, Z._realDataset, Z._hostDatasetName); //1 - lookup dataset, 2 - subdataset\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(lkDsObj) {\r\n\t\t\tZ._dataset = lkDsObj;\r\n\t\t\tZ._dsParsed = true;\r\n\t\t} else {\r\n\t\t\tZ._dataset = lkdataset;\r\n\t\t\tZ._dsParsed = false;\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set key field.\r\n\t * Key field is optional, if it is null, it will use LookupDataset.keyField instead. \r\n\t * \r\n\t * @param {String or undefined} keyFldName Key field name.\r\n\t * @return {String or this}\r\n\t */\r\n\trealDataset: function(realDataset) {\r\n\t\tvar Z = this;\r\n\t\tif (realDataset === undefined){\r\n\t\t\treturn Z._realDataset;\r\n\t\t}\r\n\r\n\t\tjslet.Checker.test('FieldLookup.realDataset', realDataset).isString();\r\n\t\tZ._realDataset = realDataset;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get or set key field.\r\n\t * Key field is optional, if it is null, it will use LookupDataset.keyField instead. \r\n\t * \r\n\t * @param {String or undefined} keyFldName Key field name.\r\n\t * @return {String or this}\r\n\t */\r\n\tkeyField: function(keyFldName) {\r\n\t\tvar Z = this;\r\n\t\tif (keyFldName === undefined){\r\n\t\t\treturn Z._keyField || Z.dataset().keyField();\r\n\t\t}\r\n\r\n\t\tjslet.Checker.test('FieldLookup.keyField', keyFldName).isString();\r\n\t\tZ._keyField = jQuery.trim(keyFldName);\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set code field.\r\n\t * Code field is optional, if it is null, it will use LookupDataset.codeField instead. \r\n\t * \r\n\t * @param {String or undefined} codeFldName Code field name.\r\n\t * @return {String or this}\r\n\t */\r\n\tcodeField: function(codeFldName) {\r\n\t\tvar Z = this;\r\n\t\tif (codeFldName === undefined){\r\n\t\t\treturn Z._codeField || Z.dataset().codeField();\r\n\t\t}\r\n\r\n\t\tjslet.Checker.test('FieldLookup.codeField', codeFldName).isString();\r\n\t\tZ._codeField = jQuery.trim(codeFldName);\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\tcodeFormat: function(format) {\r\n\t\tvar Z = this;\r\n\t\tif (format === undefined) {\r\n\t\t\treturn Z._codeFormat;\r\n\t\t}\r\n\r\n\t\tjslet.Checker.test('FieldLookup.codeFormat', format).isString();\r\n\t\tZ._codeFormat = jQuery.trim(format);\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set name field.\r\n\t * Name field is optional, if it is null, it will use LookupDataset.nameField instead. \r\n\t * \r\n\t * @param {String or undefined} nameFldName Name field name.\r\n\t * @return {String or this}\r\n\t */\r\n\tnameField: function(nameFldName) {\r\n\t\tvar Z = this;\r\n\t\tif (nameFldName === undefined){\r\n\t\t\treturn Z._nameField || Z.dataset().nameField();\r\n\t\t}\r\n\r\n\t\tjslet.Checker.test('FieldLookup.nameField', nameFldName).isString();\r\n\t\tZ._nameField = jQuery.trim(nameFldName);\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set parent field.\r\n\t * Parent field is optional, if it is null, it will use LookupDataset.parentField instead. \r\n\t * \r\n\t * @param {String or undefined} parentFldName Parent field name.\r\n\t * @return {String or this}\r\n\t */\r\n\tparentField: function(parentFldName) {\r\n\t\tvar Z = this;\r\n\t\tif (parentFldName === undefined){\r\n\t\t\treturn Z._parentField || Z.dataset().parentField();\r\n\t\t}\r\n\r\n\t\tjslet.Checker.test('FieldLookup.parentField', parentFldName).isString();\r\n\t\tZ._parentField = jQuery.trim(parentFldName);\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * An expression for display field value. Example:\r\n\t * <pre><code>\r\n\t * lookupFldObj.displayFields('[code]-[name]'); \r\n\t * </code></pre>\r\n\t */\r\n\tdisplayFields: function(fieldExpr) {\r\n\t\tvar Z = this;\r\n\t\tif (fieldExpr === undefined) {\r\n\t\t\treturn Z._displayFields? Z._displayFields: this.getDefaultDisplayFields();\r\n\t\t}\r\n\t\tjslet.Checker.test('FieldLookup.displayFields', fieldExpr).isString();\r\n\t\tfieldExpr = jQuery.trim(fieldExpr);\r\n\t\tif (Z._displayFields != fieldExpr) {\r\n\t\t\tZ._displayFields = fieldExpr;\r\n\t\t\tZ._innerdisplayFields = null;\r\n\t\t\tif(Z._hostField) {\r\n\t\t\t\tZ._hostField._clearFieldCache();\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Return extra field values of lookup dataset into main dataset:\r\n\t * <pre><code>\r\n\t * lookupFldObj.returnFieldMap({\"main dataset field name\":\"lookup dataset field name\", ...}); \r\n\t * </code></pre>\r\n\t */\r\n\treturnFieldMap: function(returnFieldMap) {\r\n\t\tif(returnFieldMap === undefined) {\r\n\t\t\treturn this._returnFieldMap;\r\n\t\t}\r\n\t\tjslet.Checker.test('FieldLookup.returnFieldMap', returnFieldMap).isObject();\r\n\t\tthis._returnFieldMap = returnFieldMap;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @private\r\n\t */\r\n\tgetDefaultDisplayFields: function() {\r\n//\t\tvar expr = '[',fldName = this.codeField();\r\n//\t\tif (fldName) {\r\n//\t\t\texpr += fldName + ']';\r\n//\t\t}\r\n//\t\tfldName = this.nameField();\r\n//\r\n//\t\tif (fldName) {\r\n//\t\t\texpr += '+\"-\"+[';\r\n//\t\t\texpr += fldName + ']';\r\n//\t\t}\r\n//\t\tif (expr === '') {\r\n//\t\t\texpr = '\"Not set displayFields\"';\r\n//\t\t}\r\n//\t\t\r\n\t\tvar expr = '[' + this.nameField() + ']';\r\n\t\treturn expr;\r\n\t},\r\n\r\n\t/**\r\n\t * @private\r\n\t */\r\n\tgetCurrentDisplayValue: function() {\r\n\t\tvar Z = this;\r\n\t\tif (Z._displayFields === null) {\r\n\t\t\tthis.displayFields(this.getDefaultDisplayFields());\r\n\t\t}\r\n\t\tif(!Z._innerdisplayFields) {\r\n\t\t\tZ._innerdisplayFields = new jslet.Expression(Z.dataset(), Z.displayFields());\r\n\t\t}\r\n\t\t\r\n\t\treturn Z._innerdisplayFields.eval();\r\n\t},\r\n\r\n\t/**\r\n\t * Identify whether user can select leaf level item if lookup dataset is a tree-style dataset.\r\n\t * \r\n\t * @param {Boolean or undefined} flag True - Only leaf level item user can selects, false - otherwise.\r\n\t * @return {Boolean or this}\r\n\t */\r\n\tonlyLeafLevel: function(flag) {\r\n\t\tvar Z = this;\r\n\t\tif (flag === undefined) {\r\n\t\t\treturn Z._onlyLeafLevel;\r\n\t\t}\r\n\t\tZ._onlyLeafLevel = flag ? true: false;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * An expression for display field value. Example:\r\n\t * <pre><code>\r\n\t * lookupFldObj.editFilter('like([code], \"101%\" '); \r\n\t * </code></pre>\r\n\t * \r\n\t * @param {String or undefined} flag True - Only leaf level item user can selects, false - otherwise.\r\n\t * @return {String or this}\r\n\t */\r\n\teditFilter: function(editFilter) {\r\n\t\tvar Z = this;\r\n\t\tif (editFilter === undefined) {\r\n\t\t\treturn Z._editFilter;\r\n\t\t}\r\n\t\tjslet.Checker.test('FieldLookup.editFilter', editFilter).isString();\r\n\t\t\r\n\t\tif (Z._editFilter != editFilter) {\r\n\t\t\tZ._editFilter = editFilter;\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Disable or hide the edit item which not match the 'editFilter'.\r\n\t * editItemDisabled is true, the non-matched item will be disabled, not hidden.\r\n\t * \r\n\t * @param {Boolean or undefined} editItemDisabled - true: disable edit item, false: hide edit item, default is true.\r\n\t * @return {Boolean or this}\r\n\t */\r\n\teditItemDisabled: function(editItemDisabled) {\r\n\t\tvar Z = this;\r\n\t\tif (editItemDisabled === undefined) {\r\n\t\t\treturn Z._editItemDisabled;\r\n\t\t}\r\n\t\t\r\n\t\tZ._editItemDisabled = editItemDisabled? true: false;\r\n\t\treturn this;\r\n\t}\r\n\t\r\n};\r\n\r\n/**\r\n * Create lookup field object.\r\n * \r\n * @param {Json Object} param A json object which property names are same as jslet.data.FieldLookup. Example: {dataset: fooDataset, keyField: 'xxx', ...}\r\n * @return {jslet.data.FieldLookup}\r\n */\r\njslet.data.createFieldLookup = function(param, hostDsName) {\r\n\tjslet.Checker.test('createFieldLookup#param', param).required().isObject();\r\n\tvar lkds = param.dataset;\r\n\tif (!lkds) {\r\n\t\tthrow new Error('Property: dataset required!');\r\n\t}\r\n\tvar lkFldObj = new jslet.data.FieldLookup();\r\n\t\tlkFldObj._hostDatasetName = hostDsName;\r\n\tif (param.realDataset !== undefined) {\r\n\t\tlkFldObj.realDataset(param.realDataset);\r\n\t}\r\n\tlkFldObj.dataset(lkds);\r\n\tif (param.keyField !== undefined) {\r\n\t\tlkFldObj.keyField(param.keyField);\r\n\t}\r\n\tif (param.codeField !== undefined) {\r\n\t\tlkFldObj.codeField(param.codeField);\r\n\t}\r\n\tif (param.nameField !== undefined) {\r\n\t\tlkFldObj.nameField(param.nameField);\r\n\t}\r\n\tif (param.codeFormat !== undefined) {\r\n\t\tlkFldObj.codeFormat(param.codeFormat);\r\n\t}\r\n\tif (param.displayFields !== undefined) {\r\n\t\tlkFldObj.displayFields(param.displayFields);\r\n\t}\r\n\tif (param.parentField !== undefined) {\r\n\t\tlkFldObj.parentField(param.parentField);\r\n\t}\r\n\tif (param.onlyLeafLevel !== undefined) {\r\n\t\tlkFldObj.onlyLeafLevel(param.onlyLeafLevel);\r\n\t}\r\n\tif (param.returnFieldMap !== undefined) {\r\n\t\tlkFldObj.returnFieldMap(param.returnFieldMap);\r\n\t}\r\n\tif (param.editFilter !== undefined) {\r\n\t\tlkFldObj.editFilter(param.editFilter);\r\n\t}\r\n\tif (param.editItemDisabled !== undefined) {\r\n\t\tlkFldObj.editItemDisabled(param.editItemDisabled);\r\n\t}\r\n\t\r\n\treturn lkFldObj;\r\n};\r\n\r\njslet.data.CrossFieldSource = function() {\r\n\tvar Z = this;\r\n\t\r\n\tZ._sourceType = 0; //Optional value: 0-field, 1-custom'\r\n\tZ._sourceField = null;\r\n\tZ._lookupLevel = 1;\r\n\t\r\n\tZ._labels = null;\r\n\tZ._values = null;\r\n\tZ._matchExpr = null;\r\n\t\r\n\tZ._hideEmptyValue = false;\r\n\tZ._hasSubtotal = true;\r\n\tZ._subtotalPosition = 1; //Optional value: 0-first, 1-end\r\n\tZ._subtotalLabel = null;\t\t\r\n};\r\njslet.data.CrossFieldSource.className = 'jslet.data.CrossFieldSource';\r\n\r\njslet.data.CrossFieldSource.prototype = {\r\n\tclassName: jslet.data.CrossFieldSource.className,\r\n\t\r\n\tclone: function(){\r\n\t\tvar Z = this, \r\n\t\t\tresult = new jslet.data.CrossFieldSource();\r\n\t\tresult.sourceType(Z._sourceType);\r\n\t\tresult.sourceField(Z._sourceField);\r\n\t\tresult.lookupLevel(Z._lookupLevel);\r\n\t\tresult.labels(Z._labels);\r\n\t\tresult.values(Z._values);\r\n\t\tresult.matchExpr(Z._matchExpr);\r\n\t\tresult.hideEmptyValue(Z._hideEmptyValue);\r\n\t\tresult.hasSubtotal(Z._hasSubtotal);\r\n\t\tresult.subtotalPosition(Z._subtotalPosition);\r\n\t\tresult.subtotalLabel(Z._subtotalLabel);\r\n\t\treturn result;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Cross source type, optional value: 0 - field, 1 - custom.\r\n\t * \r\n\t * @param {Number or undefined} sourceType Cross source type.\r\n\t * @return {Number or this}\r\n\t */\r\n\tsourceType: function(sourceType) {\r\n\t\tvar Z = this;\r\n\t\tif (sourceType === undefined) {\r\n\t\t\treturn Z._sourceType;\r\n\t\t}\r\n\t\tjslet.Checker.test('CrossFieldSource.sourceType', sourceType).isNumber();\r\n\t\tZ._sourceType = sourceType;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Identify the field name which is used to create cross field. Avaliable when crossType is 0-Field.\r\n\t * sourceField must be a lookup field and required. \r\n\t * \r\n\t * @param {String or undefined} sourceField The field name which is used to create cross field.\r\n\t * @return {String or this}\r\n\t */\r\n\tsourceField: function(sourceField) {\r\n\t\tvar Z = this;\r\n\t\tif (sourceField === undefined) {\r\n\t\t\treturn Z._sourceField;\r\n\t\t}\r\n\t\tjslet.Checker.test('CrossFieldSource.sourceField', sourceField).isString();\r\n\t\tZ._sourceField = sourceField;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Identify cross field labels. Avaliable when crossType is 1-Field.\r\n\t * If labels is null, use \"values\" as \"labels\" instead.\r\n\t * \r\n\t * @param {String[] or undefined} labels The cross field labels.\r\n\t * @return {String[] or this}\r\n\t */\r\n\tlabels: function(labels) {\r\n\t\tvar Z = this;\r\n\t\tif (labels === undefined) {\r\n\t\t\treturn Z._labels;\r\n\t\t}\r\n\t\tjslet.Checker.test('CrossFieldSource.labels', labels).isArray();\r\n\t\tZ._labels = labels;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Identify cross field cross values. Avaliable when crossType is 1-Field.\r\n\t * If crossType is 1-Field, \"values\" is reqired.\r\n\t * \r\n\t * @param {Object[] or undefined} values The cross field source values.\r\n\t * @return {Object[] or this}\r\n\t */\r\n\tvalues: function(values) {\r\n\t\tvar Z = this;\r\n\t\tif (values === undefined) {\r\n\t\t\treturn Z._values;\r\n\t\t}\r\n\t\tjslet.Checker.test('CrossFieldSource.values', values).isArray();\r\n\t\tZ._values = values;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Identify the field name which is used to create cross field. Avaliable when crossType is 1-Custom.\r\n\t * If crossType is 1-Custom, matchExpr is required. \r\n\t * \r\n\t * @param {String or undefined} matchExpr The expression which use to match value.\r\n\t * @return {String or this}\r\n\t */\r\n\tmatchExpr: function(matchExpr) {\r\n\t\tvar Z = this;\r\n\t\tif (matchExpr === undefined) {\r\n\t\t\treturn Z._matchExpr;\r\n\t\t}\r\n\t\tjslet.Checker.test('CrossFieldSource.matchExpr', matchExpr).isString();\r\n\t\tZ._matchExpr = matchExpr;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Identify it has subtotal column or not.\r\n\t * \r\n\t * @param {Boolean or undefined} hasSubtotal True - has subtotal, false otherwise.\r\n\t * @return {Boolean or this}\r\n\t */\r\n\thasSubtotal: function(hasSubtotal) {\r\n\t\tvar Z = this;\r\n\t\tif (hasSubtotal === undefined) {\r\n\t\t\treturn Z._hasSubtotal;\r\n\t\t}\r\n\t\tjslet.Checker.test('CrossFieldSource.hasSubtotal', hasSubtotal).isString();\r\n\t\tZ._hasSubtotal = hasSubtotal;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Identify the \"subtotal\" column position. Avaliable when \"hasSubtotal\" is true;\r\n\t * Optional Value: 0 - At first column, 1 - At last column.\r\n\t * \r\n\t * @param {Number or undefined} subtotalPosition subtotal column position.\r\n\t * @return {Number or this}\r\n\t */\r\n\tsubtotalPosition: function(subtotalPosition) {\r\n\t\tvar Z = this;\r\n\t\tif (subtotalPosition === undefined) {\r\n\t\t\treturn Z._subtotalPosition;\r\n\t\t}\r\n\t\tjslet.Checker.test('CrossFieldSource.subtotalPosition', subtotalPosition).isNumber();\r\n\t\tZ._subtotalPosition = subtotalPosition;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Subtotal label. Avaliable when \"hasSubtotal\" is true;\r\n\t * \r\n\t * @param {String or undefined} subtotalLabel Subtotal label.\r\n\t * @return {String or this}\r\n\t */\r\n\tsubtotalLabel: function(subtotalLabel) {\r\n\t\tvar Z = this;\r\n\t\tif (subtotalLabel === undefined) {\r\n\t\t\treturn Z._subtotalLabel;\r\n\t\t}\r\n\t\tjslet.Checker.test('CrossFieldSource.subtotalLabel', subtotalLabel).isString();\r\n\t\tZ._subtotalLabel = subtotalLabel;\r\n\t\treturn this;\r\n\t}\r\n}\r\n\r\njslet.data.createCrossFieldSource = function(cfg) {\r\n\tvar result = new jslet.data.CrossFieldSource();\r\n\tvar srcType = cfg.sourceType || 0;\r\n\tresult.sourceType(srcType);\r\n\tif(cfg.hasSubtotal !== undefined) {\r\n\t\tresult.hasSubtotal(cfg.hasSubtotal);\r\n\t}\r\n\t\r\n\tif(cfg.subtotalPosition !== undefined) {\r\n\t\tresult.subtotalPosition(cfg.subtotalPosition);\r\n\t}\r\n\t\r\n\tif(cfg.subtotalLabel !== undefined) {\r\n\t\tresult.subtotalLabel(cfg.subtotalLabel);\r\n\t}\r\n\t\r\n\tif(srcType === 0) {\r\n\t\tresult.sourceField(cfg.sourceField);\r\n\t} else {\r\n\t\tresult.labels(cfg.labels);\r\n\t\tresult.values(cfg.values);\r\n\t\tresult.matchExpr(cfg.matchExpr);\r\n\t}\r\n\treturn result;\r\n}\r\n\r\n/* ========================================================================\r\n * Jslet framework: jslet.provider.js\r\n *\r\n * Copyright (c) 2014 Jslet Group(https://github.com/jslet/jslet/)\r\n * Licensed under MIT (https://github.com/jslet/jslet/LICENSE.txt)\r\n * ======================================================================== */\r\n\r\nif (!jslet.data) {\r\n\tjslet.data = {};\r\n}\r\n\r\n/**\r\n * @static\r\n * @private\r\n * \r\n */\r\njslet.data.ApplyAction = {QUERY: 'query', SAVE: 'save', SELECTED: 'selected'};\r\n\r\n/**\r\n * @class jslet.data.DataProvider\r\n * \r\n * @required\r\n */\r\njslet.data.DataProvider = function() {\r\n\t\r\n\t/**\r\n\t * @param dataset jslet.data.Dataset;\r\n\t * @param url String the request url;\r\n\t * @param reqData String the request data which need to send to server.\r\n\t */\r\n\tthis.sendRequest = function(dataset, url, reqData) {\r\n\t\tvar settings;\r\n\t\tif(jslet.global.beforeSubmit) {\r\n\t\t\tsettings = jslet.global.beforeSubmit({url: url});\r\n\t\t}\r\n\t\tif(!settings) {\r\n\t\t\tsettings = {}\r\n\t\t}\r\n\t\tsettings.type = 'POST';\r\n\t\tsettings.contentType = 'application/json';\r\n\t\tsettings.mimeType = 'application/json';\r\n\t\tsettings.dataType = 'json';\r\n\t\tsettings.data = reqData;\r\n\t\tsettings.context = dataset;\r\n\t\tif(dataset.csrfToken) {\r\n\t\t\tvar headers = settings.headers || {};\r\n\t\t\theaders.csrfToken = dataset.csrfToken;\r\n\t\t\tsettings.headers = headers;\r\n\t\t}\r\n\t\t\r\n\t\tvar defer = jQuery.Deferred();\r\n\t\tjQuery.ajax(url, settings)\r\n\t\t.done(function(data, textStatus, jqXHR) {\r\n\t\t\tif(data) {\r\n\t\t\t\tif(data.csrfToken) {\r\n\t\t\t\t\tthis.csrfToken = data.csrfToken;\r\n\t\t\t\t}\r\n\t\t\t\tvar errorCode = data.errorCode;\r\n\t\t\t\tif (errorCode) {\r\n\t\t\t\t\tdefer.reject(data, this);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tdefer.resolve(data, this);\r\n\t\t})\r\n\t\t.fail(function( jqXHR, textStatus, errorThrown ) {\r\n\t\t\tvar data = jqXHR.responseJSON,\r\n\t\t\t\tresult;\r\n\t\t\tif(data && data.errorCode) {\r\n\t\t\t\tresult = {errorCode: data.errorCode, errorMessage: data.errorMessage};\r\n\t\t\t} else {\r\n\t\t\t\tif(textStatus == 'error') {\r\n\t\t\t\t\terrorCode = '0000';\r\n\t\t\t\t\terrorMessage = jslet.locale.Common.ConnectError;\r\n\t\t\t\t}\r\n\t\t\t\tresult = {errorCode: errorCode, errorMessage: errorMessage};\r\n\t\t\t}\r\n\t\t\tdefer.reject(result, this);\r\n\t\t})\r\n\t\t.always(function(dataOrJqXHR, textStatus, jqXHRorErrorThrown) {\r\n\t\t\tif(jQuery.isFunction(dataOrJqXHR.done)) { //fail\r\n\t\t\t\tvar data = dataOrJqXHR.responseJSON,\r\n\t\t\t\t\tresult;\r\n\t\t\t\tif(data && data.errorCode) {\r\n\t\t\t\t\tresult = {errorCode: data.errorCode, errorMessage: data.errorMessage};\r\n\t\t\t\t} else {\r\n\t\t\t\t\tresult = {errorCode: textStatus, errorMessage: jqXHRorErrorThrown};\r\n\t\t\t\t}\r\n\t\t\t\tdefer.always(result, this);\r\n\t\t\t} else {\r\n\t\t\t\tdefer.always(dataOrJqXHR, this);\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn defer.promise();\r\n\t};\r\n};\r\n\r\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./build/jslet-data.debug.js\n ** module id = 11\n ** module chunks = 0 1 2 3 4 5 6\n **/","/*!\r\n * jQuery.tabbable 1.0 - Simple utility for selecting the next / previous ':tabbable' element.\r\n * https://github.com/marklagendijk/jQuery.tabbable\r\n *\r\n * Includes ':tabbable' and ':focusable' selectors from jQuery UI Core\r\n *\r\n * Copyright 2013, Mark Lagendijk\r\n * Released under the MIT license\r\n *\r\n */\r\n(function($){\r\n\t'use strict';\r\n\r\n\t/**\r\n\t * Focusses the next :focusable element. Elements with tabindex=-1 are focusable, but not tabable.\r\n\t * Does not take into account that the taborder might be different as the :tabbable elements order\r\n\t * (which happens when using tabindexes which are greater than 0).\r\n\t */\r\n\t$.focusNext = function(container, isLoop, onChangingFocus){\r\n\t\tselectNextTabbableOrFocusable(':focusable', container, isLoop, onChangingFocus);\r\n\t};\r\n\r\n\t/**\r\n\t * Focusses the previous :focusable element. Elements with tabindex=-1 are focusable, but not tabable.\r\n\t * Does not take into account that the taborder might be different as the :tabbable elements order\r\n\t * (which happens when using tabindexes which are greater than 0).\r\n\t */\r\n\t$.focusPrev = function(container, isLoop, onChangingFocus){\r\n\t\treturn selectPrevTabbableOrFocusable(':focusable', container, isLoop, onChangingFocus);\r\n\t};\r\n\r\n\t/**\r\n\t * Focusses the next :tabable element.\r\n\t * Does not take into account that the taborder might be different as the :tabbable elements order\r\n\t * (which happens when using tabindexes which are greater than 0).\r\n\t */\r\n\t$.tabNext = function(container, isLoop, onChangingFocus){\r\n\t\treturn selectNextTabbableOrFocusable(':tabbable', container, isLoop, onChangingFocus);\r\n\t};\r\n\r\n\t/**\r\n\t * Focusses the previous :tabbable element\r\n\t * Does not take into account that the taborder might be different as the :tabbable elements order\r\n\t * (which happens when using tabindexes which are greater than 0).\r\n\t */\r\n\t$.tabPrev = function(container, isLoop, onChangingFocus){\r\n\t\treturn selectPrevTabbableOrFocusable(':tabbable', container, isLoop, onChangingFocus);\r\n\t};\r\n\r\n\tfunction selectNextTabbableOrFocusable(selector, container, isLoop, onChangingFocus){\r\n\t\tif(!container) {\r\n\t\t\tcontainer = document;\r\n\t\t}\r\n\t\tvar selectables = jQuery(container).find(selector);\r\n\t\tsortByTabIndex(selectables);\r\n\t\tvar current = $(':focus');\r\n\t\tvar nextIndex = 0;\r\n\t\tvar currEle = null;\r\n\t\tif(current.length === 1){\r\n\t\t\tcurrEle = current[0];\r\n\t\t\tvar currentIndex = selectables.index(current);\r\n\t\t\tif(currentIndex + 1 < selectables.length){\r\n\t\t\t\tnextIndex = currentIndex + 1;\r\n\t\t\t} else {\r\n\t\t\t\tif(isLoop) {\r\n\t\t\t\t\tnextIndex = 0;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar canFocus = true;\r\n\t\tif(onChangingFocus && currEle) {\r\n\t\t\tcanFocus = onChangingFocus(currEle, false);\r\n\t\t}\r\n\t\tif(canFocus) {\r\n\t\t\tvar jqEl = selectables.eq(nextIndex);\r\n\t\t\tjqEl.focus();\r\n\t\t\treturn jqEl[0];\r\n\t\t} else {\r\n\t\t\treturn currEle;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction selectPrevTabbableOrFocusable(selector, container, isLoop, onChangingFocus){\r\n\t\tif(!container) {\r\n\t\t\tcontainer = document;\r\n\t\t}\r\n\t\tvar selectables = jQuery(container).find(selector);\r\n\t\tsortByTabIndex(selectables);\r\n\t\tvar current = $(':focus');\r\n\t\tvar prevIndex = selectables.length - 1;\r\n\t\tvar currEle = null;\r\n\t\tif(current.length === 1){\r\n\t\t\tcurrEle = current[0];\r\n\t\t\tvar currentIndex = selectables.index(current);\r\n\t\t\tif(currentIndex > 0){\r\n\t\t\t\tprevIndex = currentIndex - 1;\r\n\t\t\t} else {\r\n\t\t\t\tif(isLoop) {\r\n\t\t\t\t\tprevIndex = selectables.length - 1;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar canFocus = true;\r\n\t\tif(onChangingFocus && currEle) {\r\n\t\t\tcanFocus = onChangingFocus(currEle, true);\r\n\t\t}\r\n\t\tif(canFocus) {\r\n\t\t\tvar jqEl = selectables.eq(prevIndex);\r\n\t\t\tjqEl.focus();\r\n\t\t\treturn jqEl[0];\r\n\t\t} else {\r\n\t\t\treturn currEle;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction sortByTabIndex(items) {\r\n\t\tif(!items) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tvar item, item1, k;\r\n\t\tfor(var i = 1, len = items.length; i < len; i++) {\r\n\t\t\titem = items[i];\r\n\t\t\tk = 0;\r\n\t\t\tfor(var j = i - 1; j >= 0; j--) {\r\n\t\t\t\titem1 = items[j];\r\n\t\t\t\tif(item1.tabIndex <= item.tabIndex) {\r\n\t\t\t\t\tk = j + 1;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t} //end for j\r\n\t\t\tif(i !== k) {\r\n\t\t\t\titems.splice(i, 1);\r\n\t\t\t\titems.splice(k, 0, item);\r\n\t\t\t}\r\n\t\t} //end for i\r\n\t}\r\n\t\r\n\t/**\r\n\t * :focusable and :tabbable, both taken from jQuery UI Core\r\n\t */\r\n\t$.extend($.expr[ ':' ], {\r\n\t\tdata: $.expr.createPseudo ?\r\n\t\t\t$.expr.createPseudo(function(dataName){\r\n\t\t\t\treturn function(elem){\r\n\t\t\t\t\treturn !!$.data(elem, dataName);\r\n\t\t\t\t};\r\n\t\t\t}) :\r\n\t\t\t// support: jQuery <1.8\r\n\t\t\tfunction(elem, i, match){\r\n\t\t\t\treturn !!$.data(elem, match[ 3 ]);\r\n\t\t\t},\r\n\r\n\t\tfocusable: function(element){\r\n\t\t\treturn focusable(element, !isNaN($.attr(element, 'tabindex')));\r\n\t\t},\r\n\r\n\t\ttabbable: function(element){\r\n\t\t\tvar tabIndex = $.attr(element, 'tabindex'),\r\n\t\t\t\tisTabIndexNaN = isNaN(tabIndex);\r\n\t\t\treturn ( isTabIndexNaN || tabIndex >= 0 ) && focusable(element, !isTabIndexNaN);\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t * focussable function, taken from jQuery UI Core\r\n\t * @param element\r\n\t * @returns {*}\r\n\t */\r\n\tfunction focusable(element){\r\n\t\tvar map, mapName, img,\r\n\t\t\tnodeName = element.nodeName.toLowerCase(),\r\n\t\t\tisTabIndexNotNaN = !isNaN($.attr(element, 'tabindex'));\r\n\t\tif('area' === nodeName){\r\n\t\t\tmap = element.parentNode;\r\n\t\t\tmapName = map.name;\r\n\t\t\tif(!element.href || !mapName || map.nodeName.toLowerCase() !== 'map'){\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\timg = $('img[usemap=#' + mapName + ']')[0];\r\n\t\t\treturn !!img && visible(img);\r\n\t\t}\r\n\t\treturn ( /input|select|textarea/.test(nodeName) ?\r\n\t\t\t!element.disabled :\r\n\t\t\t'a' === nodeName ?\r\n\t\t\t\telement.href || isTabIndexNotNaN :\r\n\t\t\t\tisTabIndexNotNaN) &&\r\n\t\t\t// the element and all of its ancestors must be visible\r\n\t\t\tvisible(element);\r\n\r\n\t\tfunction visible(element){\r\n\t\t\treturn $.expr.filters.visible(element) && !$(element).parents().addBack().filter(function(){\r\n\t\t\t\treturn $.css(this, 'visibility') === 'hidden';\r\n\t\t\t}).length;\r\n\t\t}\r\n\t}\r\n})(jQuery);\r\n\n/* ========================================================================\r\n * Jslet framework: jslet.control.js\r\n *\r\n * Copyright (c) 2014 Jslet Group(https://github.com/jslet/jslet/)\r\n * Licensed under MIT (https://github.com/jslet/jslet/LICENSE.txt)\r\n * ======================================================================== */\r\n\r\nif(!jslet.ui) {\r\n\tjslet.ui = {};\r\n}\r\n\r\n/**\r\n* @class\r\n* Control Class, base class for all control\r\n*/\r\njslet.ui.Control = jslet.Class.create({\r\n\t/**\r\n\t * Constructor method\r\n\t * \r\n\t * @param {Html Element} el Html element\r\n\t * @param {String or Object} ctrlParams Parameters of this control, \r\n\t * it would be a JSON string or plan object, like: '{prop1: value1, prop2: value2}';\r\n\t */\r\n\tinitialize: function (el, ctrlParams) {\r\n\t\tthis.el = el;\r\n\r\n\t\tthis.allProperties = null;\r\n\t\tctrlParams = jslet.ui._evalParams(ctrlParams);\r\n\t\tif (this.isValidTemplateTag\t&& !this.isValidTemplateTag(this.el)) {\r\n\t\t\tvar ctrlClass = jslet.ui.getControlClass(ctrlParams.type), template;\r\n\t\t\tif (ctrlClass) {\r\n\t\t\t\ttemplate = ctrlClass.htmlTemplate;\r\n\t\t\t} else {\r\n\t\t\t\ttemplate = '';\r\n\t\t\t}\r\n\t\t\tthrow new Error(jslet.formatString(jslet.locale.DBControl.invalidHtmlTag, template));\r\n\t\t}\r\n\r\n\t\tthis._childControls = null;\r\n\t\tthis.setParams(ctrlParams);\r\n\t\tthis.checkRequiredProperty();\r\n\t\tthis.el.jslet = this;\r\n\t\tthis.beforeBind();\r\n\t\tthis.bind();\r\n\t\tthis.afterBind();\r\n\t},\r\n\r\n\tbeforeBind: function() {\r\n\t\t\r\n\t},\r\n\t\r\n\tbind: function() {\r\n\t\t\r\n\t},\r\n\t\r\n\tafterBind: function() {\r\n\t\t\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t */\r\n\tsetParams: function (ctrlParams) {\r\n\t\tif (!ctrlParams) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar ctrlType = ctrlParams.type;\r\n\t\t\r\n\t\tfor(var name in ctrlParams) {\r\n\t\t\tvar prop = this[name];\r\n\t\t\tif(name == 'type') {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif(prop && prop.call) {\r\n\t\t\t\tprop.call(this, ctrlParams[name]);\r\n\t\t\t} else {\r\n\t\t\t\tthrow new Error(ctrlType +  \" NOT support control property: \" + name);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * @private\r\n\t */\r\n\tcheckRequiredProperty: function () {\r\n\t\tif (!this.requiredProperties) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar arrProps = this.requiredProperties.split(','),\r\n\t\tcnt = arrProps.length, name;\r\n\t\tfor (var i = 0; i < cnt; i++) {\r\n\t\t\tname = arrProps[i].trim();\r\n\t\t\tif (!this[name]) {\r\n\t\t\t\tthrow new Error(jslet.formatString(jslet.locale.DBControl.expectedProperty, [name]));\r\n\t\t\t}\r\n\t\t}//end for\r\n\t},\r\n\t\r\n\taddChildControl: function(childCtrl) {\r\n\t\tvar Z = this;\r\n\t\tif(!Z._childControls) {\r\n\t\t\tZ._childControls = [];\r\n\t\t}\r\n\t\tif(childCtrl) {\r\n\t\t\tZ._childControls.push(childCtrl);\r\n\t\t}\r\n\t},\r\n\t\r\n\tremoveAllChildControls: function() {\r\n\t\tvar Z = this, childCtrl;\r\n\t\tif(!Z._childControls) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tfor(var i = 0, len = Z._childControls.length; i < len; i++) {\r\n\t\t\tchildCtrl = Z._childControls[i];\r\n\t\t\tchildCtrl.destroy();\r\n\t\t}\r\n\t\tZ._childControls = null;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Destroy method\r\n\t */\r\n\tdestroy: function(){\r\n\t\tif(this.el) {\r\n\t\t\tthis.el.jslet = null;\r\n\t\t\tthis.el = null;\r\n\t\t}\r\n\t}\r\n});\r\n\r\n/**\r\n * @class\r\n * Base data sensitive control\r\n */\r\njslet.ui.DBControl = jslet.Class.create(jslet.ui.Control, {\r\n\t\r\n\tinitialize: function ($super, el, ctrlParams) {\r\n\t\t$super(el, ctrlParams);\r\n\t},\r\n\r\n\t_dataset: undefined,\r\n\r\n\tdataset: function(dataset) {\r\n\t\tif(dataset === undefined) {\r\n\t\t\treturn this._dataset;\r\n\t\t}\r\n\r\n\t\tif (jslet.isString(dataset)) {\r\n\t\t\tdataset = jslet.data.dataModule.get(jQuery.trim(dataset));\r\n\t\t}\r\n\t\t\r\n\t\tjslet.Checker.test('DBControl.dataset', dataset).required().isClass(jslet.data.Dataset.className);\r\n\t\tthis._dataset = dataset;\r\n\t},\r\n\r\n\t/**\r\n\t * @protected\r\n\t */\r\n\tsetParams: function ($super, ctrlParams) {\r\n\t\t$super(ctrlParams);\r\n\t\tif(!this._dataset) {\r\n\t\t\tvar dsName = this.getDatasetInParentElement();\r\n\t\t\tthis.dataset(dsName);\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t * Call this method before binding parameters to a HTML element, you can rewrite this in your owner control\r\n\t * @param {String or Object} ctrlParams Parameters of this control, it would be a json string or object, like: '{prop1: value1, prop2: value2}';\r\n\t * \r\n\t */\r\n\tbeforeBind: function ($super) {\r\n\t\t$super();\r\n\t\tthis._dataset.addLinkedControl(this);\r\n\t},\r\n\r\n\tcheckRequiredProperty: function($super) {\r\n\t\tjslet.Checker.test('DBControl.dataset', this._dataset).required();\r\n\t\t$super();\r\n\t},\r\n\t\r\n\t/**\r\n\t * Refresh control when data changed.\r\n\t * There are three type changes: meta changed, data changed, lookup data changed.\r\n\t * \r\n\t * @param {jslet.data.refreshEvent} evt jslet refresh event object;\r\n\t * @isForce {Boolean} Identify refresh control anyway or not.\r\n\t * \r\n\t * @return {Boolean} if refresh successfully, return true, otherwise false.\r\n\t */\r\n\trefreshControl: function (evt, isForce) {\r\n\t\tvar Z = this,\r\n\t\t\tevtType = evt.eventType;\r\n\t\t// Meta changed \r\n\t\tif (evtType == jslet.data.RefreshEvent.CHANGEMETA) {\r\n\t\t\tvar metaName = evt.metaName,\r\n\t\t\t\tchangeAllRows = evt.changeAllRows;\r\n\t\t\tif(Z._field && Z._field == evt.fieldName) {\r\n\t\t\t\tif (!changeAllRows && !isForce && !Z.isActiveRecord()) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t\tZ.doMetaChanged(metaName);\r\n\t\t\t} else {\r\n\t\t\t\tif(!Z._field && (metaName == 'visible' || metaName == 'editControl')) {\r\n\t\t\t\t\tZ.doMetaChanged(metaName);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\t//Lookup data changed\r\n\t\tif(evtType == jslet.data.RefreshEvent.UPDATELOOKUP && evt.fieldName == Z._field) {\r\n\t\t\tif(Z._ctrlRecno >= 0 && (evt.recno || evt.recno === 0)) {\r\n\t\t\t\tif(Z._ctrlRecno === evt.recno) {\r\n\t\t\t\t\tZ.doLookupChanged();\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tZ.doLookupChanged();\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\tif (!isForce && Z.isActiveRecord && !Z.isActiveRecord()) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\t//Value changed\r\n\t\tif (evtType == jslet.data.RefreshEvent.SCROLL || \r\n\t\t\t\tevtType == jslet.data.RefreshEvent.INSERT ||\r\n\t\t\t\tevtType == jslet.data.RefreshEvent.DELETE) {\r\n\t\t\tZ.doValueChanged();\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tif((evtType == jslet.data.RefreshEvent.UPDATERECORD ||\r\n\t\t\tevtType == jslet.data.RefreshEvent.UPDATECOLUMN) && \r\n\t\t\tevt.fieldName === undefined || evt.fieldName == Z._field){\r\n\t\t\tZ.doValueChanged();\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tif(evtType == jslet.data.RefreshEvent.UPDATEALL) {\r\n\t\t\tZ.doMetaChanged();\r\n\t\t\tZ.doLookupChanged();\r\n\t\t\tZ.doValueChanged();\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\t\r\n\t\treturn true;\r\n\t}, // end refreshControl\r\n\t\r\n\t/**\r\n\t * \r\n\t */\r\n\tdoMetaChanged: function(metaName){},\r\n\t\r\n\tdoValueChanged: function() {},\r\n\t\r\n\tdoLookupChanged: function() {},\r\n\t\r\n\t/**\r\n\t * @private\r\n\t */\r\n\tgetDatasetInParentElement: function () {\r\n\t\tvar el = this.el, pEl = null;\r\n\t\twhile (true) {\r\n\t\t\tpEl = jslet.ui.getParentElement(el, 1);\r\n\t\t\tif (!pEl) {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tif (pEl.jslet) {\r\n\t\t\t\treturn pEl.jslet.dataset;\r\n\t\t\t}\r\n\t\t\tel = pEl;\r\n\t\t} //end while\r\n\t\treturn null;\r\n\t},\r\n\r\n\tdestroy: function ($super) {\r\n\t\tthis.removeAllChildControls();\r\n\t\tif (this._dataset) {\r\n\t\t\tthis._dataset.removeLinkedControl(this);\r\n\t\t}\r\n\t\tthis._dataset = null;\r\n\t\t$super();\r\n\t}\r\n});\r\n\r\n/**\r\n * @class\r\n * Base data sensitive control\r\n */\r\njslet.ui.DBFieldControl = jslet.Class.create(jslet.ui.DBControl, {\r\n\tinitialize: function ($super, el, ctrlParams) {\r\n\t\t$super(el, ctrlParams);\r\n\t},\r\n\r\n\t_field: undefined,\r\n\t\r\n\t_valueIndex: undefined,\r\n\t\r\n\t_enableInvalidTip: true,\r\n\t\r\n\t/**Inner use**/\r\n\t_ctrlRecno: -1,\r\n\t\r\n\t_inTableCtrl: false,\r\n\t\r\n\tfield: function(fldName) {\r\n\t\tif(fldName === undefined) {\r\n\t\t\treturn this._field;\r\n\t\t}\r\n\t\t\r\n\t\tfldName = jQuery.trim(fldName);\r\n\t\tjslet.Checker.test('DBControl.field', fldName).isString().required();\r\n\t\tvar k = fldName.lastIndexOf('#');\r\n\t\tif(k > 0) {\r\n\t\t\tthis._fieldMeta = fldName.substring(k+1);\r\n\t\t\tfldName = fldName.substring(0, k);\r\n\t\t}\r\n\t\t\r\n\t\tthis._field = fldName;\r\n\t},\r\n\t\r\n\tfieldMeta: function() {\r\n\t\treturn this._fieldMeta;\r\n\t},\r\n\t\r\n\tvalueIndex: function(valueIndex) {\r\n\t\tif(valueIndex === undefined) {\r\n\t\t\treturn this._valueIndex;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBControl.valueIndex', valueIndex).isNumber();\r\n\t\t\r\n\t\tthis._valueIndex = parseInt(valueIndex);\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tsetParams: function ($super, ctrlParams) {\r\n\t\t$super(ctrlParams);\r\n\t\tvalue = ctrlParams.valueIndex;\r\n\t\tif (value !== undefined) {\r\n\t\t\tthis.valueIndex(value);\r\n\t\t}\r\n\t},\r\n \r\n\tcheckRequiredProperty: function($super) {\r\n\t\t$super();\r\n\t\tjslet.Checker.test('DBControl.field', this._field).required();\r\n\t\tthis.existField(this._field);\r\n\t},\r\n\r\n\tdoMetaChanged: function($super, metaName){\r\n\t\t$super(metaName);\r\n\t\tif(!metaName || metaName == 'tip') {\r\n\t\t\tvar fldObj = this._dataset.getField(this._field);\r\n\t\t\tif(!fldObj) {\r\n\t\t\t\tthrow new Error('Field: ' + this._field + ' NOT exist!');\r\n\t\t\t}\r\n\t\t\tvar tip = fldObj.tip();\r\n\t\t\ttip = tip ? tip: '';\r\n\t\t\tthis.el.title = tip;\r\n\t\t}\r\n\t},\r\n\t\r\n\tsetTabIndex: function(tabIdx) {\r\n\t\tvar Z = this;\r\n\t\tif(Z._inTableCtrl) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(tabIdx !== 0 && !tabIdx) {\r\n\t\t\tfldObj = Z._dataset.getField(Z._field);\r\n\t\t\tif(fldObj) {\r\n\t\t\t\ttabIdx = fldObj.tabIndex();\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(tabIdx === 0 || tabIdx) {\r\n\t\t\tZ.el.tabIndex = tabIdx;\r\n\t\t}\r\n\t},\r\n\t\r\n\texistField: function(fldName) {\r\n\t\tvar fldObj = this._dataset.getField(fldName);\r\n\t\treturn fldObj ? true: false;\r\n\t},\r\n\t\r\n\t/**\r\n\t * DBTable uses this property.\r\n\t */\r\n\tctrlRecno: function(ctrlRecno) {\r\n\t\tif(ctrlRecno === undefined) {\r\n\t\t\treturn this._ctrlRecno;\r\n\t\t}\r\n\r\n\t\tjslet.Checker.test('DBFieldControl.ctrlRecno', ctrlRecno).isGTEZero();\r\n\t\tthis._ctrlRecno = ctrlRecno;\r\n\t\tthis.doValueChanged();\r\n\t},\r\n\t\r\n\tinTableCtrl: function(inTable) {\r\n\t\tif(inTable === undefined) {\r\n\t\t\treturn this._inTableCtrl;\r\n\t\t}\r\n\t\tthis._inTableCtrl = inTable;\r\n\t},\r\n\t\r\n\tgetValue: function() {\r\n\t\tvar Z = this;\r\n\t\tif(Z._ctrlRecno < 0) {\r\n\t\t\treturn Z._dataset.getFieldValue(Z._field, Z._valueIndex); \r\n\t\t} else {\r\n\t\t\treturn Z._dataset.getFieldValueByRecno(Z._ctrlRecno, Z._field, Z._valueIndex);\r\n\t\t}\r\n\t},\r\n\t\r\n\tgetText: function(isEditing) {\r\n\t\tvar Z = this;\r\n\t\tif(Z._ctrlRecno < 0) {\r\n\t\t\treturn Z._dataset.getFieldText(Z._field, isEditing, Z._valueIndex); \r\n\t\t} else {\r\n\t\t\treturn Z._dataset.getFieldTextByRecno(Z._ctrlRecno, Z._field, isEditing, Z._valueIndex);\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * Check if this control is in current record.\r\n\t * In DBTable edit mode, one field corresponds many edit control(one row one edit control), but only one edit control is in active record.\r\n\t * Normally, only edit control in active record will refresh.  \r\n\t */\r\n\tisActiveRecord: function(){\r\n\t\treturn this._ctrlRecno < 0 || this._ctrlRecno == this._dataset.recno();\r\n\t},\r\n\t\r\n\t/**\r\n\t * Force refresh control, regardless of which in active record or not.\r\n\t */\r\n\tforceRefreshControl: function(){\r\n\t\tthis.refreshControl(jslet.data.RefreshEvent.updateRecordEvent(this._field), true);\r\n\t},\r\n\t\r\n\tgetFieldError: function() {\r\n\t\tvar Z = this,\r\n\t\t\terrObj;\r\n\t\tif(Z._ctrlRecno < 0) {\r\n\t\t\terrObj = Z._dataset.getFieldError(Z._field, Z._valueIndex);\r\n\t\t} else {\r\n\t\t\terrObj = Z._dataset.getFieldErrorByRecno(Z._ctrlRecno, Z._field, Z._valueIndex);\r\n\t\t}\r\n\t\treturn errObj;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * Render invalid message and change the control to \"invalid\" style.\r\n\t * \r\n\t *  @param {String} errObj error object: {code: xxx, message}, if it's null, clear the 'invalid' style. \r\n\t */\r\n\trenderInvalid: function (errObj) {\r\n\t\tvar Z = this;\r\n\t\tif (!Z._field) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (errObj){\r\n\t\t\tjQuery(Z.el).parent().addClass('has-error');\r\n\t\t\tZ.el.title = errObj.message || '';\r\n\t\t} else {\r\n\t\t\tjQuery(Z.el).parent().removeClass('has-error');\r\n\t\t\tZ.el.title = '';\r\n\t\t}\r\n\t},\r\n \r\n\tdestroy: function ($super) {\r\n\t\tthis._field = null;\r\n\t\t$super();\r\n\t}\r\n\t\r\n});\r\n\r\n/**\r\n* @private\r\n* Convert string parameters to object\r\n* \r\n* @param {String or Object} ctrlParams Control parameters.\r\n* @return {Object}\r\n*/\r\njslet.ui._evalParams = function (ctrlParams) {\r\n\tjslet.Checker.test('evalParams#ctrlParams', ctrlParams).required();\r\n\tif (jslet.isString(ctrlParams)) {\r\n\t\tvar p = jQuery.trim(ctrlParams);\r\n\t\tif (!p.startsWith('{') && p.indexOf(':')>0) {\r\n\t\t\tp = '{' + p +'}';\r\n\t\t}\r\n\t\ttry {\r\n\t\t\tctrlParams = new Function('return ' + p)();\r\n\t\t\tif(ctrlParams['var']) {\r\n\t\t\t\tctrlParams = ctrlParams['var'];\r\n\t\t\t}\r\n\t\t\treturn ctrlParams;\r\n\t\t} catch (e) {\r\n\t\t\tthrow new Error(jslet.formatString(jslet.locale.DBControl.invalidJsletProp, [ctrlParams]));\r\n\t\t}\r\n\t}\r\n\treturn ctrlParams;\r\n};\r\n\r\n/**\r\n* Hold all jslet control's configurations\r\n*/\r\njslet.ui.controls = new jslet.SimpleMap();\r\n\r\n/**\r\n* Register jslet control class.\r\n* <pre><code>\r\n* jslet.ui.register('Accordion', jslet.ui.Accordion);\r\n* </code></pre>\r\n* \r\n* @param {String} ctrlName Control name.\r\n* @param {jslet.Class} ctrlType Control Class\r\n*/\r\njslet.ui.register = function (ctrlName, ctrlType) {\r\n\tjslet.ui.controls.set(ctrlName.toLowerCase(), ctrlType);\r\n};\r\n\r\n/**\r\n* Create jslet control according to control configuration, and add it to parent element.\r\n* \r\n* @param {String or Object} jsletparam Jslet Parameter\r\n* @param {Html Element} parent Parent html element which created control will be added to.\r\n* @param {Integer} width Control width, unit: px;\r\n* @param {Integer} height Control height, Unit: px; \r\n* @param {Boolean} hidden Hide control or not;\r\n*  \r\n* @return {jslet control}\r\n*/\r\njslet.ui.createControl = function (jsletparam, parent, width, height, hidden) {\r\n\tvar isAuto = false, \r\n\t\tpnode = parent,\r\n\t\tcontainer = document.createElement('div'),\r\n\t\tctrlParam = jslet.ui._evalParams(jsletparam),\r\n\t\tcontrolType = ctrlParam.type;\r\n\tif (!controlType) {\r\n\t\tcontrolType = jslet.ui.controls.DBTEXT;\r\n\t}\r\n\tvar ctrlClass = jslet.ui.controls.get(controlType.toLowerCase());\r\n\tif (!ctrlClass) {\r\n\t\tthrow new Error('NOT found control type: ' + controlType);\r\n\t}\r\n\tcontainer.innerHTML = ctrlClass.htmlTemplate;\r\n\r\n\tvar el = container.firstChild;\r\n\tcontainer.removeChild(el);\r\n\tif(hidden) {\r\n\t\tel.style.display = 'none';\r\n\t}\t\r\n\tif (parent) {\r\n\t\tparent.appendChild(el);\r\n\t} else {\r\n//\t\tel.style.display = 'none';\r\n\t\tdocument.body.appendChild(el);\r\n\t}\r\n\tif (width) {\r\n\t\tif (parseInt(width) == width)\r\n\t\t\twidth = width + 'px';\r\n\t\tel.style.width = width; // parseInt(width) + 'px';\r\n\t}\r\n\tif (height) {\r\n\t\tif (parseInt(height) == height)\r\n\t\t\theight = height + 'px';\r\n\t\tel.style.height = height; // parseInt(height) + 'px';\r\n\t}\r\n\r\n\treturn new ctrlClass(el, ctrlParam);\r\n};\r\n\r\n/**\r\n * Get jslet class with class name.\r\n * \r\n * @param {String} name Class name.\r\n * @return {jslet.Class}\r\n */\r\njslet.ui.getControlClass = function (name) {\r\n\treturn jslet.ui.controls.get(name.toLowerCase());\r\n};\r\n\r\n/**\r\n* Bind jslet control to an existing html element.\r\n* \r\n* @param {Html Element} el Html element\r\n* @param {String or Object} jsletparam Control parameters\r\n*/\r\njslet.ui.bindControl = function (el, jsletparam) {\r\n\tif (!jsletparam)\r\n\t\tjsletparam = jQuery(el).attr('data-jslet');\r\n\tif(el.jslet) {\r\n\t\tconsole.warn('Control has installed! Don\\'t install it again!');\r\n\t\treturn;\r\n\t}\r\n\tvar ctrlParam = jslet.ui._evalParams(jsletparam);\r\n\tvar controlType = ctrlParam.type;\r\n\tif (!controlType) {\r\n\t\tel.jslet = ctrlParam;\r\n\t\treturn;\r\n\t}\r\n\tvar ctrlClass = jslet.ui.controls.get(controlType.toLowerCase());\r\n\tif (!ctrlClass) {\r\n\t\tthrow new Error('NOT found control type: ' + controlType);\r\n\t}\r\n\tnew ctrlClass(el, ctrlParam);\r\n};\r\n\r\n/**\r\n* Unbind jslet control and clear jslet property.\r\n* \r\n* @param {Html Element} el Html element\r\n*/\r\njslet.ui.unbindControl = function(el) {\r\n\tif (el.jslet && el.jslet.destroy) {\r\n\t\tel.jslet.destroy();\r\n\t}\r\n\tel.jslet = null;\r\n};\r\n\r\n/**\r\n* re-bind jslet control.\r\n* \r\n* @param {Html Element} el Html element\r\n*/\r\njslet.ui.rebindControl = function(el) {\r\n\tjslet.ui.unbindControl(el);\r\n\tjslet.ui.bindControl(el);\r\n};\r\n\r\n/**\r\n* Scan the specified html element children and bind jslet control to these html element with 'data-jslet' attribute.\r\n* \r\n* @param {Html Element} pElement Parent html element which need to be scan, if null, document.body used.\r\n* @param {Function} onJsletReady Call back function after jslet installed.\r\n*/\r\njslet.ui.install = function (pElement, onJsletReady) {\r\n\tif(pElement && (onJsletReady === undefined)) {\r\n\t\t//Match case: jslet.ui.install(onJsletReady);\r\n\t\tif(jQuery.isFunction(pElement)) {\r\n\t\t\tonJsletReady = pElement;\r\n\t\t\tpElement = null;\r\n\t\t}\r\n\t}\r\n\t\r\n\tif(!pElement && jslet.locale.isRtl){\r\n\t\tvar jqBody = jQuery(document.body);\r\n\t\tif(!jqBody.hasClass('jl-rtl')) {\r\n\t\t\tjqBody.addClass('jl-rtl');\r\n\t\t}\r\n\t}\r\n\tvar htmlTags;\r\n\tif (!pElement){\r\n\t\tpElement = document.body;\r\n\t}\r\n\thtmlTags = jQuery(pElement).find('*[data-jslet]');\r\n\r\n\tvar cnt = htmlTags.length, el;\r\n\tfor (var i = 0; i < cnt; i++) {\r\n\t\tel = htmlTags[i];\r\n\t\tjslet.ui.bindControl(el);\r\n\t}\r\n\tif(onJsletReady){\r\n\t\tonJsletReady();\r\n\t\t//jslet.ui.onReady();\r\n\t}\r\n};\r\n\r\n///**\r\n// * {Event} Fired after jslet has installed all controls.\r\n// * Pattern: function(){};\r\n// */\r\n//jslet.ui.onReady = null;\r\n\r\n/**\r\n* Scan the specified html element children and unbind jslet control to these html element with 'data-jslet' attribute.\r\n* \r\n* @param {Html Element} pElement Parent html element which need to be scan, if null, document.body used.\r\n*/\r\njslet.ui.uninstall = function (pElement) {\r\n\tvar htmlTags;\r\n\tif (!pElement) {\r\n\t\thtmlTags = jQuery('*[data-jslet]');\r\n\t} else {\r\n\t\thtmlTags = jQuery(pElement).find('*[data-jslet]');\r\n\t}\r\n\tvar el;\r\n\tfor(var i =0, cnt = htmlTags.length; i < cnt; i++){\r\n\t\tel = htmlTags[i];\r\n\t\tif (el.jslet && el.jslet.destroy) {\r\n\t\t\tel.jslet.destroy();\r\n\t\t}\r\n\t\tel.jslet = null;\r\n\t}\r\n\tif(jslet.ui.menuManager) {\r\n\t\tjQuery(document).off('mousedown', jslet.ui.menuManager.hideAll);\r\n\t}\r\n//\tjslet.ui.onReady = null;\r\n};\r\n\n/* ========================================================================\r\n * Jslet framework: jslet.dnd.js\r\n *\r\n * Copyright (c) 2014 Jslet Group(https://github.com/jslet/jslet/)\r\n * Licensed under MIT (https://github.com/jslet/jslet/LICENSE.txt)\r\n * ======================================================================== */\r\nif(!jslet.ui) {\r\n\tjslet.ui = {};\r\n}\r\n\r\n/**\r\n* Drag & Drop. A common framework to implement drag & drop. Example:\r\n* <pre><code>\r\n*   //Define a delegate class\r\n*   dndDelegate = {}\r\n*   dndDelegate._doDragStart = function(){}\r\n*   dndDelegate._doDragging = function (oldX, oldY, x, y, deltaX, deltaY) {}\r\n*   dndDelegate._doDragEnd = function (oldX, oldY, x, y, deltaX, deltaY) {}\r\n*   dndDelegate._doDragCancel = function () {}\r\n* \r\n*   //Initialize jslet.ui.DnD\r\n*   //var dnd = new jslet.ui.DnD();\r\n*   //Or use global jslet.ui.DnD instance to bind 'dndDelegate'\r\n*   jslet.ui.dnd.bindControl(dndDelegate);\r\n*\t\r\n*   //After end dragging, you need unbind it\r\n*   jslet.ui.dnd.unbindControl();\r\n* \r\n* </code></pre>\r\n* \r\n*/\r\n\r\njslet.ui.DnD = function () {\r\n\tvar oldX, oldY, x, y, deltaX, deltaY,\r\n\t\tdragDelta = 2, \r\n\t\tdragged = false, \r\n\t\tbindedControl, \r\n\t\tmouseDowned = true,\r\n\t\tself = this;\r\n\r\n\tthis._docMouseDown = function (event) {\r\n\t\tevent = jQuery.event.fix( event || window.event );\r\n\t\tmouseDowned = true;\r\n\t\tdeltaX = 0;\r\n\t\tdeltaY = 0;\r\n\t\toldX = event.pageX;\r\n\t\toldY = event.pageY;\r\n\t\tdragged = false;\r\n\r\n\t\tif (bindedControl && bindedControl._doMouseDown) {\r\n\t\t\tbindedControl._doMouseDown(oldX, oldY, x, y, deltaX, deltaY);\r\n\t\t}\r\n\t};\r\n\r\n\tthis._docMouseMove = function (event) {\r\n\t\tif (!mouseDowned) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tevent = jQuery.event.fix( event || window.event );\r\n\t\t\r\n\t\tx = event.pageX;\r\n\t\ty = event.pageY;\r\n\t\tif (!dragged) {\r\n\t\t\tif (Math.abs(deltaX) > dragDelta || Math.abs(deltaY) > dragDelta) {\r\n\t\t\t\tdragged = true;\r\n\t\t\t\toldX = x;\r\n\t\t\t\toldY = y;\r\n\t\t\t\tif (bindedControl && bindedControl._doDragStart) {\r\n\t\t\t\t\tbindedControl._doDragStart(oldX, oldY);\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\tdeltaX = x - oldX;\r\n\t\tdeltaY = y - oldY;\r\n\t\tif (dragged) {\r\n\t\t\tif (bindedControl && bindedControl._doDragging) {\r\n\t\t\t\tbindedControl._doDragging(oldX, oldY, x, y, deltaX, deltaY);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (bindedControl && bindedControl._doMouseMove) {\r\n\t\t\t\tbindedControl._doMouseMove(oldX, oldY, x, y, deltaX, deltaY);\r\n\t\t\t}\r\n\t\t\toldX = x;\r\n\t\t\toldY = y;\r\n\t\t}\r\n\t};\r\n\r\n\tthis._docMouseUp = function (event) {\r\n\t\tmouseDowned = false;\r\n\t\tif (dragged) {\r\n\t\t\tdragged = false;\r\n\t\t\tif (bindedControl && bindedControl._doDragEnd) {\r\n\t\t\t\tbindedControl._doDragEnd(oldX, oldY, x, y, deltaX, deltaY);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (bindedControl && bindedControl._doMouseUp) {\r\n\t\t\t\tbindedControl._doMouseUp(oldX, oldY, x, y, deltaX, deltaY);\r\n\t\t\t}\r\n\t\t}\r\n\t\tself.unbindControl();\r\n\t};\r\n\r\n\tthis._docKeydown = function (event) {\r\n\t\tevent = jQuery.event.fix( event || window.event );\r\n\t\tif (event.which == 27) {//Esc key\r\n\t\t\tif (dragged) {\r\n\t\t\t\tdragged = false;\r\n\t\t\t\tif (bindedControl && bindedControl._doDragCancel) {\r\n\t\t\t\t\tbindedControl._doDragCancel();\r\n\t\t\t\t\tself.unbindControl();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tthis._docSelectStart = function (event) {\r\n\t\tevent = jQuery.event.fix( event || window.event );\r\n\t\tevent.preventDefault();\r\n\r\n\t\treturn false;\r\n\t};\r\n\r\n\t/**\r\n\t * Bind control \r\n\t * \r\n\t * @param {Object} ctrl The control need drag & drop, there are four method in it: \r\n\t *  ctrl._doDragStart = function(){}\r\n\t *  ctrl._doDragging = function(oldX, oldY, x, y, deltaX, deltaY){}\r\n\t *  ctrl._doDragEnd = function(oldX, oldY, x, y, deltaX, deltaY){}\r\n\t *  ctrl._doDragCancel = function(){}\r\n\t *  ctrl_doDragStart = function{}\r\n\t *  \r\n\t */\r\n\tthis.bindControl = function (ctrl) {\r\n\t\tbindedControl = ctrl;\r\n\t\tvar doc = jQuery(document);\r\n\t\tdoc.on('mousedown', this._docMouseDown);\r\n\t\tdoc.on('mouseup', this._docMouseUp);\r\n\t\tdoc.on('mousemove', this._docMouseMove);\r\n\t\tdoc.on('selectstart', this._docSelectStart);\r\n\t\tdoc.on('keydown', this._docKeydown);\r\n\t};\r\n\r\n\t/**\r\n\t * Unbind the current control\r\n\t */\r\n\tthis.unbindControl = function () {\r\n\t\tvar doc = jQuery(document);\r\n\t\tdoc.off('mousedown', this._docMouseDown);\r\n\t\tdoc.off('mouseup', this._docMouseUp);\r\n\t\tdoc.off('mousemove', this._docMouseMove);\r\n\t\tdoc.off('selectstart', this._docSelectStart);\r\n\t\tdoc.off('keydown', this._docKeydown);\r\n\t\t\r\n\t\tbindedControl = null;\r\n\t};\r\n};\r\n\r\njslet.ui.dnd = new jslet.ui.DnD();\r\n\r\n\n/* ========================================================================\r\n * Jslet framework: jslet.editmask.js\r\n *\r\n * Copyright (c) 2014 Jslet Group(https://github.com/jslet/jslet/)\r\n * Licensed under MIT (https://github.com/jslet/jslet/LICENSE.txt)\r\n * ======================================================================== */\r\n\r\nif(!jslet.ui) {\r\n\tjslet.ui = {};\r\n}\r\n\r\n/**\r\n * @class EditMask\r\n * Create edit mask class and attach to a html text element.Example:\r\n * <pre><code>\r\n *  var mask = new jslet.ui.EditMask('L00-000');\r\n *  var mask.attach(htmlText);\r\n * </code></pre>\r\n * \r\n * @param {String} mask Mask string, rule:\r\n *  '#': char set: 0-9 and -, not required, \r\n *  '0': char set: 0-9, required,\r\n *  '9': char set: 0-9, not required,\r\n *  'L': char set: A-Z,a-z, required,\r\n *  'l': char set: A-Z,a-z, not required,\r\n *  'A': char set: 0-9,a-z,A-Z, required,\r\n *  'a': char set: 0-9,a-z,A-Z, not required,\r\n *  'C': char set: any char, required\r\n *  'c': char set: any char, not required\r\n *\r\n *@param {Boolean} keepChar Keep the literal character or not\r\n *@param {String} transform Transform character into UpperCase or LowerCase,\r\n *  optional value: upper, lower or null.\r\n */\r\njslet.ui.EditMask = function () {\r\n\tthis._mask = null;\r\n\tthis._keepChar = true;\r\n\tthis._transform = null;\r\n\r\n\tthis._literalChars = null;\r\n\tthis._parsedMask = null;\r\n\tthis._format = null;\r\n\tthis._target = null;\r\n\tthis._buffer = null;\r\n};\r\n\r\njslet.ui.EditMask.prototype = {\r\n\tmaskChars: {\r\n\t\t'#': { regexpr: new RegExp('[0-9\\\\-]'), required: false }, \r\n\t\t'0': { regexpr: new RegExp('[0-9]'), required: true },\r\n\t\t'9': { regexpr: new RegExp('[0-9]'), required: false },\r\n\t\t'L': { regexpr: new RegExp('[A-Za-z]'), required: true },\r\n\t\t'l': { regexpr: new RegExp('[A-Za-z]'), required: false },\r\n\t\t'A': { regexpr: new RegExp('[0-9a-zA-Z]'), required: true },\r\n\t\t'a': { regexpr: new RegExp('[0-9a-zA-Z]'), required: false },\r\n\t\t'C': { regexpr: null, required: true },\r\n\t\t'c': { regexpr: null, required: false }\r\n\t},\r\n\t\r\n\ttransforms: ['upper','lower'],\r\n\r\n\tsetMask: function(mask, keepChar, transform){\r\n\t\tmask = jQuery.trim(mask);\r\n\t\tjslet.Checker.test('EditMask#mask', mask).isString();\r\n\t\tthis._mask = mask;\r\n\t\tthis._keepChar = keepChar ? true: false;\r\n\t\t\r\n\t\tthis._transform = null;\r\n\t\tif(transform){\r\n\t\t\tvar checker = jslet.Checker.test('EditMask#transform', transform).isString();\r\n\t\t\ttransform = jQuery.trim(transform);\r\n\t\t\ttransform = transform.toLowerCase();\r\n\t\t\tchecker.inArray(this.transforms);\r\n\t\t\tthis._transform = transform;\r\n\t\t}\r\n\t\tthis._parseMask();\r\n\t},\r\n\t\r\n\t/**\r\n\t * Attach edit mask to a html text element\r\n\t * \r\n\t * @param {Html Text Element} target Html text element\r\n\t */\r\n\tattach: function (target) {\r\n\t\tjslet.Checker.test('EditMask.attach#target', target).required();\r\n\t\tvar Z = this, jqText = jQuery(target);\r\n\t\tZ._target = target;\r\n\t\tjqText.on('keypress.editmask', function (event) {\r\n\t\t\tif(this.readOnly || !Z._mask) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\tvar c = event.which;\r\n\t\t\tif (c === 0) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\tif (!Z._doKeypress(c)) {\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t} else {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t});\r\n\t\tjqText.on('keydown.editmask', function (event) {\r\n\t\t\tif(this.readOnly || !Z._mask) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\tif (!Z._doKeydown(event.which)) {\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t} else {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tjqText.on('blur.editmask', function (event) {\r\n\t\t\tif(this.readOnly || !Z._mask) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\tif (!Z._doBur()) {\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\tevent.currentTarget.focus();\r\n\t\t\t} else {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tjqText.on('cut.editmask', function (event) {\r\n\t\t\tif(this.readOnly || !Z._mask) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\tZ._doCut(event.originalEvent.clipboardData || window.clipboardData);\r\n\t\t\tevent.preventDefault();\r\n\t\t\treturn false;\r\n\t\t});\r\n\r\n\t\tjqText.on('paste.editmask', function (event) {\r\n\t\t\tif(this.readOnly || !Z._mask) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\tif (!Z._doPaste(event.originalEvent.clipboardData || window.clipboardData)) {\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\r\n\t/**\r\n\t * Detach edit mask from a html text element\r\n\t */\r\n\tdetach: function(){\r\n\t\tvar jqText = jQuery(this._target);\r\n\t\tjqText.off('keypress.editmask');\r\n\t\tjqText.off('keydown.editmask');\r\n\t\tjqText.off('blur.editmask');\r\n\t\tjqText.off('cut.editmask');\r\n\t\tjqText.off('paste.editmask');\r\n\t\tthis._target = null; \r\n\t},\r\n\t\r\n\tsetValue: function (value) {\r\n\t\tvalue = jQuery.trim(value);\r\n\t\tjslet.Checker.test('EditMask.setValue#value', value).isString();\r\n\t\tvalue = value ? value : '';\r\n\t\tif(!this._mask) {\r\n\t\t\tthis._target.value = value;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tvar Z = this;\r\n\t\tZ._clearBuffer(0);\r\n\t\tvar prePos = 0, pos, preValuePos = 0, k, i, \r\n\t\t\tch, vch, valuePos = 0, fixedChar, \r\n\t\t\tmaskLen = Z._parsedMask.length;\r\n\t\twhile (true) {\r\n\t\t\tfixedChar = Z._getFixedCharAndPos(prePos);\r\n\t\t\tpos = fixedChar.pos;\r\n\t\t\tch = fixedChar.ch;\r\n\t\t\tif (pos < 0) {\r\n\t\t\t\tpos = prePos;\r\n\t\t\t}\r\n\t\t\tif (ch) {\r\n\t\t\t\tvaluePos = value.indexOf(ch, preValuePos);\r\n\t\t\t\tif (valuePos < 0) {\r\n\t\t\t\t\tvaluePos = value.length;\r\n\t\t\t\t}\r\n\t\t\t\tk = -1;\r\n\t\t\t\tfor (i = valuePos - 1; i >= preValuePos; i--) {\r\n\t\t\t\t\tvch = value.charAt(i);\r\n\t\t\t\t\tZ._buffer[k + pos] = vch;\r\n\t\t\t\t\tk--;\r\n\t\t\t\t}\r\n\t\t\t\tpreValuePos = valuePos + 1;\r\n\t\t\t} else {\r\n\t\t\t\tk = 0;\r\n\t\t\t\tvar c, cnt = Z._buffer.length;\r\n\t\t\t\tfor (i = prePos; i < cnt; i++) {\r\n\t\t\t\t\tc = value.charAt(preValuePos + k);\r\n\t\t\t\t\tif (!c) {\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tZ._buffer[i] = c;\r\n\t\t\t\t\tk++;\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tprePos = pos + 1;\r\n\t\t}\r\n\t\tZ._showValue();\r\n\t},\r\n\t\r\n\tgetValue: function(){\r\n\t\tvar value = this._target.value;\r\n\t\tif(this._keepChar) {\r\n\t\t\treturn value;\r\n\t\t} else {\r\n\t\t\tvar result = [], maskObj;\r\n\t\t\tfor(var i = 0, cnt = value.length; i< cnt; i++){\r\n\t\t\t\tmaskObj = this._parsedMask[i];\r\n\t\t\t\tif(maskObj.isMask) {\r\n\t\t\t\t\tresult.push(value.charAt(i));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn result.join('');\r\n\t\t}\r\n\t},\r\n\t\r\n\tvalidateValue: function(){\r\n\t\tvar Z = this, len = Z._parsedMask.length, cfg;\r\n\t\tfor(var i = 0; i< len; i++){\r\n\t\t\tcfg = Z._parsedMask[i];\r\n\t\t\tif(cfg.isMask && Z.maskChars[cfg.ch].required){\r\n\t\t\t\tif(Z._buffer[i] == Z._format[i]) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn true;\r\n\t},\r\n\t\r\n\t_getFixedCharAndPos: function (begin) {\r\n\t\tvar Z = this;\r\n\t\tif (!Z._literalChars || Z._literalChars.length === 0) {\r\n\t\t\treturn { pos: 0, ch: null };\r\n\t\t}\r\n\t\tif (!begin) {\r\n\t\t\tbegin = 0;\r\n\t\t}\r\n\t\tvar ch, mask;\r\n\t\tfor (var i = begin, cnt = Z._parsedMask.length; i < cnt; i++) {\r\n\t\t\tmask = Z._parsedMask[i];\r\n\t\t\tif (mask.isMask) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tch = mask.ch;\r\n\t\t\tif (Z._literalChars.indexOf(ch) >= 0) {\r\n\t\t\t\treturn { ch: ch, pos: i };\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn { pos: -1, ch: null };\r\n\t},\r\n\r\n\t_parseMask: function () {\r\n\t\tvar Z = this;\r\n\t\tif(!Z._mask) {\r\n\t\t\tZ._parsedMask = null;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tZ._parsedMask = [];\r\n\t\t\r\n\t\tZ._format = [];\r\n\t\tvar c, prevChar = null, isMask;\r\n\r\n\t\tfor (var i = 0, cnt = Z._mask.length; i < cnt; i++) {\r\n\t\t\tc = Z._mask.charAt(i);\r\n\t\t\tif (c == '\\\\') {\r\n\t\t\t\tprevChar = c;\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tisMask = false;\r\n\t\t\tif (Z.maskChars[c] === undefined) {\r\n\t\t\t\tif (prevChar) {\r\n\t\t\t\t\tZ._parsedMask.push({ ch: prevChar, isMask: isMask });\r\n\t\t\t\t}\r\n\t\t\t\tZ._parsedMask.push({ ch: c, isMask: isMask });\r\n\t\t\t} else {\r\n\t\t\t\tisMask = prevChar ? false : true;\r\n\t\t\t\tZ._parsedMask.push({ ch: c, isMask: isMask });\r\n\t\t\t}\r\n\t\t\tif(Z._keepChar && !isMask){\r\n\t\t\t\tif(!Z._literalChars) {\r\n\t\t\t\t\tZ._literalChars = [];\r\n\t\t\t\t}\r\n\t\t\t\tvar notFound = true;\r\n\t\t\t\tfor(var k = 0, iteralCnt = Z._literalChars.length; k < iteralCnt; k++){\r\n\t\t\t\t\tif(Z._literalChars[k] == c){\r\n\t\t\t\t\t\tnotFound = false;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif(notFound) {\r\n\t\t\t\t\tZ._literalChars.push(c);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tprevChar = null;\r\n\t\t\tZ._format.push(isMask ? '_' : c);\r\n\t\t} //end for\r\n\r\n\t\tZ._buffer = Z._format.slice(0);\r\n\t\tif(Z._target) {\r\n\t\t\tZ._target.value = Z._format.join('');\r\n\t\t}\r\n\t},\r\n\t\r\n\t_validateChar: function (maskChar, inputChar) {\r\n\t\tvar maskCfg = this.maskChars[maskChar];\r\n\t\tvar regExpr = maskCfg.regexpr;\r\n\t\tif (regExpr) {\r\n\t\t\treturn regExpr.test(inputChar);\r\n\t\t} else {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t},\r\n\r\n\t_getValidPos: function (pos, toLeft) {\r\n\t\tvar Z = this, \r\n\t\t\tcnt = Z._parsedMask.length, i;\r\n\t\tif (pos >= cnt) {\r\n\t\t\treturn cnt - 1;\r\n\t\t}\r\n\t\tif (!toLeft) {\r\n\t\t\tfor (i = pos; i < cnt; i++) {\r\n\t\t\t\tif (Z._parsedMask[i].isMask) {\r\n\t\t\t\t\treturn i;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tfor (i = pos; i >= 0; i--) {\r\n\t\t\t\tif (Z._parsedMask[i].isMask) {\r\n\t\t\t\t\treturn i;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\t\t\tfor (i = pos; i >= 0; i--) {\r\n\t\t\t\tif (Z._parsedMask[i].isMask) {\r\n\t\t\t\t\treturn i;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tfor (i = pos; i < cnt; i++) {\r\n\t\t\t\tif (Z._parsedMask[i].isMask) {\r\n\t\t\t\t\treturn i;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn -1;\r\n\t},\r\n\r\n\t_clearBuffer: function (begin, end) {\r\n\t\tif(!this._buffer) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (!end) {\r\n\t\t\tend = this._buffer.length - 1;\r\n\t\t}\r\n\t\tfor (var i = begin; i <= end; i++) {\r\n\t\t\tthis._buffer[i] = this._format[i];\r\n\t\t}\r\n\t},\r\n\r\n\t_packEmpty: function (begin, end) {\r\n\t\tvar c, k = 0, Z = this, i;\r\n\t\tfor (i = begin; i >= 0; i--) {\r\n\t\t\tc = Z._format[i];\r\n\t\t\tif (Z._literalChars && Z._literalChars.indexOf(c) >= 0) {\r\n\t\t\t\tk = i;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tbegin = k;\r\n\t\tvar str = [];\r\n\t\tfor (i = begin; i < end; i++) {\r\n\t\t\tc = Z._buffer[i];\r\n\t\t\tif (c != Z._format[i]) {\r\n\t\t\t\tstr.push(c);\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar len = str.length - 1;\r\n\r\n\t\tfor (i = end - 1; i >= begin; i--) {\r\n\t\t\tif (len >= 0) {\r\n\t\t\t\tZ._buffer[i] = str[len];\r\n\t\t\t\tlen--;\r\n\t\t\t} else {\r\n\t\t\t\tZ._buffer[i] = Z._format[i];\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t_updateBuffer: function (pos, ch) {\r\n\t\tvar begin = pos.begin, end = pos.end, Z = this;\r\n\r\n\t\tbegin = Z._getValidPos(begin);\r\n\t\tif (begin < 0) {\r\n\t\t\treturn -1;\r\n\t\t}\r\n\t\tZ._clearBuffer(begin + 1, end);\r\n\t\tif (Z._literalChars && Z._literalChars.indexOf(ch) >= 0) {\r\n\t\t\tfor (var i = begin, cnt = Z._parsedMask.length; i < cnt; i++) {\r\n\t\t\t\tif (Z._parsedMask[i].ch == ch) {\r\n\t\t\t\t\tZ._packEmpty(begin, i);\r\n\t\t\t\t\treturn i;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tvar maskObj = Z._parsedMask[begin];\r\n\t\t\tif (Z._validateChar(maskObj.ch, ch)) {\r\n\t\t\t\tZ._buffer[begin] = ch;\r\n\t\t\t\treturn begin;\r\n\t\t\t} else\t{\r\n\t\t\t\treturn -1;\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t_moveCursor: function (begin, toLeft) {\r\n\t\tbegin = this._getValidPos(begin, toLeft);\r\n\t\tif (begin >= 0) {\r\n\t\t\tjslet.ui.textutil.setCursorPos(this._target, begin);\r\n\t\t}\r\n\t},\r\n\r\n\t_showValue: function () {\r\n\t\tthis._target.value = this._buffer.join('');\r\n\t},\r\n\r\n\t_doKeypress: function (chCode) {\r\n\t\tif (chCode == 13) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\tvar ch = String.fromCharCode(chCode), Z = this;\r\n\t\tif (Z._transform == 'upper') {\r\n\t\t\tch = ch.toUpperCase();\r\n\t\t} else {\r\n\t\t\tif (Z._transform == 'lower') {\r\n\t\t\t\tch = ch.toLowerCase();\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar pos = jslet.ui.textutil.getCursorPos(Z._target);\r\n\t\tvar begin = Z._updateBuffer(pos, ch);\r\n\t\tZ._showValue();\r\n\t\tif (begin >= 0) {\r\n\t\t\tZ._moveCursor(begin + 1);\r\n\t\t} else {\r\n\t\t\tZ._moveCursor(pos.begin);\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t},\r\n\r\n\t_doKeydown: function (chCode) {\r\n\t\tvar Z = this,\r\n\t\t\tpos = jslet.ui.textutil.getCursorPos(Z._target),\r\n\t\t\tbegin = pos.begin,\r\n\t\t\tend = pos.end;\r\n\r\n\t\tif (chCode == 229) {//IME showing\r\n\t\t\tvar flag = (Z._parsedMask.legnth > begin);\r\n\t\t\tif (flag) {\r\n\t\t\t\tvar msk = Z._parsedMask[begin];\r\n\t\t\t\tflag = msk.isMask;\r\n\t\t\t\tif (flag) {\r\n\t\t\t\t\tvar c = msk.ch;\r\n\t\t\t\t\tflag = (c == 'c' || c == 'C');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (!flag) {\r\n\t\t\t\twindow.setTimeout(function () {\r\n\t\t\t\t\tZ._showValue();\r\n\t\t\t\t\tZ._moveCursor(begin);\r\n\t\t\t\t}, 50);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (chCode == 13) //enter\r\n\t\t{\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\tif (chCode == 8) //backspace\r\n\t\t{\r\n\t\t\tif (begin == end) {\r\n\t\t\t\tbegin = Z._getValidPos(--begin, true);\r\n\t\t\t\tend = begin;\r\n\t\t\t}\r\n\t\t\tZ._clearBuffer(begin, end);\r\n\t\t\tZ._showValue();\r\n\t\t\tZ._moveCursor(begin, true);\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif (chCode == 27) // Allow to send 'ESC' command\r\n\t\t{\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif (chCode == 39) // Move Left\r\n\t\t{\r\n\t\t}\r\n\r\n\t\tif (chCode == 46) // delete the selected text\r\n\t\t{\r\n\t\t\tZ._clearBuffer(begin, end - 1);\r\n\t\t\tZ._showValue();\r\n\t\t\tZ._moveCursor(begin);\r\n\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\treturn true;\r\n\t},\r\n\r\n\t_doBur: function () {\r\n\t\tvar mask, c, Z = this;\r\n\t\tfor (var i = 0, cnt = Z._parsedMask.length; i < cnt; i++) {\r\n\t\t\tmask = Z._parsedMask[i];\r\n\t\t\tif (!mask.isMask) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tc = mask.ch;\r\n\t\t\tif (Z.maskChars[c].required) {\r\n\t\t\t\tif (Z._buffer[i] == Z._format[i]) {\r\n\t\t\t\t\t//jslet.ui.textutil.setCursorPos(Z._target, i);\r\n\t\t\t\t\t//return false;\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn true;\r\n\t},\r\n\r\n\t_doCut: function (clipboardData) {\r\n\t\tvar Z = this,\r\n\t\t\tdata = jslet.ui.textutil.getSelectedText(Z._target),\r\n\t\t\trange = jslet.ui.textutil.getCursorPos(Z._target),\r\n\t\t\tbegin = range.begin;\r\n\t\tZ._clearBuffer(begin, range.end - 1);\r\n\t\tZ._showValue();\r\n\t\tZ._moveCursor(begin, true);\r\n\t\tclipboardData.setData('Text', data);\r\n\t\treturn false;\r\n\t},\r\n\r\n\t_doPaste: function (clipboardData) {\r\n\t\tvar pasteValue = clipboardData.getData('Text');\r\n\t\tif (!pasteValue) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tvar pos = jslet.ui.textutil.getCursorPos(this._target), begin = 0, ch;\r\n\t\tpos.end = pos.begin;\r\n\t\tfor (var i = 0; i < pasteValue.length; i++) {\r\n\t\t\tch = pasteValue.charAt(i);\r\n\t\t\tbegin = this._updateBuffer(pos, ch);\r\n\t\t\tpos.begin = i;\r\n\t\t\tpos.end = pos.begin;\r\n\t\t}\r\n\t\tthis._showValue();\r\n\t\tif (begin >= 0) {\r\n\t\t\tthis._moveCursor(begin + 1);\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n};//edit mask\r\n\r\n/**\r\n * Util of \"Text\" control\r\n */\r\njslet.ui.textutil = {\r\n\t/**\r\n\t * Select text from an Input(Text) element \r\n\t * \r\n\t * @param {Html Text Element} txtEl The html text element   \r\n\t * @param {Integer} start Start position.\r\n\t * @param {Integer} end End position.\r\n\t */\r\n\tselectText: function(txtEl, start, end){\r\n\t\tvar v = txtEl.value;\r\n\t\tif (v.length > 0) {\r\n\t\t\tstart = start === undefined ? 0 : start;\r\n\t\t\tend = end === undefined ? v.length : end;\r\n \r\n\t\t\tif (txtEl.setSelectionRange) {\r\n\t\t\t\ttxtEl.setSelectionRange(start, end);\r\n\t\t\t} else if (txtEl.createTextRange) {\r\n\t\t\t\tvar range = txtEl.createTextRange();\r\n\t\t\t\trange.moveStart('character', start);\r\n\t\t\t\trange.moveEnd('character', end - v.length);\r\n\t\t\t\trange.select();\r\n\t\t\t}\r\n\t\t}\t\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get selected text\r\n\t * \r\n\t * @param {Html Text Element} textEl Html Text Element\r\n\t * @return {String}  \r\n\t */\r\n\tgetSelectedText: function (txtEl) {\r\n\t\tif (txtEl.setSelectionRange) {\r\n\t\t\tvar begin = txtEl.selectionStart;\r\n\t\t\tvar end = txtEl.selectionEnd;\r\n\t\t\treturn txtEl.value.substring(begin, end);\r\n\t\t}\r\n\t\tif (document.selection && document.selection.createRange) {\r\n\t\t\treturn document.selection.createRange().text;\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Get cursor postion of html text element\r\n\t * \r\n\t * @param {Html Text Element} txtEl Html Text Element\r\n\t * @return {Integer}\r\n\t */\r\n\tgetCursorPos: function(txtEl){\r\n\t\tvar result = { begin: 0, end: 0 };\r\n\r\n\t\tif (txtEl.setSelectionRange) {\r\n\t\t\tresult.begin = txtEl.selectionStart;\r\n\t\t\tresult.end = txtEl.selectionEnd;\r\n\t\t}\r\n\t\telse if (document.selection && document.selection.createRange) {\r\n\t\t\tvar range = document.selection.createRange();\r\n\t\t\tresult.begin = 0 - range.duplicate().moveStart('character', -100000);\r\n\t\t\tresult.end = result.begin + range.text.length;\r\n\t\t}\r\n\t\treturn result;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Set cursor postion of html text element\r\n\t * \r\n\t * @param {Html Text Element} txtEl Html Text Element\r\n\t * @param {Integer} pos Cusor position\r\n\t */\r\n\tsetCursorPos: function(txtEl, pos){\r\n\t\tif (txtEl.setSelectionRange) {\r\n\t\t\ttxtEl.focus();\r\n\t\t\ttxtEl.setSelectionRange(pos, pos);\r\n\t\t}\r\n\t\telse if (txtEl.createTextRange) {\r\n\t\t\tvar range = txtEl.createTextRange();\r\n\t\t\trange.collapse(true);\r\n\t\t\trange.moveEnd('character', pos);\r\n\t\t\trange.moveStart('character', pos);\r\n\t\t\trange.select();\r\n\t\t}\t\r\n\t}\r\n};\r\n\n/* ========================================================================\r\n * Jslet framework: jslet.resizeeventbus.js\r\n *\r\n * Copyright (c) 2014 Jslet Group(https://github.com/jslet/jslet/)\r\n * Licensed under MIT (https://github.com/jslet/jslet/LICENSE.txt)\r\n * ======================================================================== */\r\n\r\n/**\r\n* Resize event bus, manage all resize event. Example:\r\n* <pre><code>\r\n*\tvar myCtrlObj = {\r\n*\t\tcheckSizeChanged: function(){\r\n*\t\t\t;\r\n*\t\t}\r\n*\t}\r\n*\t\r\n*\t//Subcribe a message from MessageBus\r\n*\tjslet.messageBus.subcribe(myCtrlObj);\r\n*   \r\n*\t//Unsubcribe a message from MessageBus\r\n*\tjslet.messageBus.unsubcribe(myCtrlObj);\r\n* \r\n*\t//Send a mesasge to MessageBus\r\n*\tjslet.messageBus.sendMessage('MyMessage', {x: 10, y:10});\r\n* \r\n* </code></pre>\r\n* \r\n*/\r\njslet.ResizeEventBus = function () {\r\n\t\r\n\tvar handler = null;\r\n\t/**\r\n\t * Send a message.\r\n\t * \r\n\t * @param {Html Element} sender Sender which send resize event.\r\n\t */\r\n\tthis.resize = function (sender) {\r\n\t\tif (handler){\r\n\t\t\twindow.clearTimeout(handler);\r\n\t\t}\r\n\t\thandler = setTimeout(function(){\r\n\t\t\tvar ctrls, ctrl, jsletCtrl;\r\n\t\t\tif (sender) {\r\n\t\t\t\tctrls = jQuery(sender).find(\"*[data-jslet-resizable]\");\r\n\t\t\t} else {\r\n\t\t\t\tctrls = jQuery(\"*[data-jslet-resizable]\");\r\n\t\t\t}\r\n\t\t\tif(jslet.ui._activePopup) {\r\n\t\t\t\tjslet.ui._activePopup.hide();\r\n\t\t\t}\r\n\t\t\tfor(var i = 0, cnt = ctrls.length; i < cnt; i++){\r\n\t\t\t\tctrl = ctrls[i];\r\n\t\t\t\tif (ctrl){\r\n\t\t\t\t\tjsletCtrl = ctrl.jslet;\r\n\t\t\t\t\tif (jsletCtrl && jsletCtrl.checkSizeChanged){\r\n\t\t\t\t\t\tjsletCtrl.checkSizeChanged();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\thandler = null;\r\n\t\t}, 100);\r\n\t};\r\n\r\n\t/**\r\n\t * Subscribe a control to response a resize event.\r\n\t * \r\n\t * @param {Object} ctrlObj control object which need subscribe a message, \r\n\t *\tthere must be a function: checkSizeChanged in ctrlObj.\r\n\t *\tcheckSizeChanged: function(){}\r\n\t */\r\n\tthis.subscribe = function(ctrlObj){\r\n\t\tif (!ctrlObj || !ctrlObj.el) {\r\n\t\t\tthrow new Error(\"ctrlObj required!\");\r\n\t\t}\r\n\t\tjQuery(ctrlObj.el).attr(jslet.ResizeEventBus.RESIZABLE, true);\r\n\t};\r\n\t\r\n\t/**\r\n\t * Unsubscribe a control to response a resize event.\r\n\t * \r\n\t * @param {Object} ctrlObj control object which need subscribe a message.\r\n\t */\r\n\tthis.unsubscribe = function(ctrlObj){\r\n\t\tif (!ctrlObj || !ctrlObj.el) {\r\n\t\t\tthrow new Error(\"ctrlObj required!\");\r\n\t\t}\r\n\t\tjQuery(ctrlObj.el).removeAttr(jslet.ResizeEventBus.RESIZABLE);\r\n\t};\r\n\t\r\n};\r\n\r\njslet.ResizeEventBus.RESIZABLE = \"data-jslet-resizable\";\r\n\r\njslet.resizeEventBus = new jslet.ResizeEventBus();\r\n\r\njQuery(window).on(\"resize\",function(){\r\n\tjslet.resizeEventBus.resize();\r\n});\r\n\n/* ========================================================================\r\n * Jslet framework: jslet.uicommon.js\r\n *\r\n * Copyright (c) 2014 Jslet Group(https://github.com/jslet/jslet/)\r\n * Licensed under MIT (https://github.com/jslet/jslet/LICENSE.txt)\r\n * ======================================================================== */\r\n\r\nif(!jslet.ui) {\r\n\tjslet.ui = {};\r\n}\r\n\r\njslet.ui.htmlclass = {};\r\njslet.ui.GlobalZIndex = 100;\r\n\r\n/**\r\n* Popup Panel. Example: \r\n* <pre><code>\r\n* var popPnl = new jslet.ui.PopupPanel();\r\n* popPnl.setContent(document.getElementById('id'));\r\n* popPnl.show(10, 10, 100, 100);\r\n* \r\n* popPnl.hide(); //or\r\n* popPnl.destroy();\r\n* </code></pre>\r\n*  \r\n*/\r\njslet.ui.KeyCode = {\r\n\tUP: 38,\r\n\tDOWN: 40,\r\n\tLEFT: 37,\r\n\tRIGHT: 39,\r\n\tTAB: 9,\r\n\tENTER: 13\r\n};\r\n\r\njslet.ui.PopupPanel = function () {\r\n\t/**\r\n\t * Event handler when hide popup panel: function(){}\r\n\t */\r\n\tthis.onHidePopup = null;\r\n\r\n\tthis.isShowing = false;\r\n\t/**\r\n\t * Private document click handler\r\n\t */\r\n\tthis.documentClickHandler = function (event) {\r\n\t\tevent = jQuery.event.fix( event || window.event );\r\n\t\tvar srcEle = event.target;\r\n\t\tif (jslet.ui.isChild(jslet.ui.PopupPanel.excludedElement,srcEle) ||\r\n\t\t\tjslet.ui.inPopupPanel(srcEle)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (jslet.ui._activePopup) {\r\n\t\t\tjslet.ui._activePopup.hide();\r\n\t\t}\r\n\t};\r\n\r\n\tthis._stopMouseEvent = function(event) {\r\n\t\tevent.stopImmediatePropagation();\r\n\t\tevent.preventDefault();\r\n\t};\r\n\t\r\n\t/**\r\n\t * Private, create popup panel\r\n\t */\r\n\tthis._createPanel = function () {\r\n\t\tif (!jslet.ui._popupPanel) {\r\n\t\t\tvar p = document.createElement('div');\r\n\t\t\tp.style.display = 'none';\r\n\t\t\tp.className = 'jl-popup-panel jl-opaque jl-border-box dropdown-menu';\r\n\t\t\tp.style.position = 'absolute';\r\n\t\t\tp.style.zIndex = 99000;\r\n\t\t\tdocument.body.appendChild(p);\r\n\t\t\t\r\n\t\t\tjQuery(document).on('click', this.documentClickHandler);\r\n//\t\t\tjQuery(p).on('click', this._stopMouseEvent);\r\n//\t\t\tjQuery(p).on('mousedown', this._stopMouseEvent);\r\n//\t\t\tjQuery(p).on('mouseup', this._stopMouseEvent);\r\n\t\t\tjslet.ui._popupPanel = p;\r\n\t\t}\r\n\t};\r\n\t\r\n\t/**\r\n\t * Show popup panel in specified position with specified size.\r\n\t * \r\n\t * @param {Integer} left Left position\r\n\t * @param {Integer} top Top position\r\n\t * @param {Integer} width Popup panel width\r\n\t * @param {Integer} height Popup panel height\r\n\t * \r\n\t */\r\n\tthis.show = function (left, top, width, height, ajustX, ajustY) {\r\n\t\tthis._createPanel();\r\n\t\tleft = parseInt(left);\r\n\t\ttop = parseInt(top);\r\n\t\t\r\n\t\tif (height) {\r\n\t\t\tjslet.ui._popupPanel.style.height = parseInt(height) + 'px';\r\n\t\t}\r\n\t\tif (width) {\r\n\t\t\tjslet.ui._popupPanel.style.width = parseInt(width) + 'px';\r\n\t\t}\r\n\t\tvar jqWin = jQuery(window),\r\n\t\t\twinWidth = jqWin.scrollLeft() + jqWin.width(),\r\n\t\t\twinHeight = jqWin.scrollTop() + jqWin.height(),\r\n\t\t\tpanel = jQuery(jslet.ui._popupPanel),\r\n\t\t\tw = panel.outerWidth(),\r\n\t\t\th = panel.outerHeight();\r\n\t\t/*\r\n\t\tif (left - obody.scrollLeft + w > obody.clientWidth) {\r\n\t\t\tleft -= w;\r\n\t\t}\r\n\t\tif (top - obody.scrollTop + h > obody.clientHeight) {\r\n\t\t\ttop -= (h + ajustY);\r\n\t\t}\r\n\t\t*/\r\n\t\tif (jslet.locale.isRtl) {\r\n\t\t\tleft -= w;\r\n\t\t}\r\n\t\tif(left + w > winWidth) {\r\n\t\t\tleft += winWidth - left - w - 1;\r\n\t\t}\r\n\t\tif(top + h > winHeight) {\r\n\t\t\ttop -= (h + ajustY);\r\n\t\t}\r\n\t\tif(left < 0) {\r\n\t\t\tleft = 1;\r\n\t\t}\r\n\t\tif(top < 0) {\r\n\t\t\ttop = 1;\r\n\t\t}\r\n\t\t\r\n\t\tif (top) {\r\n\t\t\tjslet.ui._popupPanel.style.top = top + 'px';\r\n\t\t}\r\n\t\tif (left) {\r\n\t\t\tjslet.ui._popupPanel.style.left = left + 'px';\r\n\t\t}\r\n\t\tjslet.ui._popupPanel.style.display = 'block';\r\n\r\n\t\tvar shadow = jslet.ui._popupShadow;\r\n\t\tif(shadow) {\r\n\t\t\tshadow.style.width = w + 'px';\r\n\t\t\tshadow.style.height = h + 'px';\r\n\t\t\tshadow.style.top = top + 2 + 'px';\r\n\t\t\tshadow.style.left = left + 2 + 'px';\r\n\t\t\tshadow.style.display = 'block';\r\n\t\t}\r\n\t\tjslet.ui._activePopup = this;\r\n\t\tthis.isShowing = true;\r\n\t};\r\n\r\n\t/**\r\n\t * Set popup panel content.\r\n\t * \r\n\t * @param {Html Element} content popup panel content\r\n\t * @param {String} content width;\r\n\t * @param {String} cotnent height;\r\n\t */\r\n\tthis.setContent = function (content, width, height) {\r\n\t\tthis._createPanel();\r\n\t\tvar oldContent = jslet.ui._popupPanel.childNodes[0];\r\n\t\tif (oldContent) {\r\n\t\t\tjslet.ui._popupPanel.removeChild(oldContent);\r\n\t\t}\r\n\t\tjslet.ui._popupPanel.appendChild(content);\r\n\t\tcontent.style.border = 'none';\r\n\t\tif(width) {\r\n\t\t\tcontent.style.width = width;\r\n\t\t}\r\n\t\tif(height) {\r\n\t\t\tcontent.style.height = height;\r\n\t\t}\r\n\t};\r\n\r\n\t/**\r\n\t * Get popup Panel. You can use this method to customize popup panel.\r\n\t * \r\n\t * @return {Html Element}\r\n\t * \r\n\t */\r\n\tthis.getPopupPanel = function () {\r\n\t\tthis._createPanel();\r\n\t\treturn jslet.ui._popupPanel;\r\n\t};\r\n\r\n\t/**\r\n\t * Destroy popup panel completely.\r\n\t */\r\n\tthis.destroy = function () {\r\n\t\tif (!jslet.ui._popupPanel) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.isShowing = false;\r\n\t\tdocument.body.removeChild(jslet.ui._popupPanel);\r\n\t\tif(jslet.ui._popupShadow) {\r\n\t\t\tdocument.body.removeChild(jslet.ui._popupShadow);\r\n\t\t}\r\n\t\tjQuery(this._popupPanel).off();\r\n\t\tjslet.ui._popupPanel = null;\r\n\t\tjslet.ui._popupShadow = null;\r\n\t\tthis.onHidePopup = null;\r\n\t\tjQuery(document).off('click', this.documentClickHandler);\r\n\t};\r\n\r\n\t/**\r\n\t * Hide popup panel, and you can show it again.\r\n\t * \r\n\t */\r\n\tthis.hide = function () {\r\n\t\tif (jslet.ui._popupPanel) {\r\n\t\t\tjslet.ui._popupPanel.style.display = 'none';\r\n\t\t\tif(jslet.ui._popupShadow) {\r\n\t\t\t\tjslet.ui._popupShadow.style.display = 'none';\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (this.onHidePopup) {\r\n\t\t\tthis.onHidePopup();\r\n\t\t}\r\n\t\tthis.isShowing = false;\r\n\t\tdelete jslet.ui._activePopup;\r\n\t};\r\n};\r\n\r\n/**\r\n* Check if a html element is in an active popup or not\r\n* \r\n* @param {Html Element} htmlElement Checking html element\r\n* \r\n* @return {Boolean} True - In popup panel, False - Otherwise\r\n*/\r\njslet.ui.inPopupPanel = function (htmlElement) {\r\n\tif (!htmlElement || htmlElement == document) {\r\n\t\treturn false;\r\n\t}\r\n\tif (jQuery(htmlElement).hasClass('jl-popup-panel')) {\r\n\t\treturn true;\r\n\t} else {\r\n\t\treturn jslet.ui.inPopupPanel(htmlElement.parentNode);\r\n\t}\r\n};\r\n\r\n/**\r\n* Get the specified level parent element. Example:\r\n* <pre><code>\r\n*  //html snippet is: body -> div1 -> div2 ->table\r\n*  jslet.ui.getParentElement(div2); // return div1\r\n*  jslet.ui.getParentElement(div2, 2); //return body \r\n* </code></pre>\r\n* \r\n* @param {Html Element} htmlElement html element as start point\r\n* @param {Integer} level level\r\n* \r\n* @return {Html Element} Parent element, if not found, return null.\r\n*/\r\njslet.ui.getParentElement = function (htmlElement, level) {\r\n\tif (!level) {\r\n\t\tlevel = 1;\r\n\t}\r\n\tvar flag = htmlElement.parentElement ? true : false,\r\n\tresult = htmlElement;\r\n\tfor (var i = 0; i < level; i++) {\r\n\t\tif (flag) {\r\n\t\t\tresult = result.parentElement;\r\n\t\t} else {\r\n\t\t\tresult = result.parentNode;\r\n\t\t}\r\n\t\tif (!result) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\treturn result;\r\n};\r\n\r\n/**\r\n* Find first parent with specified condition. Example:\r\n* <pre><code>\r\n*   //Html snippet: body ->div1 ->div2 -> div3\r\n*\tvar odiv = jslet.ui.findFirstParent(\r\n*\t\todiv3, \r\n*\t\tfunction (node) {return node.class == 'head';},\r\n*\t\tfunction (node) {return node.tagName != 'BODY'}\r\n*   );\r\n* </code></pre>\r\n* \r\n* @param {Html Element} element The start checking html element\r\n* @param {Function} conditionFn Callback function: function(node}{...}, node is html element;\r\n*\t\t\tif conditionFn return true, break finding and return 'node'\r\n* @param {Function} stopConditionFn Callback function: function(node}{...}, node is html element;\r\n*\t\t\tif stopConditionFn return true, break finding and return null\r\n* \r\n* @return {Html Element} Parent element or null\r\n*/\r\njslet.ui.findFirstParent = function (htmlElement, conditionFn, stopConditionFn) {\r\n\tvar p = htmlElement;\r\n\tif (!p) {\r\n\t\treturn null;\r\n\t}\r\n\tif (!conditionFn) {\r\n\t\treturn p.parentNode;\r\n\t}\r\n\tif (conditionFn(p)) {\r\n\t\treturn p;\r\n\t} else {\r\n\t\tif (stopConditionFn && stopConditionFn(p.parentNode)) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\treturn jslet.ui.findFirstParent(p.parentNode, conditionFn, stopConditionFn);\r\n\t}\r\n};\r\n\r\n/**\r\n * Find parent element that has 'jslet' property\r\n * \r\n * @param {Html Element} element The start checking html element\r\n * @return {Html Element} Parent element or null\r\n */\r\njslet.ui.findJsletParent = function(element){\r\n\treturn jslet.ui.findFirstParent(element, function(ele){\r\n\t\treturn ele.jslet ? true:false; \r\n\t});\r\n};\r\n\r\n/**\r\n * Check one node is a child of another node or not.\r\n * \r\n * @param {Html Element} parentNode parent node;\r\n * @param {Html Element} testNode, testing node\r\n * @return {Boolean} true - 'testNode' is a child of 'parentNode', false - otherwise.\r\n */\r\njslet.ui.isChild = function(parentNode, testNode) {\r\n\tif(!parentNode || !testNode) {\r\n\t\treturn false;\r\n\t}\r\n\tvar p = testNode;\r\n\twhile(p) {\r\n\t\tif(p == parentNode) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tp = p.parentNode;\r\n\t}\r\n\treturn false;\r\n};\r\n\r\n/**\r\n* Text Measurer, measure the display width or height of the given text. Example:\r\n* <pre><code>\r\n*   jslet.ui.textMeasurer.setElement(document.body);\r\n*   try{\r\n\t\tvar width = jslet.ui.textMeasurer.getWidth('HellowWorld');\r\n\t\tvar height = jslet.ui.textMeasurer.getHeight('HellowWorld');\r\n\t}finally{\r\n\t\tjslet.ui.textMeasurer.setElement();\r\n\t}\r\n* </code></pre>\r\n* \r\n*/\r\njslet.ui.TextMeasurer = function () {\r\n\tvar rule,felement = document.body,felementWidth;\r\n\r\n\tvar lastText = null;\r\n\t\r\n\tvar createRule = function () {\r\n\t\tif (!rule) {\r\n\t\t\trule = document.createElement('div');\r\n\t\t\tdocument.body.appendChild(rule);\r\n\t\t\trule.style.position = 'absolute';\r\n\t\t\trule.style.left = '-9999px';\r\n\t\t\trule.style.top = '-9999px';\r\n\t\t\trule.style.display = 'none';\r\n\t\t\trule.style.margin = '0px';\r\n\t\t\trule.style.padding = '0px';\r\n\t\t\trule.style.overflow = 'hidden';\r\n\t\t}\r\n\t\tif (!felement) {\r\n\t\t\tfelement = document.body;\r\n\t\t}\r\n\t};\r\n\r\n\t/**\r\n\t * Set html element which to be used as rule. \r\n\t * \r\n\t * @param {Html Element} element \r\n\t */\r\n\tthis.setElement = function (element) {\r\n\t\tfelement = element;\r\n\t\tif (!felement) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tcreateRule();\r\n\t\trule.style.fontSize = felement.style.fontSize;\r\n\t\trule.style.fontStyle = felement.style.fontStyle;\r\n\t\trule.style.fontWeight = felement.style.fontWeight;\r\n\t\trule.style.fontFamily = felement.style.fontFamily;\r\n\t\trule.style.lineHeight = felement.style.lineHeight;\r\n\t\trule.style.textTransform = felement.style.textTransform;\r\n\t\trule.style.letterSpacing = felement.style.letterSpacing;\r\n\t};\r\n\r\n\tthis.setElementWidth = function (width) {\r\n\t\tfelementWidth = width;\r\n\t\tif (!felement) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (width) {\r\n\t\t\tfelement.style.width = width;\r\n\t\t} else {\r\n\t\t\tfelement.style.width = '';\r\n\t\t}\r\n\t};\r\n\r\n\tfunction updateText(text){\r\n\t\tif (lastText != text) {\r\n\t\t\trule.innerHTML = text;\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * Get the display size of specified text\r\n\t * \r\n\t * @param {String} text The text to be measured\r\n\t * \r\n\t * @return {Integer} Display size, unit: px\r\n\t */\r\n\tthis.getSize = function (text) {\r\n\t\tcreateRule();\r\n\t\tupdateText(text);\r\n\t\tvar ruleObj = jQuery(rule);\r\n\t\treturn {width:ruleObj.width(),height:ruleObj.height()};\r\n\t};\r\n\r\n\t/**\r\n\t * Get the display width of specified text\r\n\t * \r\n\t * @param {String} text The text to be measured\r\n\t * \r\n\t * @return {Integer} Display width, unit: px\r\n\t */\r\n\tthis.getWidth = function (text) {\r\n\t\treturn this.getSize(text).width;\r\n\t};\r\n\r\n\t/**\r\n\t * Get the display height of specified text\r\n\t * \r\n\t * @param {String} text The text to be measured\r\n\t * \r\n\t * @return {Integer} Display height, unit: px\r\n\t */\r\n\tthis.getHeight = function (text) {\r\n\t\treturn this.getSize(text).height;\r\n\t};\r\n};\r\n\r\njslet.ui.textMeasurer = new jslet.ui.TextMeasurer();\r\n\r\n/**\r\n * Get css property value. Example:\r\n * <pre><code>\r\n * var width = jslet.ui.getCssValue('fooClass', 'width'); //Return value like '100px' or '200em'\r\n * </code></pre>\r\n * \r\n * @param {String} className Css class name.\r\n * @param {String} styleName style name\r\n * \r\n * @return {String} Css property value.\r\n */\r\njslet.ui.getCssValue = function(className, styleName){\r\n\tvar odiv = document.createElement('div');\r\n\todiv.className = className;\r\n\todiv.style.display = 'none';\r\n\tdocument.body.appendChild(odiv);\r\n\tvar result = jQuery(odiv).css(styleName);\r\n\t\r\n\tdocument.body.removeChild(odiv);\r\n\treturn result;\r\n};\r\n\r\njslet.ui.setEditableStyle = function(formElement, disabled, readOnly, onlySetStyle, required) {\r\n\tif(!onlySetStyle) {\r\n\t\tformElement.disabled = disabled;\r\n\t\tformElement.readOnly = readOnly;\r\n\t}\r\n\tvar jqEl = jQuery(formElement);\r\n\tif(disabled || readOnly) {\r\n\t\tif (!jqEl.hasClass('jl-readonly')) {\r\n\t\t\tjqEl.addClass('jl-readonly');\r\n\t\t\tjqEl.removeClass('jl-ctrl-required');\r\n\t\t}\r\n\t} else {\r\n\t\tjqEl.removeClass('jl-readonly');\r\n\t\tif(required) {\r\n\t\t\tjqEl.addClass('jl-ctrl-required');\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * Get system scroll bar width\r\n * \r\n * @return {Integer} scroll bar width\r\n */\r\njslet.scrollbarSize = function() {\r\n\tvar parent, child, width, height;\r\n\r\n\tif (width === undefined) {\r\n\t\tparent = jQuery('<div style=\"width:50px;height:50px;overflow:auto\"><div/></div>').appendTo('body');\r\n\t\tchild = parent.children();\r\n\t\twidth = child.innerWidth() - child.height(99).innerWidth();\r\n\t\tparent.remove();\r\n\t}\r\n\r\n\treturn width;\r\n};\r\n\r\n/**\r\n * Control focus manager.\r\n * \r\n * @param containerId {String} container id, if containerid is not specified, container is document.\r\n */\r\njslet.ui.FocusManager = function(containerId) {\r\n\tthis._onChangingFocus = null;\r\n\tthis._focusKeyCode = null;\r\n\tthis._containerId = containerId;\r\n\t\r\n\tthis.initialize();\r\n}\r\n\r\njslet.ui.FocusManager.prototype = {\r\n\t/**\r\n\t * Get or set onChangingFocus event handler. \r\n\t * \r\n\t * @param onChangingFocus {Function} event handler, pattern:\r\n\t * function doChangingFocus(element, reserve, datasetObj, fieldName) {\r\n\t * \t\tconsole.log('Changind focus');\r\n\t * }\r\n\t * \r\n\t * focusManager.onChangingFocus(doChangingFocus);\r\n\t * \r\n\t */\r\n\tonChangingFocus: function(onChangingFocus) {\r\n\t\tif(onChangingFocus === undefined) {\r\n\t\t\treturn this._onChangingFocus;\r\n\t\t}\r\n\t\tjslet.Checker.test('FocusManager.onChangingFocus', onChangingFocus).isFunction();\r\n\t\tthis._onChangingFocus = onChangingFocus;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get or set 'focusKeyCode'\r\n\t * \r\n\t * @param {Integer} focusKeyCode - Key code for changing focus.\r\n\t * \r\n\t */\r\n\tfocusKeyCode: function(focusKeyCode) {\r\n\t\tif(focusKeyCode === undefined) {\r\n\t\t\treturn this._focusKeyCode;\r\n\t\t}\r\n\t\tjslet.Checker.test('FocusManager.focusKeyCode', focusKeyCode).isNumber();\r\n\t\tthis._focusKeyCode = focusKeyCode;\r\n\t},\r\n\t\r\n\tinitialize: function() {\r\n\t\tfunction isTabableElement(ele) {\r\n\t\t\tvar tagName = ele.tagName;\r\n\t\t\tif(tagName == 'TEXTAREA' || tagName == 'A' || tagName == 'BUTTON') {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tif(tagName == 'INPUT') {\r\n\t\t\t\tvar typeAttr = ele.type;\r\n\t\t\t\tif(typeAttr == 'button' || typeAttr == 'image' || typeAttr == 'reset' || typeAttr == 'submit' || typeAttr == 'url' || typeAttr == 'file') {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\t\r\n\t\tvar Z = this;\r\n\t\t\r\n\t\tfunction doChangingFocus(ele, reverse) {\r\n\t\t\tvar ojslet = jslet(ele), \r\n\t\t\t\tdsObj = null, fldName = null, valueIndex = null;\r\n\t\t\tif(ojslet) {\r\n\t\t\t\tif(ojslet.dataset) {\r\n\t\t\t\t\tdsObj = ojslet.dataset();\t\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif(ojslet.field) {\r\n\t\t\t\t\tfldName = ojslet.field();\t\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif(ojslet.valueIndex) {\r\n\t\t\t\t\tvalueIndex = ojslet.valueIndex();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(!Z._onChangingFocus) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\treturn Z._onChangingFocus(ele, reverse, dsObj, fldName, valueIndex);\r\n\t\t}\r\n\t\t\r\n\t\tfunction handleHostKeyDown(event) {\r\n\t\t\tvar focusKeyCode = Z._focusKeyCode || jslet.global.defaultFocusKeyCode || 9;\r\n\t\t\tvar keyCode = event.which;\r\n\t\t\tif(keyCode === focusKeyCode || keyCode === 9) {\r\n\t\t\t\tif(keyCode !== 9 && !isTabableElement(event.target)) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tif(this._containerId) {\r\n\t\t\t\t\tjqHost = jQuery('#' + this._containerId);\r\n\t\t\t\t\tif(jqHost.length === 0) {\r\n\t\t\t\t\t\tthrow new Error('Not found container: ' + this._containerId);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tjqHost = jQuery(document);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif(event.shiftKey){\r\n\t\t\t\t\tjQuery.tabPrev(jqHost, true, doChangingFocus);\r\n\t\t\t\t}\r\n\t\t\t\telse{\r\n\t\t\t\t\tjQuery.tabNext(jqHost, true, doChangingFocus);\r\n\t\t\t\t}\r\n\t\t\t\tevent.preventDefault();\r\n\t       \t\tevent.stopImmediatePropagation();\r\n\t       \t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar jqHost;\r\n\t\tif(this._containerId) {\r\n\t\t\tjqHost = jQuery('#' + this._containerId);\r\n\t\t\tif(jqHost.length === 0) {\r\n\t\t\t\tthrow new Error('Not found container: ' + this._containerId);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tjqHost = jQuery(document);\r\n\t\t}\r\n\t\tjqHost.keydown(handleHostKeyDown);\r\n\t}\r\n}\r\n\r\njslet.ui.rootFocusManager = new jslet.ui.FocusManager();\r\n\r\n\n/* ========================================================================\r\n * Jslet framework: jslet.accordion.js\r\n *\r\n * Copyright (c) 2014 Jslet Group(https://github.com/jslet/jslet/)\r\n * Licensed under MIT (https://github.com/jslet/jslet/LICENSE.txt)\r\n * ======================================================================== */\r\n\r\n/**\r\n * @class Accordion. Example:\r\n * <pre><code>\r\n * var jsletParam = {type:\"Accordion\",selectedIndex:1,items:[{caption:\"Caption1\"},{caption:\"Caption2\"}]};\r\n * //1. Declaring:\r\n *\t&lt;div data-jslet='jsletParam' style=\"width: 300px; height: 400px;\">\r\n *     &lt;div>content1&lt;/div>\r\n *     &lt;div>content2&lt;/div>\r\n *    &lt;/div>\r\n *  \r\n *  //2. Binding\r\n *    &lt;div id='ctrlId'>\r\n *      &lt;div>content1&lt;/div>\r\n *      &lt;div>content2&lt;/div>\r\n *    &lt;/div>\r\n *    //Js snippet\r\n *    var el = document.getElementById('ctrlId');\r\n *    jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *  //3. Create dynamically\r\n *    jslet.ui.createControl(jsletParam, document.body);\r\n *\r\n * </code></pre>\r\n */\r\njslet.ui.Accordion = jslet.Class.create(jslet.ui.Control, {\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.el = el;\r\n\t\tZ.allProperties = 'selectedIndex,onChanged,items';\r\n\r\n\t\tZ._selectedIndex = 0;\r\n\t\t\r\n\t\tZ._onChanged = null;\r\n\t\t\r\n\t\t/**\r\n\t\t * Array of accordion items,like: [{caption: 'cap1'},{caption: 'cap2'}]\r\n\t\t */\r\n\t\tZ._items = null;\r\n\t\t\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * Selected index.\r\n\t * \r\n\t * @param {Integer or undefined} index selected index.\r\n\t * @return {this or Integer}\r\n\t */\r\n\tselectedIndex: function(index) {\r\n\t\tif(index === undefined) {\r\n\t\t\treturn this._selectedIndex;\r\n\t\t}\r\n\t\tjslet.Checker.test('Accordion.selectedIndex', index).isGTEZero();\r\n\t\tthis._selectedIndex = index;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Fired when user changes accordion panel.\r\n\t * Pattern: \r\n\t *\tfunction(index){}\r\n\t *\t//index: Integer\r\n\t *\r\n\t * @param {Function or undefined} onChanged Accordion panel changed event handler.\r\n\t * @return {this or Function}\r\n\t */\r\n\tonChanged: function(onChanged) {\r\n\t\tif(onChanged === undefined) {\r\n\t\t\treturn this._onChanged;\r\n\t\t}\r\n\t\tjslet.Checker.test('Accordion.onChanged', onChanged).isFunction();\r\n\t\tthis._onChanged = onChanged;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Accordion items.\r\n\t * Pattern:\r\n\t * [{caption:'item1'},...]\r\n\t * \r\n\t * @param {PlanObject[] or undefined} items\r\n\t * @return {this or PlanObject[]} \r\n\t */\r\n\titems: function(items) {\r\n\t\tif(items === undefined) {\r\n\t\t\treturn this._items;\r\n\t\t}\r\n\t\tjslet.Checker.test('Accordion.items', items).isArray();\r\n\t\tvar item;\r\n\t\tfor(var i = 0, len = items.length; i < len; i++) {\r\n\t\t\titem = items[i];\r\n\t\t\tjslet.Checker.test('Accordion.items.caption', item.caption).isString().required();\r\n\t\t}\r\n\t\tthis._items = items;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tthis.renderAll();\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tvar Z = this;\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tif (!jqEl.hasClass('jl-accordion')) {\r\n\t\t\tjqEl.addClass('jl-accordion jl-border-box jl-round5');\r\n\t\t}\r\n\t\tvar panels = jqEl.find('>div'), jqCaption, headHeight = 0, item;\r\n\r\n\t\tvar captionCnt = Z._items ? Z._items.length - 1: -1, caption;\r\n\t\tpanels.before(function(index) {\r\n\t\t\tif (index <= captionCnt) {\r\n\t\t\t\tcaption = Z._items[index].caption;\r\n\t\t\t} else {\r\n\t\t\t\tcaption = 'caption' + index;\r\n\t\t\t}\r\n\t\t\treturn '<button class=\"btn btn-default jl-accordion-head btn-sm\" jsletindex = \"' + index + '\">' + caption + '</button>';\r\n\t\t});\r\n\r\n\t\tvar jqCaptions = jqEl.find('>.jl-accordion-head');\r\n\t\tjqCaptions.click(Z._doCaptionClick);\r\n\t\t\r\n\t\theadHeight = jqCaptions.outerHeight() * panels.length;\r\n\t\tvar contentHeight = jqEl.innerHeight() - headHeight-1;\r\n\t\t\r\n\t\tpanels.wrap('<div class=\"jl-accordion-body\" style=\"height:'+contentHeight+'px;display:none\"></div>');\r\n        Z.setSelectedIndex(Z._selectedIndex, true);\r\n\t},\r\n\t\r\n\t_doCaptionClick: function(event){\r\n\t\tvar jqCaption = jQuery(event.currentTarget),\r\n\t\t\tZ = jslet.ui.findJsletParent(jqCaption[0]).jslet,\r\n\t\t\tk = parseInt(jqCaption.attr('jsletindex'));\r\n\t\tZ.setSelectedIndex(k);\r\n\t},\r\n\t\r\n\t/**\r\n\t * Set selected index\r\n\t * \r\n\t * @param {Integer} index Panel index, start at 0.\r\n\t */\r\n\tsetSelectedIndex: function(index, isRenderAll){\r\n\t\tif (!index) {\r\n\t\t\tindex = 0;\r\n\t\t}\r\n\t\tvar Z = this;\r\n\t\tvar jqBodies = jQuery(Z.el).find('>.jl-accordion-body');\r\n\t\tvar pnlCnt = jqBodies.length - 1;\r\n\t\tif (index > pnlCnt) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (Z._selectedIndex == index && index < pnlCnt){\r\n\t\t\tjQuery(jqBodies[index]).slideUp('fast');\r\n\t\t\tif(!isRenderAll || isRenderAll && index > 0) {\r\n\t\t\t\tindex++;\r\n\t\t\t}\r\n\t\t\tjQuery(jqBodies[index]).slideDown('fast');\r\n\t\t\tZ._selectedIndex = index;\r\n\t\t\tif (Z._onChanged){\r\n\t\t\t\tZ._onChanged.call(this, index);\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (Z._selectedIndex >= 0 && Z._selectedIndex != index) {\r\n\t\t\tjQuery(jqBodies[Z._selectedIndex]).slideUp('fast');\r\n\t\t}\r\n\t\tjQuery(jqBodies[index]).slideDown('fast');\r\n\t\tZ._selectedIndex = index;\r\n\t\tif (Z._onChanged){\r\n\t\t\tZ._onChanged.call(this, index);\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\tvar jqEl = jQuery(this.el);\r\n\t\tjqEl.find('>.jl-accordion-head').off();\r\n\t\t$super();\r\n\t}\r\n});\r\njslet.ui.register('Accordion', jslet.ui.Accordion);\r\njslet.ui.Accordion.htmlTemplate = '<div></div>';\r\n\n/* ========================================================================\r\n * Jslet framework: jslet.calendar.js\r\n *\r\n * Copyright (c) 2014 Jslet Group(https://github.com/jslet/jslet/)\r\n * Licensed under MIT (https://github.com/jslet/jslet/LICENSE.txt)\r\n * ======================================================================== */\r\n\r\n/**\r\n * @class Calendar. Example:\r\n * <pre><code>\r\n *  var jsletParam = {type:\"Calendar\"};\r\n *  //1. Declaring:\r\n *    &lt;div data-jslet='type:\"Calendar\"' />\r\n *\r\n *  //2. Binding\r\n *    &lt;div id='ctrlId' />\r\n *    //js snippet \r\n *    var el = document.getElementById('ctrlId');\r\n *    jslet.ui.bindControl(el, jsletParam);\r\n *\t\r\n *  //3. Create dynamically\r\n *    jslet.ui.createControl(jsletParam, document.body);\r\n *\r\n * </code></pre>\r\n */\r\njslet.ui.Calendar = jslet.Class.create(jslet.ui.Control, {\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.el = el;\r\n\t\tZ.allProperties = 'value,onDateSelected,minDate,maxDate';\r\n\r\n\t\tZ._value = null;\r\n\t\t\r\n\t\tZ._onDateSelected = null;\r\n\t\t\r\n\t\tZ._minDate = null;\r\n\r\n\t\tZ._maxDate = null;\r\n\t\t\r\n\t\tZ._currYear = 0;\r\n\t\tZ._currMonth = 0;\r\n\t\tZ._currDate = 0;\r\n\t\t\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * Calendar value.\r\n\t * \r\n\t * @param {Date or undefined} value calendar value.\r\n\t * @param {Date or undefined}\r\n\t */\r\n\tvalue: function(value) {\r\n\t\tif(value === undefined) {\r\n\t\t\treturn this._value;\r\n\t\t}\r\n\t\tjslet.Checker.test('Calendar.value', value).isDate();\r\n\t\tthis._value = value;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Set or get minimum date of calendar range.\r\n\t * \r\n\t * @param {Date or undefined} minDate minimum date of calendar range \r\n\t * @return {this or Date}\r\n\t */\r\n\tminDate: function(minDate) {\r\n\t\tif(minDate === undefined) {\r\n\t\t\treturn this._minDate;\r\n\t\t}\r\n\t\tjslet.Checker.test('Calendar.minDate', minDate).isDate();\r\n\t\tthis._minDate = minDate;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Set or get maximum date of calendar range.\r\n\t * \r\n\t * @param {Date or undefined} maxDate maximum date of calendar range \r\n\t * @return {this or Date}\r\n\t */\r\n\tmaxDate: function(maxDate) {\r\n\t\tif(maxDate === undefined) {\r\n\t\t\treturn this._maxDate;\r\n\t\t}\r\n\t\tjslet.Checker.test('Calendar.maxDate', maxDate).isDate();\r\n\t\tthis._maxDate = maxDate;\r\n\t},\r\n\t\t\r\n\t/**\r\n\t * Fired when user select a date.\r\n\t * Pattern: \r\n\t *\tfunction(value){}\r\n\t *\t//value: Date\r\n\t *\r\n\t * @param {Function or undefined} onDateSelected Date selected event handler.\r\n\t * @return {this or Function}\r\n\t */\r\n\tonDateSelected: function(onDateSelected) {\r\n\t\tif(onDateSelected === undefined) {\r\n\t\t\treturn this._onDateSelected;\r\n\t\t}\r\n\t\tjslet.Checker.test('Calendar.onDateSelected', onDateSelected).isFunction();\r\n\t\tthis._onDateSelected = onDateSelected;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tthis.renderAll();\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tvar Z = this;\r\n\t\tjqEl = jQuery(Z.el);\r\n\t\tif (!jqEl.hasClass('jl-calendar')) {\r\n\t\t\tjqEl.addClass('jl-calendar panel panel-default');\r\n\t\t}\r\n\t\tvar template = ['<div class=\"jl-cal-header\">',\r\n\t\t\t'<a class=\"jl-cal-btn jl-cal-yprev\" title=\"', jslet.locale.Calendar.yearPrev,\r\n\t\t\t'\" href=\"javascript:;\">&lt;&lt;</a><a href=\"javascript:;\" class=\"jl-cal-btn jl-cal-mprev\" title=\"', jslet.locale.Calendar.monthPrev, '\">&lt;',\r\n\t\t\t'</a><a href=\"javascript:;\" class=\"jl-cal-title\"></a><a href=\"javascript:;\" class=\"jl-cal-btn jl-cal-mnext\" title=\"', jslet.locale.Calendar.monthNext, '\">&gt;',\r\n\t\t\t'</a><a href=\"javascript:;\" class=\"jl-cal-btn jl-cal-ynext\" title=\"', jslet.locale.Calendar.yearNext, '\">&gt;&gt;</a>',\r\n\t\t'</div>',\r\n\t\t'<div class=\"jl-cal-body\">',\r\n\t\t\t'<table cellpadding=\"0\" cellspacing=\"0\">',\r\n\t\t\t\t'<thead><tr><th class=\"jl-cal-weekend\">',\r\n\t\t\t\tjslet.locale.Calendar.Sun,\r\n\t\t\t\t\t'</th><th>',\r\n\t\t\t\t\tjslet.locale.Calendar.Mon,\r\n\t\t\t\t\t\t'</th><th>',\r\n\t\t\t\t\tjslet.locale.Calendar.Tue,\r\n\t\t\t\t\t\t'</th><th>',\r\n\t\t\t\t\tjslet.locale.Calendar.Wed,\r\n\t\t\t\t\t\t'</th><th>',\r\n\t\t\t\t\tjslet.locale.Calendar.Thu,\r\n\t\t\t\t\t\t'</th><th>',\r\n\t\t\t\t\tjslet.locale.Calendar.Fri,\r\n\t\t\t\t\t\t'</th><th class=\"jl-cal-weekend\">',\r\n\t\t\t\t\tjslet.locale.Calendar.Sat,\r\n\t\t\t\t\t\t'</th></tr></thead><tbody>',\r\n\t\t\t\t\t\t'<tr><td class=\"jl-cal-weekend\"><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\"></a></td><td class=\"jl-cal-weekend\"><a href=\"javascript:;\"></a></td></tr>',\r\n\t\t\t\t\t\t'<tr><td class=\"jl-cal-weekend\"><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\"></a></td><td class=\"jl-cal-weekend\"><a href=\"javascript:;\"></a></td></tr>',\r\n\t\t\t\t\t\t'<tr><td class=\"jl-cal-weekend\"><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\"></a></td><td class=\"jl-cal-weekend\"><a href=\"javascript:;\"></a></td></tr>',\r\n\t\t\t\t\t\t'<tr><td class=\"jl-cal-weekend\"><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\" class=\"jl-cal-disable\"></a></td><td><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\"></a></td><td class=\"jl-cal-weekend\"><a href=\"javascript:;\"></a></td></tr>',\r\n\t\t\t\t\t\t'<tr><td class=\"jl-cal-weekend\"><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\" class=\"jl-cal-disable\"></a></td><td><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\"></a></td><td class=\"jl-cal-weekend\"><a href=\"javascript:;\"></a></td></tr>',\r\n\t\t\t\t\t\t'<tr><td class=\"jl-cal-weekend\"><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\"></a></td><td><a href=\"javascript:;\"></a></td><td class=\"jl-cal-weekend\"><a href=\"javascript:;\"></a></td></tr>',\r\n\t\t\t\t\t\t'</tbody></table></div><div class=\"jl-cal-footer\"><a class=\"jl-cal-today\" href=\"javascript:;\">', jslet.locale.Calendar.today, '</a></div>'];\r\n\r\n\t\tjqEl.html(template.join(''));\r\n\t\tvar jqTable = jqEl.find('.jl-cal-body table');\r\n\t\tZ._currYear = -1;\r\n\t\tjqTable.on('click', Z._doTableClick);\r\n\t\t\r\n\t\tvar dvalue = Z._value && jslet.isDate(Z._value) ? Z._value : new Date();\r\n\t\tthis.setValue(dvalue);\r\n\t\tjqEl.find('.jl-cal-today').click(function (event) {\r\n\t\t\tvar d = new Date();\r\n\t\t\tZ.setValue(new Date(d.getFullYear(), d.getMonth(), d.getDate()));\r\n\t\t\tZ._fireSelectedEvent();\r\n\t\t});\r\n\t\t\r\n\t\tjqEl.find('.jl-cal-yprev').click(function (event) {\r\n\t\t\tZ.incYear(-1);\r\n\t\t});\r\n\t\t\r\n\t\tjqEl.find('.jl-cal-mprev').click(function (event) {\r\n\t\t\tZ.incMonth(-1);\r\n\t\t});\r\n\t\t\r\n\t\tjqEl.find('.jl-cal-ynext').click(function (event) {\r\n\t\t\tZ.incYear(1);\r\n\t\t});\r\n\t\t\r\n\t\tjqEl.find('.jl-cal-mnext').click(function (event) {\r\n\t\t\tZ.incMonth(1);\r\n\t\t});\r\n\t\t\r\n\t\tjqEl.on('keydown', function(event){\r\n\t\t\tvar ctrlKey = event.ctrlKey,\r\n\t\t\t\tkeyCode = event.keyCode;\r\n\t\t\tvar delta = 0;\r\n\t\t\tif(keyCode == jslet.ui.KeyCode.UP) {\r\n\t\t\t\tif(ctrlKey) {\r\n\t\t\t\t\tZ.incYear(-1);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tZ.incDate(-7);\r\n\t\t\t\t}\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\treturn;\r\n\t\t\t} \r\n\t\t\tif(keyCode == jslet.ui.KeyCode.DOWN) {\r\n\t\t\t\tif(ctrlKey) {\r\n\t\t\t\t\tZ.incYear(1);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tZ.incDate(7);\r\n\t\t\t\t}\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif(keyCode == jslet.ui.KeyCode.LEFT) {\r\n\t\t\t\tif(ctrlKey) {\r\n\t\t\t\t\tZ.incMonth(-1);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tZ.incDate(-1);\r\n\t\t\t\t}\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif(keyCode == jslet.ui.KeyCode.RIGHT) {\r\n\t\t\t\tif(ctrlKey) {\r\n\t\t\t\t\tZ.incMonth(1);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tZ.incDate(1);\r\n\t\t\t\t}\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\t\r\n\t_getNotNullDate: function() {\r\n\t\tvar value =this._value;\r\n\t\tif(!value) {\r\n\t\t\tvalue = new Date();\r\n\t\t}\r\n\t\treturn value;\r\n\t},\r\n\t\r\n\tincDate: function(deltaDay) {\r\n\t\tvar value = this._getNotNullDate();\r\n\t\tvalue.setDate(value.getDate() + deltaDay);\r\n\t\tthis.setValue(value);\r\n\t},\r\n\t\r\n\tincMonth: function(deltaMonth) {\r\n\t\tvar value = this._getNotNullDate();\r\n\t\tvalue.setMonth(value.getMonth() + deltaMonth);\r\n\t\tthis.setValue(value);\r\n\t},\r\n\t\r\n\tincYear: function(deltaYear) {\r\n\t\tvar value = this._getNotNullDate();\r\n\t\tvalue.setFullYear(value.getFullYear() + deltaYear);\r\n\t\tthis.setValue(value);\r\n\t},\r\n\t\r\n\t/**\r\n\t * Set date value of calendar.\r\n\t * \r\n\t * @param {Date} value Calendar date\r\n\t */\r\n\tsetValue: function (value) {\r\n\t\tif (!value) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar Z = this;\r\n\t\tif (Z._minDate && value < Z._minDate) {\r\n\t\t\tvalue = new Date(Z._minDate.getTime());\r\n\t\t}\r\n\t\tif (Z._maxDate && value > Z._maxDate) {\r\n\t\t\tvalue = new Date(Z._maxDate.getTime());\r\n\t\t}\r\n\t\tZ._value = value;\r\n\t\tvar y = value.getFullYear(), \r\n\t\t\tm = value.getMonth();\r\n\t\tif (Z._currYear == y && Z._currMonth == m) {\r\n\t\t\tZ._setCurrDateCls();\r\n\t\t} else {\r\n\t\t\tZ._refreshDateCell(y, m);\r\n\t\t}\r\n\t},\r\n\r\n\tfocus: function() {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el);\r\n\t\tjqEl.find('.jl-cal-current')[0].focus();\r\n\r\n\t},\r\n\t\r\n\t_checkNaviState: function () {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el), flag, btnToday;\r\n\t\tif (Z._minDate) {\r\n\t\t\tvar minY = Z._minDate.getFullYear(),\r\n\t\t\t\tminM = Z._minDate.getMonth(),\r\n\t\t\t\tbtnYearPrev = jqEl.find('.jl-cal-yprev')[0];\r\n\t\t\tflag = (Z._currYear <= minY);\r\n\t\t\tbtnYearPrev.style.visibility = (flag ? 'hidden' : 'visible');\r\n\r\n\t\t\tflag = (Z._currYear == minY && Z._currMonth <= minM);\r\n\t\t\tvar btnMonthPrev = jqEl.find('.jl-cal-mprev')[0];\r\n\t\t\tbtnMonthPrev.style.visibility = (flag ? 'hidden' : 'visible');\r\n\r\n\t\t\tflag = (Z._minDate > new Date());\r\n\t\t\tbtnToday = jqEl.find('.jl-cal-today')[0];\r\n\t\t\tbtnToday.style.visibility = (flag ? 'hidden' : 'visible');\r\n\t\t}\r\n\r\n\t\tif (Z._maxDate) {\r\n\t\t\tvar maxY = Z._maxDate.getFullYear(),\r\n\t\t\t\tmaxM = Z._maxDate.getMonth(),\r\n\t\t\t\tbtnYearNext = jqEl.find('.jl-cal-ynext')[0];\r\n\t\t\tflag = (Z._currYear >= maxY);\r\n\t\t\tbtnYearNext.jslet_disabled = flag;\r\n\t\t\tbtnYearNext.style.visibility = (flag ? 'hidden' : 'visible');\r\n\r\n\t\t\tflag = (Z._currYear == maxY && Z._currMonth >= maxM);\r\n\t\t\tvar btnMonthNext = jqEl.find('.jl-cal-mnext')[0];\r\n\t\t\tbtnMonthNext.jslet_disabled = flag;\r\n\t\t\tbtnMonthNext.style.visibility = (flag ? 'hidden' : 'visible');\r\n\r\n\t\t\tflag = (Z._maxDate < new Date());\r\n\t\t\tbtnToday = jqEl.find('.jl-cal-today')[0];\r\n\t\t\tbtnToday.style.visibility = (flag ? 'hidden' : 'visible');\r\n\t\t}\r\n\t},\r\n\r\n\t_refreshDateCell: function (year, month) {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el),\r\n\t\t\tmonthnames = jslet.locale.Calendar.monthNames,\r\n\t\t\tmname = monthnames[month],\r\n\t\t\totitle = jqEl.find('.jl-cal-title')[0];\r\n\t\totitle.innerHTML = mname + ',' + year;\r\n\t\tvar otable = jqEl.find('.jl-cal-body table')[0],\r\n\t\t\trows = otable.tBodies[0].rows,\r\n\t\t\tfirstDay = new Date(year, month, 1),\r\n\t\t\tw1 = firstDay.getDay(),\r\n\t\t\toneDayMs = 86400000, //24 * 60 * 60 * 1000\r\n\t\t\tdate = new Date(firstDay.getTime() - (w1 + 1) * oneDayMs);\r\n\t\tdate = new Date(date.getFullYear(), date.getMonth(), date.getDate());\r\n\r\n\t\tvar rowCnt = rows.length, otr, otd, m, oa;\r\n\t\tfor (var i = 1; i <= rowCnt; i++) {\r\n\t\t\totr = rows[i - 1];\r\n\t\t\tfor (var j = 1, tdCnt = otr.cells.length; j <= tdCnt; j++) {\r\n\t\t\t\totd = otr.cells[j - 1];\r\n\t\t\t\tdate = new Date(date.getTime() + oneDayMs);\r\n\t\t\t\toa = otd.firstChild;\r\n\t\t\t\tif (Z._minDate && date < Z._minDate || Z._maxDate && date > Z._maxDate) {\r\n\t\t\t\t\toa.innerHTML = '';\r\n\t\t\t\t\totd.jslet_date_value = null;\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t} else {\r\n\t\t\t\t\toa.innerHTML = date.getDate();\r\n\t\t\t\t\totd.jslet_date_value = date;\r\n\t\t\t\t}\r\n\t\t\t\tm = date.getMonth();\r\n\t\t\t\tif (m != month) {\r\n\t\t\t\t\tjQuery(otd).addClass('jl-cal-disable');\r\n\t\t\t\t} else {\r\n\t\t\t\t\tjQuery(otd).removeClass('jl-cal-disable');\r\n\t\t\t\t}\r\n\t\t\t} //end for j\r\n\t\t} //end for i\r\n\t\tZ._currYear = year;\r\n\t\tZ._currMonth = month;\r\n\t\tZ._setCurrDateCls();\r\n\t\tZ._checkNaviState();\r\n\t},\r\n\t\r\n\t_fireSelectedEvent: function() {\r\n\t\tvar Z = this;\r\n\t\tif (Z._onDateSelected) {\r\n\t\t\tZ._onDateSelected.call(Z, Z._value);\r\n\t\t}\r\n\t},\r\n\t\r\n\t_doTableClick: function (event) {\r\n\t\tevent = jQuery.event.fix( event || window.event );\r\n\t\tvar node = event.target,\r\n\t\t\totd = node.parentNode;\r\n\t\t\r\n\t\tif (otd && otd.tagName && otd.tagName.toLowerCase() == 'td') {\r\n\t\t\tif (!otd.jslet_date_value) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar el = jslet.ui.findFirstParent(otd, function (node) { return node.jslet; });\r\n\t\t\tvar Z = el.jslet;\r\n\t\t\tZ._value = otd.jslet_date_value;\r\n\t\t\tZ._setCurrDateCls();\r\n\t\t\ttry{\r\n\t\t\totd.firstChild.focus();\r\n\t\t\t}catch(e){\r\n\t\t\t}\r\n\t\t\tZ._fireSelectedEvent();\r\n\t\t}\r\n\t},\r\n\r\n\t_setCurrDateCls: function () {\r\n\t\tvar Z = this;\r\n\t\tif (!jslet.isDate(Z._value)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar currM = Z._value.getMonth(),\r\n\t\t\tcurrY = Z._value.getFullYear(),\r\n\t\t\tcurrD = Z._value.getDate(),\r\n\t\t\totable = jqEl.find('.jl-cal-body table')[0],\r\n\t\t\trows = otable.tBodies[0].rows,\r\n\t\t\trowCnt = rows.length, otr, otd, m, d, y, date, jqLink;\r\n\t\tfor (var i = 0; i < rowCnt; i++) {\r\n\t\t\totr = rows[i];\r\n\t\t\tfor (var j = 0, tdCnt = otr.cells.length; j < tdCnt; j++) {\r\n\t\t\t\totd = otr.cells[j];\r\n\t\t\t\tdate = otd.jslet_date_value;\r\n\t\t\t\tif (!date) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tm = date.getMonth();\r\n\t\t\t\ty = date.getFullYear();\r\n\t\t\t\td = date.getDate();\r\n\t\t\t\tjqLink = jQuery(otd.firstChild);\r\n\t\t\t\tif (y == currY && m == currM && d == currD) {\r\n\t\t\t\t\tif (!jqLink.hasClass('jl-cal-current')) {\r\n\t\t\t\t\t\tjqLink.addClass('jl-cal-current');\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttry{\r\n\t\t\t\t\t\totd.firstChild.focus();\r\n\t\t\t\t\t} catch(e){\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tjqLink.removeClass('jl-cal-current');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\tvar jqEl = jQuery(this.el);\r\n\t\tjqEl.off();\r\n\t\tjqEl.find('.jl-cal-body table').off();\r\n\t\tjqEl.find('.jl-cal-today').off();\r\n\t\tjqEl.find('.jl-cal-yprev').off();\r\n\t\tjqEl.find('.jl-cal-mprev').off();\r\n\t\tjqEl.find('.jl-cal-mnext').off();\r\n\t\tjqEl.find('.jl-cal-ynext').off();\r\n\t\t$super();\r\n\t}\r\n});\r\njslet.ui.register('Calendar', jslet.ui.Calendar);\r\njslet.ui.Calendar.htmlTemplate = '<div></div>';\r\n\n/* ========================================================================\r\n * Jslet framework: jslet.fieldset.js\r\n *\r\n * Copyright (c) 2014 Jslet Group(https://github.com/jslet/jslet/)\r\n * Licensed under MIT (https://github.com/jslet/jslet/LICENSE.txt)\r\n * ======================================================================== */\r\n\r\n/**\r\n * @class FieldSet. Example:\r\n * <pre><code>\r\n *   //1. Declaring:\r\n *      &lt;div data-jslet='type:\"FieldSet\"' />\r\n *\r\n *  //2. Binding\r\n *      &lt;div id='ctrlId' />\r\n *      //Js snippet\r\n *      var jsletParam = {type:\"FieldSet\"};\r\n *      var el = document.getElementById('ctrlId');\r\n *      jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *  //3. Create dynamically\r\n *      var jsletParam = {type:\"FieldSet\"};\r\n *      jslet.ui.createControl(jsletParam, document.body);\r\n *\r\n * </code></pre>\r\n */\r\njslet.ui.FieldSet = jslet.Class.create(jslet.ui.Control, {\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.el = el;\r\n\t\tZ.allProperties = 'caption,collapsed';\r\n\r\n\t\tZ._caption = null; \r\n\t\t\r\n\t\tZ._collapsed = false;\r\n\t\t\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * Set or get caption of fieldset.\r\n\t * \r\n\t * @param {String or undefined} caption caption of fieldset. \r\n\t * @return {this or String}\r\n\t */\r\n\tcaption: function(caption) {\r\n\t\tif(caption === undefined) {\r\n\t\t\treturn this._caption;\r\n\t\t}\r\n\t\tjslet.Checker.test('FieldSet.caption', caption).isString();\r\n\t\tthis._caption = caption;\r\n\t},\r\n\r\n\t/**\r\n\t * Identify fieldset is collapsed or not.\r\n\t * \r\n\t * @param {Boolean or undefined} collapsed true - fieldset is collapsed, false(default) - otherwise. \r\n\t * @return {this or Boolean}\r\n\t */\r\n\tcollapsed: function(collapsed) {\r\n\t\tif(collapsed === undefined) {\r\n\t\t\treturn this._collapsed;\r\n\t\t}\r\n\t\tthis._collapsed = collapsed ? true: false;\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tthis.renderAll();\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tvar Z = this, jqEl = jQuery(Z.el);\r\n\t\tif (!jqEl.hasClass('jl-fieldset')) {\r\n\t\t\tjqEl.addClass('jl-fieldset jl-round5');\r\n\t\t}\r\n\t\t\r\n\t\tvar tmpl = ['<legend class=\"jl-fieldset-legend\">'];\r\n\t\ttmpl.push('<span class=\"jl-fieldset-title\"><i class=\"fa fa-chevron-circle-up jl-fieldset-btn\">');\r\n\t\ttmpl.push('<span>');\r\n\t\ttmpl.push(Z._caption);\r\n\t\ttmpl.push('</span></span></legend><div class=\"jl-fieldset-body\"></div>');\r\n\t\t\r\n\t\tvar nodes = Z.el.childNodes, \r\n\t\t\tchildren = [],\r\n\t\t\ti, cnt;\r\n\t\tcnt = nodes.length;\r\n\t\tfor(i = 0; i < cnt; i++){\r\n\t\t\tchildren.push(nodes[i]);\r\n\t\t}\r\n\r\n\t\tjqEl.html(tmpl.join(''));\r\n\t\tvar obody = jQuery(Z.el).find('.jl-fieldset-body')[0];\r\n\t\tcnt = children.length;\r\n\t\tfor(i = 0; i < cnt; i++){\r\n\t\t\tobody.appendChild(children[i]);\r\n\t\t}\r\n\t\t\r\n\t\tjqEl.find('.jl-fieldset-btn').click(jQuery.proxy(Z._doExpandBtnClick, this));\r\n\t},\r\n\t\r\n\t_doExpandBtnClick: function(){\r\n\t\tvar Z = this, jqEl = jQuery(Z.el);\r\n\t\tvar fsBody = jqEl.find('.jl-fieldset-body');\r\n\t\tif (!Z._collapsed){\r\n\t\t\tfsBody.slideUp();\r\n\t\t\tjqEl.addClass('jl-fieldset-collapse');\r\n\t\t\tjqEl.find('.jl-fieldset-btn').addClass('fa-chevron-circle-down');\r\n\t\t}else{\r\n\t\t\tfsBody.slideDown();\r\n\t\t\tjqEl.removeClass('jl-fieldset-collapse');\r\n\t\t\tjqEl.find('.jl-fieldset-btn').removeClass('fa-chevron-circle-down');\r\n\t\t}\r\n\t\tfsBody[0].focus();\r\n\t\tZ._collapsed = !Z._collapsed;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\tvar jqEl = jQuery(this.el);\r\n\t\tjqEl.find('input.jl-fieldset-btn').off();\r\n\t\t$super();\r\n\t}\r\n});\r\n\r\njslet.ui.register('FieldSet', jslet.ui.FieldSet);\r\njslet.ui.FieldSet.htmlTemplate = '<fieldset></fieldset>';\r\n\n/* ========================================================================\r\n * Jslet framework: jslet.menu.js\r\n *\r\n * Copyright (c) 2014 Jslet Group(https://github.com/jslet/jslet/)\r\n * Licensed under MIT (https://github.com/jslet/jslet/LICENSE.txt)\r\n * ======================================================================== */\r\n\r\n/**\r\n* Menu Manager\r\n*/\r\njslet.ui.menuManager = {};\r\n/**\r\n * Global menu id collection, array of string\r\n */\r\njslet.ui.menuManager._menus = [];\r\n\r\n/**\r\n * Register menu id\r\n * \r\n * @param {String} menuid Menu control id\r\n */\r\njslet.ui.menuManager.register = function (menuid) {\r\n\tjslet.ui.menuManager._menus.push(menuid);\r\n};\r\n\r\n/**\r\n * Unregister menu id\r\n * \r\n * @param {String} menuid Menu control id\r\n */\r\njslet.ui.menuManager.unregister = function (menuid) {\r\n\tfor (var i = 0, len = this._menus.length; i < len; i++) {\r\n\t\tjslet.ui.menuManager._menus.splice(i, 1);\r\n\t}\r\n};\r\n\r\n/**\r\n * Hide all menu item.\r\n */\r\njslet.ui.menuManager.hideAll = function (event) {\r\n\tvar id, menu, menus = jslet.ui.menuManager._menus;\r\n\tfor (var i = 0, len = menus.length; i < len; i++) {\r\n\t\tid = menus[i];\r\n\t\tmenu = jslet('#'+id);\r\n\t\tif (menu) {\r\n\t\t\tmenu.hide();\r\n\t\t}\r\n\t}\r\n\tjslet.ui.menuManager.menuBarShown = false;\r\n\tjslet.ui.menuManager._contextObject = null;\r\n};\r\n\r\njQuery(document).on('mousedown', jslet.ui.menuManager.hideAll);\r\n\r\n/**\r\n * @class Calendar. Example:\r\n * <pre><code>\r\n *  var jsletParam = { type: 'MenuBar', onItemClick: globalMenuItemClick, items: [\r\n *\t\t{ name: 'File', items: [\r\n *         { id: 'new', name: 'New Tab', iconClass: 'icon1' }]\r\n *      }]};\r\n *\r\n *  //1. Declaring:\r\n *    &lt;div data-jslet='jsletParam' />\r\n *\r\n *  //2. Binding\r\n *    &lt;div id='ctrlId' />\r\n *    //js snippet:\r\n *    var el = document.getElementById('ctrlId');\r\n *    jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *  //3. Create dynamically\r\n *    jslet.ui.createControl(jsletParam, document.body);\r\n *\r\n * </code></pre>\r\n */\r\njslet.ui.MenuBar = jslet.Class.create(jslet.ui.Control, {\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.el = el;\r\n\t\tZ.allProperties = 'onItemClick,items';\r\n\r\n\t\tZ._onItemClick = null;\r\n\t\t\r\n\t\tZ._items = null;\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set menuItem click event handler\r\n\t * Pattern: \r\n\t * function(menuId){}\r\n\t *   //menuId: String\r\n\t * \r\n\t * @param {Function or undefined} onItemClick menuItem click event handler\r\n\t * @param {this or Function}\r\n\t */\r\n\tonItemClick: function(onItemClick) {\r\n\t\tif(onItemClick === undefined) {\r\n\t\t\treturn this._onItemClick;\r\n\t\t}\r\n\t\tjslet.Checker.test('MenuBar.onItemClick', onItemClick).isFunction();\r\n\t\tthis._onItemClick = onItemClick;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get or set menu items configuration.\r\n\t * \r\n\t * menu item's properties: \r\n\t * id, //{String} Menu id\r\n\t * name, //{String} Menu name \r\n\t * onClick, //{Event} Item click event, \r\n\t *   Pattern: function(event){}\r\n\t *   \r\n\t * disabled, //{Boolean} Menu item is disabled or not\r\n\t * iconClass,  //{String} Icon style class \r\n\t * disabledIconClass, //{String} Icon disabled style class\r\n\t * itemType, //{String} Menu item type, optional value: null, radio, check\r\n\t * checked, //{Boolean} Menu item is checked or not,  only work when itemType equals 'radio' or 'check'\r\n\t * group, //{String} Group name, only work when itemType equals 'radio'\r\n\t * items, //{Array} Sub menu items\r\n\t * \r\n\t * @param {PlanObject[] or undefined} items menu items.\r\n\t * @param {this or PlanObject[]}\r\n\t */\r\n\titems: function(items) {\r\n\t\tif(items === undefined) {\r\n\t\t\treturn this._items;\r\n\t\t}\r\n\t\tjslet.Checker.test('MenuBar.items', items).isArray();\r\n\t\tvar item;\r\n\t\tfor(var i = 0, len = items.length; i < len; i++) {\r\n\t\t\titem = items[i];\r\n\t\t\tjslet.Checker.test('MenuBar.items.name', item.name).isString().required();\r\n\t\t}\r\n\t\tthis._items = items;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tthis.renderAll();\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tvar Z = this;\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tif (!jqEl.hasClass('jl-menubar')) {\r\n\t\t\tjqEl.addClass('jl-menubar jl-unselectable jl-bgcolor jl-round5');\r\n\t\t}\r\n\r\n\t\tZ._createMenuBar();\r\n\t\tjqEl.on('mouseout',function (event) {\r\n\t\t\tif (Z._preHoverItem && !jslet.ui.menuManager.menuBarShown) {\r\n\t\t\t\tjQuery(Z._preHoverItem).removeClass('jl-menubar-item-hover');\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\r\n\t_createMenuBar: function () {\r\n\t\tvar Z = this;\r\n\t\tif (Z.isPopup) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tfor (var i = 0, cnt = Z._items.length, item; i < cnt; i++) {\r\n\t\t\titem = Z._items[i];\r\n\t\t\tZ._createBarItem(Z.el, item, Z._menubarclick);\r\n\t\t}\r\n\t},\r\n\r\n\t_showSubMenu: function (omi) {\r\n\t\tvar Z = omi.parentNode.jslet,\r\n\t\t\titemCfg = omi.jsletvar;\r\n\t\tif (!itemCfg.items) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (!itemCfg.subMenu) {\r\n\t\t\tvar el = document.createElement('div');\r\n\t\t\tdocument.body.appendChild(el);\r\n\t\t\titemCfg.subMenu = new jslet.ui.Menu(el, { onItemClick: Z._onItemClick, items: itemCfg.items });\r\n\t\t}\r\n\t\tvar jqBody = jQuery(document.body),\r\n\t\t\tbodyMTop = parseInt(jqBody.css('margin-top')),\r\n\t\t\tbodyMleft = parseInt(jqBody.css('margin-left')),\r\n\t\t\tjqMi = jQuery(omi), \r\n\t\t\tpos = jqMi.offset(), \r\n\t\t\tposX = pos.left;\r\n\t\tif (jslet.locale.isRtl) {\r\n\t\t\tposX +=  jqMi.width() + 10;\r\n\t\t}\r\n\t\titemCfg.subMenu.show(posX, pos.top + jqMi.height());\r\n\t\tjslet.ui.menuManager.menuBarShown = true;\r\n\t\tZ._activeMenuItem = omi;\r\n\t\t// this.parentNode.parentNode.jslet.ui._createMenuPopup(cfg);\r\n\t},\r\n\r\n\t_createBarItem: function (obar, itemCfg) {\r\n\t\tif (itemCfg.visible !== undefined && !itemCfg.visible) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar omi = document.createElement('div');\r\n\t\tjQuery(omi).addClass('jl-menubar-item');\r\n\t\tomi.jsletvar = itemCfg;\r\n\t\tvar Z = this, jqMi = jQuery(omi);\r\n\t\tjqMi.on('click',function (event) {\r\n\t\t\tvar cfg = this.jsletvar;\r\n\t\t\tif(!cfg.items) {\r\n\t\t\t\tif (cfg.onClick) {\r\n\t\t\t\t\tcfg.onClick.call(Z, cfg.id || cfg.name);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (Z._onItemClick)\r\n\t\t\t\t\t\tZ._onItemClick.call(Z, cfg.id || cfg.name);\r\n\t\t\t\t}\r\n\t\t\t\tjslet.ui.menuManager.hideAll();\r\n\t\t\t} else {\r\n\t\t\t\t//\t\t\t\tif (Z._activeMenuItem != this || jslet.ui.menuManager.menuBarShown)\r\n\t\t\t\tZ._showSubMenu(this);\r\n\t\t\t}\r\n\t\t\tevent.stopPropagation();\r\n\t\t\tevent.preventDefault();\r\n\t\t});\r\n\r\n\t\tjqMi.on('mouseover', function (event) {\r\n\t\t\tif (Z._preHoverItem) {\r\n\t\t\t\tjQuery(Z._preHoverItem).removeClass('jl-menubar-item-hover');\r\n\t\t\t}\r\n\t\t\tZ._preHoverItem = this;\r\n\t\t\tjQuery(this).addClass('jl-menubar-item-hover');\r\n\t\t\tif (jslet.ui.menuManager.menuBarShown) {\r\n\t\t\t\tjslet.ui.menuManager.hideAll();\r\n\t\t\t\tZ._showSubMenu(this);\r\n\t\t\t\tjslet.ui.menuManager._inPopupMenu = true;\r\n\t\t\t}\r\n\t\t});\r\n\t\t\r\n\t\tvar template = [];\r\n\t\ttemplate.push('<a class=\"jl-focusable-item\" href=\"javascript:void(0)\">');\r\n\t\ttemplate.push(itemCfg.name);\r\n\t\ttemplate.push('</a>');\r\n\t\t\r\n\t\tomi.innerHTML = template.join('');\r\n\t\tobar.appendChild(omi);\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\tvar Z = this;\r\n\t\tZ._activeMenuItem = null;\r\n\t\tZ._preHoverItem = null;\r\n\t\tZ._menubarclick = null;\r\n\t\tZ._onItemClick = null;\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tjqEl.off();\r\n\t\tjqEl.find('.jl-menubar-item').off();\r\n\t\tjqEl.find('.jl-menubar-item').each(function(){\r\n\t\t\tvar omi = this;\r\n\t\t\tif (omi.jsletvar){\r\n\t\t\t\tomi.jsletvar.subMenu = null;\r\n\t\t\t\tomi.jsletvar = null;\r\n\t\t\t}\r\n\t\t});\r\n\t\t$super();\r\n\t}\r\n});\r\njslet.ui.register('MenuBar', jslet.ui.MenuBar);\r\njslet.ui.MenuBar.htmlTemplate = '<div></div>';\r\n\r\n/**\r\n * @class Calendar. Example:\r\n * <pre><code>\r\n *  var jsletParam = { type: 'Menu', onItemClick: globalMenuItemClick, items: [\r\n *     { id: 'back', name: 'Backward', iconClass: 'icon1' },\r\n *     { id: 'go', name: 'Forward', disabled: true },\r\n *     { name: '-' }]};\r\n *\r\n *  //1. Declaring:\r\n *     &lt;div data-jslet='jsletParam' />\r\n *\r\n *  //2. Binding\r\n *     &lt;div id='menu1' />\r\n *     //js snippet:\r\n *     var el = document.getElementById('menu1');\r\n *     jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *  //3. Create dynamically\r\n *     jslet.ui.createControl(jsletParam, document.body);\r\n * //Use the below code to show context menu\r\n * jslet('#ctrlId').showContextMenu(event);\r\n * //Show menu at the specified position\r\n * jslet('#ctrlId').show(left, top);\r\n * \r\n * </code></pre>\r\n */\r\n/***\r\n* Popup Menu\r\n*/\r\njslet.ui.Menu = jslet.Class.create(jslet.ui.Control, {\r\n\t_onItemClick: undefined,\r\n\t_items:undefined,\r\n\t_invoker: null,\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.el = el;\r\n\t\tZ.allProperties = 'onItemClick,items,invoker'; //'invoker' is used for inner\r\n\t\t//items is an array, menu item's properties: id, name, onClick,disabled,iconClass,disabledIconClass,itemType,checked,group,items\r\n\t\t$super(el, params);\r\n\t\tZ._activeSubMenu = null;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set menuItem click event handler\r\n\t * Pattern: \r\n\t * function(menuId){}\r\n\t *   //menuId: String\r\n\t * \r\n\t * @param {Function or undefined} onItemClick menuItem click event handler\r\n\t * @param {this or Function}\r\n\t */\r\n\tonItemClick: function(onItemClick) {\r\n\t\tif(onItemClick === undefined) {\r\n\t\t\treturn this._onItemClick;\r\n\t\t}\r\n\t\tjslet.Checker.test('Menu.onItemClick', onItemClick).isFunction();\r\n\t\tthis._onItemClick = onItemClick;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get or set menu items configuration.\r\n\t * \r\n\t * menu item's properties: \r\n\t * id, //{String} Menu id\r\n\t * name, //{String} Menu name \r\n\t * onClick, //{Event} Item click event, \r\n\t *   Pattern: function(event){}\r\n\t *   \r\n\t * disabled, //{Boolean} Menu item is disabled or not\r\n\t * iconClass,  //{String} Icon style class \r\n\t * disabledIconClass, //{String} Icon disabled style class\r\n\t * itemType, //{String} Menu item type, optional value: null, radio, check\r\n\t * checked, //{Boolean} Menu item is checked or not,  only work when itemType equals 'radio' or 'check'\r\n\t * group, //{String} Group name, only work when itemType equals 'radio'\r\n\t * items, //{Array} Sub menu items\r\n\t * \r\n\t * @param {PlanObject[] or undefined} items menu items.\r\n\t * @param {this or PlanObject[]}\r\n\t */\r\n\titems: function(items) {\r\n\t\tif(items === undefined) {\r\n\t\t\treturn this._items;\r\n\t\t}\r\n\t\tjslet.Checker.test('Menu.items', items).isArray();\r\n\t\tvar item;\r\n\t\tfor(var i = 0, len = items.length; i < len; i++) {\r\n\t\t\titem = items[i];\r\n\t\t\tjslet.Checker.test('Menu.items.name', item.name).isString().required();\r\n\t\t}\r\n\t\tthis._items = items;\r\n\t},\r\n\t\r\n\tinvoker: function(invoker) {\r\n\t\tif(invoker === undefined) {\r\n\t\t\treturn this._invoker;\r\n\t\t}\r\n\t\tthis._invoker = invoker;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tthis.renderAll();\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el),\r\n\t\t\tele = Z.el;\r\n\t\tif (!jqEl.hasClass('jl-menu')) {\r\n\t\t\tjqEl.addClass('jl-menu');\r\n\t\t}\r\n\t\tele.style.display = 'none';\r\n\r\n\t\tif (!ele.id) {\r\n\t\t\tele.id = jslet.nextId();\r\n\t\t}\r\n\r\n\t\tjslet.ui.menuManager.register(ele.id);\r\n\t\tZ._createMenuPopup();\r\n\t\tjqEl.on('mousedown',function (event) {\r\n\t\t\tevent = jQuery.event.fix( event || window.event );\r\n\t\t\tevent.stopPropagation();\r\n\t\t\tevent.preventDefault();\r\n\t\t\treturn false;\r\n\t\t});\r\n\r\n\t\tjqEl.on('mouseover', function (event) {\r\n\t\t\tjslet.ui.menuManager._inPopupMenu = true;\r\n\t\t\tif (jslet.ui.menuManager.timerId) {\r\n\t\t\t\twindow.clearTimeout(jslet.ui.menuManager.timerId);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tjqEl.on('mouseout', function (event) {\r\n\t\t\tjslet.ui.menuManager._inPopupMenu = false;\r\n\t\t\tjslet.ui.menuManager.timerId = window.setTimeout(function () {\r\n\t\t\t\tif (!jslet.ui.menuManager._inPopupMenu) {\r\n\t\t\t\t\tjslet.ui.menuManager.hideAll();\r\n\t\t\t\t}\r\n\t\t\t\tjslet.ui.menuManager.timerId = null;\r\n\t\t\t}, 800);\r\n\t\t});\r\n\t},\r\n\r\n\t/**\r\n\t * Show menu at specified position.\r\n\t * \r\n\t * @param {Integer} left Position left\r\n\t * @param {Integer} top Position top\r\n\t */\r\n\tshow: function (left, top) {\r\n\t\tvar Z = this, \r\n\t\t\tjqEl = jQuery(Z.el),\r\n\t\t\twidth = jqEl.outerWidth(),\r\n\t\t\theight = jqEl.outerHeight(),\r\n\t\t\tjqWin = jQuery(window),\r\n\t\t\twinWidth = jqWin.scrollLeft() + jqWin.width(),\r\n\t\t\twinHeight = jqWin.scrollTop() + jqWin.height();\r\n\t\t\t\r\n\t\tleft = left || Z.left || 10;\r\n\t\ttop = top || Z.top || 10;\r\n\t\tif (jslet.locale.isRtl) {\r\n\t\t\tleft -= width;\r\n\t\t}\r\n\t\tif(left + width > winWidth) {\r\n\t\t\tleft += winWidth - left - width - 1;\r\n\t\t}\r\n\t\tif(top + height > winHeight) {\r\n\t\t\ttop += winHeight - top - height - 1;\r\n\t\t}\r\n\t\tif(left < 0) {\r\n\t\t\tleft = 0;\r\n\t\t}\r\n\t\tif(top < 0) {\r\n\t\t\ttop = 0;\r\n\t\t}\r\n\t\tZ.el.style.left = left + 'px';\r\n\t\tZ.el.style.top = parseInt(top) + 'px';\r\n\t\tZ.el.style.display = 'block';\r\n\t\tif (!Z.shadow) {\r\n\t\t\tZ.shadow = document.createElement('div');\r\n\t\t\tjQuery(Z.shadow).addClass('jl-menu-shadow');\r\n\t\t\tZ.shadow.style.width = width + 'px';\r\n\t\t\tZ.shadow.style.height = height + 'px';\r\n\t\t\tdocument.body.appendChild(Z.shadow);\r\n\t\t}\r\n\t\tZ.shadow.style.left = left + 1 + 'px';\r\n\t\tZ.shadow.style.top = top + 1 + 'px';\r\n\t\tZ.shadow.style.display = 'block';\r\n\t},\r\n\r\n\t/**\r\n\t * Hide menu item and all its sub menu item.\r\n\t */\r\n\thide: function () {\r\n\t\tthis.ctxElement = null;\r\n\t\tthis.el.style.display = 'none';\r\n\t\tif (this.shadow) {\r\n\t\t\tthis.shadow.style.display = 'none';\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Show menu on context menu. Example:\r\n\t * <pre><code>\r\n\t *  <div id=\"popmenu\" oncontextmenu=\"popMenu(event);\">\r\n\t *\tfunction popMenu(event) {\r\n\t *\tjslet(\"#popmenu\").showContextMenu(event);\r\n\t *  }\r\n\t * </code></pre>\r\n\t */\r\n\tshowContextMenu: function (event, contextObj) {\r\n\t\tjslet.ui.menuManager.hideAll();\r\n\r\n\t\tevent = jQuery.event.fix( event || window.event );\r\n\t\tjslet.ui.menuManager._contextObject = contextObj;\r\n\t\tthis.show(event.pageX, event.pageY);\r\n\t\tevent.preventDefault();\r\n\t},\r\n\r\n\t_createMenuPopup: function () {\r\n\t\tvar panel = this.el,\r\n\t\t\titems = this._items, itemCfg, name, i, cnt;\r\n\t\tcnt = items.length;\r\n\t\tfor (i = 0; i < cnt; i++) {\r\n\t\t\titemCfg = items[i];\r\n\t\t\tif (!itemCfg.name) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tname = itemCfg.name.trim();\r\n\t\t\tif (name != '-') {\r\n\t\t\t\tthis._createMenuItem(panel, itemCfg);\r\n\t\t\t} else {\r\n\t\t\t\tthis._createLine(panel, itemCfg);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar w = jQuery(panel).width() - 2 + 'px',\r\n\t\t\tarrMi = panel.childNodes, node;\r\n\t\tcnt = arrMi.length;\r\n\t\tfor (i = 0; i < cnt; i++) {\r\n\t\t\tnode = arrMi[i];\r\n\t\t\tif (node.nodeType == 1) {\r\n\t\t\t\tnode.style.width = w;\r\n\t\t\t}\r\n\t\t}\r\n\t\tdocument.body.appendChild(panel);\r\n\t},\r\n\r\n\t_ItemClick: function (sender, cfg) {\r\n\t\t//has sub menu items\r\n\t\tif (cfg.items) {\r\n\t\t\tthis._showSubMenu(sender, cfg);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (cfg.disabled) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar contextObj = jslet.ui.menuManager._contextObject || this;\r\n\t\tif (cfg.onClick) {\r\n\t\t\tcfg.onClick.call(contextObj, cfg.id || cfg.name, cfg.checked);\r\n\t\t} else {\r\n\t\t\tif (this._onItemClick) {\r\n\t\t\t\tthis._onItemClick.call(contextObj, cfg.id || cfg.name, cfg.checked);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (cfg.itemType == 'check' || cfg.itemType == 'radio') {\r\n\t\t\tjslet.ui.Menu.setChecked(sender, !cfg.checked);\r\n\t\t}\r\n\t\tjslet.ui.menuManager.hideAll();\r\n\t},\r\n\r\n\t_hideSubMenu: function () {\r\n\t\tvar Z = this;\r\n\t\tif (Z._activeSubMenu) {\r\n\t\t\tZ._activeSubMenu._hideSubMenu();\r\n\t\t\tZ._activeSubMenu.hide();\r\n\t\t\tZ._activeSubMenu.el.style.zIndex = parseInt(jQuery(Z.el).css('zIndex'));\r\n\t\t}\r\n\t},\r\n\r\n\t_showSubMenu: function (sender, cfg, delayTime) {\r\n\t\tvar Z = this;\r\n\t\tvar func = function () {\r\n\t\t\tZ._hideSubMenu();\r\n\t\t\tif (!cfg.subMenu) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar jqPmi = jQuery(sender),\r\n\t\t\t\tpos = jqPmi.offset(), \r\n\t\t\t\tx = pos.left;\r\n\t\t\tif (!jslet.locale.isRtl) {\r\n\t\t\t\tx += jqPmi.width();\r\n\t\t\t}\r\n\r\n\t\t\tcfg.subMenu.show(x - 2, pos.top);\r\n\t\t\tcfg.subMenu.el.style.zIndex = parseInt(jQuery(Z.el).css('zIndex')) + 1;\r\n\t\t\tZ._activeSubMenu = cfg.subMenu;\r\n\t\t};\r\n\t\tif (delayTime) {\r\n\t\t\twindow.setTimeout(func, delayTime);\r\n\t\t} else {\r\n\t\t\tfunc();\r\n\t\t}\r\n\t},\r\n\r\n\t_ItemOver: function (sender, cfg) {\r\n\t\tif (this._activeSubMenu) {\r\n\t\t\tthis._showSubMenu(sender, cfg, 200);\r\n\t\t}\r\n\t},\r\n\r\n\t_createMenuItem: function (container, itemCfg, defaultClickHandler) {\r\n\t\t//id, name, onClick,disabled,iconClass,disabledIconClass,itemType,checked,group,items,subMenuId\r\n\t\tvar isCheckBox = false, \r\n\t\t\tisRadioBox = false,\r\n\t\t\titemType = itemCfg.itemType;\r\n\t\tif (itemType) {\r\n\t\t\tisCheckBox = (itemType == 'check');\r\n\t\t\tisRadioBox = (itemType == 'radio');\r\n\t\t}\r\n\t\tif (isCheckBox) {\r\n\t\t\titemCfg.iconClass = 'jl-menu-check';\r\n\t\t\titemCfg.disabledIconClass = 'jl-menu-check-disabled';\r\n\t\t}\r\n\t\tif (isRadioBox) {\r\n\t\t\titemCfg.iconClass = 'jl-menu-radio';\r\n\t\t\titemCfg.disabledIconClass = 'jl-menu-radio-disabled';\r\n\t\t}\r\n\t\tif (itemCfg.items) {\r\n\t\t\titemCfg.disabled = false;\r\n\t\t}\r\n\t\tvar mi = document.createElement('div'), Z = this, jqMi = jQuery(mi);\r\n\t\tjqMi.addClass('jl-menu-item ' + (itemCfg.disabled ? 'jl-menu-disabled' : 'jl-menu-enabled'));\r\n\r\n\t\tif (!itemCfg.id) {\r\n\t\t\titemCfg.id = jslet.nextId();\r\n\t\t}\r\n\t\tmi.id = itemCfg.id;\r\n\t\tmi.jsletvar = itemCfg;\r\n\t\tjqMi.on('click', function (event) {\r\n\t\t\tZ._ItemClick(this, this.jsletvar);\r\n\t\t\tevent.stopPropagation();\r\n\t\t\tevent.preventDefault();\r\n\t\t});\r\n\r\n\t\tjqMi.on('mouseover', function (event) {\r\n\t\t\tZ._ItemOver(this, this.jsletvar);\r\n\t\t\tif (Z._preHoverItem) {\r\n\t\t\t\tjQuery(Z._preHoverItem).removeClass('jl-menu-item-hover');\r\n\t\t\t}\r\n\t\t\tZ._preHoverItem = this;\r\n\t\t\tif (!this.jsletvar.disabled) {\r\n\t\t\t\tjQuery(this).addClass('jl-menu-item-hover');\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tjqMi.on('mouseout', function (event) {\r\n\t\t\tif (!this.jsletvar.subMenu) {\r\n\t\t\t\tjQuery(this).removeClass('jl-menu-item-hover');\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tvar template = [];\r\n\t\ttemplate.push('<span class=\"jl-menu-icon-placeholder ');\r\n\t\tif ((isCheckBox || isRadioBox) && !itemCfg.checked) {\r\n\t\t\t//Empty \r\n\t\t} else {\r\n\t\t\tif (itemCfg.iconClass) {\r\n\t\t\t\ttemplate.push((!itemCfg.disabled || !itemCfg.disabledIconClass) ? itemCfg.iconClass : itemCfg.disabledIconClass);\r\n\t\t\t}\r\n\t\t}\r\n\t\ttemplate.push('\"></span>');\r\n\r\n\t\tif (itemCfg.items) {\r\n\t\t\ttemplate.push('<div class=\"jl-menu-arrow\"></div>');\r\n\t\t}\r\n\r\n\t\ttemplate.push('<a  href=\"javascript:void(0)\" class=\"jl-focusable-item jl-menu-content ');\r\n\t\ttemplate.push(' jl-menu-content-left jl-menu-content-right');\r\n\t\ttemplate.push('\">');\r\n\t\ttemplate.push(itemCfg.name);\r\n\t\ttemplate.push('</a>');\r\n\t\tmi.innerHTML = template.join('');\r\n\t\tcontainer.appendChild(mi);\r\n\t\tif (itemCfg.items) {\r\n\t\t\tvar el = document.createElement('div');\r\n\t\t\tdocument.body.appendChild(el);\r\n\t\t\titemCfg.subMenu = new jslet.ui.Menu(el, { onItemClick: Z._onItemClick, items: itemCfg.items, invoker: mi });\r\n\t\t}\r\n\t},\r\n\r\n\t_createLine: function (container, itemCfg) {\r\n\t\tvar odiv = document.createElement('div');\r\n\t\tjQuery(odiv).addClass('jl-menu-line');\r\n\t\tcontainer.appendChild(odiv);\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\tvar Z = this, \r\n\t\t\tjqEl = jQuery(Z.el);\r\n\t\tZ._activeSubMenu = null;\r\n\t\tjslet.ui.menuManager.unregister(Z.el.id);\r\n\t\tjqEl.off();\r\n\t\tjqEl.find('.jl-menu-item').each(function(){\r\n\t\t\tthis.onmouseover = null;\r\n\t\t\tthis.onclick = null;\r\n\t\t\tthis.onmouseout = null;\r\n\t\t});\r\n\t\t\r\n\t\t$super();\r\n\t}\r\n});\r\n\r\njslet.ui.register('Menu', jslet.ui.Menu);\r\njslet.ui.Menu.htmlTemplate = '<div></div>';\r\n\r\njslet.ui.Menu.setDisabled = function (menuId, disabled) {\r\n\tvar jqMi;\r\n\tif (Object.isString(menuId)) {\r\n\t\tjqMi = jQuery('#'+menuId);\r\n\t} else {\r\n\t\tjqMi = jQuery(menuId);\r\n\t}\r\n\tvar cfg = jqMi.context.jsletvar;\r\n\tif (cfg.items) {\r\n\t\treturn;\r\n\t}\r\n\tif (disabled) {\r\n\t\tjqMi.removeClass('jl-menu-enabled');\r\n\t\tjqMi.addClass('jl-menu-disabled');\r\n\t} else {\r\n\t\tjqMi.removeClass('jl-menu-disabled');\r\n\t\tjqMi.addClass('jl-menu-enabled');\r\n\t}\r\n\tcfg.disabled = disabled;\r\n};\r\n\r\njslet.ui.Menu.setChecked = function (menuId, checked) {\r\n\tvar jqMi;\r\n\tif (typeof(menuId)==='string') {\r\n\t\tjqMi = jQuery('#' + menuId);\r\n\t} else {\r\n\t\tjqMi = jQuery(menuId);\r\n\t}\r\n\tvar mi = jqMi.context,\r\n\t\tcfg = mi.jsletvar,\r\n\t\titemType = cfg.itemType;\r\n\tif (itemType != 'check' && itemType != 'radio') {\r\n\t\treturn;\r\n\t}\r\n\tif (itemType == 'radio') {\r\n\t\tif (cfg.checked && checked || !checked) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar group = mi.group;\r\n\t\t//uncheck all radio button in the same group\r\n\t\tvar allMi = mi.parentNode.childNodes;\r\n\r\n\t\tfor (var i = 0, node, cfg1, icon, cnt = allMi.length; i < cnt; i++) {\r\n\t\t\tnode = allMi[i];\r\n\t\t\tif (node == mi) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tcfg1 = node.jsletvar;\r\n\t\t\tif (cfg1 && cfg1.itemType == 'radio' && cfg1.group == group) {\r\n\t\t\t\ticon = node.childNodes[0];\r\n\t\t\t\tif (cfg1.disabled) {\r\n\t\t\t\t\tjQuery(icon).removeClass(cfg1.disabledIconClass);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tjQuery(icon).removeClass(cfg1.iconClass);\r\n\t\t\t\t}\r\n\t\t\t\tcfg1.checked = false;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tvar jqIcon = jQuery(mi.childNodes[0]);\r\n\r\n\tif (cfg.checked && !checked) {\r\n\t\tif (cfg.disabled) {\r\n\t\t\tjqIcon.removeClass(cfg.disabledIconClass);\r\n\t\t} else {\r\n\t\t\tjqIcon.removeClass(cfg.iconClass);\r\n\t\t}\r\n\t}\r\n\tif (!cfg.checked && checked) {\r\n\t\tif (cfg.disabled) {\r\n\t\t\tjqIcon.addClass(cfg.disabledIconClass);\r\n\t\t}else {\r\n\t\t\tjqIcon.addClass(cfg.iconClass);\r\n\t\t}\r\n\t}\r\n\tcfg.checked = checked;\r\n};\r\n\n/* ========================================================================\r\n * Jslet framework: jslet.overlaypanel.js\r\n *\r\n * Copyright (c) 2014 Jslet Group(https://github.com/jslet/jslet/)\r\n * Licensed under MIT (https://github.com/jslet/jslet/LICENSE.txt)\r\n * ======================================================================== */\r\n\r\n/**\r\n* @class Overlay panel. Example:\r\n* <pre><code>\r\n*  var overlay = new jslet.ui.OverlayPanel(Z.el.parentNode);\r\n*  overlay.setZIndex(999);\r\n*  overlay.show();\r\n* </code></pre>\r\n* \r\n* @param {Html Element} container Html Element that OverlayPanel will cover.\r\n* @param {String} color Color String.\r\n*/\r\njslet.ui.OverlayPanel = function (container, color) {\r\n\tvar odiv = document.createElement('div');\r\n\tjQuery(odiv).addClass('jl-overlay').on('click', function(event){\r\n\t\tevent.stopPropagation();\r\n\t\tevent.preventDefault();\r\n\t});\r\n\t\r\n\tif (color) {\r\n\t\todiv.style.backgroundColor = color;\r\n\t}\r\n\tvar left, top, width, height;\r\n\tif (!container) {\r\n\t\tvar jqBody = jQuery(document.body);\r\n\t\tleft = 0;\r\n\t\ttop = 0;\r\n\t\twidth = jqBody.width();\r\n\t\theight = jqBody.height();\r\n\t} else {\r\n\t\twidth = jQuery(container).width();\r\n\t\theight = jQuery(container).height();\r\n\t}\r\n\todiv.style.left = '0px';\r\n\todiv.style.top = '0px';\r\n\todiv.style.bottom = '0px';\r\n\todiv.style.right = '0px';\r\n\tif (!container) {\r\n\t\tdocument.body.appendChild(odiv);\r\n\t} else {\r\n\t\tcontainer.appendChild(odiv);\r\n\t}\r\n\todiv.style.display = 'none';\r\n\r\n\tvar oldResizeHanlder = null;\r\n\tif (!container) {\r\n\t\toldResizeHanlder = window.onresize;\r\n\r\n\t\twindow.onresize = function () {\r\n\t\t\todiv.style.width = document.body.scrollWidth + 'px';\r\n\t\t\todiv.style.height = document.body.scrollHeight + 'px';\r\n\t\t};\r\n\t} else {\r\n\t\toldResizeHanlder = container.onresize;\r\n\t\tcontainer.onresize = function () {\r\n\t\t\tvar width = jQuery(container).width() - 12;\r\n\t\t\tvar height = jQuery(container).height() - 12;\r\n\t\t\todiv.style.width = width + 'px';\r\n\t\t\todiv.style.height = height + 'px';\r\n\t\t};\r\n\t}\r\n\r\n\tthis.overlayPanel = odiv;\r\n\r\n\t/**\r\n\t * Show overlay panel\r\n\t */\r\n\tthis.show = function () {\r\n\t\todiv.style.display = 'block';\r\n\t\treturn odiv;\r\n\t};\r\n\r\n\t/**\r\n\t * Hide overlay panel\r\n\t */\r\n\tthis.hide = function () {\r\n\t\todiv.style.display = 'none';\r\n\t\treturn odiv;\r\n\t};\r\n\t\r\n\t/**\r\n\t * Set Z-index \r\n\t * \r\n\t * @param {Integer} zIndex Z-Index\r\n\t */\r\n\tthis.setZIndex = function(zIndex){\r\n\t\tthis.overlayPanel.style.zIndex = zIndex;\r\n\t};\r\n\r\n\tthis.destroy = function () {\r\n\t\tthis.hide();\r\n\t\tif (!container) {\r\n\t\t\twindow.onresize = oldResizeHanlder;\r\n\t\t\tdocument.body.removeChild(odiv);\r\n\t\t} else {\r\n\t\t\tcontainer.onresize = oldResizeHanlder;\r\n\t\t\tcontainer.removeChild(odiv);\r\n\t\t}\r\n\t\tjQuery(this.overlayPanel).off();\r\n\t};\r\n};\r\n\n/* ========================================================================\r\n * Jslet framework: jslet.splitpanel.js\r\n *\r\n * Copyright (c) 2014 Jslet Group(https://github.com/jslet/jslet/)\r\n * Licensed under MIT (https://github.com/jslet/jslet/LICENSE.txt)\r\n * ======================================================================== */\r\n\r\n/**\r\n * @class Split Panel. Example:\r\n * <pre><code>\r\n * var jsletParam = {type:\"SplitPanel\",direction:\"hori\",floatIndex: 1};\r\n * //1. Declaring:\r\n *     &lt;div data-jslet='jsletParam' style=\"width: 300px; height: 400px;\">\r\n *     &lt;div>content1&lt;/div>\r\n *     &lt;div>content2&lt;/div>\r\n *     &lt;/div>\r\n *     \r\n *  //2. Binding\r\n *     &lt;div id='ctrlId'>\r\n *       &lt;div>content1&lt;/div>\r\n *       &lt;div>content2&lt;/div>\r\n *     &lt;/div>\r\n *     //Js snippet\r\n *     var el = document.getElementById('ctrlId');\r\n *     jslet.ui.bindControl(el, jsletParam);\r\n *\t\r\n *  //3. Create dynamically\r\n *     jslet.ui.createControl(jsletParam, document.body);\r\n *\r\n * </code></pre>\r\n */\r\njslet.ui.SplitPanel = jslet.Class.create(jslet.ui.Control, {\r\n\tdirections: ['hori', 'vert'],\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.el = el;\r\n\t\tZ.allProperties = 'direction,floatIndex,onExpanded,onSize';//{size:100, align:-1/0/1,minSize:10}\r\n\r\n\t\tZ._direction = 'hori';\r\n\r\n\t\tZ._floatIndex = 1;\r\n\t\t\r\n\t\tZ._onExpanded = null;\r\n\t\t\r\n\t\tZ._onSize = null;\r\n\t\t\r\n\t\tZ.panels = null; //Array, panel configuration\r\n\t\tZ.splitter = null;\r\n\t\tZ._oldSize = 0;\r\n\t\tjslet.resizeEventBus.subscribe(Z);\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set float panel index, only one panel can be a floating panel.\r\n\t * \r\n\t * @param {Integer or undefined} index float panel index.\r\n\t * @return {this or Integer}\r\n\t */\r\n\tfloatIndex: function(index) {\r\n\t\tif(index === undefined) {\r\n\t\t\treturn this._floatIndex;\r\n\t\t}\r\n\t\tjslet.Checker.test('SplitPanel.floatIndex', index).isGTEZero();\r\n\t\tthis._floatIndex = index;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get or set Split direction, optional value: hori, vert\r\n\t * Default value is 'hori'\r\n\t * \r\n\t * @param {String or undefined} direction optional value: hori, vert.\r\n\t * @return {this or String}\r\n\t */\r\n\tdirection: function(direction) {\r\n\t\tif(direction === undefined) {\r\n\t\t\treturn this._direction;\r\n\t\t}\r\n\t\tdirection = jQuery.trim(direction);\r\n\t\tvar checker = jslet.Checker.test('SplitPanel.direction', direction).required().isString();\r\n\t\tdirection = direction.toLowerCase();\r\n\t\tchecker.inArray(this.directions);\r\n\t\tthis._direction = direction;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Fired when user expand/collapse one panel.\r\n\t *  Pattern: \r\n\t *\tfunction(panelIndex){} \r\n\t *\t//panelIndex: Integer\r\n\t *\r\n\t * @param {Function or undefined} onExpanded expanded event handler.\r\n\t * @return {this or Function}\r\n\t */\r\n\tonExpanded: function(onExpanded) {\r\n\t\tif(onExpanded === undefined) {\r\n\t\t\treturn this._onExpanded;\r\n\t\t}\r\n\t\tjslet.Checker.test('SplitPanel.onExpanded', onExpanded).isFunction();\r\n\t\tthis._onExpanded = onExpanded;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Fired after user change size of one panel.\r\n\t *  Pattern: \r\n\t *\tfunction(panelIndex, newSize){} \r\n\t *\t//panelIndex: Integer\r\n\t *\t//newSize: Integer\r\n\t *\r\n\t * @param {Function or undefined} onExpanded resize event handler.\r\n\t * @return {this or Function}\r\n\t */\r\n\tonSize: function(onSize) {\r\n\t\tif(onSize === undefined) {\r\n\t\t\treturn this._onSize;\r\n\t\t}\r\n\t\tjslet.Checker.test('SplitPanel.onSize', onSize).isFunction();\r\n\t\tthis._onSize = onSize;\r\n\t},\r\n   \r\n\t/**\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tthis.renderAll();\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tvar Z = this, jqEl = jQuery(Z.el);\r\n\t\tif (!jqEl.hasClass('jl-splitpanel')) {\r\n\t\t\tjqEl.addClass('jl-splitpanel jl-border-box jl-round5');\r\n\t\t}\r\n\t\tZ.isHori = (Z._direction == 'hori');\r\n\t\t\r\n\t\tZ.width = jqEl.innerWidth();\r\n\t\tZ.height = jqEl.innerHeight();\r\n\t\tZ._oldSize = Z.isHori ? Z.width: Z.height;\r\n\t\t\r\n\t\tvar panelDivs = jqEl.find('>div'),\r\n\t\t\tlastIndex = panelDivs.length - 1;\r\n\t\tif (!Z._floatIndex || Z._floatIndex > lastIndex) {\r\n\t\t\tZ._floatIndex = lastIndex;\r\n\t\t}\r\n\t\tif (Z._floatIndex > lastIndex) {\r\n\t\t\tZ._floatIndex = lastIndex;\r\n\t\t}\r\n\t\tif (!Z.panels) {\r\n\t\t\tZ.panels = [];\r\n\t\t}\r\n\t\tvar containerSize = (Z.isHori ? Z.width : Z.height), sumSize = 0;\r\n\r\n\t\tpanelDivs.each(function(k){\r\n\t\t\tvar jqPanel = jQuery(panelDivs[k]),\r\n\t\t\t\toPanel = Z.panels[k];\r\n\t\t\tif (!oPanel){\r\n\t\t\t\toPanel = {};\r\n\t\t\t\tZ.panels[k] = oPanel;\r\n\t\t\t}\r\n\r\n\t\t\tvar minSize = parseInt(jqPanel.css(Z.isHori ?'min-width': 'min-height'));\r\n\t\t\toPanel.minSize = minSize ? minSize : 5;\r\n\t\t\t\r\n\t\t\tvar maxSize = parseInt(jqPanel.css(Z.isHori ?'max-width': 'max-height'));\r\n\t\t\toPanel.maxSize = maxSize ? maxSize : Infinity;\r\n\t\t\toPanel.expanded = jqPanel.css('display') != 'none';\r\n\t\t\t\r\n\t\t\tvar size = oPanel.size;\r\n\t\t\tif (size === null || size === undefined) {\r\n\t\t\t\tsize = Z.isHori ? jqPanel.outerWidth(): jqPanel.outerHeight();\r\n\t\t\t} else {\r\n\t\t\t\tif (Z.isHori) {\r\n\t\t\t\t\tjqPanel.width(size - 5);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tjqPanel.height(size - 5);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\t\r\n\t\t\tif (k != Z._floatIndex){\r\n\t\t\t\tsumSize += size;\r\n\t\t\t\toPanel.size = size;\r\n\t\t\t}\r\n\t\t});\r\n\t\tZ.panels[Z._floatIndex].size = containerSize - sumSize;\r\n\t\t\r\n\t\tZ.splitterTracker = document.createElement('div');\r\n\t\tvar jqTracker = jQuery(Z.splitterTracker);\r\n\t\tjqTracker.addClass('jl-sp-splitter-tracker');\r\n\t\tvar fixedSize = 0,\r\n\t\t\tclsName = Z.isHori ? 'jl-sp-panel-hori': 'jl-sp-panel-vert';\r\n\t\tZ.splitterClsName = Z.isHori ? 'jl-sp-splitter-hori': 'jl-sp-splitter-vert';\r\n\t\tZ.el.appendChild(Z.splitterTracker);\r\n\t\tif (Z.isHori) {\r\n\t\t\tZ.splitterTracker.style.height = '100%';\r\n\t\t} else {\r\n\t\t\tZ.splitterTracker.style.width = '100%';\r\n\t\t}\r\n\t\tvar splitterSize = parseInt(jslet.ui.getCssValue(Z.splitterClsName, Z.isHori? 'width' : 'height'));\r\n\t\tpanelDivs.after(function(k){\r\n\t\t\tvar panel = panelDivs[k],\r\n\t\t\tjqPanel = jQuery(panel),\r\n\t\t\texpanded = Z.panels[k].expanded;\r\n\t\t\t\r\n\t\t\tjqPanel.addClass(clsName);\r\n\r\n\t\t\tif (k == Z._floatIndex) {\r\n\t\t\t\tZ.floatPanel = panel;\r\n\t\t\t} else {\r\n\t\t\t\tif (expanded) {\r\n\t\t\t\t\tfixedSize += splitterSize + Z.panels[k].size;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tjqPanel.css('display', 'none');\r\n\t\t\t\t\tfixedSize += splitterSize;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (k == lastIndex){\r\n\t\t\t\tif (Z.isHori) {\r\n\t\t\t\t\treturn '<div style=\"clear:both;width:0px\"></div>';\r\n\t\t\t\t}\r\n\t\t\t\treturn '';\r\n\t\t\t}\r\n\t\t\tvar id = jslet.nextId(),\r\n\t\t\t\tminBtnCls = Z.isHori ? 'jl-sp-button-left' : 'jl-sp-button-top';\r\n\t\t\t\t\r\n\t\t\tif (Z._floatIndex <= k || !expanded) {\r\n\t\t\t\tminBtnCls += Z.isHori ? ' jl-sp-button-right' : ' jl-sp-button-bottom';\r\n\t\t\t}\r\n\t\t\treturn '<div class=\"'+ Z.splitterClsName + ' jl-unselectable\" id = \"' + id + \r\n\t\t\t'\" jsletindex=\"'+ (k >= Z._floatIndex ? k+1: k)+ '\"><div class=\"jl-sp-button ' + \r\n\t\t\tminBtnCls +'\"' + (expanded ? '': ' jsletcollapsed=\"1\"') +'></div></div>';\r\n\t\t});\r\n\t\tif (Z.isHori) {\r\n\t\t\tjQuery(Z.floatPanel).width(jqEl.innerWidth() - fixedSize - 4);\r\n\t\t} else {\r\n\t\t\tjQuery(Z.floatPanel).height(jqEl.innerHeight() - fixedSize);\r\n\t\t}\r\n\t\tvar splitters = jqEl.find('.'+Z.splitterClsName);\r\n\t\tsplitters.on('mousedown', Z._splitterMouseDown);\r\n\t\tvar splitBtns = splitters.children();\r\n\t\tsplitBtns.on('mousedown', function(event){\r\n\t\t\tvar jqBtn = jQuery(event.target),\r\n\t\t\t\tjqSplitter = jqBtn.parent(),\r\n\t\t\t\tindex = parseInt(jqSplitter.attr('jsletindex'));\r\n\t\t\tZ.expand(index);\r\n\t\t\tevent.stopPropagation();\r\n\t\t});\r\n\t\t\r\n\t\tvar oSplitter;\r\n\t\tfor(var i = 0, cnt = splitters.length; i < cnt; i++){\r\n\t\t\toSplitter = splitters[i];\r\n\t\t\toSplitter._doDragStart = Z._splitterDragStart;\r\n\t\t\toSplitter._doDragging = Z._splitterDragging;\r\n\t\t\toSplitter._doDragEnd = Z._splitterDragEnd;\r\n\t\t\toSplitter._doDragCancel = Z._splitterDragCancel;\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get float panel\r\n\t * \r\n\t * @return {Html Element} \r\n\t */\r\n\tfloatPanel: function(){\r\n\t\treturn Z.panels[Z._floatIndex];\t\r\n\t},\r\n\t\r\n\tchangeSize: function(k, size){\r\n\t\t\r\n\t},\r\n\t\r\n\t/**\r\n\t * Expand or collapse the specified panel\r\n\t * \r\n\t * @param {Integer} index Panel index\r\n\t * @param {Boolean} expanded True for expanded, false otherwise.\r\n\t */\r\n\texpand: function(index, expanded, notChangeSize){\r\n\t\tvar Z = this, jqPanel, jqEl = jQuery(Z.el),\r\n\t\t\tsplitters = jqEl.find('.'+Z.splitterClsName);\r\n\t\tif (index < 0 || index > splitters.length) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar\tjqSplitter = jQuery(splitters[(index >= Z._floatIndex ? index - 1: index)]),\r\n\t\t\tjqBtn = jqSplitter.find(':first-child');\r\n\t\t\t\r\n\t\tif (expanded === undefined) {\r\n\t\t\texpanded  = jqBtn.attr('jsletcollapsed')=='1';\r\n\t\t}\r\n\t\tif (index < Z._floatIndex) {\r\n\t\t\tjqPanel = jqSplitter.prev();\r\n\t\t} else {\r\n\t\t\tjqPanel = jqSplitter.next();\r\n\t\t}\r\n\t\tif (Z.isHori){\r\n\t\t\tif (jqBtn.hasClass('jl-sp-button-right')) {\r\n\t\t\t\tjqBtn.removeClass('jl-sp-button-right');\r\n\t\t\t} else {\r\n\t\t\t\tjqBtn.addClass('jl-sp-button-right');\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (jqBtn.hasClass('jl-sp-button-bottom')) {\r\n\t\t\t\tjqBtn.removeClass('jl-sp-button-bottom');\r\n\t\t\t} else {\r\n\t\t\t\tjqBtn.addClass('jl-sp-button-bottom');\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (expanded){\r\n\t\t\tjqPanel.css('display', 'block');\r\n\t\t\tjqBtn.attr('jsletcollapsed', '0');\r\n\t\t}else{\r\n\t\t\tjqPanel.css('display','none');\r\n\t\t\tjqBtn.attr('jsletcollapsed', '1');\r\n\t\t}\r\n\t\tif(notChangeSize) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar jqFp = jQuery(Z.floatPanel);\r\n\t\tif (Z.isHori) {\r\n\t\t\tjqFp.width(jqFp.width()+jqPanel.width()*(expanded ? -1: 1));\r\n\t\t} else {\r\n\t\t\tjqFp.height(jqFp.height()+jqPanel.height()*(expanded ? -1: 1));\r\n\t\t}\r\n\t\tZ.panels[index].expanded = expanded;\r\n\t\tif (Z._onExpanded) {\r\n\t\t\tZ._onExpanded.call(Z, panelIndex);\r\n\t\t}\r\n\t\tjslet.resizeEventBus.resize(Z.el);\r\n\t},\r\n\t\r\n\t/**\r\n\t * @private\r\n\t */\r\n\t_splitterMouseDown: function(event){\r\n\t\tvar pos = jQuery(this).position(),\r\n\t\t\tZ = this.parentNode.jslet;\r\n\t\tZ.splitterTracker.style.top = pos.top + 'px';\r\n\t\tZ.splitterTracker.style.left = pos.left + 'px';\r\n\t\tZ.draggingId = this.id;\r\n\t\tvar jqSplitter = jQuery('#'+Z.draggingId);\r\n\t\tjqBtn = jqSplitter.find(':first-child');\r\n\t\tif(jqBtn.attr('jsletcollapsed')=='1') { //Collapsed\r\n\t\t\tjqBtn.click();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tjslet.ui.dnd.bindControl(this);\r\n\t},\r\n\t\t\r\n\t/**\r\n\t * @private\r\n\t */\r\n\t_splitterDragStart: function (oldX, oldY, x, y, deltaX, deltaY){\r\n\t\tvar Z = this.parentNode.jslet,\r\n\t\t\tjqTracker = jQuery(Z.splitterTracker),\r\n\t\t\tjqSplitter = jQuery('#'+Z.draggingId),\r\n\t\t\tindex = parseInt(jqSplitter.attr('jsletindex')),\r\n\t\t\tcfg = Z.panels[index],\r\n\t\t\tjqFp = jQuery(Z.floatPanel);\r\n\t\t\r\n\t\tZ.dragRangeMin = cfg.size - cfg.minSize;\r\n\t\tZ.dragRangeMax = cfg.maxSize - cfg.size;\r\n\t\tvar fpMax = (Z.isHori ? jqFp.width() : jqFp.height()) - Z.panels[Z._floatIndex].minSize;\r\n\t\tif (Z.dragRangeMax > fpMax) {\r\n\t\t\tZ.dragRangeMax = fpMax;\r\n\t\t}\r\n\t\tjqTracker.show();\r\n\t},\r\n\t\r\n\t/**\r\n\t * @private\r\n\t */\r\n\t_splitterDragging: function (oldX, oldY, x, y, deltaX, deltaY){\r\n\t\tvar Z = this.parentNode.jslet,\r\n\t\t\tjqTracker = jQuery(Z.splitterTracker),\r\n\t\t\tjqSplitter = jQuery('#'+Z.draggingId),\r\n\t\t\tindex = parseInt(jqSplitter.attr('jsletindex')),\r\n\t\t\tdelta = Math.abs(Z.isHori ? deltaX : deltaY),\r\n\t\t\texpanded;\r\n\t\t\t\r\n\t\tif (Z.isHori) {\r\n\t\t\texpanded = index < Z._floatIndex && deltaX >= 0 || index > Z._floatIndex && deltaX < 0;\r\n\t\t} else {\r\n\t\t\texpanded = index < Z._floatIndex && deltaY >= 0 || index > Z._floatIndex && deltaY < 0;\r\n\t\t}\r\n\t\tif (expanded && delta > Z.dragRangeMax){\r\n\t\t\tZ.endDelta = Z.dragRangeMax;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tif (!expanded && delta > Z.dragRangeMin){\r\n\t\t\tZ.endDelta = Z.dragRangeMin;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tZ.endDelta = Math.abs(Z.isHori ? deltaX : deltaY);\r\n\t\tvar pos = jqTracker.offset();\r\n\t\tif (Z.isHori) {\r\n\t\t\tpos.left = x;\r\n\t\t} else {\r\n\t\t\tpos.top = y;\r\n\t\t}\r\n\t\tjqTracker.offset(pos);\r\n\t},\r\n\t\r\n\t/**\r\n\t * @private\r\n\t */\r\n\t_splitterDragEnd: function (oldX, oldY, x, y, deltaX, deltaY){\r\n\t\tvar Z = this.parentNode.jslet,\r\n\t\t\tjqTracker = jQuery(Z.splitterTracker),\r\n\t\t\tjqSplitter = jQuery('#'+Z.draggingId),\r\n\t\t\tindex = parseInt(jqSplitter.attr('jsletindex')),\r\n\t\t\tjqPanel = index < Z._floatIndex ? jqSplitter.prev(): jqSplitter.next(),\r\n\t\t\texpanded,\r\n\t\t\tjqFp = jQuery(Z.floatPanel);\r\n\r\n\t\tif (Z.isHori) {\r\n\t\t\texpanded = index < Z._floatIndex && deltaX >= 0 || index > Z._floatIndex && deltaX < 0;\r\n\t\t} else {\r\n\t\t\texpanded = index < Z._floatIndex && deltaY >= 0 || index > Z._floatIndex && deltaY < 0;\r\n\t\t}\r\n\t\tvar delta = Z.endDelta * (expanded ? 1: -1);\r\n\t\tvar newSize = Z.panels[index].size + delta;\r\n\t\tZ.panels[index].size = newSize;\r\n\t\t\r\n\t\tif (Z.isHori){\r\n\t\t\tjqPanel.width(newSize);\r\n\t\t\tjqFp.width(jqFp.width() - delta);\r\n\t\t}else{\r\n\t\t\tjqPanel.height(newSize);\r\n\t\t\tjqFp.height(jqFp.height() - delta);\r\n\t\t}\r\n\t\tif (Z._onSize) {\r\n\t\t\tZ._onSize.call(Z, index, newSize);\r\n\t\t}\r\n\t\tjslet.resizeEventBus.resize(Z.el);\r\n\t\tjqTracker.hide();\r\n\t},\r\n\t\r\n\t/**\r\n\t * @private\r\n\t */\r\n\t_splitterDragCancel: function (oldX, oldY, x, y, deltaX, deltaY){\r\n\t\tvar Z = this.parentNode.jslet,\r\n\t\t\tjqTracker = jQuery(Z.splitterTracker);\r\n\t\tjqTracker.hide();\r\n\t},\r\n\t\r\n\t/**\r\n\t * Run when container size changed, it's revoked by jslet.resizeeventbus.\r\n\t * \r\n\t */\r\n\tcheckSizeChanged: function(){\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el),\r\n\t\t\tcurrSize = Z.isHori ? jqEl.width() : jqEl.height();\r\n\t\tif ( Z._oldSize != currSize){\r\n\t\t\tvar delta = currSize - Z._oldSize;\r\n\t\t\tZ._oldSize = currSize;\r\n\t\t\tvar oFp = Z.panels[Z._floatIndex],\r\n\t\t\t\tjqFp = jQuery(Z.floatPanel),\r\n\t\t\t\tnewSize = delta + (Z.isHori ? jqFp.width(): jqFp.height());\r\n\r\n\t\t\tif (newSize < oFp.minSize) {\r\n\t\t\t\tnewSize = oFp.minSize;\r\n\t\t\t}\r\n\t\t\tif (Z.isHori) {\r\n\t\t\t\tjqFp.width(newSize);\r\n\t\t\t} else {\r\n\t\t\t\tjqFp.height(newSize);\r\n\t\t\t}\r\n\t\t}\r\n\t\tjslet.resizeEventBus.resize(Z.floatPanel);\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\tvar Z = this,\r\n\t\tjqEl = jQuery(Z.el);\r\n\t\tZ.splitterTracker = null;\r\n\t\tZ.floatPanel = null;\r\n\t\tvar splitters = jqEl.find('.'+Z.splitterClsName);\r\n\t\tsplitters.off('mousedown', Z._splitterMouseDown);\r\n\t\tvar item;\r\n\t\tfor(var i = 0, cnt = splitters.length; i < cnt; i++){\r\n\t\t\titem = splitters[i];\r\n\t\t\tjslet.ui.dnd.unbindControl(item);\r\n\t\t\titem._doDragStart = null;\r\n\t\t\titem._doDragging = null;\r\n\t\t\titem._doDragEnd = null;\r\n\t\t\titem._doDragCancel = null;\r\n\t\t}\r\n\t\tjslet.resizeEventBus.unsubscribe(Z);\r\n\t\t$super();\r\n\t}\r\n});\r\n\r\njslet.ui.register('SplitPanel', jslet.ui.SplitPanel);\r\njslet.ui.SplitPanel.htmlTemplate = '<div></div>';\r\n\n/* ========================================================================\r\n * Jslet framework: jslet.tabcontrol.js\r\n *\r\n * Copyright (c) 2014 Jslet Group(https://github.com/jslet/jslet/)\r\n * Licensed under MIT (https://github.com/jslet/jslet/LICENSE.txt)\r\n * ======================================================================== */\r\n\r\n/**\r\n * @class TabControl. Example:\r\n * <pre><code>\r\n * var jsletParam = {type: \"TabControl\", \r\n *\t\tselectedIndex: 1, \r\n *\t\tonCreateContextMenu: doCreateContextMenu, \r\n *\t\titems: [\r\n *\t\t\t{header: \"one\", userIFrame: true, url: \"http://www.google.com\", iconClass: \"tabIcon\"},\r\n *\t\t\t{header: \"two\", closable: true, divId: \"p2\"},\r\n *\t\t\t{header:\"three\",closable:true,divId:\"p3\"},\r\n *\t\t]};\r\n *  //1. Declaring:\r\n *\t\t&lt;div data-jslet='jsletParam' style=\"width: 300px; height: 400px;\" />\r\n *\r\n *  //2. Binding\r\n *\t\t&lt;div id='ctrlId' />\r\n *\t\t//Js snippet\r\n *\t\tvar el = document.getElementById('ctrlId');\r\n *\t\tjslet.ui.bindControl(el, jsletParam);\r\n *\t\r\n *  //3. Create dynamically\r\n *\t\tjslet.ui.createControl(jsletParam, document.body);\r\n *\r\n * </code></pre>\r\n */\r\njslet.ui.TabControl = jslet.Class.create(jslet.ui.Control, {\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.el = el;\r\n\t\tZ.allProperties = 'selectedIndex,newable,closable,items,onAddTabItem,onSelectedChanged,onRemoveTabItem,onCreateContextMenu';\r\n\t\t\r\n\t\tZ._selectedIndex = 0;\r\n\t\t\r\n\t\tZ._newable = true;\r\n\t\t\r\n\t\tZ._closable = true;\r\n\t\t\r\n\t\tZ._onSelectedChanged = null;\r\n\t\t\r\n\t\tZ._onAddTabItem = null;\r\n\t\t\r\n\t\tZ._onRemoveTabItem = null;\r\n\t\t\r\n\t\tZ._onCreateContextMenu = null;\r\n\t\t\r\n\t\tZ._items = [];\r\n\t\t\r\n\t\tZ._itemsWidth = [];\r\n\t\tZ._containerWidth = 0;\r\n\t\tZ._ready = false;\r\n\t\t\r\n\t\tZ._leftIndex = 0;\r\n\t\tZ._rightIndex = 0;\r\n\r\n\t\tZ._tabControlWidth = jQuery(Z.el).width();\r\n\t\tjslet.resizeEventBus.subscribe(this);\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set selected tab item index.\r\n\t * \r\n\t * @param {Integer or undefined} index selected tabItem index.\r\n\t * @param {this or Integer}\r\n\t */\r\n\tselectedIndex: function(index) {\r\n\t\tif(index === undefined) {\r\n\t\t\treturn this._selectedIndex;\r\n\t\t}\r\n\t\tjslet.Checker.test('TabControl.selectedIndex', index).isGTEZero();\r\n\t\tif(this._ready) {\r\n\t\t\tthis._chgSelectedIndex(index);\r\n\t\t} else {\r\n\t\t\tthis._selectedIndex = index;\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * Identify if user can add tab item on fly.\r\n\t * \r\n\t * @param {Boolean or undefined} newable true(default) - user can add tab item on fly, false - otherwise.\r\n\t * @return {this or Boolean} \r\n\t */\r\n\tnewable: function(newable) {\r\n\t\tif(newable === undefined) {\r\n\t\t\treturn this._newable;\r\n\t\t}\r\n\t\tthis._newable = newable? true: false;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Identify if user can close tab item on fly.\r\n\t * \r\n\t * @param {Boolean or undefined} closable true(default) - user can close tab item on fly, false - otherwise.\r\n\t * @return {this or Boolean} \r\n\t */\r\n\tclosable: function(closable) {\r\n\t\tif(closable === undefined) {\r\n\t\t\treturn this._closable;\r\n\t\t}\r\n\t\tthis._closable = closable? true: false;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Fired after add a new tab item.\r\n\t * Pattern: \r\n\t *   function(){}\r\n\t *   \r\n\t * @param {Function or undefined} onAddTabItem tab item added event handler.\r\n\t * @return {this or Function} \r\n\t */\r\n\tonAddTabItem: function(onAddTabItem) {\r\n\t\tif(onAddTabItem === undefined) {\r\n\t\t\treturn this._onAddTabItem;\r\n\t\t}\r\n\t\tjslet.Checker.test('TabControl.onAddTabItem', onAddTabItem).isFunction();\r\n\t\tthis._onAddTabItem = onAddTabItem;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Fired when user toggle tab item.\r\n\t * Pattern: \r\n\t *   function(oldIndex, newIndex){}\r\n\t *   //oldIndex: Integer\r\n\t *   //newIndex: Integer\r\n\t *   \r\n\t * @param {Function or undefined} onSelectedChanged tab item selected event handler.\r\n\t * @return {this or Function} \r\n\t */\r\n\tonSelectedChanged: function(onSelectedChanged) {\r\n\t\tif(onSelectedChanged === undefined) {\r\n\t\t\treturn this._onSelectedChanged;\r\n\t\t}\r\n\t\tjslet.Checker.test('TabControl.onSelectedChanged', onSelectedChanged).isFunction();\r\n\t\tthis._onSelectedChanged = onSelectedChanged;\r\n\t},\r\n\r\n\t/**\r\n\t * Fired after remove a tab item.\r\n\t * Pattern: \r\n\t *  function(tabIndex, selected){}\r\n\t *  //tabIndex: Integer\r\n\t *  //selected: Boolean Identify if the removing item is active\r\n\t *  //return: Boolean, false - cancel removing tab item, true - remove tab item. \r\n\t *   \r\n\t * @param {Function or undefined} onRemoveTabItem tab item removed event handler.\r\n\t * @return {this or Function} \r\n\t */\r\n\tonRemoveTabItem: function(onRemoveTabItem) {\r\n\t\tif(onRemoveTabItem === undefined) {\r\n\t\t\treturn this._onRemoveTabItem;\r\n\t\t}\r\n\t\tjslet.Checker.test('TabControl.onRemoveTabItem', onRemoveTabItem).isFunction();\r\n\t\tthis._onRemoveTabItem = onRemoveTabItem;\r\n\t},\r\n\r\n\t/**\r\n\t * Fired before show context menu\r\n\t * Pattern: \r\n\t *   function(menuItems){}\r\n\t *   //menuItems: Array of MenuItem, @see menu item configuration in jslet.menu.js.\r\n\t *   \r\n\t * @param {Function or undefined} onCreateContextMenu creating context menu event handler.\r\n\t * @return {this or Function} \r\n\t */\r\n\tonCreateContextMenu: function(onCreateContextMenu) {\r\n\t\tif(onCreateContextMenu === undefined) {\r\n\t\t\treturn this._onCreateContextMenu;\r\n\t\t}\r\n\t\tjslet.Checker.test('TabControl.onCreateContextMenu', onCreateContextMenu).isFunction();\r\n\t\tthis._onCreateContextMenu = onCreateContextMenu;\r\n\t},\r\n\t \r\n\t/**\r\n\t * Get or set tab item configuration.\r\n\t * \r\n\t * @param {jslet.ui.TabItem[] or undefined} items tab items.\r\n\t * @return {this or jslet.ui.TabItem[]}\r\n\t */\r\n\titems: function(items) {\r\n\t\tif(items === undefined) {\r\n\t\t\treturn this._items;\r\n\t\t}\r\n\t\tjslet.Checker.test('TabControl.items', items).isArray();\r\n\t\tvar item;\r\n\t\tfor(var i = 0, len = items.length; i < len; i++) {\r\n\t\t\titem = items[i];\r\n\t\t\tjslet.Checker.test('TabControl.items.header', item.header).isString().required();\r\n\t\t}\r\n\t\tthis._items = items;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tthis.renderAll();\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tvar Z = this,\r\n\t\t\ttemplate = [\r\n\t\t\t'<div class=\"jl-tab-header jl-unselectable\"><div class=\"jl-tab-container jl-unselectable\"><ul class=\"jl-tab-list\">',\r\n\t\t\tZ._newable ? '<li><a href=\"javascript:;\" class=\"jl-tab-inner\"><span class=\"jl-tab-new\">+</span></a></li>' : '',\r\n\t\t\t'</ul></div><a class=\"jl-tab-left jl-hidden\"><span class=\"jl-nav-btn glyphicon glyphicon-circle-arrow-left\"></span></a><a class=\"jl-tab-right  jl-hidden\"><span class=\"jl-nav-btn glyphicon glyphicon-circle-arrow-right\"></span></a></div><div class=\"jl-tab-items jl-round5\"></div>'];\r\n\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tif (!jqEl.hasClass('jl-tabcontrol'))\r\n\t\t\tjqEl.addClass('jl-tabcontrol jl-round5');\r\n\t\tjqEl.html(template.join(''));\r\n\t\tif (Z._newable) {\r\n\t\t\toul = jqEl.find('.jl-tab-list')[0];\r\n\t\t\tvar newTab = oul.childNodes[oul.childNodes.length - 1];\r\n\t\t\tZ._newTabItem = newTab;\r\n\t\t\t\r\n\t\t\tnewTab.onclick = function () {\r\n\t\t\t\tvar itemCfg = null;\r\n\t\t\t\tif (Z._onAddTabItem) {\r\n\t\t\t\t\titemCfg = Z._onAddTabItem.call(Z);\r\n\t\t\t\t}\r\n\t\t\t\tif (!itemCfg) {\r\n\t\t\t\t\titemCfg = new jslet.ui.TabItem();\r\n\t\t\t\t\titemCfg.header = 'new tab';\r\n\t\t\t\t\titemCfg.closable = true;\r\n\t\t\t\t}\r\n\t\t\t\tZ.addTabItem(itemCfg);\r\n\t\t\t\tZ._calcItemsWidth();\r\n\t\t\t\tZ.selectedIndex(Z._items.length - 1);\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tvar jqNavBtn = jqEl.find('.jl-tab-left');\r\n\t\t\r\n\t\tjqNavBtn.on(\"click\",function (event) {\r\n\t\t\tZ._setVisiTabItems(Z._leftIndex - 1)\r\n\t\t\tevent.stopImmediatePropagation();\r\n\t\t\tevent.preventDefault();\r\n\t\t\treturn false;\r\n\t\t});\r\n\t\tjqNavBtn.on(\"mousedown\",function (event) {\r\n\t\t\tevent.stopImmediatePropagation();\r\n\t\t\tevent.preventDefault();\r\n\t\t\treturn false;\r\n\t\t});\r\n\t\tjqNavBtn = jqEl.find('.jl-tab-right');\r\n\r\n\t\tjqNavBtn.on(\"click\",function (event) {\r\n\t\t\tZ._setVisiTabItems(Z._leftIndex + 1)\r\n\t\t\tevent.stopImmediatePropagation();\r\n\t\t\tevent.preventDefault();\r\n\t\t\treturn false;\r\n\t\t});\r\n\t\tjqNavBtn.on(\"mousedown\",function (event) {\r\n\t\t\tevent.stopImmediatePropagation();\r\n\t\t\tevent.preventDefault();\r\n\t\t\treturn false;\r\n\t\t});\r\n\t\t\r\n\t\tif (Z._items && Z._items.length > 0) {\r\n\t\t\tvar oitem, \r\n\t\t\t\tcnt = Z._items.length;\r\n\t\t\tfor (var i = 0; i < cnt; i++) {\r\n\t\t\t\toitem = Z._items[i];\r\n\t\t\t\tZ._renderTabItem(oitem);\r\n\t\t\t}\r\n\t\t}\r\n\t\tZ._calcItemsWidth();\r\n\t\tZ._ready = true;\r\n\t\tZ._chgSelectedIndex(Z._selectedIndex);\r\n\t\tZ._createContextMenu();\r\n\t},\r\n\r\n\taddItem: function (itemCfg) {\r\n\t\tthis._items[this._items.length] = itemCfg;\r\n\t},\r\n\r\n\ttabLabel: function(index, label) {\r\n\t\tjslet.Checker.test('tabLabel#index', index).isGTEZero();\r\n\t\tjslet.Checker.test('tabLabel#label', label).required().isString();\r\n\t\t\r\n\t\tvar Z = this;\r\n\t\tvar itemCfg = Z._getTabItemCfg(index);\r\n\t\tif(!itemCfg) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\titemCfg.label(label);\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tvar panelContainer = jqEl.find('.jl-tab-items')[0];\r\n\t\tvar nodes = panelContainer.childNodes;\r\n\t\tjQuery(nodes[index]).find('.jl-tab-title').html(label);\r\n\t\tZ._calcItemsWidth();\r\n\t},\r\n\t\r\n\ttabDisabled: function(index, disabled) {\r\n\t\tjslet.Checker.test('tabLabel#index', index).isGTEZero();\r\n\t\tvar Z = this;\r\n\t\tvar itemCfg = Z._getTabItemCfg(index);\r\n\t\tif(!itemCfg) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(index == Z._selectedIndex) {\r\n\t\t\tconsole.warn('Cannot set current tab item to disabled.');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\titemCfg.disabled(disabled);\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tvar panelContainer = jqEl.find('.jl-tab-items')[0];\r\n\t\tvar nodes = panelContainer.childNodes;\r\n\t\tvar jqItem = jQuery(nodes[index]);\r\n\t\tif(disabled) {\r\n\t\t\tjqItem.addClass('jl-tab-disabled');\r\n\t\t} else {\r\n\t\t\tjqItem.removeClass('jl-tab-disabled');\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * Change selected tab item.\r\n\t * \r\n\t * @param {Integer} index Tab item index which will be toggled to.\r\n\t */\r\n\t_chgSelectedIndex: function (index) {\r\n\t\tvar Z = this;\r\n\t\r\n\t\tvar itemCfg = Z._getTabItemCfg(index);\r\n\t\tif(!itemCfg || itemCfg.disabled) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (Z._onSelectedChanged) {\r\n\t\t\tvar canChanged = Z._onSelectedChanged.call(Z, Z._selectedIndex, index);\r\n\t\t\tif (canChanged !== undefined && !canChanged) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tvar jqEl = jQuery(Z.el),\r\n\t\t\toli, \r\n\t\t\toul = jqEl.find('.jl-tab-list')[0],\r\n\t\t\tnodes = oul.childNodes,\r\n\t\t\tcnt = nodes.length - (Z._newable ? 2 : 1);\r\n\r\n\t\tvar itemContainer = jqEl.find('.jl-tab-items')[0],\r\n\t\t\titem, \r\n\t\t\titems = itemContainer.childNodes;\r\n\t\tfor (var i = 0; i <= cnt; i++) {\r\n\t\t\toli = jQuery(nodes[i]);\r\n\t\t\titem = items[i];\r\n\t\t\tif (i == index) {\r\n\t\t\t\toli.addClass('jl-tab-selected');\r\n\t\t\t\titem.style.display = 'block';\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\toli.removeClass('jl-tab-selected');\r\n\t\t\t\titem.style.display = 'none';\r\n\t\t\t}\r\n\t\t}\r\n\t\tZ._selectedIndex = index;\r\n\t\tif(index < Z._leftIndex || index >= Z._rightIndex) {\r\n\t\t\tZ._setVisiTabItems(null, Z._selectedIndex);\r\n\t\t}\r\n\t},\r\n\t\r\n\t_getTabItemCfg: function(index) {\r\n\t\tvar Z = this;\r\n\t\tif(Z._items.length <= index) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\treturn Z._items[index];\r\n\t},\r\n\t\r\n\t_calcItemsWidth: function() {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl =jQuery(Z.el),\r\n\t\t\tnodes = jqEl.find('.jl-tab-list').children();\r\n\t\tZ._itemsWidth = [];\r\n\t\tnodes.each(function(index){\r\n\t\t\tZ._itemsWidth[index] = jQuery(this).outerWidth() + 5;\r\n\t\t});\r\n\r\n\t\tZ._containerWidth = jqEl.find('.jl-tab-container').innerWidth();\r\n\t},\r\n\t\r\n\t_setVisiTabItems: function(leftIndex, rightIndex) {\r\n\t\tvar Z = this, w;\r\n\t\tif(!leftIndex && leftIndex !== 0) {\r\n\t\t\tif(!rightIndex) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif(Z._newable) {\r\n\t\t\t\trightIndex++;\r\n\t\t\t}\r\n\t\t\tw = Z._itemsWidth[rightIndex];\r\n\t\t\tZ._leftIndex = rightIndex;\r\n\t\t\tfor(var i = rightIndex - 1; i >= 0; i--) {\r\n\t\t\t\tw += Z._itemsWidth[i];\r\n\t\t\t\tif(w > Z._containerWidth) {\r\n\t\t\t\t\tZ._leftIndex = i + 1;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tZ._leftIndex = i;\r\n\t\t\t}\r\n\t\t\tleftIndex = Z._leftIndex;\r\n\t\t} else {\r\n\t\t\tZ._leftIndex = leftIndex;\r\n\t\t}\r\n\t\tw = 0;\r\n\t\tZ._rightIndex = leftIndex;\r\n\t\tfor(var i = leftIndex, len = Z._itemsWidth.length; i < len; i++) {\r\n\t\t\tw += Z._itemsWidth[i];\r\n\t\t\tif(w > Z._containerWidth) {\r\n\t\t\t\tZ._rightIndex = i - 1;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tZ._rightIndex = i;\r\n\t\t}\r\n\t\tvar leftPos = 0;\r\n\t\tfor(var i = 0; i < Z._leftIndex; i++) {\r\n\t\t\tleftPos += Z._itemsWidth[i];\r\n\t\t}\r\n\t\tleftPos += 5;\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tjqEl.find('.jl-tab-container').scrollLeft(jslet.locale.isRtl ? 50000 - leftPos: leftPos);\r\n\t\tZ._setNavBtnVisible();\r\n\t},\r\n\t\r\n\t_setNavBtnVisible: function() {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el),\r\n\t\t\tjqBtnLeft = jqEl.find('.jl-tab-left'),\r\n\t\t\tisHidden = jqBtnLeft.hasClass('jl-hidden');\r\n\t\tif(Z._leftIndex > 0) {\r\n\t\t\tif(isHidden) {\r\n\t\t\t\tjqBtnLeft.removeClass('jl-hidden');\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif(!isHidden) {\r\n\t\t\t\tjqBtnLeft.addClass('jl-hidden');\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar jqBtnRight = jqEl.find('.jl-tab-right');\r\n\t\tvar isHidden = jqBtnRight.hasClass('jl-hidden');\r\n\t\tvar totalCnt = Z._itemsWidth.length;\r\n\t\tif(Z._rightIndex < totalCnt - 1) {\r\n\t\t\tif(isHidden) {\r\n\t\t\t\tjqBtnRight.removeClass('jl-hidden');\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif(!isHidden) {\r\n\t\t\t\tjqBtnRight.addClass('jl-hidden');\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\t_createHeader: function (parent, itemCfg) {\r\n\t\tvar Z = this,\r\n\t\t\tcanClose = Z._closable && itemCfg.closable,\r\n\t\t\ttmpl = ['<a href=\"javascript:;\" class=\"jl-tab-inner' + (canClose? ' jl-tab-close-loc': '')\r\n\t\t\t        + '\" onclick=\"javascript:this.blur();\"><span class=\"jl-tab-title '];\r\n\r\n\t\ttmpl.push('\">');\r\n\t\ttmpl.push(itemCfg.header);\r\n\t\ttmpl.push('</span>');\r\n\t\ttmpl.push('<span href=\"javascript:;\" class=\"close jl-tab-close' + (!canClose || itemCfg.disabled? ' jl-hidden': '') + '\">x</span>');\r\n\t\ttmpl.push('</a>');\r\n\t\tvar oli = document.createElement('li');\r\n\t\tif(itemCfg.disabled) {\r\n\t\t\tjQuery(oli).addClass('jl-tab-disabled');\r\n\t\t}\r\n\t\toli.innerHTML = tmpl.join('');\r\n\r\n\t\tif (Z._newable) {\r\n\t\t\tvar lastNode = parent.childNodes[parent.childNodes.length - 1];\r\n\t\t\tparent.insertBefore(oli, lastNode);\r\n\t\t} else {\r\n\t\t\tparent.appendChild(oli);\r\n\t\t}\r\n\t\toli.jslet = Z;\r\n\t\tjQuery(oli).on('click', Z._changeTabItem);\r\n\r\n\t\tif (canClose) {\r\n\t\t\tjQuery(oli).find('.jl-tab-close').click(Z._doCloseBtnClick);\r\n\t\t}\r\n\t},\r\n\r\n\t_changeTabItem: function (event) {\r\n\t\tvar nodes = this.parentNode.childNodes,\r\n\t\t\tindex = -1;\r\n\t\tfor (var i = 0; i < nodes.length; i++) {\r\n\t\t\tif (nodes[i] == this) {\r\n\t\t\t\tindex = i;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.jslet._chgSelectedIndex(index);\r\n\t},\r\n\r\n\t_doCloseBtnClick: function (event) {\r\n\t\tvar oli = this.parentNode.parentNode,\r\n\t\t\tnodes = oli.parentNode.childNodes,\r\n\t\t\tindex = -1;\r\n\t\tfor (var i = 0; i < nodes.length; i++) {\r\n\t\t\tif (nodes[i] == oli) {\r\n\t\t\t\tindex = i;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\toli.jslet.removeTabItem(index);\r\n\t\tevent.preventDefault();\r\n\t\treturn false;\r\n\t},\r\n\r\n\t_createBody: function (parent, itemCfg) {\r\n\t\tvar Z = this,\r\n\t\t\tjqDiv = jQuery(document.createElement('div'));\r\n\t\tif (!jqDiv.hasClass('jl-tab-panel')) {\r\n\t\t\tjqDiv.addClass('jl-tab-panel');\r\n\t\t}\r\n\t\tvar odiv = jqDiv[0];\r\n\t\tparent.appendChild(odiv);\r\n\t\tvar padding = 4,\r\n\t\t\tjqEl = jQuery(Z.el),\r\n\t\t\tjqHead = jqEl.find('.jl-tab-header'),\r\n\t\t\th = itemCfg.height;\r\n\t\th = h ? h: 300;\r\n\r\n\t\tif (itemCfg.content || itemCfg.divId) {\r\n\t\t\tvar ocontent = itemCfg.content ? itemCfg.content : jQuery('#'+itemCfg.divId)[0];\r\n\t\t\tif (ocontent) {\r\n\t\t\t\tvar pNode = ocontent.parentNode;\r\n\t\t\t\tif (pNode && pNode != odiv) {\r\n\t\t\t\t\tpNode.removeChild(ocontent);\r\n\t\t\t\t}\r\n\t\t\t\todiv.appendChild(ocontent);\r\n\t\t\t\tocontent.style.display = 'block';\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (itemCfg.url) {\r\n\t\t\tif (itemCfg.useIFrame) {\r\n\t\t\t\tvar s = '<iframe scrolling=\"yes\" frameborder=\"0\" src=\"' + \r\n\t\t\t\titemCfg.url + \r\n\t\t\t\t'\" style=\"width: 100%;height:' + h  + 'px;\"></iframe>';\r\n\t\t\t\tjqDiv.html(s);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t/**\r\n\t * Add tab item dynamically.\r\n\t * \r\n\t * @param {Object} newItemCfg Tab item configuration\r\n\t * @param {Boolean} notRefreshRightIdx Improve performance purpose. If you need add a lot of tab item, you can set this parameter to true. \r\n\t */\r\n\taddTabItem: function (newItemCfg, notRefreshRightIdx) {\r\n\t\tvar Z = this;\r\n\t\tZ._items.push(newItemCfg);\r\n\t\tZ._renderTabItem(newItemCfg);\r\n\t\tif(!notRefreshRightIdx) {\r\n\t\t\tZ._calcItemsWidth();\r\n\t\t\tZ._chgSelectedIndex(Z._selectedIndex + 1);\r\n\t\t}\r\n\t},\r\n\r\n\t_renderTabItem: function(itemCfg) {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el),\r\n\t\t\toul = jqEl.find('.jl-tab-list')[0],\r\n\t\t\tpanelContainer = jqEl.find('.jl-tab-items')[0];\r\n\t\tZ._createHeader(oul, itemCfg);\r\n\t\tZ._createBody(panelContainer, itemCfg);\r\n\t},\r\n\t\r\n\t/**\r\n\t * Remove tab item with tabIndex\r\n\t * \r\n\t * @param {Integer} tabIndex Tab item index\r\n\t */\r\n\tremoveTabItem: function (tabIndex) {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el),\r\n\t\t\toli, \r\n\t\t\toul = jqEl.find('.jl-tab-list')[0],\r\n\t\t\tnodes = oul.childNodes,\r\n\t\t\tcnt = nodes.length - (Z._newable ? 2 : 1);\r\n\t\tif (tabIndex > cnt || tabIndex < 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\toli = jQuery(nodes[tabIndex]);\r\n\t\tvar selected = oli.hasClass('jl-tab-selected');\r\n\t\tif (Z._onRemoveTabItem) {\r\n\t\t\tvar canRemoved = Z._onRemoveTabItem.call(Z, tabIndex, selected);\r\n\t\t\tif (!canRemoved) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\toul.removeChild(oli[0]);\r\n\t\tZ._items.splice(tabIndex, 1);\r\n\t\tvar panelContainer = jqEl.find('.jl-tab-items')[0];\r\n\t\tnodes = panelContainer.childNodes;\r\n\t\tpanelContainer.removeChild(nodes[tabIndex]);\r\n\t\tZ._calcItemsWidth();\r\n\r\n\t\tif (selected) {\r\n\t\t\tcnt--;\r\n\t\t\ttabIndex = Z._getNextValidIndex(tabIndex, tabIndex >= cnt)\r\n\t\t\tif (tabIndex >= 0) {\r\n\t\t\t\tZ._chgSelectedIndex(tabIndex);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t_getNextValidIndex: function(start, isLeft) {\r\n\t\tvar Z = this;\r\n\t\tif(isLeft) {\r\n\t\t\tfor(var i = start - 1; i >= 0; i--) {\r\n\t\t\t\tif(!Z._items[i].disabled) {\r\n\t\t\t\t\treturn i;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tfor(var i = start + 1, len = Z._items.length; i < len; i++) {\r\n\t\t\t\tif(!Z._items[i].disabled) {\r\n\t\t\t\t\treturn i;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn -1;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Close the current active tab item  if this tab item is closable.\r\n\t */\r\n\tclose: function () {\r\n\t\tvar Z = this,\r\n\t\t\tcurrIdx = Z._selectedIndex,\r\n\t\t\toitem = Z._items[currIdx];\r\n\t\tif (oitem && currIdx >= 0 && oitem.closable && !oitem.disabled) {\r\n\t\t\tZ.removeTabItem(currIdx);\r\n\t\t\tZ._calcItemsWidth();\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Close all closable tab item except current active tab item.\r\n\t */\r\n\tcloseOther: function () {\r\n\t\tvar Z = this, oitem;\r\n\t\tfor (var i = Z._items.length - 1; i >= 0; i--) {\r\n\t\t\toitem = Z._items[i];\r\n\t\t\tif (oitem.closable && !oitem.disabled) {\r\n\t\t\t\tif (Z._selectedIndex == i) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tZ.removeTabItem(i);\r\n\t\t\t}\r\n\t\t}\r\n\t\tZ._calcItemsWidth();\r\n\t},\r\n\t\r\n\t/**\r\n\t * Run when container size changed, it's revoked by jslet.resizeeventbus.\r\n\t * \r\n\t */\r\n\tcheckSizeChanged: function(){\r\n\t\tvar Z = this,\r\n\t\t\tcurrWidth = jQuery(Z.el).width();\r\n\t\tif ( Z._tabControlWidth != currWidth){\r\n\t\t\tZ._tabControlWidth = currWidth;\r\n\t\t\tZ._calcItemsWidth();\r\n\t\t\tZ._setVisiTabItems(Z._leftIndex);\r\n\t\t}\r\n\t},\r\n\t\r\n\t_createContextMenu: function () {\r\n\t\tvar Z = this;\r\n\t\tif (!jslet.ui.Menu || !Z._closable) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar menuCfg = { type: 'Menu', onItemClick: Z._menuItemClick, items: [\r\n\t\t\t{ id: 'close', name: jslet.locale.TabControl.close},\r\n\t\t\t{ id: 'closeOther', name: jslet.locale.TabControl.closeOther}]};\r\n\t\tif (Z._onCreateContextMenu) {\r\n\t\t\tZ._onCreateContextMenu.call(Z, menuCfg.items);\r\n\t\t}\r\n\r\n\t\tif (menuCfg.items.length === 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tZ.contextMenu = jslet.ui.createControl(menuCfg);\r\n\r\n\t\tvar head = jQuery(Z.el).find('.jl-tab-container')[0];\r\n\r\n\t\thead.oncontextmenu = function (event) {\r\n\t\t\tvar evt = event || window.event;\r\n\t\t\tZ.contextMenu.showContextMenu(evt, Z);\r\n\t\t};\r\n\t},\r\n\r\n\t_menuItemClick: function (menuid, checked) {\r\n\t\tif (menuid == 'close') {\r\n\t\t\tthis.close();\r\n\t\t} else {\r\n\t\t\tif (menuid == 'closeOther') {\r\n\t\t\t\tthis.closeOther();\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\tvar Z = this;\r\n\t\tif(Z._newTabItem) {\r\n\t\t\tZ._newTabItem.onclick = null;\r\n\t\t\tZ._newTabItem = null;\r\n\t\t}\r\n\t\tvar jqEl = jQuery(Z.el), \r\n\t\t\thead = jqEl.find('.jl-tab-header')[0];\r\n\t\t\r\n\t\tjqEl.find('.jl-tab-left').off();\r\n\t\tjqEl.find('.jl-tab-right').off();\r\n\t\thead.oncontextmenu = null;\r\n\t\tjqEl.find('.jl-tab-close').off();\r\n\t\tvar items = jqEl.find('.jl-tab-list').find('li');\r\n\t\titems.off();\r\n\t\titems.each(function(){\r\n\t\t\tthis.jslet = null;\r\n\t\t});\r\n\t\tjslet.resizeEventBus.unsubscribe(this);\r\n\r\n\t\t$super();\r\n\t}\r\n});\r\n\r\njslet.ui.register('TabControl', jslet.ui.TabControl);\r\njslet.ui.TabControl.htmlTemplate = '<div></div>';\r\n\r\n/**\r\n* Tab Item\r\n*/\r\njslet.ui.TabItem = function () {\r\n\tvar Z = this;\r\n\tZ.id = null; //{String} Element Id\r\n\tZ.index = -1; //{Integer} TabItem index\r\n\tZ.header = null; //{String} Head of tab item\r\n\tZ.closable = false; //{Boolean} Can be closed or not\r\n\tZ.disabled = false; //{Boolean} \r\n\tZ.useIFrame = false; //{Boolean}\r\n\tZ.height = 100;\r\n\tZ.url = null; //{String} \r\n\tZ.divId = null; //{String} \r\n\tZ.content = null; //{String} \r\n};\r\n\r\n\r\n\n/* ========================================================================\r\n * Jslet framework: jslet.tippanel.js\r\n *\r\n * Copyright (c) 2014 Jslet Group(https://github.com/jslet/jslet/)\r\n * Licensed under MIT (https://github.com/jslet/jslet/LICENSE.txt)\r\n * ======================================================================== */\r\n\r\n/**\r\n* @class TipPanel. Example:\r\n* <pre><code>\r\n*   var tipPnl = new jslet.ui.TipPanel();\r\n*   tipPnl.show('Hello world', 10, 10);\r\n* </code></pre>\r\n*/\r\njslet.ui.TipPanel = function () {\r\n\tthis._hideTimerId = null;\r\n\tthis._showTimerId = null;\r\n\tthis._oldElement = null;\r\n\tvar p = document.createElement('div');\r\n\tjQuery(p).addClass('jl-tip-panel');\r\n\tdocument.body.appendChild(p);\r\n\tthis._tipPanel = p;\r\n\r\n\t/**\r\n\t * Show tips at specified position. Example:\r\n\t * <pre><code>\r\n\t *  tipPnl.show('foo...', event);\r\n\t *  tipPnl.show('foo...', 100, 200);\r\n\t * </code></pre>\r\n\t * \r\n\t * @param {String} tips Tips text\r\n\t * @param {Integer or Event} left Position left, if left is mouse event, then top argument can't be specified\r\n\t * @param {Integer} top Position top\r\n\t */\r\n\tthis.show = function (tips, leftOrEvent, top) {\r\n\t\tvar Z = this;\r\n\t\tvar len = arguments.length;\r\n\t\tvar isSameCtrl = false, left = leftOrEvent;\r\n\t\tif (len == 2) { //this.show(tips)\r\n\t\t\tvar evt = left;\r\n\t\t\tevt = jQuery.event.fix( evt );\r\n\r\n\t\t\ttop = evt.pageY + 16; left = evt.pageX + 2;\r\n\t\t\tvar ele = evt.currentTarget;\r\n\t\t\tisSameCtrl = (ele === Z._oldElement);\r\n\t\t\tZ._oldElement = ele;\r\n\t\t} else {\r\n\t\t\tleft = parseInt(left);\r\n\t\t\ttop = parseInt(top);\r\n\t\t}\r\n\r\n\t\tif (Z._hideTimerId) {\r\n\t\t\twindow.clearTimeout(Z._hideTimerId);\r\n\t\t\tif (isSameCtrl) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._showTimerId = window.setTimeout(function () {\r\n\t\t\tvar p = Z._tipPanel;\r\n\t\t\tp.innerHTML = tips;\r\n\t\t\tp.style.left = left + 'px';\r\n\t\t\tp.style.top = top + 'px';\r\n\t\t\tZ._tipPanel.style.display = 'block';\r\n\t\t\tZ._showTimerId = null;\r\n\t\t}, 300);\r\n\t};\r\n\r\n\t/**\r\n\t * Hide tip panel\r\n\t */\r\n\tthis.hide = function () {\r\n\t\tvar Z = this;\r\n\t\tif (Z._showTimerId) {\r\n\t\t\twindow.clearTimeout(Z._showTimerId);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tZ._hideTimerId = window.setTimeout(function () {\r\n\t\t\tZ._tipPanel.style.display = 'none';\r\n\t\t\tZ._hideTimerId = null;\r\n\t\t\tZ._oldElement = null;\r\n\t\t}, 300);\r\n\t};\r\n};\r\n\r\n/**\r\n * Global tip panel\r\n */\r\njslet.ui.globalTip = new jslet.ui.TipPanel();\r\n\n/* ========================================================================\r\n * Jslet framework: jslet.waitingbox.js\r\n *\r\n * Copyright (c) 2014 Jslet Group(https://github.com/jslet/jslet/)\r\n * Licensed under MIT (https://github.com/jslet/jslet/LICENSE.txt)\r\n * ======================================================================== */\r\n\r\n/**\r\n * @class WaitingBox. Example:\r\n * <pre><code>\r\n *   var wb = new jslet.ui.WaitingBox(document.getElementById(\"test\"), \"Gray\", true);\r\n *\twb.show(\"Please wait a moment...\");\r\n * \r\n * </code></pre>\r\n * @param {Html Element} container The container which waitingbox reside on.\r\n * @param {String} overlayColor Overlay color\r\n * @param {Boolean} tipsAtNewLine Tips is at new line or not. If false, tips and waiting icon is at the same line.\r\n */\r\njslet.ui.WaitingBox = function (container, overlayColor, tipsAtNewLine) {\r\n\tvar overlay = new jslet.ui.OverlayPanel(container);\r\n\tvar s = '<div class=\"jl-waitingbox\"><b class=\"jl-waitingbox-icon\"></b>';\r\n\t\ts += '<span id=\"tips\"></span></div>';\r\n\r\n\tjQuery(overlay.overlayPanel).html(s);\r\n\r\n\t/**\r\n\t * Show wating box\r\n\t * \r\n\t * @param {String} tips Tips\r\n\t */\r\n\tthis.show = function (tips) {\r\n\t\tvar p = overlay.overlayPanel,\r\n\t\t\tbox = p.firstChild,\r\n\t\t\ttipPanel = box.childNodes[1];\r\n\t\ttipPanel.innerHTML = tips ? tips : '';\r\n\t\tvar jqPnl = jQuery(p),\r\n\t\t\tph = jqPnl.height(),\r\n\t\t\tpw = jqPnl.width();\r\n\r\n\t\tsetTimeout(function () {\r\n\t\t\tvar jqBox = jQuery(box);\r\n\t\t\tbox.style.top = Math.round((ph - jqBox.height()) / 2) + 'px';\r\n\t\t\tbox.style.left = Math.round((pw - jqBox.width()) / 2) + 'px';\r\n\t\t}, 10);\r\n\r\n\t\toverlay.show();\r\n\t};\r\n\r\n\t/**\r\n\t * Hide waiting box\r\n\t */\r\n\tthis.hide = function () {\r\n\t\toverlay.hide();\r\n\t};\r\n\r\n\tthis.destroy = function () {\r\n\t\toverlay.overlayPanel.innerHTML = '';\r\n\t\toverlay.destroy();\r\n\t};\r\n};\r\n\n/* ========================================================================\r\n * Jslet framework: jslet.window.js\r\n *\r\n * Copyright (c) 2014 Jslet Group(https://github.com/jslet/jslet/)\r\n * Licensed under MIT (https://github.com/jslet/jslet/LICENSE.txt)\r\n * ======================================================================== */\r\n\r\n/**\r\n * @class Window, it has the following function: \r\n * 1. Show as modal or modeless;\r\n * 2. User can change window size;\r\n * 3. User can minimize/maximize/restore/close window;\r\n * 4. User can move window;\r\n * \r\n * Example:\r\n * <pre><code>\r\n\tvar oWin = jslet.ui.createControl({ type: \"Window\", iconClass:\"winicon\", caption: \"test window\", minimizable: false, maximizable:false,onActive: doWinActive, onPositionChanged: doPositionChanged });\r\n\toWin.setContent(\"Open modeless window in the Body(with icon)!\");\r\n\toWin.show(350,250);\r\n\t//or oWin.showModel(350, 250);\r\n\r\n *\r\n * </code></pre>\r\n */\r\njslet.ui.Window = jslet.Class.create(jslet.ui.Control, {\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.el = el;\r\n\t\tZ.allProperties = 'caption,resizable,minimizable,maximizable,closable,iconClass,onSizeChanged,onClosed,onPositionChanged,onActive,width,height,minWidth,maxWidth,minHeight,maxHeight,sizeClass,isCenter,isSmallHeader,stopEventBubbling';\r\n\r\n\t\tZ._caption = null;\r\n\t\t\r\n\t\tZ._resizable = true;\r\n\t\t\r\n\t\tZ._minimizable = true;\r\n\r\n\t\tZ._maximizable = true;\r\n\t\t\r\n\t\tZ._closable = true;\r\n\t\t\r\n\t\tZ._iconClass = null;\r\n\t\t\r\n\t\tZ._width = 0;\r\n\t\t\r\n\t\tZ._height = 0;\r\n\t\t\r\n\t\tZ._minWidth = 20;\r\n\t\t\r\n\t\tZ._minHeight = 30;\r\n\t\t\r\n\t\tZ._maxWidth = -1;\r\n\r\n\t\tZ._maxHeight = -1;\r\n\r\n\t\tZ._sizeClass = null,\r\n\t\t\r\n\t\tZ._isCenter = false;\r\n \r\n\t\tZ._onSizeChanged = null;\r\n\t\t\r\n\t\tZ._onPositionChanged = null;\r\n\t\t\r\n\t\tZ._onActive = null;\r\n\t\t\r\n\t\tZ._onClosed = null;\r\n\r\n\t\tZ._stopEventBubbling = false;\r\n\t\t\r\n\t\t//@private\r\n\t\tZ._isModal = false;\r\n\t\t\r\n\t\tZ._state = null; \r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set window caption.\r\n\t * \r\n\t * @param {String or undefined} window caption.\r\n\t * @return {String or this}\r\n\t */\r\n\tcaption: function(caption) {\r\n\t\tif(caption === undefined) {\r\n\t\t\treturn this._caption;\r\n\t\t}\r\n\t\tjslet.Checker.test('Window.caption', caption).isString();\r\n\t\tthis._caption = caption;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get or set the icon class of window header.\r\n\t * \r\n\t * @param {String or undefined} iconClass the icon of window header.\r\n\t * @return {String or this}\r\n\t */\r\n\ticonClass: function(iconClass) {\r\n\t\tif(iconClass === undefined) {\r\n\t\t\treturn this._iconClass;\r\n\t\t}\r\n\t\tjslet.Checker.test('Window.iconClass', iconClass).isString();\r\n\t\tthis._iconClass = iconClass;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Identify whether the window can be resized or not.\r\n\t * \r\n\t * @param {Boolean or undefined} resizable true - window can be resized, false otherwise.\r\n\t * @return {Boolean or this}\r\n\t */\r\n\tresizable: function(resizable) {\r\n\t\tif(resizable === undefined) {\r\n\t\t\treturn this._resizable;\r\n\t\t}\r\n\t\tthis._resizable = resizable? true: false;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Identify whether the window can be minimized or not.\r\n\t * \r\n\t * @param {Boolean or undefined} minimizable true - window can be minimized, false - otherwise.\r\n\t * @return {Boolean or this}\r\n\t */\r\n\tminimizable: function(minimizable) {\r\n\t\tif(minimizable === undefined) {\r\n\t\t\treturn this._minimizable;\r\n\t\t}\r\n\t\tthis._minimizable = minimizable? true: false;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Identify whether the window can be maximized or not.\r\n\t * \r\n\t * @param {Boolean or undefined} maximizable true - window can be maximized, false - otherwise.\r\n\t * @return {Boolean or this}\r\n\t */\r\n\tmaximizable: function(maximizable) {\r\n\t\tif(maximizable === undefined) {\r\n\t\t\treturn this._maximizable;\r\n\t\t}\r\n\t\tthis._maximizable = maximizable? true: false;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Identify whether the window can be closed or not.\r\n\t * \r\n\t * @param {Boolean or undefined} closable true - window can be closed, false - otherwise.\r\n\t * @return {Boolean or this}\r\n\t */\r\n\tclosable: function(closable) {\r\n\t\tif(closable === undefined) {\r\n\t\t\treturn this._closable;\r\n\t\t}\r\n\t\tthis._closable = closable? true: false;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Identify whether the window is shown in center of container.\r\n\t * \r\n\t * @param {Boolean or undefined} isCenter true - window is shown in center of container, false - otherwise.\r\n\t * @return {Boolean or this}\r\n\t */\r\n\tisCenter: function(isCenter) {\r\n\t\tif(isCenter === undefined) {\r\n\t\t\treturn this._isCenter;\r\n\t\t}\r\n\t\tthis._isCenter = isCenter? true: false;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Identify whether stopping the event bubble.\r\n\t * \r\n\t * @param {Boolean or undefined} stopEventBubbling true - stop event bubbling, false - otherwise.\r\n\t * @return {Boolean or this}\r\n\t */\r\n\tstopEventBubbling: function(stopEventBubbling) {\r\n\t\tif(stopEventBubbling === undefined) {\r\n\t\t\treturn this._stopEventBubbling;\r\n\t\t}\r\n\t\tthis._stopEventBubbling = stopEventBubbling? true: false;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get or set window width.\r\n\t * \r\n\t * @param {Integer or undefined} width window width.\r\n\t * @return {Integer or this}\r\n\t */\r\n\twidth: function(width) {\r\n\t\tif(width === undefined) {\r\n\t\t\treturn this._width;\r\n\t\t}\r\n\t\tjslet.Checker.test('Window.width', width).isGTZero();\r\n\t\tthis._width = width;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set window height.\r\n\t * \r\n\t * @param {Integer or undefined} height window height.\r\n\t * @return {Integer or this}\r\n\t */\r\n\theight: function(height) {\r\n\t\tif(height === undefined) {\r\n\t\t\treturn this._height;\r\n\t\t}\r\n\t\tjslet.Checker.test('Window.height', height).isGTZero();\r\n\t\tthis._height = height;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set window minimum width.\r\n\t * \r\n\t * @param {Integer or undefined} minWidth window minimum width.\r\n\t * @return {Integer or this}\r\n\t */\r\n\tminWidth: function(minWidth) {\r\n\t\tif(minWidth === undefined) {\r\n\t\t\treturn this._minWidth;\r\n\t\t}\r\n\t\tjslet.Checker.test('Window.minWidth', minWidth).isGTZero();\r\n\t\tif(minWidth < 20) {\r\n\t\t\tminWidth = 20;\r\n\t\t}\r\n\t\tthis._minWidth = minWidth;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set window minimum height.\r\n\t * \r\n\t * @param {Integer or undefined} minHeight window minimum height.\r\n\t * @return {Integer or this}\r\n\t */\r\n\tminHeight: function(minHeight) {\r\n\t\tif(minHeight === undefined) {\r\n\t\t\treturn this._minHeight;\r\n\t\t}\r\n\t\tjslet.Checker.test('Window.minHeight', minHeight).isGTZero();\r\n\t\tif(minHeight < 30) {\r\n\t\t\tminHeight = 30;\r\n\t\t}\r\n\t\tthis._minHeight = minHeight;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set window maximum width.\r\n\t * \r\n\t * @param {Integer or undefined} maxWidth window maximum width.\r\n\t * @return {Integer or this}\r\n\t */\r\n\tmaxWidth: function(maxWidth) {\r\n\t\tif(maxWidth === undefined) {\r\n\t\t\treturn this._maxWidth;\r\n\t\t}\r\n\t\tjslet.Checker.test('Window.maxWidth', maxWidth).isNumber();\r\n\t\tthis._maxWidth = maxWidth;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set window maximum height.\r\n\t * \r\n\t * @param {Integer or undefined} maxHeight window maximum height.\r\n\t * @return {Integer or this}\r\n\t */\r\n\tmaxHeight: function(maxHeight) {\r\n\t\tif(maxHeight === undefined) {\r\n\t\t\treturn this._maxHeight;\r\n\t\t}\r\n\t\tjslet.Checker.test('Window.maxHeight', maxHeight).isNumber();\r\n\t\tthis._maxHeight = maxHeight;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set window size class name, sizeClass contains: width, height, minWidth, minHeight, maxWidth, maxHeight\r\n\t * \r\n\t * @param {String or undefined} sizeClass window size class name.\r\n\t * @return {String or this}\r\n\t */\r\n\tsizeClass: function(sizeClass) {\r\n\t\tvar Z = this;\r\n\t\tif(sizeClass === undefined) {\r\n\t\t\treturn Z.sizeClass;\r\n\t\t}\r\n\t\tjslet.Checker.test('Window.sizeClass', sizeClass).isString();\r\n\t\tZ.sizeClass = sizeClass;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Set or get window size changed event handler.\r\n\t * Pattern:\r\n\t *   function(width, height){}\r\n\t *   //width: Integer Window width\r\n\t *   //height: Integer Window height\r\n\t * \r\n\t * @param {Function or undefined} onSizeChanged window size changed event handler\r\n\t * @return {Function or this}\r\n\t */\r\n\tonSizeChanged: function(onSizeChanged) {\r\n\t\tif(onSizeChanged === undefined) {\r\n\t\t\treturn this._onSizeChanged;\r\n\t\t}\r\n\t\tjslet.Checker.test('Window.onSizeChanged', onSizeChanged).isFunction();\r\n\t\tthis._onSizeChanged = onSizeChanged;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Set or get window position changed event handler.\r\n\t * Fired when user changes the window's position.\r\n\t * Pattern: \r\n\t *   function(left, top){}\r\n\t *   //left: Integer Window position left\r\n\t *   //top: Integer Window position top \r\n\t * \r\n\t * @param {Function or undefined} onPositionChanged window position changed event handler\r\n\t * @return {Function or this}\r\n\t */\r\n\tonPositionChanged: function(onPositionChanged) {\r\n\t\tif(onPositionChanged === undefined) {\r\n\t\t\treturn this._onPositionChanged;\r\n\t\t}\r\n\t\tjslet.Checker.test('Window.onPositionChanged', onPositionChanged).isFunction();\r\n\t\tthis._onPositionChanged = onPositionChanged;\r\n\t},\r\n\r\n\t/**\r\n\t * Set or get window activated event handler.\r\n\t * Fired when the window is active.\r\n\t *\tfunction(windObj){}\r\n\t *\t//windObj: jslet.ui.Window Window Object\r\n\t * \r\n\t * @param {Function or undefined} onActive window activated event handler\r\n\t * @return {Function or this}\r\n\t */\r\n\tonActive: function(onActive) {\r\n\t\tif(onActive === undefined) {\r\n\t\t\treturn this._onActive;\r\n\t\t}\r\n\t\tjslet.Checker.test('Window.onActive', onActive).isFunction();\r\n\t\tthis._onActive = onActive;\r\n\t},\r\n\t\r\n\t\r\n\t/**\r\n\t * Set or get window closed event handler.\r\n\t * Fired when uses closes window.\r\n\t * Pattern: \r\n\t *\tfunction(windObj){}\r\n\t *\t//windObj: jslet.ui.Window Window Object\r\n\t *\t//return: String If return value equals 'hidden', then hide window instead of closing.\r\n\t * \r\n\t * @param {Function or undefined} onClosed window closed event handler\r\n\t * @return {Function or this}\r\n\t */\r\n\tonClosed: function(onClosed) {\r\n\t\tif(onClosed === undefined) {\r\n\t\t\treturn this._onClosed;\r\n\t\t}\r\n\t\tjslet.Checker.test('Window.onClosed', onClosed).isFunction();\r\n\t\tthis._onClosed = onClosed;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tthis.renderAll();\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tvar Z = this;\r\n\t\tif (!Z._closable) {\r\n\t\t\tZ._minimizable = false;\r\n\t\t\tZ._maximizable = false;\r\n\t\t}\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tif (!jqEl.hasClass('jl-window')) {\r\n\t\t\tjqEl.addClass('panel panel-default jl-window');\r\n\t\t}\r\n\t\tif (!Z._width) {\r\n\t\t\tZ._width = parseInt(Z.el.style.width);\r\n\t\t}\r\n\t\tif (!Z._height) {\r\n\t\t\tZ._height = parseInt(Z.el.style.height);\r\n\t\t}\r\n\t\tif (!Z._width) {\r\n\t\t\tZ._width = 300;\r\n\t\t}\r\n\t\tif (!Z._height) {\r\n\t\t\tZ._height = 300;\r\n\t\t}\r\n\t\tZ.el.style.width = Z._width + 'px';\r\n\t\tZ.el.style.height = Z._height + 'px';\r\n\r\n\t\tvar template = [\r\n\t\t'<div class=\"panel-heading jl-win-header jl-win-header-sm\" style=\"cursor:move\">',\r\n\t\t\tZ._iconClass ? '<span class=\"jl-win-header-icon ' + Z._iconClass + '\"></span>' : '',\r\n\r\n\t\t\t'<span class=\"panel-title jl-win-caption\">', Z._caption ? Z._caption : '', '</span>',\r\n\t\t\t'<span class=\"jl-win-tool jl-unselectable\">'];\r\n\t\t\ttemplate.push(Z._closable ? '<button class=\"close jl-win-close\" onfocus=\"this.blur();\">x</button>' : '');\r\n\t\t\ttemplate.push(Z._maximizable ? '<button class=\"close jl-win-max\" onfocus=\"this.blur();\">□</button>' : '');\r\n\t\t\ttemplate.push(Z._minimizable ? '<button class=\"close jl-win-min\" onfocus=\"this.blur();\">-</button>' : '');\r\n\t\ttemplate.push('</span></div>');\r\n\t\ttemplate.push('<div class=\"panel-body jl-win-body\"></div>');\r\n\r\n\t\tjqEl.html(template.join(''));\r\n\t\tjqEl.on('mousemove', Z._doWinMouseMove);\r\n\t\tjqEl.on('mousedown', Z._doWinMouseDown);\r\n\t\tjqEl.on('dblclick', function(event){\r\n\t\t\tevent.stopPropagation();\r\n\t\t\tevent.preventDefault();\r\n\t\t});\r\n\r\n\t\tjqEl.on('click', function(event){\r\n\t\t\tif(Z._isModal || Z._stopEventBubbling) {\r\n\t\t\t\tevent.stopPropagation();\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t}\r\n\t\t});\r\n\t\t\r\n\t\tvar jqHeader = jqEl.find('.jl-win-header'),\r\n\t\t\theader = jqHeader[0];\r\n\t\tZ._headerHeight = jqHeader.outerHeight();\r\n\t\tvar bodyDiv = jqEl.find('.jl-win-body')[0],\r\n\t\t\tbh = Z._height - Z._headerHeight - 12;\r\n\t\tif (bh < 0) {\r\n\t\t\tbh = 0;\r\n\t\t}\r\n\t\tbodyDiv.style.height = bh + 'px';\r\n\t\tjqBody = jQuery(bodyDiv);\r\n\t\tjqBody.on('mouseenter',function (event) {\r\n\t\t\twindow.setTimeout(function(){\r\n\t\t\t\tif (jslet.temp_dragging) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tZ.cursor = null;\r\n\t\t\t},300);\r\n\t\t});\r\n\t\tjqBody.on('dblclick',function (event) {\r\n\t\t\tevent.stopPropagation();\r\n\t\t\tevent.preventDefault();\r\n\t\t});\r\n\t\t\r\n\t\tjqHeader.on('mousedown',function (event) {\r\n\t\t\tZ.activate();\r\n\t\t\tif (Z._state == 'max') {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tZ.cursor = null;\r\n\t\t\tjslet.ui.dnd.bindControl(this);\r\n\t\t});\r\n\r\n\t\tjqHeader.on('dblclick',function (event) {\r\n\t\t\tevent.stopPropagation();\r\n\t\t\tevent.preventDefault();\r\n\t\t\tif (!Z._maximizable) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif (Z._state != 'max') {\r\n\t\t\t\tZ.maximize();\r\n\t\t\t} else {\r\n\t\t\t\tZ.restore();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\theader._doDragStart = function (oldX, oldY, x, y, deltaX, deltaY) {\r\n\t\t\tZ._createTrackerMask(header);\r\n\t\t\tZ.trackerMask.style.cursor = header.style.cursor;\r\n\t\t\tjslet.temp_dragging = true;\r\n\t\t};\r\n\r\n\t\theader._doDragging = function (oldX, oldY, x, y, deltaX, deltaY) {\r\n\t\t\tZ.setPosition(Z.left + deltaX, Z.top + deltaY, true);\r\n\t\t};\r\n\r\n\t\theader._doDragEnd = function (oldX, oldY, x, y, deltaX, deltaY) {\r\n\t\t\tvar left = parseInt(Z.el.style.left);\r\n\t\t\tvar top = parseInt(Z.el.style.top);\r\n\t\t\tZ.setPosition(left, top);\r\n\t\t\tZ._removeTrackerMask();\r\n\t\t\tZ.cursor = null;\r\n\t\t\tjslet.temp_dragging = false;\r\n\t\t};\r\n\r\n\t\theader._doDragCancel = function (oldX, oldY, x, y, deltaX, deltaY) {\r\n\t\t\tZ.setPosition(Z.left, Z.top);\r\n\t\t\tZ._removeTrackerMask();\r\n\t\t\tZ.cursor = null;\r\n\t\t\tjslet.temp_dragging = false;\r\n\t\t};\r\n\r\n\t\tZ.el._doDragStart = function (oldX, oldY, x, y, deltaX, deltaY) {\r\n\t\t\tZ._createTrackerMask(this);\r\n\t\t\tZ._createTracker();\r\n\t\t\tZ.trackerMask.style.cursor = Z.el.style.cursor;\r\n\t\t\tjslet.temp_dragging = true;\r\n\t\t};\r\n\r\n\t\tZ.el._doDragging = function (oldX, oldY, x, y, deltaX, deltaY) {\r\n\t\t\tZ._changeTrackerSize(deltaX, deltaY);\r\n\t\t};\r\n\r\n\t\tZ.el._doDragEnd = function (oldX, oldY, x, y, deltaX, deltaY) {\r\n\t\t\tif (!Z.tracker) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar left = parseInt(Z.tracker.style.left);\r\n\t\t\tvar top = parseInt(Z.tracker.style.top);\r\n\t\t\tvar width = parseInt(Z.tracker.style.width);\r\n\t\t\tvar height = parseInt(Z.tracker.style.height);\r\n\r\n\t\t\tZ.setPosition(left, top);\r\n\t\t\tZ.changeSize(width, height);\r\n\t\t\tZ._removeTrackerMask();\r\n\t\t\tZ._removeTracker();\r\n\t\t\tZ.cursor = null;\r\n\t\t\tjslet.temp_dragging = false;\r\n\t\t};\r\n\r\n\t\tZ.el._doDragCancel = function (oldX, oldY, x, y, deltaX, deltaY) {\r\n\t\t\tZ._removeTrackerMask();\r\n\t\t\tZ._removeTracker();\r\n\t\t\tZ.cursor = null;\r\n\t\t\tjslet.temp_dragging = false;\r\n\t\t};\r\n\r\n\t\tif (Z._closable) {\r\n\t\t\tvar jqClose = jqEl.find('.jl-win-close');\r\n\t\t\tjqClose.click(function (event) {\r\n\t\t\t\tZ.close();\r\n\t\t\t\tevent = jQuery.event.fix( event || window.event );\r\n\t\t\t\tevent.stopPropagation();\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t});\r\n\t\t}\r\n\t\tif (Z._minimizable) {\r\n\t\t\tvar jqMin = jqEl.find('.jl-win-min');\r\n\t\t\tjqMin.click(function (event) {\r\n//\t\t\t\tif (Z._state == 'max') {\r\n//\t\t\t\t\tvar btnMax = jqEl.find('.jl-win-restore')[0];\r\n//\t\t\t\t\tif (btnMax) {\r\n//\t\t\t\t\t\tbtnMax.className = 'jl-win-max';\r\n//\t\t\t\t\t}\r\n//\t\t\t\t}\r\n\t\t\t\tZ.minimize();\r\n\t\t\t\tevent = jQuery.event.fix( event || window.event );\r\n\t\t\t\tevent.stopPropagation();\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t});\r\n\t\t}\r\n\t\tif (Z._maximizable) {\r\n\t\t\tvar jqMax = jqEl.find('.jl-win-max'),\r\n\t\t\t\tbtnMax = jqMax[0];\r\n\t\t\tjqMax.click(function (event) {\r\n\t\t\t\tif (Z._state != 'max') {\r\n\t\t\t\t\tbtnMax.innerHTML = '■'\r\n\t\t\t\t\tZ.maximize();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tbtnMax.innerHTML = '□'\r\n\t\t\t\t\tZ.restore();\r\n\t\t\t\t}\r\n\t\t\t\tevent = jQuery.event.fix( event || window.event );\r\n\t\t\t\tevent.stopPropagation();\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t});\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Show window at specified position\r\n\t * \r\n\t * @param {Integer} left Position left.\r\n\t * @param {Integer} top Position top.\r\n\t */\r\n\tshow: function (left, top) {\r\n\t\tvar Z = this;\r\n\t\tif (Z._isCenter) {\r\n\t\t\tvar offsetP = jQuery(Z.el).offsetParent()[0],\r\n\t\t\t\tjqOffsetP = jQuery(offsetP),\r\n\t\t\t\tpw = jqOffsetP.width(),\r\n\t\t\t\tph = jqOffsetP.height();\r\n\t\t\tleft = offsetP.scrollLeft + Math.round((pw - Z._width) / 2);\r\n\t\t\ttop = offsetP.scrollTop + Math.round((ph - Z._height) / 2);\r\n\t\t}\r\n\r\n\t\tZ.top = top ? top : 0;\r\n\t\tZ.left = left ? left : 0;\r\n\t\tZ.el.style.left = Z.left + 'px';\r\n\t\tZ.el.style.top = Z.top + 'px';\r\n\t\tZ.el.style.display = 'block';\r\n\r\n\t\tZ.activate();\r\n\t},\r\n\r\n\t/**\r\n\t * Show modal window at specified position\r\n\t * \r\n\t * @param {Integer} left Position left.\r\n\t * @param {Integer} top Position top.\r\n\t */\r\n\tshowModal: function (left, top) {\r\n\t\tvar Z = this;\r\n\t\tZ._isModal = true;\r\n\t\tif (!Z.overlay) {\r\n\t\t\tZ.overlay = new jslet.ui.OverlayPanel(Z.el.parentNode);\r\n\t\t}\r\n\t\tjslet.ui.GlobalZIndex += 10;\r\n\t\tvar k = jslet.ui.GlobalZIndex;\r\n\t\tZ.el.style.zIndex = k;\r\n\t\tZ.show(left, top);\r\n\t\tZ.overlay.setZIndex(k - 2);\r\n\t\tZ.overlay.show();\r\n\t},\r\n\r\n\t/**\r\n\t * Hide window\r\n\t */\r\n\thide: function () {\r\n\t\tvar Z = this;\r\n\t\tZ.el.style.display = 'none';\r\n\t\tif (Z.overlay) {\r\n\t\t\tZ.overlay.hide();\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Close window, this will fire onClosed event.\r\n\t * \r\n\t */\r\n\tclose: function () {\r\n\t\tvar Z = this;\r\n\t\tif(!Z.el) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (Z._onClosed) {\r\n\t\t\tvar action = Z._onClosed.call(Z);\r\n\t\t\tif (action && action.toLowerCase() == 'hidden') {\r\n\t\t\t\tZ.hide();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar pnode = Z.el.parentNode;\r\n\t\tpnode.removeChild(Z.el);\r\n\t\tif (Z.overlay) {\r\n\t\t\tZ.overlay.destroy();\r\n\t\t\tZ.overlay = null;\r\n\t\t}\r\n\t\tjslet.ui.GlobalZIndex -= 10;\r\n\t\tZ.destroy();\r\n\t},\r\n\r\n\t/**\r\n\t * Minimize window\r\n\t */\r\n\tminimize: function () {\r\n\t\tvar Z = this;\r\n\t\tif (Z._state == 'min') {\r\n\t\t\tZ.restore();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (Z._state == 'max') {\r\n\t\t\tZ.restore();\r\n\t\t}\r\n\t\tZ.changeSize(null, Z._headerHeight + 8, true);\r\n\t\tZ._state = 'min';\r\n\t},\r\n\r\n\t/**\r\n\t * Maximize window\r\n\t */\r\n\tmaximize: function () {\r\n\t\tvar Z = this;\r\n\t\tvar offsetP = jQuery(Z.el).offsetParent();\r\n\t\tvar width = offsetP.width(); // -12;\r\n\t\tvar height = offsetP.height(); // -12;\r\n\t\tZ.setPosition(0, 0, true);\r\n\t\tZ.changeSize(width, height, true);\r\n\t\tZ._state = 'max';\r\n\t},\r\n\r\n\t/**\r\n\t * Restore window\r\n\t */\r\n\trestore: function () {\r\n\t\tvar Z = this;\r\n\t\tZ.setPosition(Z.left, Z.top, true);\r\n\t\tZ.changeSize(Z._width, Z._height, true);\r\n\t\tZ._state = null;\r\n\t},\r\n\r\n\t/**\r\n\t * Activate window, this will fire the 'OnActive' event\r\n\t */\r\n\tactivate: function () {\r\n\t\tvar Z = this;\r\n\t\tif (!Z.overlay) {\r\n\t\t\tZ.bringToFront();\r\n\t\t}\r\n\t\tif (Z._onActive) {\r\n\t\t\tZ._onActive.call();\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Change window position.\r\n\t * \r\n\t * @param {Integer} left Position left\r\n\t * @param {Integer} top Position top\r\n\t * @param {Boolean} notUpdateLeftTop True - Only change html element position, \r\n\t *\t\tnot change the inner position of Window object, it is usually use for moving action\r\n\t */\r\n\tsetPosition: function (left, top, notUpdateLeftTop) {\r\n\t\tvar Z = this;\r\n\t\tif (!notUpdateLeftTop) {\r\n\t\t\tZ.left = left;\r\n\t\t\tZ.top = top;\r\n\t\t} else {\r\n\t\t\tif (Z._onPositionChanged) {\r\n\t\t\t\tvar result = Z._onPositionChanged.call(Z, left, top);\r\n\t\t\t\tif (result) {\r\n\t\t\t\t\tif (result.left) {\r\n\t\t\t\t\t\tleft = result.left;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (result.top) {\r\n\t\t\t\t\t\ttop = result.top;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tZ.el.style.left = left + 'px';\r\n\t\tZ.el.style.top = top + 'px';\r\n\t},\r\n\r\n\t/**\r\n\t * Change window size.\r\n\t * \r\n\t * @param {Integer} width Window width\r\n\t * @param {Integer} height Window height\r\n\t * @param {Boolean} notUpdateSize True - Only change html element size, \r\n\t *\t\tnot change the inner size of Window object, it is usually use for moving action\r\n\t */\r\n\tchangeSize: function (width, height, notUpdateSize) {\r\n\t\tvar Z = this;\r\n\t\tif (!width) {\r\n\t\t\twidth = Z._width;\r\n\t\t}\r\n\t\tif (!height) {\r\n\t\t\theight = Z._height;\r\n\t\t}\r\n\r\n\t\tif (Z._onSizeChanged) {\r\n\t\t\tZ._onSizeChanged.call(Z, width, height);\r\n\t\t}\r\n\r\n\t\tif (!notUpdateSize) {\r\n\t\t\tZ._width = width;\r\n\t\t\tZ._height = height;\r\n\t\t}\r\n\t\tZ.el.style.width = width + 'px';\r\n\t\tZ.el.style.height = height + 'px';\r\n\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tvar bodyDiv = jqEl.find('.jl-win-body')[0];\r\n\t\tvar bh = height - Z._headerHeight - 12;\r\n\t\tif (bh < 0) {\r\n\t\t\tbh = 0;\r\n\t\t}\r\n\t\tbodyDiv.style.height = bh + 'px';\r\n\t},\r\n\r\n\t/**\r\n\t * Get window caption element. You can use it to customize window caption.\r\n\t * \r\n\t * @return {Html Element}\r\n\t */\r\n\tgetCaptionDiv: function () {\r\n\t\treturn jQuery(this.el).find('.jl-win-caption')[0];\r\n\t},\r\n\r\n\t/**\r\n\t * Set window caption\r\n\t * \r\n\t * @param {String} caption Window caption\r\n\t */\r\n\tchangeCaption: function (caption) {\r\n\t\tthis.caption = caption;\r\n\t\tvar captionDiv = jQuery(this.el).find('.jl-win-caption');\r\n\t\tcaptionDiv.html(caption);\r\n\t},\r\n\r\n\t/**\r\n\t * Get window content element. You can use it to customize window content.\r\n\t * \r\n\t * @return {Html Element}\r\n\t */\r\n\tgetContentDiv: function () {\r\n\t\treturn jQuery(this.el).find('.jl-win-body')[0];\r\n\t},\r\n\r\n\t/**\r\n\t * Set window content\r\n\t * \r\n\t * @param {String} html Html text for window content\r\n\t */\r\n\tsetContent: function (html) {\r\n\t\tif (!html){\r\n\t\t\tjslet.showError('Window content cannot be null!');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar bodyDiv = jQuery(this.el).find('.jl-win-body');\r\n\t\tif (html && html.toLowerCase) {\r\n\t\t\tbodyDiv.html(html);\r\n\t\t} else {\r\n\t\t\tbodyDiv.html('');\r\n\t\t\t\r\n\t\t\thtml.parentNode.removeChild(html);\r\n\t\t\tbodyDiv[0].appendChild(html);\r\n\t\t\tif (html.style && html.style.display == 'none') {\r\n\t\t\t\thtml.style.display = 'block';\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Bring window to front\r\n\t */\r\n\tbringToFront: function () {\r\n\t\tvar Z = this;\r\n\t\tvar p = Z.el.parentNode;\r\n\t\tvar node, jqEl = jQuery(Z.el);\r\n\t\tvar maxIndex = 0, jqNode;\r\n\t\tfor (var i = 0, cnt = p.childNodes.length; i < cnt; i++) {\r\n\t\t\tnode = p.childNodes[i];\r\n\t\t\tif (node.nodeType != 1 || node == Z.el) {\r\n\t\t\t\tif (!Z._isModal) {\r\n\t\t\t\t\tjqEl.find('.jl-win-header').addClass('jl-window-active');\r\n\t\t\t\t}\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tjqNode = jQuery(node);\r\n\t\t\tif (jqNode.hasClass('jl-window')) {\r\n\t\t\t\tif (maxIndex < node.style.zIndex) {\r\n\t\t\t\t\tmaxIndex = node.style.zIndex;\r\n\t\t\t\t}\r\n\t\t\t\tif (!Z._isModal) {\r\n\t\t\t\t\tjqNode.find('.jl-win-header').removeClass('jl-window-active');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (Z.el.style.zIndex < maxIndex || maxIndex === 0) {\r\n\t\t\tZ.setZIndex(maxIndex + 3);\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Set window Z-Index\r\n\t * \r\n\t * @param {Integer} zIndex Z-Index\r\n\t */\r\n\tsetZIndex: function (zIndex) {\r\n\t\tthis.el.style.zIndex = zIndex;\r\n\t},\r\n\r\n\t_checkSize: function (width, height) {\r\n\t\tvar Z = this;\r\n\t\tif (width) {\r\n\t\t\tif (width < Z._minWidth || Z._maxWidth > 0 && width > Z._maxWidth) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (height) {\r\n\t\t\tif (height < Z.minHeight || Z._maxHeight > 0 && height > Z._maxHeight) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn true;\r\n\t},\r\n\r\n\t_changeTrackerSize: function (deltaX, deltaY) {\r\n\t\tvar Z = this;\r\n\t\tif (!Z.tracker || !Z.cursor) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar w = Z.el.offsetWidth, h = Z.el.offsetHeight, top = null, left = null;\r\n\r\n\t\tif (Z.cursor == 'nw') {\r\n\t\t\tw = Z._width - deltaX;\r\n\t\t\th = Z._height - deltaY;\r\n\t\t\ttop = Z.top + deltaY;\r\n\t\t\tleft = Z.left + deltaX;\r\n\t\t} else if (Z.cursor == 'n') {\r\n\t\t\th = Z._height - deltaY;\r\n\t\t\ttop = Z.top + deltaY;\r\n\t\t} else if (Z.cursor == 'ne') {\r\n\t\t\th = Z._height - deltaY;\r\n\t\t\tw = Z._width + deltaX;\r\n\t\t\ttop = Z.top + deltaY;\r\n\t\t} else if (Z.cursor == 'e') {\r\n\t\t\tw = Z._width + deltaX;\r\n\t\t} else if (Z.cursor == 'se') {\r\n\t\t\tw = Z._width + deltaX;\r\n\t\t\th = Z._height + deltaY;\r\n\t\t} else if (Z.cursor == 's'){\r\n\t\t\th = Z._height + deltaY;\r\n\t\t} else if (Z.cursor == 'sw') {\r\n\t\t\th = Z._height + deltaY;\r\n\t\t\tw = Z._width - deltaX;\r\n\t\t\tleft = Z.left + deltaX;\r\n\t\t} else if (Z.cursor == 'w') {\r\n\t\t\tw = Z._width - deltaX;\r\n\t\t\tleft = Z.left + deltaX;\r\n\t\t}\r\n\r\n\t\tif (!Z._checkSize(w, h)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (w) {\r\n\t\t\tZ.tracker.style.width = w + 'px';\r\n\t\t}\r\n\t\tif (h) {\r\n\t\t\tZ.tracker.style.height = h + 'px';\r\n\t\t}\r\n\t\tif (top) {\r\n\t\t\tZ.tracker.style.top = top + 'px';\r\n\t\t}\r\n\t\tif (left) {\r\n\t\t\tZ.tracker.style.left = left + 'px';\r\n\t\t}\r\n\t},\r\n\r\n\t_doWinMouseMove: function (event) {\r\n\t\tif (jslet.temp_dragging) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tevent = jQuery.event.fix( event || window.event );\r\n\t\t\r\n\t\tvar srcEl = event.target, jqSrcEl = jQuery(srcEl);\r\n\t\t\r\n\t\tif (!jqSrcEl.hasClass('jl-window')) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (!srcEl.jslet._resizable || srcEl.jslet._state) {\r\n\t\t\tsrcEl.jslet.cursor = null;\r\n\t\t\tsrcEl.style.cursor = 'default';\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar pos = jqSrcEl.offset(),\r\n\t\t\tx = event.pageX - pos.left,\r\n\t\t\ty = event.pageY - pos.top,\r\n\t\t\tw = jqSrcEl.width(),\r\n\t\t\th = jqSrcEl.height();\r\n\t\tvar delta = 8, wdelta = w - delta, hdelta = h - delta, cursor = null;\r\n\t\tif (x <= delta && y <= delta) {\r\n\t\t\tcursor = 'nw';\r\n\t\t} else if (x > delta && x < wdelta && y <= delta) {\r\n\t\t\tcursor = 'n';\r\n\t\t} else if (x >= wdelta && y <= delta) {\r\n\t\t\tcursor = 'ne';\r\n\t\t} else if (x >= wdelta && y > delta && y <= hdelta) {\r\n\t\t\tcursor = 'e';\r\n\t\t} else if (x >= wdelta && y >= hdelta) {\r\n\t\t\tcursor = 'se';\r\n\t\t} else if (x > delta && x < wdelta && y >= hdelta) {\r\n\t\t\tcursor = 's';\r\n\t\t} else if (x <= delta && y >= hdelta) {\r\n\t\t\tcursor = 'sw';\r\n\t\t} else if (x <= delta && y > delta && y < hdelta) {\r\n\t\t\tcursor = 'w';\r\n\t\t}\r\n\t\t\r\n\t\tsrcEl.jslet.cursor = cursor;\r\n\t\tsrcEl.style.cursor = cursor ? cursor + '-resize' : 'default';\r\n\t},\r\n\r\n\t_doWinMouseDown: function (event) {\r\n\t\tvar ojslet = this.jslet;\r\n\t\tojslet.activate();\r\n\t\tif (ojslet.cursor) {\r\n\t\t\tjslet.ui.dnd.bindControl(this);\r\n\t\t}\r\n\t},\r\n\r\n\t_createTrackerMask: function (holder) {\r\n\t\tvar Z = this;\r\n\t\tif (Z.trackerMask) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar jqBody = jQuery(document.body);\r\n\r\n\t\tZ.trackerMask = document.createElement('div');\r\n\t\tjQuery(Z.trackerMask).addClass('jl-win-tracker-mask');\r\n\t\tZ.trackerMask.style.top = '0px';\r\n\t\tZ.trackerMask.style.left = '0px';\r\n\t\tZ.trackerMask.style.zIndex = 99998;\r\n\t\tZ.trackerMask.style.width = jqBody.width() + 'px';\r\n\t\tZ.trackerMask.style.height = jqBody.height() + 'px';\r\n\t\tZ.trackerMask.style.display = 'block';\r\n\t\tZ.trackerMask.onmousedown = function () {\r\n\t\t\tif (holder && holder._doDragCancel) {\r\n\t\t\t\tholder._doDragCancel();\r\n\t\t\t}\r\n\t\t};\r\n\t\tjqBody[0].appendChild(Z.trackerMask);\r\n\t},\r\n\r\n\t_removeTrackerMask: function () {\r\n\t\tvar Z = this;\r\n\t\tif (Z.trackerMask) {\r\n\t\t\tZ.trackerMask.onmousedown = null;\r\n\t\t\tdocument.body.removeChild(Z.trackerMask);\r\n\t\t}\r\n\t\tZ.trackerMask = null;\r\n\t},\r\n\r\n\t_createTracker: function () {\r\n\t\tvar Z = this;\r\n\t\tif (Z.tracker) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tZ.tracker = document.createElement('div');\r\n\t\tjQuery(Z.tracker).addClass('jl-win-tracker');\r\n\t\tZ.tracker.style.top = Z.top + 'px';\r\n\t\tZ.tracker.style.left = Z.left + 'px';\r\n\t\tZ.tracker.style.zIndex = 99999;\r\n\t\tZ.tracker.style.width = Z._width + 'px';\r\n\t\tZ.tracker.style.height = Z._height + 'px';\r\n\t\tZ.tracker.style.display = 'block';\r\n\t\tZ.el.parentNode.appendChild(Z.tracker);\r\n\t},\r\n\r\n\t_removeTracker: function () {\r\n\t\tvar Z = this;\r\n\t\tif (Z.tracker) {\r\n\t\t\tZ.el.parentNode.removeChild(Z.tracker);\r\n\t\t}\r\n\t\tZ.tracker = null;\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el);\r\n\t\tjqEl.find('.jl-win-max').off();\r\n\t\tjqEl.find('.jl-win-min').off();\r\n\t\tjqEl.find('.jl-win-close').off();\r\n\r\n\t\tvar jqHeader = jqEl.find('.jl-win-header'),\r\n\t\t\theader = jqHeader[0];\r\n\t\tjqHeader.off();\r\n\t\tjqEl.find('.jl-win-body').off();\r\n\t\tif (Z.trackerMask) {\r\n\t\t\tZ.trackerMask.onmousedown = null;\r\n\t\t}\r\n\t\tZ.trackerMask = null;\r\n\t\tZ.el._doDragCancel = null;\r\n\t\tZ.el._doDragEnd = null;\r\n\t\tZ.el._doDragging = null;\r\n\t\tZ.el._doDragStart = null;\r\n\t\theader._doDragCancel = null;\r\n\t\theader._doDragEnd = null;\r\n\t\theader._doDragging = null;\r\n\t\theader._doDragStart = null;\r\n\t\t\r\n\t\tif ($super) {\r\n\t\t\t$super();\r\n\t\t}\r\n\t}\r\n});\r\njslet.ui.register('Window', jslet.ui.Window);\r\njslet.ui.Window.htmlTemplate = '<div></div>';\r\n\r\n\r\n/**\r\n* @class MessageBox\r\n*/\r\njslet.ui.MessageBox = function () {\r\n\r\n\t//hasInput-0:none,1-single line input, 2:multiline input\r\n\t/**\r\n\t * Show message box\r\n\t * \r\n\t * @param {String} message Message text\r\n\t * @param {String} caption Caption text\r\n\t * @param {String} iconClass Caption icon class\r\n\t * @param {String[]} buttons Array of button names, like : ['ok','cancel']\r\n\t * @param {Fucntion} callbackFn Callback function when user click one button, \r\n\t *\tPattern: \r\n\t *\tfunction({String}button, {String} value){}\r\n\t *\t//button: String, button name;\r\n\t *\t//value: String, the alue inputed by user;\r\n\t * @param {Integer} hasInput There is input or not, value options: 0 - none, 1 - single line input, 2 - multiline input\r\n\t * @param {String} defaultValue The default value of Input element, if hasInput = 0, this argument is be igored.\r\n\t * @param {Fucntion} validateFn Validate function of input element, if hasInput = 0, this argument is be igored.\r\n\t *   Pattern: \r\n\t *   function(value){}\r\n\t *   //value: String, the value which need to be validated.\r\n\t * \r\n\t */\r\n\tthis.show = function (message, caption, iconClass, buttons, callbackFn, hasInput, defaultValue, validateFn) {\r\n\t\tjslet.ui.textMeasurer.setElement(document.body);\r\n\t\tvar arrMsg = message.split('\\n'),\r\n\t\t\tmsgLen = arrMsg.length;\r\n\t\tvar mh = jslet.ui.textMeasurer.getHeight(message),\r\n\t\t\tmw = 0;\r\n\t\tfor(var i = 0; i < msgLen; i++) {\r\n\t\t\tmw = Math.max(mw, jslet.ui.textMeasurer.getWidth(message[i]));\r\n\t\t}\r\n\t\tmh = mh * arrMsg.length + 100;\r\n\t\tjslet.ui.textMeasurer.setElement();\r\n\t\tif (mw < 200) {\r\n\t\t\tmw = 200;\r\n\t\t}\r\n\t\tmessage = message.replace('\\n', '<br />');\r\n\t\tvar btnWidth = parseInt(jslet.ui.getCssValue('jl-msg-button', 'width'));\r\n\t\tvar btnCount = buttons.length;\r\n\t\tvar toolWidth = (btnWidth + 10) * btnCount - 10;\r\n\t\tif (mw < toolWidth) {\r\n\t\t\tmw = toolWidth;\r\n\t\t}\r\n\t\tmw += 100;\r\n\t\tif (hasInput == 1)  {\r\n\t\t\tmh += 25;\r\n\t\t} else if (hasInput == 2) {\r\n\t\t\t\tmh += 100;\r\n\t\t}\r\n\t\tvar opt = { type: 'window', caption: caption, isCenter: true, resizable: false, minimizable: false, maximizable: false, stopEventBubbling: true, height: mh, width: mw };\r\n\t\tvar owin = jslet.ui.createControl(opt);\r\n\t\tvar iconHtml = '';\r\n\t\tif (iconClass) {\r\n\t\t\ticonHtml = '<div class=\"jl-msg-icon ';\r\n\t\t\tif (iconClass == 'info' || iconClass == 'error' || iconClass == 'question' || iconClass == 'warning') {\r\n\t\t\t\ticonHtml += 'jl-msg-icon-' + iconClass;\r\n\t\t\t} else {\r\n\t\t\t\ticonHtml += iconClass;\r\n\t\t\t}\r\n\t\t\ticonHtml += '\"><i class=\"fa ';\r\n\t\t\tswitch (iconClass) {\r\n\t            case 'info':\r\n\t            \ticonHtml += 'fa-info';\r\n\t                break;\r\n\t            case 'error':\r\n\t            \ticonHtml += 'fa-times';\r\n\t                break;\r\n\t            case 'success':\r\n\t            \ticonHtml += 'fa-check';\r\n\t                break;\r\n\t            case 'warning':\r\n\t            \ticonHtml += 'fa-exclamation';\r\n\t                break;\r\n\t            case 'question':\r\n\t            \ticonHtml += 'fa-question';\r\n\t                break;\r\n\t            default :\r\n\t            \ticonHtml += 'fa-info';\r\n                 \tbreak;\r\n\t        }\r\n\t\t\ticonHtml += '\"></i></div>';\r\n\t\t}\r\n\r\n\t\tvar btnHtml = [], btnName, left, k = 0, i;\r\n\t\tif (jslet.locale.isRtl){\r\n\t\t\tfor (i = btnCount - 1; i >=0; i--) {\r\n\t\t\t\tbtnName = buttons[i];\r\n\t\t\t\tleft = (k++) * (btnWidth + 10) - 10;\r\n\t\t\t\tbtnHtml.push('<button class=\"jl-msg-button btn btn-default btn-sm\" ');\r\n\t\t\t\tbtnHtml.push(' data-jsletname=\"');\r\n\t\t\t\tbtnHtml.push(btnName);\r\n\t\t\t\tbtnHtml.push('\" style=\"left: ');\r\n\t\t\t\tbtnHtml.push(left);\r\n\t\t\t\tbtnHtml.push('px\">');\r\n\t\t\t\tbtnHtml.push(jslet.locale.MessageBox[btnName]);\r\n\t\t\t\tbtnHtml.push('</button>');\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tfor (i = 0; i < btnCount; i++) {\r\n\t\t\t\tbtnName = buttons[i];\r\n\t\t\t\tleft = i * (btnWidth + 10) - 10;\r\n\t\t\t\tbtnHtml.push('<button class=\"jl-msg-button btn btn-default btn-sm\" ');\r\n\t\t\t\tbtnHtml.push('\" data-jsletname=\"');\r\n\t\t\t\tbtnHtml.push(btnName);\r\n\t\t\t\tbtnHtml.push('\" style=\"left: ');\r\n\t\t\t\tbtnHtml.push(left);\r\n\t\t\t\tbtnHtml.push('px\">');\r\n\t\t\t\tbtnHtml.push(jslet.locale.MessageBox[btnName]);\r\n\t\t\t\tbtnHtml.push('</button>');\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar inputHtml = ['<br />'];\r\n\t\tif (hasInput) {\r\n\t\t\tif (hasInput == 1) {\r\n\t\t\t\tinputHtml.push('<input type=\"text\"');\r\n\t\t\t} else {\r\n\t\t\t\tinputHtml.push('<textarea rows=\"5\"');\r\n\t\t\t}\r\n\t\t\tinputHtml.push(' style=\"width:');\r\n\t\t\tinputHtml.push('98%\"');\r\n\t\t\tif (defaultValue !== null && defaultValue !== undefined) {\r\n\t\t\t\tinputHtml.push(' value=\"');\r\n\t\t\t\tinputHtml.push(defaultValue);\r\n\t\t\t\tinputHtml.push('\"');\r\n\t\t\t}\r\n\t\t\tif (hasInput == 1) {\r\n\t\t\t\tinputHtml.push(' />');\r\n\t\t\t} else {\r\n\t\t\t\tinputHtml.push('></textarea>');\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar html = ['<div class=\"jl-msg-container\">', iconHtml, '<div class=\"' + (hasInput? 'jl-msg-message-noicon': 'jl-msg-message') + '\">',\r\n\t\t\t\t\tmessage, inputHtml.join(''), '</div>', '</div>',\r\n\t\t\t\t\t'<div class=\"jl-msg-tool\"><div style=\"position:relative;width:', toolWidth, 'px;margin:0px auto;\">', btnHtml.join(''), '</div></div>'\r\n\t\t];\r\n\r\n\t\towin.setContent(html.join(''));\r\n\t\tvar jqEl = jQuery(owin.el);\r\n\t\tvar toolBar = jqEl.find('.jl-msg-tool')[0].firstChild;\r\n\t\tvar inputCtrl = null;\r\n\t\tif (hasInput == 1) {\r\n\t\t\tinputCtrl = jqEl.find('.jl-msg-container input')[0];\r\n\t\t} else {\r\n\t\t\tinputCtrl = jqEl.find('.jl-msg-container textarea')[0];\r\n\t\t}\r\n\t\tvar obtn;\r\n\t\tfor (i = 0; i < btnCount; i++) {\r\n\t\t\tobtn = toolBar.childNodes[i];\r\n\t\t\tobtn.onclick = function () {\r\n\t\t\t\tbtnName = jQuery(this).attr('data-jsletname');\r\n\t\t\t\tvar value = null;\r\n\t\t\t\tif (hasInput && btnName == 'ok') {\r\n\t\t\t\t\tvalue = inputCtrl.value;\r\n\t\t\t\t\tif (validateFn && !validateFn(value)) {\r\n\t\t\t\t\t\tinputCtrl.focus();\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\towin.close();\r\n\t\t\t\tif (callbackFn) {\r\n\t\t\t\t\tcallbackFn(btnName, value);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\towin.onClosed(function () {\r\n\t\t\tif (callbackFn) {\r\n\t\t\t\tcallbackFn(btnName);\r\n\t\t\t}\r\n\t\t});\r\n\t\t\r\n\t\towin.showModal();\r\n\t\towin.setZIndex(99981);\r\n\t\tk = 0;\r\n\t\tif (jslet.locale.isRtl) {\r\n\t\t\tk = btnCount - 1;\r\n\t\t}\r\n\t\tvar toolBtn = toolBar.childNodes[k];\r\n\t\ttoolBtn && toolBtn.focus();\r\n\t\treturn owin;\r\n\t};\r\n};\r\n\r\n/**\r\n * Show alert message. Example:\r\n * <pre><code>\r\n * jslet.ui.MessageBox.alert('Finished!', 'Tips');\r\n * </code></pre>\r\n */\r\njslet.ui.MessageBox.alert = function (message, caption, callbackFn, timeout) {\r\n\tvar omsgBox = new jslet.ui.MessageBox();\r\n\tif (!caption) {\r\n\t\tcaption = jslet.locale.MessageBox.info;\r\n\t}\r\n\tvar owin = omsgBox.show(message, caption, 'info', ['ok'], callbackFn);\r\n\tif(timeout) {\r\n\t\ttimeout = parseInt(timeout);\r\n\t\tif(timeout !== NaN) {\r\n\t\t\twindow.setTimeout(function() {\r\n\t\t\t\towin.close()\r\n\t\t\t}, timeout);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * Show error message. Example:\r\n * <pre><code>\r\n * jslet.ui.MessageBox.alert('You have made a mistake!', 'Error');\r\n * </code></pre>\r\n */\r\njslet.ui.MessageBox.error = function (message, caption, callbackFn, timeout) {\r\n\tvar omsgBox = new jslet.ui.MessageBox();\r\n\tif (!caption) {\r\n\t\tcaption = jslet.locale.MessageBox.error;\r\n\t}\r\n\tvar owin = omsgBox.show(message, caption, 'error', ['ok'], callbackFn);\r\n\tif(timeout) {\r\n\t\ttimeout = parseInt(timeout);\r\n\t\tif(timeout !== NaN) {\r\n\t\t\twindow.setTimeout(function() {\r\n\t\t\t\towin.close()\r\n\t\t\t}, timeout);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * Show warning message. Example:\r\n * <pre><code>\r\n * jslet.ui.MessageBox.warn('Program will be shut down!', 'Warning');\r\n * </code></pre>\r\n */\r\njslet.ui.MessageBox.warn = function (message, caption, callbackFn) {\r\n\tvar omsgBox = new jslet.ui.MessageBox();\r\n\tif (!caption) {\r\n\t\tcaption = jslet.locale.MessageBox.warn;\r\n\t}\r\n\tomsgBox.show(message, caption, 'warning', ['ok'], callbackFn);\r\n};\r\n\r\n/**\r\n * Show confirm message. Example:\r\n * <pre><code>\r\n * var callbackFn = function(button, value){\r\n * alert('Button: ' + button + ' clicked!');\r\n * }\r\n * jslet.ui.MessageBox.warn('Are you sure?', 'Confirm', callbackFn);//show Ok/Cancel\r\n * jslet.ui.MessageBox.warn('Are you sure?', 'Confirm', callbackFn, true);//show Yes/No/Cancel\r\n * </code></pre>\r\n */\r\njslet.ui.MessageBox.confirm = function(message, caption, callbackFn, isYesNo){\r\n\tvar omsgBox = new jslet.ui.MessageBox();\r\n\tif (!caption) {\r\n\t\tcaption = jslet.locale.MessageBox.confirm;\r\n\t}\r\n\tif (!isYesNo) {\r\n\t\tomsgBox.show(message, caption, 'question',['ok', 'cancel'], callbackFn);\t\r\n\t} else {\r\n\t\tomsgBox.show(message, caption, 'question', ['yes', 'no', 'cancel'], callbackFn);\r\n\t}\r\n};\r\n\r\n/**\r\n * Prompt user to input some value. Example:\r\n * <pre><code>\r\n * var callbackFn = function(button, value){\r\n * alert('Button: ' + button + ' clicked!');\r\n * }\r\n * var validateFn = function(value){\r\n *  if (!value){\r\n *    alert('Please input some thing!');\r\n * return false;\r\n *  }\r\n *  return true;\r\n * }\r\n * jslet.ui.MessageBox.prompt('Input your name: ', 'Prompt', callbackFn, 'Bob', validateFn);\r\n * jslet.ui.MessageBox.warn('Input your comments: ', 'Prompt', callbackFn, null, validateFn, true);\r\n * </code></pre>\r\n */\r\njslet.ui.MessageBox.prompt = function (message, caption, callbackFn, defaultValue, validateFn, isMultiLine) {\r\n\tvar omsgBox = new jslet.ui.MessageBox();\r\n\tif (!caption) {\r\n\t\tcaption = jslet.locale.MessageBox.prompt;\r\n\t}\r\n\tif (!isMultiLine) {\r\n\t\tomsgBox.show(message, caption, null, ['ok', 'cancel'], callbackFn, 1, defaultValue, validateFn);\r\n\t} else {\r\n\t\tomsgBox.show(message, caption, null, ['ok', 'cancel'], callbackFn, 2, defaultValue, validateFn);\r\n\t}\r\n};\r\n\n/* ========================================================================\r\n * Jslet framework: jslet.listviewmodel.js\r\n *\r\n * Copyright (c) 2014 Jslet Group(https://github.com/jslet/jslet/)\r\n * Licensed under MIT (https://github.com/jslet/jslet/LICENSE.txt)\r\n * ======================================================================== */\r\n\r\n/**\r\n * Find dialog for DBTable and DBTreeView control\r\n */\r\njslet.ui.FindDialog = function (dbContainer) {\r\n\tvar _dialog;\r\n\tvar _dataset = dbContainer.dataset();\r\n\tvar _containerEl = dbContainer.el;\r\n\tvar _currfield = null;\r\n\tvar _findingField = null;\r\n\t\r\n\tfunction initialize() {\r\n\t\tvar opt = { type: 'window', caption: 'Find', isCenter: false, resizable: true, minimizable: false, maximizable: false, stopEventBubbling: true, height: 85, width: 320 };\r\n\t\t_dialog = jslet.ui.createControl(opt, _containerEl);\r\n\t\t_dialog.onClosed(function(){\r\n\t\t\treturn 'hidden';\r\n\t\t});\r\n\t\tvar content = '<div class=\"form-horizontal\"><div class=\"form-group form-group-sm jl-nogap\"><div class=\"col-sm-9 jl-nogap\"><input class=\"form-control jl-finddlg-value jl-nogap\"/></div>' + \r\n\t\t'<div class=\"col-sm-2 jl-nogap\"><select class=\"form-control jl-finddlg-opt jl-nogap\">' + \r\n\t\t'<option title=\"' + jslet.locale.findDialog.matchFirst + '\">=*</option>' + \r\n\t\t'<option>=</option>' + \r\n\t\t'<option title=\"' + jslet.locale.findDialog.matchLast + '\">*=</option>' + \r\n\t\t'<option title=\"' + jslet.locale.findDialog.matchAny + '\">*=*</option></select></div>' +\r\n\t\t'<div class=\"col-sm-1 btn-group btn-group-sm jl-nogap\"><button class=\"btn jl-finddlg-find fa fa-search\"></button></div></div>'\r\n\t\t\t\r\n\t\t_dialog.setContent(content);\r\n\t\tvar dlgEl = _dialog.el;\r\n\t\tvar jqOptions = jQuery(dlgEl).find('.jl-finddlg-opt');\r\n\r\n\t\tvar jqFindingValue = jQuery(dlgEl).find('.jl-finddlg-value');\r\n\t\tjqFindingValue.on('keydown', function(event){\r\n\t\t\tif(event.keyCode === 13) {\r\n\t\t\t\tfindData();\r\n\t       \t\tevent.stopImmediatePropagation();\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t});\r\n\t\t\r\n\t\tvar jqFind = jQuery(dlgEl).find('.jl-finddlg-find');\r\n\t\tjqFind.on('click', function(event) {\r\n\t\t\tfindData();\r\n\t\t});\r\n\r\n\t\tfunction findData() {\r\n\t\t\tvar matchType = jqOptions.val();\r\n\t\t\tif(matchType == '=*') {\r\n\t\t\t\tmatchType = 'first';\r\n\t\t\t} else if(matchType == '*=') {\r\n\t\t\t\tmatchType = 'last';\r\n\t\t\t} else if(matchType == '*=*') {\r\n\t\t\t\tmatchType = 'any';\r\n\t\t\t} else {\r\n\t\t\t\tmatchType = null;\r\n\t\t\t}\r\n\t\t\t_dataset.findByField(_findingField, jqFindingValue.val(), true, true, matchType);\r\n\t\t}\r\n\t}\r\n\t\r\n\tthis.show = function(left, top) {\r\n\t\tleft = left || 0;\r\n\t\ttop = top || 0;\r\n\t\t_dialog.show(left, top);\r\n\t};\r\n\t\r\n\tthis.hide = function() {\r\n\t\t_dialog.hide();\r\n\t};\r\n\t\r\n\tthis.findingField = function(findingField) {\r\n\t\tif(findingField === undefined) {\r\n\t\t\treturn _findingField;\r\n\t\t}\r\n\t\t_findingField = findingField;\r\n\t\tif(_findingField) {\r\n\t\t\tvar fldObj = _dataset.getField(_findingField);\r\n\t\t\tif(fldObj) {\r\n\t\t\t\t_dialog.changeCaption(jslet.formatString(jslet.locale.findDialog.caption, [fldObj.label()]));\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\t\r\n\tinitialize();\r\n\tthis.hide();\r\n};\r\n\r\n/**\r\n * Filter dialog for DBTable and DBTreeView control\r\n */\r\njslet.ui.FilterDialog = function (dataset, fields) {\r\n\t\r\n};\r\n\r\n\r\n\n/* ========================================================================\r\n * Jslet framework: jslet.dbchart.js\r\n *\r\n * Copyright (c) 2014 Jslet Group(https://github.com/jslet/jslet/)\r\n * Licensed under MIT (https://github.com/jslet/jslet/LICENSE.txt)\r\n * ======================================================================== */\r\n\r\n/**\r\n * @class DBChart, show data as a chart. There are five chart type: column, bar, line, area, pie  \r\n * Example:\r\n * <pre><code>\r\n *\t\tvar jsletParam = {type:\"dbchart\", dataset:\"summary\", chartType:\"column\",categoryField:\"month\",valueFields:\"amount\"};\r\n * \r\n * //1. Declaring:\r\n *\t\t&lt;div id=\"chartId\" data-jslet='type:\"dbchart\",chartType:\"column\",categoryField:\"month\",valueFields:\"amount,netProfit\", dataset:\"summary\"' />\r\n *\t\tor\r\n *\t\t&lt;div data-jslet='jsletParam' />\r\n *\r\n *  //2. Binding\r\n *\t\t&lt;div id=\"ctrlId\"  />\r\n *\t\t//Js snippet\r\n *\t\tvar el = document.getElementById('ctrlId');\r\n *\t\tjslet.ui.bindControl(el, jsletParam);\r\n *\r\n *  //3. Create dynamically\r\n *\t\tjslet.ui.createControl(jsletParam, document.body);\r\n *\r\n * </code></pre>\r\n */\r\njslet.ui.DBChart = jslet.Class.create(jslet.ui.DBControl, {\r\n\tchartTypes: ['line', 'bar', 'stackbar', 'pie'],\r\n\tlegendPositions: ['none', 'top', 'bottom', 'left', 'right'],\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.allProperties = 'dataset,chartType,chartTitle,categoryField,valueFields,legendPos';\r\n\t\tZ.requiredProperties = 'valueFields,categoryField';\r\n\t\t\r\n\t\t/**\r\n\t\t * {String} Chart type. Optional value is: column, bar, line, area, pie\r\n\t\t */\r\n\t\tZ._chartType = \"line\";\r\n\t\t/**\r\n\t\t * {String} Category field, use comma(,) to separate multiple fields.\r\n\t\t */\r\n\t\tZ._categoryFields = null;\r\n\t\t/**\r\n\t\t * {Number} Value field, only one field allowed.\r\n\t\t */\r\n\t\tZ._valueFields = null;\r\n\t\t/**\r\n\t\t * {String} Chart title\r\n\t\t */\r\n\t\tZ._chartTitle = null;\r\n\r\n\t\t/**\r\n\t\t * {String} Legend position, optional value: none, top, bottom, left, right\r\n\t\t */\r\n\t\tZ._legendPos = 'top';\r\n\t\t\r\n\t\tZ._fieldValidated = false;\r\n\t\t\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\tchartType: function(chartType) {\r\n\t\tif(chartType === undefined) {\r\n\t\t\treturn this._chartType;\r\n\t\t}\r\n\t\tchartType = jQuery.trim(chartType);\r\n\t\tvar checker = jslet.Checker.test('DBChart.chartType', chartType).isString().required();\r\n\t\tchecker.testValue(chartType.toLowerCase()).inArray(this.chartTypes);\r\n\t\tthis._chartType = chartType;\r\n\t},\r\n\t\r\n\tcategoryField: function(categoryField) {\r\n\t\tif(categoryField === undefined) {\r\n\t\t\treturn this._categoryField;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBChart.categoryField', categoryField).isString().required();\r\n\t\tcategoryField = jQuery.trim(categoryField);\r\n\t\tthis._categoryField = categoryField;\r\n\t\tthis._fieldValidated = false;\r\n\t},\r\n\t\r\n\tvalueFields: function(valueFields) {\r\n\t\tif(valueFields === undefined) {\r\n\t\t\treturn this._valueFields;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBChart.valueFields', valueFields).isString().required();\r\n\t\tvalueFields = jQuery.trim(valueFields);\r\n\t\tthis._valueFields = valueFields.split(',');\r\n\t\tthis._fieldValidated = false;\r\n\t},\r\n\t\r\n\tchartTitle: function(chartTitle) {\r\n\t\tif(chartTitle === undefined) {\r\n\t\t\treturn this._chartTitle;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBChart.chartTitle', chartTitle).isString();\r\n\t\tthis._chartTitle = chartTitle;\r\n\t},\r\n\t\r\n\tlegendPos: function(legendPos) {\r\n\t\tif(legendPos === undefined) {\r\n\t\t\treturn this._legendPos;\r\n\t\t}\r\n\t\tlegendPos = jQuery.trim(legendPos);\r\n\t\tvar checker = jslet.Checker.test('DBChart.legendPos', legendPos).isString().required();\r\n\t\tchecker.testValue(legendPos.toLowerCase()).inArray(this.legendPositions);\r\n\t\tthis._legendPos = legendPos;\r\n\t},\r\n\t\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\treturn el.tagName.toLowerCase() == 'div';\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tif(!this.el.id) {\r\n\t\t\tthis.el.id = jslet.nextId();\r\n\t\t}\r\n\t\tthis.renderAll();\r\n\t}, // end bind\r\n\r\n\t_validateFields: function() {\r\n\t\tvar Z = this;\r\n\t\tif(Z._fieldValidated) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar dsObj = Z._dataset,\r\n\t\t\tfldName = Z._categoryField;\r\n\t\tif (!dsObj.getField(fldName)) {\r\n\t\t\tthrow new Error(jslet.formatString(jslet.locale.Dataset.fieldNotFound, [fldName]));\r\n\t\t}\r\n\t\t\r\n\t\tfor(var i = 0, len = Z._valueFields.length; i < len; i++) {\r\n\t\t\tfldName = Z._valueFields[i];\r\n\t\t\tif(!dsObj.getField(fldName)) {\r\n\t\t\t\tthrow new Error(jslet.formatString(jslet.locale.Dataset.fieldNotFound, [fldName]));\r\n\t\t\t}\r\n\t\t}\r\n\t\tZ._fieldValidated = true;\r\n\t},\r\n\t\r\n\t_getLineData: function() {\r\n\t\tvar Z = this,\r\n\t\t\tdsObj = Z._dataset;\r\n\t\tif (dsObj.recordCount() === 0) {\r\n\t\t\treturn {xLabels: [], yValues: []};\r\n\t\t}\r\n\t\tvar oldRecno = dsObj.recnoSilence(),\r\n\t\t\txLabels = [],\r\n\t\t\tyValues = [];\r\n\r\n\t\ttry {\r\n\t\t\tvar isInit = false, valueFldName,\r\n\t\t\t\tvalueFldCnt = Z._valueFields.length,\r\n\t\t\t\tvalueArr,\r\n\t\t\t\tlegendLabels = [];\r\n\t\t\tfor(var k = 0, recCnt = dsObj.recordCount(); k < recCnt; k++) {\r\n\t\t\t\tdsObj.recnoSilence(k);\r\n\t\t\t\txLabels.push(dsObj.getFieldText(Z._categoryField));\r\n\t\t\t\tfor(var i = 0; i < valueFldCnt; i++) {\r\n\t\t\t\t\tvalueFldName = Z._valueFields[i];\r\n\t\t\t\t\tif(!isInit) {\r\n\t\t\t\t\t\tvalueArr = [];\r\n\t\t\t\t\t\tyValues.push(valueArr);\r\n\t\t\t\t\t\tlegendLabels.push(dsObj.getField(valueFldName).label());\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tvalueArr = yValues[i];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvalueArr.push(dsObj.getFieldValue(valueFldName));\r\n\t\t\t\t}\r\n\t\t\t\tisInit = true;\r\n\t\t\t} //End for k\r\n\t\t} finally {\r\n\t\t\tdsObj.recnoSilence(oldRecno);\r\n\t\t}\r\n\t\treturn {xLabels: xLabels, yValues: yValues, legendLabels: legendLabels};\r\n\t},\r\n\r\n\t_getPieData: function() {\r\n\t\tvar Z = this,\r\n\t\t\tdsObj = Z._dataset;\r\n\t\tif (dsObj.recordCount() === 0) {\r\n\t\t\treturn [];\r\n\t\t}\r\n\t\tvar oldRecno = dsObj.recnoSilence(),\r\n\t\t\tresult = [];\r\n\t\t\t\r\n\t\ttry {\r\n\t\t\tvar valueFldName = Z._valueFields[0],\r\n\t\t\t\tlabel, value;\r\n\t\t\tfor(var k = 0, recCnt = dsObj.recordCount(); k < recCnt; k++) {\r\n\t\t\t\tdsObj.recnoSilence(k);\r\n\t\t\t\tlabel = dsObj.getFieldText(Z._categoryField);\r\n\t\t\t\tvalue = dsObj.getFieldValue(valueFldName);\r\n\t\t\t\tresult.push([label, value]);\r\n\t\t\t}\r\n\t\t} finally {\r\n\t\t\tdsObj.recnoSilence(oldRecno);\r\n\t\t}\r\n\t\treturn result;\r\n\t},\r\n\r\n\t_drawLineChart: function() {\r\n\t\tvar Z = this;\r\n\t\tvar chartData = Z._getLineData();\r\n\t\t\r\n\t\tjQuery.jqplot(Z.el.id, chartData.yValues, \r\n\t\t{ \r\n\t\t\ttitle: Z._chartTitle, \r\n            animate: !jQuery.jqplot.use_excanvas,\r\n\t\t\t// Set default options on all series, turn on smoothing.\r\n\t\t\tseriesDefaults: {\r\n\t\t\t\trendererOptions: {smooth: true},\r\n\t\t\t\tpointLabels: {show: true, formatString: '%d'}\t\t\t\t\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\tlegend:{ show:true,\r\n\t\t\t\tlabels: chartData.legendLabels\r\n\t\t\t},\r\n\t\t\t\r\n            axes: {\r\n\t\t\t\txaxis: {\r\n\t\t\t\t\trenderer: $.jqplot.CategoryAxisRenderer,\r\n\t\t\t\t\tticks: chartData.xLabels\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\t\t\r\n\t_drawPieChart: function() {\r\n\t\tvar Z = this;\r\n\t\tvar chartData = Z._getPieData();\r\n\t\t\r\n\t\tjQuery.jqplot(Z.el.id, [chartData], {\r\n\t\t\ttitle: Z._chartTitle, \r\n            animate: !jQuery.jqplot.use_excanvas,\r\n\t\t\tseriesDefaults:{\r\n\t\t\t\trenderer: $.jqplot.PieRenderer ,\r\n\t\t\t\tpointLabels: {show: true, formatString: '%d'}\t\t\t\t\r\n\t\t\t},\r\n\t\t\tlegend:{ show:true }\r\n\t\t});\r\n\t},\r\n\t\r\n\t_drawBarChart: function(isStack) {\r\n\t\tvar Z = this;\r\n\t\tvar chartData = Z._getLineData();\r\n\r\n        jQuery.jqplot(Z.el.id, chartData.yValues, {\r\n\t\t\ttitle: Z._chartTitle,\r\n\t\t\tstackSeries: isStack,\r\n            // Only animate if we're not using excanvas (not in IE 7 or IE 8)..\r\n            animate: !jQuery.jqplot.use_excanvas,\r\n            seriesDefaults:{\r\n                renderer:$.jqplot.BarRenderer,\r\n\t\t\t\tpointLabels: {show: true, formatString: '%d'}\t\t\t\t\r\n            },\r\n\r\n\t\t\tlegend:{ show:true,\r\n\t\t\t\tlabels: chartData.legendLabels\r\n\t\t\t},\r\n\t\t\t\r\n            axes: {\r\n                xaxis: {\r\n                    renderer: $.jqplot.CategoryAxisRenderer,\r\n                    ticks: chartData.xLabels\r\n                }\r\n            },\r\n            highlighter: { show: false }\r\n        });\t\r\n\t},\r\n\t\r\n\tdrawChart: function () {\r\n\t\tvar Z = this,\r\n\t\t\tdsObj = Z._dataset;\r\n\t\t\t\r\n\t\tZ.el.innerHTML = '';\r\n\t\tZ._validateFields();\r\n\t\tif(Z._chartType == 'pie') {\r\n\t\t\tZ._drawPieChart();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(Z._chartType == 'line') {\r\n\t\t\tZ._drawLineChart();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(Z._chartType == 'bar') {\r\n\t\t\tZ._drawBarChart(false);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(Z._chartType == 'stackbar') {\r\n\t\t\tZ._drawBarChart(true);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\t\r\n\t}, // end draw chart\r\n\r\n\trefreshControl: function (evt) {\r\n\t\tvar evtType = evt.eventType;\r\n\t\tif (evtType == jslet.data.RefreshEvent.UPDATEALL || \r\n\t\t\tevtType == jslet.data.RefreshEvent.UPDATERECORD ||\r\n\t\t\tevtType == jslet.data.RefreshEvent.UPDATECOLUMN || \r\n\t\t\tevtType == jslet.data.RefreshEvent.INSERT || \r\n\t\t\tevtType == jslet.data.RefreshEvent.DELETE) {\r\n\t\t\tthis.drawChart()\r\n\t\t}\r\n\t},\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tthis.refreshControl(jslet.data.RefreshEvent.updateAllEvent(), true);\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\tthis.swf = null;\r\n\t\t$super();\r\n\t}\r\n});\r\n\r\njslet.ui.register('DBChart', jslet.ui.DBChart);\r\njslet.ui.DBChart.htmlTemplate = '<div></div>';\r\n\n/* ========================================================================\r\n * Jslet framework: jslet.dbeditpanel.js\r\n *\r\n * Copyright (c) 2014 Jslet Group(https://github.com/jslet/jslet/)\r\n * Licensed under MIT (https://github.com/jslet/jslet/LICENSE.txt)\r\n * ======================================================================== */\r\n\r\n/**\r\n* DBEditPanel\r\n*/\r\njslet.ui.DBEditPanel = jslet.Class.create(jslet.ui.DBControl, {\r\n\t_totalColumns: 12, //Bootstrap column count \r\n\t/**\r\n\t * @override\r\n\t*/\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.allProperties = 'dataset,columnCount,labelCols,onlySpecifiedFields,fields';\r\n\t\t\r\n\t\t/**\r\n\t\t * {Integer} Column count\r\n\t\t */\r\n\t\tZ._columnCount = 3;\r\n\t\t/**\r\n\t\t * {Integer} The gap between label and editor\r\n\t\t */\r\n\t\tZ._labelCols = 1;\r\n\r\n\t\t/**\r\n\t\t * {Boolean} True - only show specified fields, false otherwise.\r\n\t\t */\r\n\t\tZ._onlySpecifiedFields = false;\r\n\t\t/**\r\n\t\t * Array of edit field configuration, prototype: [{field: \"field1\", colSpan: 2, rowSpan: 1}, ...]\r\n\t\t */\r\n\t\tZ._fields;\r\n\t\t\r\n\t\tZ._metaChangedDebounce = jslet.debounce(Z.renderAll, 10);\r\n\r\n\t\t$super(el, params);\r\n\t},\r\n\t\r\n\tcolumnCount: function(columnCount) {\r\n\t\tif(columnCount === undefined) {\r\n\t\t\treturn this._columnCount;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBEditPanel.columnCount', columnCount).isGTZero();\r\n\t\tthis._columnCount = parseInt(columnCount);\r\n\t},\r\n\t\r\n\tlabelCols: function(labelCols) {\r\n\t\tif(labelCols === undefined) {\r\n\t\t\treturn this._labelCols;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBEditPanel.labelCols', labelCols).isNumber().between(1,3);\r\n\t\tthis._labelCols = parseInt(labelCols);\r\n\t},\r\n\t\r\n\tonlySpecifiedFields: function(onlySpecifiedFields) {\r\n\t\tif(onlySpecifiedFields === undefined) {\r\n\t\t\treturn this._onlySpecifiedFields;\r\n\t\t}\r\n\t\tthis._onlySpecifiedFields = onlySpecifiedFields ? true: false;\r\n\t},\r\n\t\r\n\tfields: function(fields) {\r\n\t\tif(fields === undefined) {\r\n\t\t\treturn this._fields;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBEditPanel.fields', fields).isArray();\r\n\t\tvar fldCfg;\r\n\t\tfor(var i = 0, len = fields.length; i < len; i++) {\r\n\t\t\tfldCfg = fields[i];\r\n\t\t\tjslet.Checker.test('DBEditPanel.fields.field', fldCfg.field).isString().required();\r\n\t\t\tjslet.Checker.test('DBEditPanel.fields.labelCols', fldCfg.colSpan).isNumber().between(1,3);\r\n\t\t\tjslet.Checker.test('DBEditPanel.fields.dataCols', fldCfg.colSpan).isNumber().between(1,11);\r\n\t\t\tfldCfg.inFirstCol = fldCfg.inFirstCol ? true: false;\r\n\t\t\tfldCfg.showLine = fldCfg.showLine ? true: false;\r\n\t\t\tfldCfg.visible = (fldCfg.visible === undefined || fldCfg.visible) ? true: false;\r\n\t\t}\r\n\t\tthis._fields = fields;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t*/\r\n\tisValidTemplateTag: function (el) {\r\n\t\treturn el.tagName.toLowerCase() == 'div';\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tthis.renderAll();\r\n\t},\r\n\t\r\n\t_calcLayout: function () {\r\n\t\tvar Z = this,\r\n\t\t\tallFlds = Z._dataset.getNormalFields(), \r\n\t\t\tfldLayouts, fldObj;\r\n\t\t\r\n\t\tif (!Z._onlySpecifiedFields) {\r\n\t\t\tfldLayouts = [];\r\n\t\t\tvar fldName, found, editFld, maxFld, visible,\r\n\t\t\t\tlayoutcnt = Z._fields ? Z._fields.length : 0;\r\n\t\t\tfor (var i = 0, fcnt = allFlds.length; i < fcnt; i++) {\r\n\t\t\t\tfldObj = allFlds[i];\r\n\t\t\t\tfldName = fldObj.name();\r\n\t\t\t\tvisible = fldObj.visible();\r\n\t\t\t\tfound = false;\r\n\t\t\t\tfor (var j = 0; j < layoutcnt; j++) {\r\n\t\t\t\t\teditFld = Z._fields[j];\r\n\t\t\t\t\tif (fldName == editFld.field) {\r\n\t\t\t\t\t\tfound = true;\r\n\t\t\t\t\t\tif(editFld.visible === undefined || editFld.visible) {\r\n\t\t\t\t\t\t\tfldLayouts.push(editFld);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif (!found) {\r\n\t\t\t\t\tif(!visible) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfldLayouts.push({\r\n\t\t\t\t\t\tfield: fldObj.name()\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t} //end for i\r\n\t\t} else {\r\n\t\t\tfldLayouts = Z._fields;\r\n\t\t}\r\n\r\n\t\tvar dftDataCols = Math.floor((Z._totalColumns - Z._labelCols * Z._columnCount) / Z._columnCount);\r\n\t\tif(dftDataCols <= 0) {\r\n\t\t\tdftDataCols = 1;\r\n\t\t}\r\n\r\n\t\t//calc row, col\r\n\t\tvar layout, r = 0, c = 0, colsInRow = 0, itemCnt;\r\n\t\tfor (var i = 0, cnt = fldLayouts.length; i < cnt; i++) {\r\n\t\t\tlayout = fldLayouts[i];\r\n\t\t\tif(!layout.labelCols) {\r\n\t\t\t\tlayout._innerLabelCols = Z._labelCols;\r\n\t\t\t}\r\n\t\t\tif(!layout.dataCols) {\r\n\t\t\t\tlayout._innerDataCols = dftDataCols\r\n\t\t\t} else {\r\n\t\t\t\tlayout._innerDataCols = layout.dataCols;\t\r\n\t\t\t}\r\n\t\t\titemCnt = layout._innerLabelCols + layout._innerDataCols;\r\n\t\t\tif (layout.inFirstCol || layout.showLine || colsInRow + itemCnt > Z._totalColumns) {\r\n\t\t\t\tr++;\r\n\t\t\t\tcolsInRow = 0;\r\n\t\t\t}\r\n\t\t\tlayout.row = r;\r\n\t\t\tcolsInRow += itemCnt;\r\n\t\t}\r\n\t\treturn fldLayouts;\r\n\t},\r\n\t\r\n\tgetEditField: function (fieldName) {\r\n\t\tvar Z = this;\r\n\t\tif (!Z._fields) {\r\n\t\t\tZ._fields = [];\r\n\t\t}\r\n\t\tvar editFld;\r\n\t\tfor (var i = 0, cnt = Z._fields.length; i < cnt; i++) {\r\n\t\t\teditFld = Z._fields[i];\r\n\t\t\tif (editFld.field == fieldName) {\r\n\t\t\t\treturn editFld;\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar fldObj = Z._dataset.getField(fieldName);\r\n\t\tif (!fldObj) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\teditFld = {\r\n\t\t\tfield: fieldName\r\n\t\t};\r\n\t\tZ._fields.push(editFld);\r\n\t\treturn editFld;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tvar Z = this;\r\n\t\tZ.removeAllChildControls();\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tif (!jqEl.hasClass('jl-editpanel')) {\r\n\t\t\tjqEl.addClass('jl-editpanel form-horizontal');\r\n\t\t}\r\n\t\tjqEl.html('');\r\n\t\tvar allFlds = Z._dataset.getNormalFields(),\r\n\t\t\tfcnt = allFlds.length;\r\n\t\tvar layouts = Z._calcLayout();\r\n\t\t//calc max label width\r\n\t\t\t\r\n\t\tvar r = -1, oLabel, editorCfg, fldName, fldObj, ohr, octrlDiv, opanel, ctrlId, dbCtrl;\r\n\t\tfor (var i = 0, cnt = layouts.length; i < cnt; i++) {\r\n\t\t\tlayout = layouts[i];\r\n\t\t\tif (layout.showLine) {\r\n\t\t\t\tohr = document.createElement('hr');\r\n\t\t\t\tZ.el.appendChild(ohr);\r\n\t\t\t}\r\n\t\t\tif (layout.row != r) {\r\n\t\t\t\topanel = document.createElement('div');\r\n\t\t\t\topanel.className = 'form-group form-group-sm';\r\n\t\t\t\tZ.el.appendChild(opanel);\r\n\t\t\t\tr = layout.row;\r\n\r\n\t\t\t}\r\n\t\t\tfldName = layout.field;\r\n\t\t\tfldObj = Z._dataset.getField(fldName);\r\n\t\t\tif (!fldObj) {\r\n\t\t\t\tthrow new Error(jslet.formatString(jslet.locale.Dataset.fieldNotFound, [fldName]));\r\n\t\t\t}\r\n\t\t\teditorCfg = fldObj.editControl();\r\n\t\t\tvar isCheckBox = editorCfg.type.toLowerCase() == 'dbcheckbox';\r\n\t\t\tif(isCheckBox) {\r\n\t\t\t\toLabel = document.createElement('div');\r\n\t\t\t\topanel.appendChild(oLabel);\r\n\t\t\t\toLabel.className = 'col-sm-' + layout._innerLabelCols;\r\n\r\n\t\t\t\toctrlDiv = document.createElement('div');\r\n\t\t\t\topanel.appendChild(octrlDiv);\r\n\t\t\t\toctrlDiv.className = 'col-sm-' + layout._innerDataCols;\r\n\t\t\t\t\r\n\t\t\t\teditorCfg.dataset = Z._dataset;\r\n\t\t\t\teditorCfg.field = fldName;\r\n\t\t\t\teditor = jslet.ui.createControl(editorCfg, null);\r\n\t\t\t\toctrlDiv.appendChild(editor.el);\r\n\t\t\t\tZ.addChildControl(editor);\r\n\t\t\t\t\r\n\t\t\t\toLabel = document.createElement('label');\r\n\t\t\t\toctrlDiv.appendChild(oLabel);\r\n\t\t\t\tdbCtrl = new jslet.ui.DBLabel(oLabel, {\r\n\t\t\t\t\ttype: 'DBLabel',\r\n\t\t\t\t\tdataset: Z._dataset,\r\n\t\t\t\t\tfield: fldName\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\t\tctrlId = jslet.nextId();\r\n\t\t\t\teditor.el.id = ctrlId;\r\n\t\t\t\tjQuery(oLabel).attr('for', ctrlId);\r\n\t\t\t\tZ.addChildControl(dbCtrl);\r\n\t\t\t} else {\r\n\t\t\t\toLabel = document.createElement('label');\r\n\t\t\t\topanel.appendChild(oLabel);\r\n\t\t\t\toLabel.className = 'col-sm-' + layout._innerLabelCols;\r\n\t\t\t\tdbctrl = new jslet.ui.DBLabel(oLabel, {\r\n\t\t\t\t\ttype: 'DBLabel',\r\n\t\t\t\t\tdataset: Z._dataset,\r\n\t\t\t\t\tfield: fldName\r\n\t\t\t\t});\r\n\t\t\t\tZ.addChildControl(dbCtrl);\r\n\t\t\t\t\r\n\t\t\t\toctrlDiv = document.createElement('div');\r\n\t\t\t\topanel.appendChild(octrlDiv);\r\n\t\t\t\toctrlDiv.className = 'col-sm-' + layout._innerDataCols;\r\n\t\t\t\t\r\n\t\t\t\tif (fldObj.valueStyle() == jslet.data.FieldValueStyle.BETWEEN) {\r\n\t\t\t\t\teditorCfg = {\r\n\t\t\t\t\t\ttype: 'DBBetweenEdit'\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\teditorCfg.dataset = Z._dataset;\r\n\t\t\t\teditorCfg.field = fldName;\r\n\t\t\t\teditor = jslet.ui.createControl(editorCfg, null);\r\n\t\t\t\toctrlDiv.appendChild(editor.el);\r\n\t\t\t\tctrlId = jslet.nextId();\r\n\t\t\t\teditor.el.id = ctrlId;\r\n\t\t\t\tjQuery(oLabel).attr('for', ctrlId);\r\n\t\t\t\tZ.addChildControl(editor);\r\n\t\t\t}\r\n\t\t}\r\n\t}, // render All\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdoMetaChanged: function($super, metaName){\r\n\t\tif(metaName && (metaName == 'visible' || metaName == 'editControl')) {\r\n\t\t\tthis._metaChangedDebounce.call(this);\r\n\t\t}\r\n\t}\r\n});\r\n\r\njslet.ui.register('DBEditPanel', jslet.ui.DBEditPanel);\r\njslet.ui.DBEditPanel.htmlTemplate = '<div></div>';\r\n\n/* ========================================================================\r\n * Jslet framework: jslet.dbinspector.js\r\n *\r\n * Copyright (c) 2014 Jslet Group(https://github.com/jslet/jslet/)\r\n * Licensed under MIT (https://github.com/jslet/jslet/LICENSE.txt)\r\n * ======================================================================== */\r\n\r\n/**\r\n * @class DBInspector. \r\n * Display&Edit fields in two columns: Label column and Value column. If in edit mode, this control takes the field editor configuration from dataset field object.\r\n * Example:\r\n * <pre><code>\r\n *  var jsletParam = {type:\"DBInspector\",dataset:\"employee\",columnCount:1,columnWidth:100};\r\n * \r\n * //1. Declaring:\r\n *  &lt;div id='ctrlId' data-jslet='type:\"DBInspector\",dataset:\"employee\",columnCount:1,columnWidth:100' />\r\n *  or\r\n *  &lt;div data-jslet='jsletParam' />\r\n * \r\n *  //2. Binding\r\n *  &lt;div id=\"ctrlId\"  />\r\n *  //Js snippet\r\n *  var el = document.getElementById('ctrlId');\r\n *  jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *  //3. Create dynamically\r\n *  jslet.ui.createControl(jsletParam, document.body);\r\n *  \r\n * </code></pre>\r\n */\r\njslet.ui.DBInspector = jslet.Class.create(jslet.ui.DBControl, {\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.allProperties = 'dataset,columnCount,rowHeight,fields';\r\n\t\t\r\n\t\t/**\r\n\t\t * {Integer} Column count\r\n\t\t */\r\n\t\tZ._columnCount = 1;\r\n\t\t/**\r\n\t\t * {Integer} Row height\r\n\t\t */\r\n\t\tZ._rowHeight = 30;\r\n\t\t\r\n\t\tZ._fields = null;\r\n\t\t\r\n\t\tZ._metaChangedDebounce = jslet.debounce(Z.renderAll, 10);\r\n\r\n\t\t$super(el, params);\r\n\t},\r\n\t\r\n\tcolumnCount: function(columnCount) {\r\n\t\tif(columnCount === undefined) {\r\n\t\t\treturn this._columnCount;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBInspector.columnCount', columnCount).isGTZero();\r\n\t\tthis._columnCount = parseInt(columnCount);\r\n\t},\r\n\t\r\n\trowHeight: function(rowHeight) {\r\n\t\tif(rowHeight === undefined) {\r\n\t\t\treturn this._rowHeight;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBInspector.rowHeight', rowHeight).isGTZero();\r\n\t\tthis._rowHeight = parseInt(rowHeight);\r\n\t},\r\n\t\r\n\tfields: function(fields) {\r\n\t\tif(fields === undefined) {\r\n\t\t\treturn this._fields;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBInspector.fields', fields).isArray();\r\n\t\tvar fldCfg;\r\n\t\tfor(var i = 0, len = fields.length; i < len; i++) {\r\n\t\t\tfldCfg = fields[i];\r\n\t\t\tjslet.Checker.test('DBInspector.fields.field', fldCfg.field).isString().required();\r\n\t\t\tfldCfg.visible = fldCfg.visible ? true: false;\r\n\t\t}\r\n\t\tthis._fields = fields;\r\n\t},\r\n\t\r\n\t/**\r\n\t* @override\r\n\t*/\r\n\tisValidTemplateTag: function (el) {\r\n\t\treturn el.tagName.toLowerCase() == 'div';\r\n\t},\r\n\t\r\n\t\t/**\r\n\t\t * @override\r\n\t\t */\r\n\tbind: function () {\r\n\t\tvar Z = this;\r\n\t\tvar colCnt = Z._columnCount;\r\n\t\tif (colCnt) {\r\n\t\t\tcolCnt = parseInt(colCnt);\r\n\t\t}\r\n\t\tif (colCnt && colCnt > 0) {\r\n\t\t\tZ._columnCount = colCnt;\r\n\t\t} else {\r\n\t\t\tZ._columnCount = 1;\r\n\t\t}\r\n\t\tZ.renderAll();\r\n\t}, // end bind\r\n\t\r\n\t\t/**\r\n\t\t * @override\r\n\t\t */\r\n\trenderAll: function () {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el);\r\n\t\tZ.removeAllChildControls();\r\n\t\t\r\n\t\tif (!jqEl.hasClass('jl-inspector'))\r\n\t\t\tjqEl.addClass('jl-inspector jl-round5');\r\n\t\tvar totalWidth = jqEl.width(),\r\n\t\t\tallFlds = Z._dataset.getFields();\r\n\t\tjqEl.html('<table cellpadding=0 cellspacing=0 style=\"margin:0;padding:0;table-layout:fixed;width:100%;height:100%\"><tbody></tbody></table>');\r\n\t\tvar oCol, fldObj, i, found, visible, fldName, cfgFld,\r\n\t\t\tfcnt = allFlds.length,\r\n\t\t\tvisibleFlds = [];\r\n\t\tfor (i = 0; i < fcnt; i++) {\r\n\t\t\tfldObj = allFlds[i];\r\n\t\t\tfldName = fldObj.name();\r\n\t\t\tfound = false;\r\n\t\t\tif(Z._fields) {\r\n\t\t\t\tfor(var j = 0, len = Z._fields.length; j < len; j++) {\r\n\t\t\t\t\tcfgFld = Z._fields[j];\r\n\t\t\t\t\tif(fldName == cfgFld.field) {\r\n\t\t\t\t\t\tfound = true;\r\n\t\t\t\t\t\tvisible = cfgFld.visible? true: false;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t} \r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(!found) {\r\n\t\t\t\tvisible = fldObj.visible();\r\n\t\t\t}\r\n\t\t\tif (visible) {\r\n\t\t\t\tvisibleFlds.push(fldObj);\r\n\t\t\t}\r\n\t\t}\r\n\t\tfcnt = visibleFlds.length;\r\n\t\tif (fcnt === 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar w, c, columnCnt = Math.min(fcnt, Z._columnCount), arrLabelWidth = [];\r\n\t\tfor (i = 0; i < columnCnt; i++) {\r\n\t\t\tarrLabelWidth[i] = 0;\r\n\t\t}\r\n\t\tvar startWidth = jslet.ui.textMeasurer.getWidth('*');\r\n\t\tjslet.ui.textMeasurer.setElement(Z.el);\r\n\t\tfor (i = 0; i < fcnt; i++) {\r\n\t\t\tfldObj = visibleFlds[i];\r\n\t\t\tc = i % columnCnt;\r\n\t\t\tw = Math.round(jslet.ui.textMeasurer.getWidth(fldObj.label()) + startWidth) + 5;\r\n\t\t\tif (arrLabelWidth[c] < w) {\r\n\t\t\t\tarrLabelWidth[c] = w;\r\n\t\t\t}\r\n\t\t}\r\n\t\tjslet.ui.textMeasurer.setElement();\r\n\t\t\r\n\t\tvar totalLabelWidth = 0;\r\n\t\tfor (i = 0; i < columnCnt; i++) {\r\n\t\t\ttotalLabelWidth += arrLabelWidth[i];\r\n\t\t}\r\n\t\t\r\n\t\tvar editorWidth = Math.round((totalWidth - totalLabelWidth) / columnCnt);\r\n\t\t\r\n\t\tvar otable = Z.el.firstChild,\r\n\t\t\ttHead = otable.createTHead(), otd, otr = tHead.insertRow(-1);\r\n\t\totr.style.height = '0';\r\n\t\tfor (i = 0; i < columnCnt; i++) {\r\n\t\t\totd = otr.insertCell(-1);\r\n\t\t\totd.style.width = arrLabelWidth[i] + 'px';\r\n\t\t\totd.style.height = '0';\r\n\t\t\totd = otr.insertCell(-1);\r\n\t\t\totd.style.height = '0';\r\n\t\t}\r\n\t\t\r\n\t\tvar oldRowNo = -1, oldC = -1, rowNo, odiv, oLabel, fldName, editor, fldCtrl, dbCtrl;\r\n\t\tZ.preRowIndex = -1;\r\n\t\tfor (i = 0; i < fcnt; i++) {\r\n\t\t\tfldObj = visibleFlds[i];\r\n\t\t\tfldName = fldObj.name();\r\n\t\t\trowNo = Math.floor(i / columnCnt);\r\n\t\t\tc = i % columnCnt;\r\n\t\t\tif (oldRowNo != rowNo) {\r\n\t\t\t\totr = otable.insertRow(-1);\r\n\t\t\t\tif (Z._rowHeight) {\r\n\t\t\t\t\totr.style.height = Z._rowHeight + 'px';\r\n\t\t\t\t}\r\n\t\t\t\toldRowNo = rowNo;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\totd = otr.insertCell(-1);\r\n\t\t\totd.noWrap = true;\r\n\t\t\totd.className = jslet.ui.htmlclass.DBINSPECTOR.labelColCls;\r\n\t\t\t\r\n\t\t\toLabel = document.createElement('label');\r\n\t\t\totd.appendChild(oLabel);\r\n\t\t\tdbCtrl = new jslet.ui.DBLabel(oLabel, {\r\n\t\t\t\ttype: 'DBLabel',\r\n\t\t\t\tdataset: Z._dataset,\r\n\t\t\t\tfield: fldName\r\n\t\t\t});\r\n\t\t\tZ.addChildControl(dbCtrl);\r\n\t\t\t\r\n\t\t\totd = otr.insertCell(-1);\r\n\t\t\totd.className = jslet.ui.htmlclass.DBINSPECTOR.editorColCls;\r\n\t\t\totd.noWrap = true;\r\n\t\t\totd.align = 'left';\r\n\t\t\todiv = document.createElement('div');\r\n\t\t\todiv.noWrap = true;\r\n\t\t\totd.appendChild(odiv);\r\n\t\t\tfldCtrl = fldObj.editControl();\r\n\t\t\tfldCtrl.dataset = Z._dataset;\r\n\t\t\tfldCtrl.field = fldName;\r\n\t\t\t\r\n\t\t\teditor = jslet.ui.createControl(fldCtrl, odiv);\r\n\t\t\tif (!editor.isCheckBox) {\r\n\t\t\t\teditor.el.style.width = '100%';//editorWidth - 10 + 'px';\r\n\t\t\t}\r\n\t\t\tZ.addChildControl(editor);\r\n\t\t} // end for\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdoMetaChanged: function($super, metaName){\r\n\t\tif(metaName && (metaName == 'visible' || metaName == 'editControl')) {\r\n\t\t\tthis._metaChangedDebounce.call(this);\r\n\t\t}\r\n\t}\r\n});\r\n\r\njslet.ui.htmlclass.DBINSPECTOR = {\r\n\tlabelColCls: 'jl-inspector-label',\r\n\teditorColCls: 'jl-inspector-editor'\r\n};\r\n\r\njslet.ui.register('DBInspector', jslet.ui.DBInspector);\r\njslet.ui.DBInspector.htmlTemplate = '<div></div>';\r\n\n/* ========================================================================\r\n * Jslet framework: jslet.dbtable.js\r\n *\r\n * Copyright (c) 2014 Jslet Group(https://github.com/jslet/jslet/)\r\n * Licensed under MIT (https://github.com/jslet/jslet/LICENSE.txt)\r\n * ======================================================================== */\r\n\r\njslet.ui.htmlclass.TABLECLASS = {\r\n\tcurrentrow: 'jl-tbl-current',\r\n\tscrollBarWidth: 16,\r\n\tselectColWidth: 30,\r\n\thoverrow: 'jl-tbl-row-hover',\r\n\t\r\n\tsortAscChar: '&#8593;',\r\n\tsortDescChar: '&#8595;'\r\n};\r\n\r\n/**\r\n * Table column\r\n */\r\njslet.ui.TableColumn = function () {\r\n\tvar Z = this;\r\n\tZ.field = null;   //String, field name\r\n\tZ.colNum = null;  //Integer, column number\r\n\tZ.label = null;   //String, column header label\r\n\tZ.title = null;   //String, column header title\r\n\tZ.displayOrder = null; //Integer, display order\r\n\tZ.width = null;   //Integer, column display width\r\n\tZ.colSpan = null; //Integer, column span\r\n\tZ.disableHeadSort = false; //Boolean, true - user sort this column by click column header\r\n\tZ.mergeSame = false; //Boolean, true - if this column value of adjoined rows is same then merge these rows \r\n\tZ.noRefresh = false; //Boolean, true - do not refresh for customized column\r\n\tZ.visible = true; //Boolean, identify specified column is visible or not \r\n\tZ.cellRender = null; //Function, column cell render for customized column  \r\n};\r\n\r\n/**\r\n * Sub group, use this class to implement complex requirement in one table row, like master-detail style row\r\n */\r\njslet.ui.TableSubgroup = function(){\r\nvar Z = this;\r\n\tZ.hasExpander = true; //Boolean, true - will add a new column automatically, click this column will expand or collapse subgroup panel\r\n\tZ.template = null;//String, html template \r\n\tZ.height = 0; //Integer, subgroup panel height\r\n};\r\n\r\n/**\r\n * Table column header, use this class to implement hierarchical header\r\n */\r\njslet.ui.TableHead = function(){\r\n\tvar Z = this;\r\n\tZ.label = null; //String, Head label\r\n\tZ.title = null; //String, Head title\r\n\tZ.id = null;//String, Head id\r\n\tZ.rowSpan = 0;  //@private\r\n\tZ.colSpan = 0;  //@private\r\n\tZ.disableHeadSort = false; //Boolean, true - user sort this column by click column header\r\n\tZ.subHeads = null; //array of jslet.ui.TableHead\r\n};\r\n\r\njslet.ui.AbstractDBTable = jslet.Class.create(jslet.ui.DBControl, {\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\t\r\n\t\tZ.allProperties = 'dataset,fixedRows,fixedCols,hasSeqCol,hasSelectCol,reverseSeqCol,seqColHeader,noborder,readOnly,hideHead,disableHeadSort,onlySpecifiedCol,selectBy,rowHeight,onRowClick,onRowDblClick,onSelect,onSelectAll,onCustomSort,onFillRow,onFillCell,treeField,columns,subgroup,aggraded,autoClearSelection,onCellClick,defaultCellRender,hasFindDialog,hasFilterDialog';\r\n\t\t\r\n\t\tZ._fixedRows = 0;\r\n\r\n\t\tZ._fixedCols = 0;\r\n\r\n\t\tZ._hasSeqCol = true;\r\n\t\t\r\n\t\tZ._reverseSeqCol = false;\r\n\t\r\n\t\tZ._seqColHeader = null;\r\n\r\n\t\tZ._hasSelectCol = false;\r\n\t\t\r\n\t\tZ._noborder = false;\r\n\t\t\r\n\t\tZ._readOnly = true;\r\n\r\n\t\tZ._hideHead = false;\r\n\t\t\r\n\t\tZ._onlySpecifiedCol = false;\r\n\t\t\r\n\t\tZ._disableHeadSort = false;\r\n\t\t\r\n\t\tZ._aggraded = true;\r\n\t\t\r\n\t\tZ._autoClearSelection = true;\r\n\t\t\r\n\t\tZ._selectBy = null;\r\n\r\n\t\tZ._rowHeight = 25;\r\n\r\n\t\tZ._headRowHeight = 25;\r\n\r\n\t\tZ._treeField = null;\r\n\r\n\t\tZ._columns = null;\r\n\t\t\r\n\t\tZ._onRowClick = null;\r\n\r\n\t\tZ._onRowDblClick = null;\r\n\t\t\r\n\t\tZ._onCellClick;\r\n\t\t\r\n\t\tZ._onCustomSort = null; \r\n\t\t\r\n\t\tZ._onSelect = null;\r\n\r\n\t\tZ._onSelectAll = null;\r\n\t\t\r\n\t\tZ._onFillRow = null;\r\n\t\t\r\n\t\tZ._onFillCell = null;\t\t\r\n\r\n\t\tZ._defaultCellRender = null;\r\n\r\n\t\tZ._hasFindDialog = true;\r\n\t\t\r\n\t\tZ._hasFilterDialog = false;\r\n\t\t//@private\r\n\t\tZ._repairHeight = 0;\r\n\t\tZ.contentHeight = 0;\r\n\t\tZ.subgroup = null;//jslet.ui.TableSubgroup\r\n\t\t\r\n\t\tZ._sysColumns = null;//all system column like sequence column, select column, sub-group column\r\n\t\tZ._isHoriOverflow = false;\r\n\t\tZ._oldHeight = null;\r\n\t\t\r\n\t\tZ._currRow = null;\r\n\t\tZ._currColNum = 0;\r\n\t\tZ._editingField = null;\r\n\t\tZ._editorTabIndex = 1;\r\n\t\tZ._rowHeightChanged = false;\r\n\t\t$super(el, params);\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get or set Fixed row count.\r\n\t * \r\n\t * @param {Integer or undefined} rows fixed rows.\r\n\t * @return {Integer or this}\r\n\t */\r\n\tfixedRows: function(rows) {\r\n\t\tif(rows === undefined) {\r\n\t\t\treturn this._fixedRows;\r\n\t\t}\r\n\t\t\tjslet.Checker.test('DBTable.fixedRows', rows).isNumber();\r\n\t\tthis._fixedRows = parseInt(rows);\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get or set Fixed column count.\r\n\t * \r\n\t * @param {Integer or undefined} cols fixed cols.\r\n\t * @return {Integer or this}\r\n\t */\r\n\tfixedCols: function(cols) {\r\n\t\tif(cols === undefined) {\r\n\t\t\treturn this._fixedCols;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTable.fixedCols', cols).isNumber();\r\n\t\tthis._fixedCols = parseInt(cols);\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get or set row height of table row.\r\n\t * \r\n\t * @param {Integer or undefined} rowHeight table row height.\r\n\t * @return {Integer or this}\r\n\t */\r\n\trowHeight: function(rowHeight) {\r\n\t\tif(rowHeight === undefined) {\r\n\t\t\treturn this._rowHeight;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTable.rowHeight', rowHeight).isGTZero();\r\n\t\tthis._rowHeight = parseInt(rowHeight);\r\n\t\tthis._rowHeightChanged = true;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get or set row height of table header.\r\n\t * \r\n\t * @param {Integer or undefined} headRowHeight table header row height.\r\n\t * @return {Integer or this}\r\n\t */\r\n\theadRowHeight: function(headRowHeight) {\r\n\t\tif(headRowHeight === undefined) {\r\n\t\t\treturn this._headRowHeight;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTable.headRowHeight', headRowHeight).isGTZero();\r\n\t\tthis._headRowHeight = parseInt(headRowHeight);\r\n\t},\r\n\t\r\n\t/**\r\n\t * Identify whether there is sequence column in DBTable.\r\n\t * \r\n\t * @param {Boolean or undefined} hasSeqCol true(default) - has sequence column, false - otherwise.\r\n\t * @return {Boolean or this}\r\n\t */\r\n\thasSeqCol: function(hasSeqCol) {\r\n\t\tif(hasSeqCol === undefined) {\r\n\t\t\treturn this._hasSeqCol;\r\n\t\t}\r\n\t\tthis._hasSeqCol = hasSeqCol ? true: false;\r\n\t},\r\n\r\n\t/**\r\n\t * Identify whether the sequence number is reverse.\r\n\t * \r\n\t * @param {Boolean or undefined} reverseSeqCol true - the sequence number is reverse, false(default) - otherwise.\r\n\t * @return {Boolean or this}\r\n\t */\r\n\treverseSeqCol: function(reverseSeqCol) {\r\n\t\tif(reverseSeqCol === undefined) {\r\n\t\t\treturn this._reverseSeqCol;\r\n\t\t}\r\n\t\tthis._reverseSeqCol = reverseSeqCol ? true: false;\r\n\t},\r\n\t\t\r\n\t/**\r\n\t * Get or set sequence column header.\r\n\t * \r\n\t * @param {String or undefined} seqColHeader sequence column header.\r\n\t * @return {String or this}\r\n\t */\r\n\tseqColHeader: function(seqColHeader) {\r\n\t\tif(seqColHeader === undefined) {\r\n\t\t\treturn this._seqColHeader;\r\n\t\t}\r\n\t\tthis._seqColHeader = seqColHeader;\r\n\t},\r\n\t\t\r\n\t/**\r\n\t * Identify whether there is \"select\" column in DBTable.\r\n\t * \r\n\t * @param {Boolean or undefined} hasSelectCol true(default) - has \"select\" column, false - otherwise.\r\n\t * @return {Boolean or this}\r\n\t */\r\n\thasSelectCol: function(hasSelectCol) {\r\n\t\tif(hasSelectCol === undefined) {\r\n\t\t\treturn this._hasSelectCol;\r\n\t\t}\r\n\t\tthis._hasSelectCol = hasSelectCol ? true: false;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Identify the table has border or not.\r\n\t * \r\n\t * @param {Boolean or undefined} noborder true - the table without border, false(default) - otherwise.\r\n\t * @return {Boolean or this}\r\n\t */\r\n\tnoborder: function(noborder) {\r\n\t\tif(noborder === undefined) {\r\n\t\t\treturn this._noborder;\r\n\t\t}\r\n\t\tthis._noborder = noborder ? true: false;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Identify the table is read only or not.\r\n\t * \r\n\t * @param {Boolean or undefined} readOnly true(default) - the table is read only, false - otherwise.\r\n\t * @return {Boolean or this}\r\n\t */\r\n\treadOnly: function(readOnly) {\r\n\t\tvar Z = this;\r\n\t\tif(readOnly === undefined) {\r\n\t\t\treturn Z._readOnly;\r\n\t\t}\r\n\t\tZ._readOnly = readOnly ? true: false;\r\n\t\tif(!Z._readOnly && !Z._rowHeightChanged) {\r\n\t\t\tZ._rowHeight = 35;\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * Identify the table is hidden or not.\r\n\t * \r\n\t * @param {Boolean or undefined} hideHead true - the table header is hidden, false(default) - otherwise.\r\n\t * @return {Boolean or this}\r\n\t */\r\n\thideHead: function(hideHead) {\r\n\t\tif(hideHead === undefined) {\r\n\t\t\treturn this._hideHead;\r\n\t\t}\r\n\t\tthis._hideHead = hideHead ? true: false;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Identify the table has aggraded row or not.\r\n\t * \r\n\t * @param {Boolean or undefined} aggraded true - the table has aggraded row, false(default) - otherwise.\r\n\t * @return {Boolean or this}\r\n\t */\r\n\taggraded: function(aggraded) {\r\n\t\tif(aggraded === undefined) {\r\n\t\t\treturn this._aggraded;\r\n\t\t}\r\n\t\tthis._aggraded = aggraded ? true: false;\r\n\t},\r\n\r\n\t/**\r\n\t * Identify whether automatically clear selection when selecting table cells.\r\n\t * \r\n\t * @param {Boolean or undefined} autoClearSelection true(default) - automatically clear selection, false(default) - otherwise.\r\n\t * @return {Boolean or this}\r\n\t */\r\n\tautoClearSelection: function(autoClearSelection) {\r\n\t\tif(autoClearSelection === undefined) {\r\n\t\t\treturn this._autoClearSelection;\r\n\t\t}\r\n\t\tthis._autoClearSelection = autoClearSelection ? true: false;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Identify disable table head sorting or not.\r\n\t * \r\n\t * @param {Boolean or undefined} disableHeadSort true - disable table header sorting, false(default) - otherwise.\r\n\t * @return {Boolean or this}\r\n\t */\r\n\tdisableHeadSort: function(disableHeadSort) {\r\n\t\tif(disableHeadSort === undefined) {\r\n\t\t\treturn this._disableHeadSort;\r\n\t\t}\r\n\t\tthis._disableHeadSort = disableHeadSort ? true: false;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Identify show the specified columns or not.\r\n\t * \r\n\t * @param {Boolean or undefined} onlySpecifiedCol true - only showing the specified columns, false(default) - otherwise.\r\n\t * @return {Boolean or this}\r\n\t */\r\n\tonlySpecifiedCol: function(onlySpecifiedCol) {\r\n\t\tif(onlySpecifiedCol === undefined) {\r\n\t\t\treturn this._onlySpecifiedCol;\r\n\t\t}\r\n\t\tthis._onlySpecifiedCol = onlySpecifiedCol ? true: false;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Specified field names for selecting group records, multiple field names are separated with ','\r\n\t * @see jslet.data.Dataset.select(selected, selectBy).\r\n\t * \r\n\t * <pre><code>\r\n\t * tbl.selectBy('code,gender');\r\n\t * </code></pre>\r\n\t * \r\n\t * @param {String or undefined} selectBy group selecting field names.\r\n\t * @return {String or this}\r\n\t */\r\n\tselectBy: function(selectBy) {\r\n\t\tif(selectBy === undefined) {\r\n\t\t\treturn this._selectBy;\r\n\t\t}\r\n\t\t\tjslet.Checker.test('DBTable.selectBy', selectBy).isString();\r\n\t\tthis._selectBy = selectBy;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Display table as tree style. If this property is set, the dataset must be a tree style dataset, \r\n\t *  means dataset.parentField() and dataset.levelField() can not be empty.\r\n\t * Only one field name allowed.\r\n\t * \r\n\t * <pre><code>\r\n\t * tbl.treeField('code');\r\n\t * </code></pre>\r\n\t * \r\n\t * @param {String or undefined} treeField the field name which will show as tree style.\r\n\t * @return {String or this}\r\n\t */\r\n\ttreeField: function(treeField) {\r\n\t\tif(treeField === undefined) {\r\n\t\t\treturn this._treeField;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTable.treeField', treeField).isString();\r\n\t\tthis._treeField = treeField;\r\n\t},\r\n\r\n\t/**\r\n\t * Default cell render, it must be a child class of @see jslet.ui.CellRender \r\n\t * <pre><code>\r\n\t * \tvar cellRender = jslet.Class.create(jslet.ui.CellRender, {\r\n\t *\t\tcreateHeader: function(cellPanel, colCfg) { },\r\n\t *\t\tcreateCell: function (cellPanel, colCfg) { },\r\n\t *\t\trefreshCell: function (cellPanel, colCfg, recNo) { }\r\n\t * });\r\n\t * </code></pre>  \r\n\t */\r\n\tdefaultCellRender: function(defaultCellRender) {\r\n\t\tif(defaultCellRender === undefined) {\r\n\t\t\treturn this._defaultCellRender;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTable.defaultCellRender', defaultCellRender).isObject();\r\n\t\t\r\n\t\tthis._defaultCellRender = defaultCellRender;\r\n\t},\r\n\t\r\n\tcurrColNum: function(currColNum) {\r\n\t\tvar Z = this;\r\n\t\tif(currColNum === undefined) {\r\n\t\t\treturn Z._currColNum;\r\n\t\t}\r\n\t\tvar oldColNum = Z._currColNum;\r\n//\t\tif(oldColNum === currColNum) {\r\n//\t\t\treturn;\r\n//\t\t}\r\n\t\tZ._currColNum = currColNum;\r\n\t\tZ._adjustCurrentCellPos(oldColNum > currColNum);\r\n\t\tZ._showCurrentCell();\r\n\t\tif(Z._findDialog) {\r\n\t\t\tvar colCfg = Z.innerColumns[currColNum];\r\n\t\t\tif(colCfg.field) {\r\n\t\t\t\tZ._findDialog.findingField(colCfg.field);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * Fired when table row clicked.\r\n\t *  Pattern: \r\n\t *\tfunction(event}{}\r\n\t *  \t//event: Js mouse event\r\n\t *  \r\n\t * @param {Function or undefined} onRowClick table row clicked event handler.\r\n\t * @return {this or Function}\r\n\t */\r\n\tonRowClick: function(onRowClick) {\r\n\t\tif(onRowClick === undefined) {\r\n\t\t\treturn this._onRowClick;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTable.onRowClick', onRowClick).isFunction();\r\n\t\tthis._onRowClick = onRowClick;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Fired when table row double clicked.\r\n\t *  Pattern: \r\n\t *\tfunction(event}{}\r\n\t *  \t//event: Js mouse event\r\n\t *  \r\n\t * @param {Function or undefined} onRowDblClick table row double clicked event handler.\r\n\t * @return {this or Function}\r\n\t */\r\n\tonRowDblClick: function(onRowDblClick) {\r\n\t\tif(onRowDblClick === undefined) {\r\n\t\t\treturn this._onRowDblClick;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTable.onRowDblClick', onRowDblClick).isFunction();\r\n\t\tthis._onRowDblClick = onRowDblClick;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Fired when table cell clicked.\r\n\t *  Pattern: \r\n\t *\tfunction(event}{}\r\n\t *  \t//event: Js mouse event\r\n\t *  \r\n\t * @param {Function or undefined} onCellClick table cell clicked event handler.\r\n\t * @return {this or Function}\r\n\t */\r\n\tonCellClick: function(onCellClick) {\r\n\t\tif(onCellClick === undefined) {\r\n\t\t\treturn this._onCellClick;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTable.onCellClick', onCellClick).isFunction();\r\n\t\tthis._onCellClick = onCellClick;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Fired when table row is selected(select column is checked).\r\n\t *  Pattern: \r\n\t *   function(selected}{}\r\n\t *   //selected: Boolean\r\n\t *   //return: true - allow user to select this row, false - otherwise.\r\n\t *  \r\n\t * @param {Function or undefined} onSelect table row selected event handler.\r\n\t * @return {this or Function}\r\n\t */\r\n\tonSelect: function(onSelect) {\r\n\t\tif(onSelect === undefined) {\r\n\t\t\treturn this._onSelect;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTable.onSelect', onSelect).isFunction();\r\n\t\tthis._onSelect = onSelect;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Fired when all table rows are selected.\r\n\t *  Pattern: \r\n\t *   function(dataset, Selected}{}\r\n\t *   //dataset: jslet.data.Dataset\r\n\t *   //Selected: Boolean\r\n\t *   //return: true - allow user to select, false - otherwise.\r\n\t *  \r\n\t * @param {Function or undefined} onSelectAll All table row selected event handler.\r\n\t * @return {this or Function}\r\n\t */\r\n\tonSelectAll: function(onSelectAll) {\r\n\t\tif(onSelectAll === undefined) {\r\n\t\t\treturn this._onSelectAll;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTable.onSelectAll', onSelectAll).isFunction();\r\n\t\tthis._onSelectAll = onSelectAll;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Fired when user click table header to sort data. You can use it to sort data instead of default, like sending request to server to sort data.  \r\n\t * Pattern: \r\n\t *   function(indexFlds}{}\r\n\t *   //indexFlds: String, format: fieldName desc/asce(default), fieldName,..., desc - descending order, asce - ascending order, like: \"field1 desc,field2,field3\"\r\n\t *   \r\n\t * @param {Function or undefined} onCustomSort Customized sorting event handler.\r\n\t * @return {this or Function}\r\n\t */\r\n\tonCustomSort: function(onCustomSort) {\r\n\t\tif(onCustomSort === undefined) {\r\n\t\t\treturn this._onCustomSort;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTable.onCustomSort', onCustomSort).isFunction();\r\n\t\tthis._onCustomSort = onCustomSort;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Fired when fill row, user can use this to customize each row style like background color, font color\r\n\t * Pattern:\r\n\t *   function(otr, dataset){)\r\n\t *   //otr: Html element: TR\r\n\t *   //dataset: jslet.data.Dataset\r\n\t *   \r\n\t * @param {Function or undefined} onFillRow Table row filled event handler.\r\n\t * @return {this or Function}\r\n\t */\r\n\tonFillRow: function(onFillRow) {\r\n\t\tif(onFillRow === undefined) {\r\n\t\t\treturn this._onFillRow;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTable.onFillRow', onFillRow).isFunction();\r\n\t\tthis._onFillRow = onFillRow;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Fired when fill cell, user can use this to customize each cell style like background color, font color\r\n\t * Pattern:\r\n\t *   function(otd, dataset, fieldName){)\r\n\t *   //otd: Html element: TD\r\n\t *   //dataset: jslet.data.Dataset\r\n\t *   //fieldName: String\r\n\t *   \r\n\t * @param {Function or undefined} onFillCell Table cell filled event handler.\r\n\t * @return {this or Function}\r\n\t */\r\n\tonFillCell: function(onFillCell) {\r\n\t\tif(onFillCell === undefined) {\r\n\t\t\treturn this._onFillCell;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTable.onFillCell', onFillCell).isFunction();\r\n\t\tthis._onFillCell = onFillCell;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Identify has finding dialog or not.\r\n\t * \r\n\t * @param {Boolean or undefined} hasFindDialog true(default) - show finding dialog when press 'Ctrl + F', false - otherwise.\r\n\t * @return {Boolean or this}\r\n\t */\r\n\thasFindDialog: function(hasFindDialog) {\r\n\t\tvar Z = this;\r\n\t\tif(hasFindDialog === undefined) {\r\n\t\t\treturn Z._hasFindDialog;\r\n\t\t}\r\n\t\tZ._hasFindDialog = hasFindDialog? true: false;\r\n\t},\r\n\r\n\t/**\r\n\t * Identify has filter dialog or not.\r\n\t * \r\n\t * @param {Boolean or undefined} hasFilterDialog true(default) - show filter dialog when creating table, false - otherwise.\r\n\t * @return {Boolean or this}\r\n\t */\r\n\thasFilterDialog: function(hasFilterDialog) {\r\n\t\tvar Z = this;\r\n\t\tif(hasFilterDialog === undefined) {\r\n\t\t\treturn Z._hasFilterDialog;\r\n\t\t}\r\n\t\tZ._hasFilterDialog = hasFilterDialog? true: false;\r\n\t},\r\n\r\n\t\r\n\t/**\r\n\t * Table columns configurations, array of jslet.ui.TableColumn.\r\n\t * \r\n\t * @param {jslet.ui.TableColumn[] or undefined} columns Table columns configurations.\r\n\t * @return {jslet.ui.TableColumn[] or undefined}\r\n\t */\r\n\tcolumns: function(columns) {\r\n\t\tif(columns === undefined) {\r\n\t\t\treturn this._columns;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTable.columns', columns).isArray();\r\n\t\tvar colObj;\r\n\t\tfor(var i = 0, len = columns.length; i < len; i++) {\r\n\t\t\tcolObj = columns[i];\r\n\t\t\tjslet.Checker.test('DBTable.Column.field', colObj.field).isString();\r\n\t\t\tjslet.Checker.test('DBTable.Column.label', colObj.label).isString();\r\n\t\t\tjslet.Checker.test('DBTable.Column.colNum', colObj.colNum).isGTEZero();\r\n\t\t\tjslet.Checker.test('DBTable.Column.displayOrder', colObj.displayOrder).isNumber();\r\n\t\t\tjslet.Checker.test('DBTable.Column.width', colObj.width).isGTZero();\r\n\t\t\tjslet.Checker.test('DBTable.Column.colSpan', colObj.colSpan).isGTZero();\r\n\t\t\tcolObj.disableHeadSort = colObj.disableHeadSort ? true: false;\r\n\t\t\tif(!colObj.field) {\r\n\t\t\t\tcolObj.disableHeadSort = true;\r\n\t\t\t}\r\n\t\t\tcolObj.mergeSame = colObj.mergeSame ? true: false;\r\n\t\t\tcolObj.noRefresh = colObj.noRefresh ? true: false;\r\n\t\t\tjslet.Checker.test('DBTable.Column.cellRender', colObj.cellRender).isObject();\r\n\t\t}\r\n\t\tthis._columns = columns;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Goto and show the specified cell by field name.\r\n\t * \r\n\t * @param {String} fldName field name.\r\n\t */\r\n\tgotoField: function(fldName) {\r\n\t\tjslet.Checker.test('DBTable.gotoField#fldName', fldName).required().isString();\r\n\t\tvar lastColNum = this.innerColumns.length - 1,\r\n\t\t\tcolCfg, colField;\r\n\t\tfor(var i = 0; i <= lastColNum; i++) {\r\n\t\t\tcolCfg = this.innerColumns[i];\r\n\t\t\tcolField = colCfg.field;\r\n\t\t\tif(colField == fldName) {\r\n\t\t\t\tthis.gotoColumn(colCfg.colNum);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * Goto and show the specified cell by field name.\r\n\t * \r\n\t * @param {String} fldName field name.\r\n\t */\r\n\tgotoColumn: function(colNum) {\r\n\t\tjslet.Checker.test('DBTable.gotoColumn#colNum', colNum).required().isGTEZero();\r\n\t\tvar lastColNum = this.innerColumns.length - 1;\r\n\t\tif(colNum > lastColNum) {\r\n\t\t\tcolNum = lastColNum\r\n\t\t}\r\n\t\tthis.currColNum(lastColNum);\r\n\t\tif(colNum < lastColNum) {\r\n\t\t\tthis.currColNum(colNum);\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t* @override\r\n\t*/\r\n\tisValidTemplateTag: function (el) {\r\n\t\treturn el.tagName.toLowerCase() == 'div';\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tvar Z = this;\r\n\t\tjslet.resizeEventBus.subscribe(Z);\r\n\t\t\r\n\t\tjslet.ui.textMeasurer.setElement(Z.el);\r\n\t\tZ.charHeight = jslet.ui.textMeasurer.getHeight('M')+4;\r\n\t\tjslet.ui.textMeasurer.setElement();\r\n\t\tZ.charWidth = jslet.global.defaultCharWidth || 12;\r\n\t\tZ._widthStyleId = jslet.nextId();\r\n\t\tZ._initializeVm();\r\n\t\tif(Z.el.tabIndex) {\r\n\t\t\tZ._editorTabIndex = Z.el.tabIndex + 1;\r\n\t\t}\r\n\t\tZ.renderAll();\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tvar ti = jqEl.attr('tabindex');\r\n\t\tif (Z._readOnly && !ti) {\r\n\t\t\tjqEl.attr('tabindex', 0);\r\n\t\t}\r\n\r\n        var notFF = ((typeof Z.el.onmousewheel) == 'object'); //firefox or nonFirefox browser\r\n        var wheelEvent = (notFF ? 'mousewheel' : 'DOMMouseScroll');\r\n        jqEl.on(wheelEvent, function (event) {\r\n            var originalEvent = event.originalEvent;\r\n            var num = notFF ? originalEvent.wheelDelta / -120 : originalEvent.detail / 3;\r\n\t\t\tif(!Z._readOnly && Z._dataset.status() != jslet.data.DataSetStatus.BROWSE) {\r\n\t\t\t\tZ._dataset.confirm();\r\n\t\t\t}\r\n            Z.listvm.setVisibleStartRow(Z.listvm.getVisibleStartRow() + num);\r\n       \t\tevent.preventDefault();\r\n        });\r\n\r\n        jqEl.on('mousedown', function(event){\r\n        \tif(event.shiftKey) {\r\n\t       \t\tevent.preventDefault();\r\n\t       \t\tevent.stopImmediatePropagation();\r\n\t       \t\treturn false;\r\n        \t}\r\n        });\r\n        \r\n        jqEl.on('click', 'button.jl-tbl-filter', function(event) {\r\n    \t\tif (!Z._filterPanel) {\r\n    \t\t\tZ._filterPanel = new jslet.ui.DBTableFilterPanel(Z);\r\n    \t\t}\r\n    \t\tvar btnEle = event.currentTarget,\r\n    \t\t\tjqFilterBtn = jQuery(btnEle);\r\n    \t\tjslet.ui.PopupPanel.excludedElement = btnEle;\r\n    \t\tvar r = jqFilterBtn.offset(), h = jqFilterBtn.outerHeight(), x = r.left, y = r.top + h;\r\n    \t\tif (jslet.locale.isRtl){\r\n    \t\t\tx = x + jqFilterBtn.outerWidth();\r\n    \t\t}\r\n    \t\tZ._filterPanel.showPopup(x, y, 0, h);\r\n\r\n        \t\r\n        \t\r\n        \t\r\n       \t\tevent.preventDefault();\r\n       \t\tevent.stopImmediatePropagation();\r\n        });\r\n        \r\n        jqEl.on('click', 'td.jl-tbl-cell', function(event){\r\n        \tif(!Z.readOnly) {\r\n        \t\treturn;\r\n        \t}\r\n        \tvar otd = event.currentTarget;\r\n        \tvar colCfg = otd.jsletColCfg;\r\n        \tif(colCfg) {\r\n        \t\tif(colCfg.isSeqCol) { //If the cell is sequence cell, process row selection.\r\n        \t\t\tZ._processRowSelection(event.ctrlKey, event.shiftKey, event.altKey);\r\n        \t\t} else {\r\n\t        \t\tvar colNum = colCfg.colNum;\r\n\t        \t\tif(colNum !== 0 && !colNum) {\r\n\t        \t\t\treturn;\r\n\t        \t\t}\r\n\t\t\t\t\tZ._doBeforeSelect(event.ctrlKey, event.shiftKey, event.altKey);\r\n\t        \t\tZ.currColNum(colNum);\r\n\t\t\t\t\tZ._processSelection(event.ctrlKey, event.shiftKey, event.altKey);\r\n        \t\t}\r\n            \tZ._doCellClick(colCfg);\r\n        \t}\r\n        \tif(event.shiftKey || event.ctrlKey) {\r\n\t       \t\tevent.preventDefault();\r\n\t       \t\tevent.stopImmediatePropagation();\r\n\t       \t\treturn false;\r\n        \t}\r\n        });\r\n\r\n\t\tjqEl.on('keydown', function (event) {\r\n\t\t\tvar keyCode = event.which;\r\n\t\t\t\r\n\t\t\tif(event.ctrlKey && keyCode == 70) { //ctrl + f\r\n\t\t\t\tif(!Z._hasFindDialog) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tif(!Z._findDialog) {\r\n\t\t\t\t\tZ._findDialog = new jslet.ui.FindDialog(Z);\r\n\t\t\t\t}\r\n\t\t\t\tif(!Z._findDialog.findingField()) {\r\n\t\t\t\t\tvar colCfg = Z.innerColumns[Z._currColNum];\r\n\t\t\t\t\tif(colCfg.field) {\r\n\t\t\t\t\t\tZ._findDialog.findingField(colCfg.field);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tZ._findDialog.show(0, Z.headSectionHt);\r\n\t\t\t\tevent.preventDefault();\r\n\t       \t\tevent.stopImmediatePropagation();\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tif(event.ctrlKey && keyCode == 67) { //ctrl + c\r\n\t\t\t\tvar selectedText = Z._dataset.selection.getSelectionText();\r\n\t\t\t\tif(selectedText) {\r\n\t\t\t\t\tjslet.Clipboard.putText(selectedText);\r\n\t\t\t\t\twindow.setTimeout(function(){Z.el.focus();}, 5);\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif(event.ctrlKey && keyCode == 65) { //ctrl + a\r\n\t\t\t\tvar fields = [], colCfg, fldName;\r\n\t\t\t\tfor(var i = 0, len = Z.innerColumns.length; i < len; i++) {\r\n\t\t\t\t\tcolCfg = Z.innerColumns[i];\r\n\t\t\t\t\tfldName = colCfg.field;\r\n\t\t\t\t\tif(fldName) {\r\n\t\t\t\t\t\tfields.push(fldName);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tZ._dataset.selection.selectAll(fields, true);\r\n\t\t\t\tZ._refreshSelection();\r\n\t\t\t\tevent.preventDefault();\r\n\t       \t\tevent.stopImmediatePropagation();\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tif(keyCode === 37) { //Arrow Left\r\n\t\t\t\tif(!Z._readOnly) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tvar num;\r\n\t\t\t\tif(Z._currColNum === 0) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tnum = Z._currColNum - 1;\r\n\t\t\t\t}\r\n\t\t\t\tZ._doBeforeSelect(event.ctrlKey, event.shiftKey, event.altKey);\r\n\t\t\t\tZ.currColNum(num);\r\n\t\t\t\tZ._processSelection(event.ctrlKey, event.shiftKey, event.altKey);\r\n\t\t\t\tevent.preventDefault();\r\n\t       \t\tevent.stopImmediatePropagation();\r\n\t\t\t} else if( keyCode === 39) { //Arrow Right\r\n\t\t\t\tif(!Z._readOnly) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tvar lastColNum = Z.innerColumns.length - 1, \r\n\t\t\t\t\tnum = 0;\r\n\t\t\t\tif(Z._currColNum < lastColNum) {\r\n\t\t\t\t\tnum = Z._currColNum + 1;\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tZ._doBeforeSelect(event.ctrlKey, event.shiftKey, event.altKey);\r\n\t\t\t\tZ.currColNum(num);\r\n\t\t\t\tZ._processSelection(event.ctrlKey, event.shiftKey, event.altKey);\r\n\t\t\t\tevent.preventDefault();\r\n\t       \t\tevent.stopImmediatePropagation();\r\n\t\t\t} else if (keyCode == 38) {//KEY_UP\r\n\t\t\t\tZ._doBeforeSelect(event.ctrlKey, event.shiftKey, event.altKey);\r\n\t\t\t\tZ.listvm.priorRow();\r\n\t\t\t\tZ._processSelection(event.ctrlKey, event.shiftKey, event.altKey);\r\n\t\t\t\tevent.preventDefault();\r\n\t       \t\tevent.stopImmediatePropagation();\r\n\t\t\t} else if (keyCode == 40) {//KEY_DOWN\r\n\t\t\t\tZ._doBeforeSelect(event.ctrlKey, event.shiftKey, event.altKey);\r\n\t\t\t\tZ.listvm.nextRow();\r\n\t\t\t\tZ._processSelection(event.ctrlKey, event.shiftKey, event.altKey);\r\n\t\t\t\tevent.preventDefault();\r\n\t       \t\tevent.stopImmediatePropagation();\r\n\t\t\t} else if (keyCode == 33) {//KEY_PAGEUP\r\n\t\t\t\tZ.listvm.priorPage();\r\n\t\t\t\tevent.preventDefault();\r\n\t       \t\tevent.stopImmediatePropagation();\r\n\t\t\t} else if (keyCode == 34) {//KEY_PAGEDOWN\r\n\t\t\t\tZ.listvm.nextPage();\r\n\t\t\t\tevent.preventDefault();\r\n\t       \t\tevent.stopImmediatePropagation();\r\n\t\t\t}\r\n\t\t});\t\t\r\n\t}, // end bind\r\n\t\r\n\t_initializeVm: function () {\r\n\t\tvar Z = this;\r\n\t\t\t\t\t\t\r\n\t\tZ.listvm = new jslet.ui.ListViewModel(Z._dataset, Z._treeField ? true : false);\r\n\t\t\r\n\t\tZ.listvm.onTopRownoChanged = function (rowno) {\r\n\t\t\tif (rowno < 0) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tZ._fillData();\r\n\t\t\t\r\n\t\t\tZ._syncScrollBar(rowno);\r\n\t\t\tZ._showCurrentRow();\r\n\t\t};\r\n\t\r\n\t\tZ.listvm.onVisibleCountChanged = function () {\r\n\t\t\tZ.renderAll();\r\n\t\t};\r\n\t\t\r\n\t\tZ.listvm.onCurrentRownoChanged = function (preRowno, rowno) {\r\n\t\t\tif (Z._dataset.recordCount() === 0) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tZ._dataset.recno(Z.listvm.getCurrentRecno())\r\n\t\t\tif (Z._currRow) {\r\n\t\t\t\tif (Z._currRow.fixed) {\r\n\t\t\t\t\tjQuery(Z._currRow.fixed).removeClass(jslet.ui.htmlclass.TABLECLASS.currentrow);\r\n\t\t\t\t}\r\n\t\t\t\tjQuery(Z._currRow.content).removeClass(jslet.ui.htmlclass.TABLECLASS.currentrow);\r\n\t\t\t}\r\n\t\t\tvar currRow = Z._getTrByRowno(rowno), otr;\r\n\t\t\tif (!currRow) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\totr = currRow.fixed;\r\n\t\t\tif (otr) {\r\n\t\t\t\tjQuery(otr).addClass(jslet.ui.htmlclass.TABLECLASS.currentrow);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\totr = currRow.content;\r\n\t\t\tjQuery(otr).addClass(jslet.ui.htmlclass.TABLECLASS.currentrow);\r\n\t\t\tZ._currRow = currRow;\r\n\t\t\tif(!Z._readOnly) {\r\n\t\t\t\tvar fldName = Z._editingField;\r\n\t\t\t\tif(fldName) {\r\n\t\t\t\t\tvar fldObj = Z._dataset.getField(fldName);\r\n\t\t\t\t\tif(fldObj && !fldObj.disabled() && !fldObj.readOnly()) {\r\n\t\t\t\t\t\tZ._dataset.focusEditControl(fldName);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tvar Z = this;\r\n\t\tZ.el.innerHTML = '';\r\n\t\tZ.listvm.fixedRows = Z._fixedRows;\r\n\t\tZ._calcParams();\r\n\t\tZ.listvm.refreshModel();\r\n\t\tZ._createFrame();\r\n\t\tZ._fillData();\r\n\t\tZ._showCurrentRow();\r\n\t\tZ._oldHeight = jQuery(Z.el).height();\r\n\t\tZ._updateSortFlag(true);\r\n\t}, // end renderAll\r\n\r\n\t_doBeforeSelect: function(hasCtrlKey, hasShiftKey, hasAltKey) {\r\n\t},\r\n\t\r\n\t_getSelectionFields: function(startColNum, endColNum) {\r\n\t\tif(startColNum > endColNum) {\r\n\t\t\tvar tmp = startColNum;\r\n\t\t\tstartColNum = endColNum;\r\n\t\t\tendColNum = tmp;\r\n\t\t}\r\n\t\tvar fields = [], fldName, colCfg, colNum;\r\n\t\tfor(var i = 0, len = this.innerColumns.length; i < len; i++) {\r\n\t\t\tcolCfg = this.innerColumns[i];\r\n\t\t\tcolNum = colCfg.colNum;\r\n\t\t\tif(colNum >= startColNum && colNum <= endColNum) {\r\n\t\t\t\tfldName = colCfg.field;\r\n\t\t\t\tif(fldName) {\r\n\t\t\t\t\tfields.push(fldName);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn fields;\r\n\t},\r\n\t\r\n\t_processSelection: function(hasCtrlKey, hasShiftKey, hasAltKey) {\r\n\t\tvar Z = this,\r\n\t\t\tcurrRecno = Z._dataset.recno(),\r\n\t\t\tfldName;\r\n\t\tif(hasCtrlKey || !Z._autoClearSelection) { //If autoClearSelection = false, click a cell will select it.\r\n\t\t\tfldName = Z.innerColumns[Z._currColNum].field;\r\n\t\t\tif(fldName) {\r\n\t\t\t\tif(Z._dataset.selection.isSelected(currRecno, fldName)) {\r\n\t\t\t\t\tZ._dataset.selection.remove(currRecno, currRecno, [fldName], true);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tZ._dataset.selection.add(currRecno, currRecno, [fldName], true);\r\n\t\t\t\t}\r\n\t\t\t\tZ._refreshSelection();\r\n\t\t\t}\r\n\t\t\tZ._preRecno = currRecno;\r\n\t\t\tZ._preColNum = Z._currColNum;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(hasShiftKey) {\r\n\t\t\tvar fields;\r\n\t\t\tif(Z._preTmpRecno >= 0 && Z._preTmpColNum >= 0) {\r\n\t\t\t\tfields = Z._getSelectionFields(Z._preColNum || 0, Z._preTmpColNum);\r\n\t\t\t\tZ._dataset.selection.remove(Z._preRecno || 0, Z._preTmpRecno, fields, false);\r\n\t\t\t}\r\n\t\t\tfields = Z._getSelectionFields(Z._preColNum || 0, Z._currColNum);\r\n\t\t\tZ._dataset.selection.add(Z._preRecno || 0, currRecno, fields, true);\r\n\t\t\tZ._refreshSelection();\r\n\t\t\tZ._preTmpRecno = currRecno;\r\n\t\t\tZ._preTmpColNum = Z._currColNum;\r\n\t\t} else {\r\n\t\t\tZ._preRecno = currRecno;\r\n\t\t\tZ._preColNum = Z._currColNum;\r\n\t\t\tZ._preTmpRecno = currRecno;\r\n\t\t\tZ._preTmpColNum = Z._currColNum;\r\n\t\t\tif(Z._autoClearSelection) {\r\n\t\t\t\tZ._dataset.selection.removeAll();\r\n\t\t\t\tZ._refreshSelection();\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\t_processColumnSelection: function(colCfg, hasCtrlKey, hasShiftKey, hasAltKey) {\r\n\t\tif(!hasCtrlKey && !hasShiftKey) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar Z = this,\r\n\t\t\trecCnt = Z._dataset.recordCount();\r\n\t\tif(recCnt === 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar fields, colNum;\r\n\t\tif(hasShiftKey) {\r\n\t\t\tif(Z._preTmpColNum >= 0) {\r\n\t\t\t\tfields = Z._getSelectionFields(Z._preColNum || 0, Z._preTmpColNum);\r\n\t\t\t\tZ._dataset.selection.remove(0, recCnt, fields, true);\r\n\t\t\t}\r\n\t\t\tcolNum = colCfg.colNum + colCfg.colSpan - 1;\r\n\t\t\tfields = Z._getSelectionFields(Z._preColNum || 0, colNum);\r\n\t\t\tZ._dataset.selection.add(0, recCnt, fields, true);\r\n\t\t\tZ._preTmpColNum = colNum;\r\n\t\t} else {\r\n\t\t\tif(!hasCtrlKey && Z._autoClearSelection) {\r\n\t\t\t\tZ._dataset.selection.removeAll();\r\n\t\t\t}\r\n\t\t\tif(colCfg.colSpan > 1) {\r\n\t\t\t\tfields = [];\r\n\t\t\t\tvar startColNum = colCfg.colNum,\r\n\t\t\t\t\tendColNum = colCfg.colNum + colCfg.colSpan, fldName;\r\n\t\t\t\t\r\n\t\t\t\tfor(var colNum = startColNum; colNum < endColNum; colNum++) {\r\n\t\t\t\t\tfldName = Z.innerColumns[colNum].field;\r\n\t\t\t\t\tfields.push(fldName);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tfields = [colCfg.field];\r\n\t\t\t}\r\n\t\t\tZ._dataset.selection.add(0, recCnt, fields, true);\r\n\t\t\tZ._preColNum = colCfg.colNum;\r\n\t\t}\r\n\t\tZ._refreshSelection();\r\n\t},\r\n\t\r\n\t_processRowSelection: function(hasCtrlKey, hasShiftKey, hasAltKey) {\r\n\t\tif(!hasCtrlKey && !hasShiftKey) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar Z = this,\r\n\t\t\tfields = Z._getSelectionFields(0, Z.innerColumns.length - 1);\r\n\t\tvar currRecno = Z._dataset.recno();\r\n\t\tif(hasShiftKey) {\r\n\t\t\tvar fields;\r\n\t\t\tif(Z._preTmpRecno >= 0) {\r\n\t\t\t\tZ._dataset.selection.remove(Z._preRecno || 0, Z._preTmpRecno, fields, true);\r\n\t\t\t}\r\n\t\t\tZ._dataset.selection.add(Z._preRecno || 0, currRecno, fields, true);\r\n\t\t\tZ._preTmpColNum = currRecno;\r\n\t\t} else {\r\n\t\t\tif(!hasCtrlKey && Z._autoClearSelection) {\r\n\t\t\t\tZ._dataset.selection.removeAll();\r\n\t\t\t}\r\n\t\t\tZ._dataset.selection.add(currRecno, currRecno, fields, true);\r\n\t\t\tZ._preRecno = currRecno;\r\n\t\t}\r\n\t\tZ._refreshSelection();\r\n\t},\r\n\t\r\n\t_prepareColumn: function(){\r\n\t\tvar Z = this, cobj;\r\n\t\tZ._sysColumns = [];\r\n\t\t//prepare system columns\r\n\t\tif (Z._hasSeqCol){\r\n\t\t\tcobj = {label:'&nbsp;',width: Z.seqColWidth, disableHeadSort:true,isSeqCol:true, \r\n\t\t\t\t\tcellRender:jslet.ui.DBTable.sequenceCellRender, widthCssName: Z._widthStyleId + '-s0'};\r\n\t\t\tZ._sysColumns.push(cobj);\r\n\t\t}\r\n\t\tif (Z._hasSelectCol){\r\n\t\t\tcobj = {label:'<input type=\"checkbox\" />', width: Z.selectColWidth, disableHeadSort:true,isSelectCol:true, \r\n\t\t\t\t\tcellRender:jslet.ui.DBTable.selectCellRender, widthCssName: Z._widthStyleId + '-s1'};\r\n\t\t\tZ._sysColumns.push(cobj);\r\n\t\t}\r\n\t\t\r\n\t\tif (Z.subgroup && Z.subgroup.hasExpander){\r\n\t\t\tcobj = {label:'&nbsp;', width: Z.selectColWidth, disableHeadSort:true, isSubgroup: true, \r\n\t\t\t\t\tcellRender:jslet.ui.DBTable.subgroupCellRender, widthCssName: Z._widthStyleId + '-s2'};\r\n\t\t\tZ._sysColumns.push(cobj);\r\n\t\t}\r\n\t\t//prepare data columns\r\n\t\tvar tmpColumns = [];\r\n\t\tif (Z._columns) {\r\n\t\t\tfor(var i = 0, colCnt = Z._columns.length; i < colCnt; i++){\r\n\t\t\t\tcobj = Z._columns[i];\r\n\t\t\t\tif (!cobj.field){\r\n\t\t\t\t\tcobj.disableHeadSort = true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar fldObj = Z._dataset.getField(cobj.field);\r\n\t\t\t\t\tif(!fldObj) {\r\n\t\t\t\t\t\tthrow new Error('Not found Field: ' + cobj.field);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcobj.displayOrder = fldObj.displayOrder();\r\n\t\t\t\t}\r\n\t\t\t\ttmpColumns.push(cobj);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (!Z._onlySpecifiedCol) {\r\n\t\t\t\r\n\t\t\tfunction getColumnObj(fldName) {\r\n\t\t\t\tif (Z._columns){\r\n\t\t\t\t\tfor(var i = 0, colCnt = Z._columns.length; i < colCnt; i++){\r\n\t\t\t\t\t\tcobj = Z._columns[i];\r\n\t\t\t\t\t\tif (cobj.field && cobj.field == fldName){\r\n\t\t\t\t\t\t\treturn cobj;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tvar fldObj, fldName,fields = Z._dataset.getFields();\r\n\t\t\tfor (var i = 0, fldcnt = fields.length; i < fldcnt; i++) {\r\n\t\t\t\tfldObj = fields[i];\r\n\t\t\t\tfldName = fldObj.name();\r\n\t\t\t\tif (fldObj.visible()) {\r\n\t\t\t\t\tcobj = getColumnObj(fldName);\r\n\t\t\t\t\tif(!cobj) {\r\n\t\t\t\t\t\tcobj = new jslet.ui.TableColumn();\r\n\t\t\t\t\t\tcobj.field = fldObj.name();\r\n\t\t\t\t\t\tcobj.displayOrder = fldObj.displayOrder();\r\n\t\t\t\t\t\ttmpColumns.push(cobj);\r\n\t\t\t\t\t}\r\n\t\t\t\t} // end if visible\r\n\t\t\t} // end for\r\n\t\t\tif (Z._columns){\r\n\t\t\t\tfor(var i = 0, colCnt = Z._columns.length; i < colCnt; i++){\r\n\t\t\t\t\tcobj = Z._columns[i];\r\n\t\t\t\t\tif (!cobj.field){\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfldObj = Z._dataset.getTopField(cobj.field);\r\n\t\t\t\t\tif (!fldObj) {\r\n\t\t\t\t\t\tthrow new Error(\"Field: \" + cobj.field + \" doesn't exist!\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvar children = fldObj.children();\r\n\t\t\t\t\tif (children && children.length > 0){\r\n\t\t\t\t\t\tfldName = fldObj.name();\r\n\t\t\t\t\t\tvar isUnique = true;\r\n\t\t\t\t\t\t// cobj.field is not a child of a groupfield, we need check if the topmost parent field is duplicate or not \r\n\t\t\t\t\t\tif (cobj.field != fldName){\r\n\t\t\t\t\t\t\tfor(var k = 0; k < tmpColumns.length; k++){\r\n\t\t\t\t\t\t\t\tif (tmpColumns[k].field == fldName){\r\n\t\t\t\t\t\t\t\t\tisUnique = false;\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} // end for k\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (isUnique){\r\n\t\t\t\t\t\t\tcobj = new jslet.ui.TableColumn();\r\n\t\t\t\t\t\t\tcobj.field = fldName;\r\n\t\t\t\t\t\t\tcobj.displayOrder = fldObj.displayOrder();\r\n\t\t\t\t\t\t\ttmpColumns.push(cobj);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} //end for i\r\n\t\t\t} //end if Z.columns\r\n\t\t}\r\n\t\t\r\n\t\ttmpColumns.sort(function(cobj1, cobj2) {\r\n\t\t\tvar ord1 = cobj1.displayOrder || 0;\r\n\t\t\tvar ord2 = cobj2.displayOrder || 0;\r\n\t\t\treturn ord1 === ord2? 0: (ord1 < ord2? -1: 1);\r\n\t\t});\r\n\t\t\r\n\t\tZ.innerHeads = [];\r\n\t\tZ.innerColumns = [];\r\n\t\tvar ohead, fldName, label, context = {lastColNum: 0, depth: 0};\r\n\t\t\r\n\t\tfor(var i = 0, colCnt = tmpColumns.length; i < colCnt; i++){\r\n\t\t\tcobj = tmpColumns[i];\r\n\t\t\tfldName = cobj.field;\r\n\t\t\tif (!fldName){\r\n\t\t\t\tohead = new jslet.ui.TableHead();\r\n\t\t\t\tlabel = cobj.label;\r\n\t\t\t\tohead.label = label? label: \"\";\r\n\t\t\t\tohead.level = 0;\r\n\t\t\t\tohead.colNum = context.lastColNum++;\r\n\t\t\t\tcobj.colNum = ohead.colNum;\r\n\t\t\t\tohead.id = jslet.nextId();\r\n\t\t\t\tohead.widthCssName = Z._widthStyleId + '-' + ohead.colNum;\r\n\t\t\t\tcobj.widthCssName = ohead.widthCssName;\r\n\t\t\t\tohead.disableHeadSort = cobj.disableHeadSort;\r\n\r\n\t\t\t\tZ.innerHeads.push(ohead);\r\n\t\t\t\tZ.innerColumns.push(cobj);\r\n\t\t\t\t\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tfldObj = Z._dataset.getField(fldName);\r\n\t\t\tZ._convertField2Head(context, fldObj);\r\n\t\t}\r\n\r\n\t\tZ.maxHeadRows = context.depth + 1;\r\n\t\tZ._calcHeadSpan();\r\n\t\r\n\t\t//check fixedCols property\r\n\t\tvar colCnt = 0, preColCnt = 0, \r\n\t\tfixedColNum = Z._fixedCols - Z._sysColumns.length;\r\n\t\tfor(var i = 1, len = Z.innerHeads.length; i < len; i++){\r\n\t\t\tohead = Z.innerHeads[i];\r\n\t\t\tcolCnt += ohead.colSpan;\r\n\t\t\tif (fixedColNum <= preColCnt || fixedColNum == colCnt) {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tif (fixedColNum < colCnt && fixedColNum > preColCnt) {\r\n\t\t\t\tZ._fixedCols = preColCnt + Z._sysColumns.length;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tpreColCnt = colCnt;\r\n\t\t}\r\n\t},\r\n\t\r\n\t_calcHeadSpan: function(heads){\r\n\t\tvar Z = this;\r\n\t\tif (!heads) {\r\n\t\t\theads = Z.innerHeads;\r\n\t\t}\r\n\t\tvar ohead, childCnt = 0;\r\n\t\tfor(var i = 0, len = heads.length; i < len; i++ ){\r\n\t\t\tohead = heads[i];\r\n\t\t\tohead.rowSpan = Z.maxHeadRows - ohead.level;\r\n\t\t\tif (ohead.subHeads){\r\n\t\t\t\tohead.colSpan = Z._calcHeadSpan(ohead.subHeads);\r\n\t\t\t\tchildCnt += ohead.colSpan;\r\n\t\t\t} else {\r\n\t\t\t\tohead.colSpan = 1;\r\n\t\t\t\tchildCnt++;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn childCnt;\r\n\t},\r\n\t\r\n\t_convertField2Head: function(context, fldObj, parentHeadObj){\r\n\t\tvar Z = this;\r\n\t\tif (!fldObj.visible()) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tvar level = 0;\r\n\t\tif (!parentHeadObj){\r\n\t\t\theads = Z.innerHeads;\r\n\t\t} else {\r\n\t\t\tlevel = parentHeadObj.level + 1;\r\n\t\t\theads = parentHeadObj.subHeads;\r\n\t\t}\r\n\t\tvar ohead, fldName = fldObj.name();\r\n\t\tohead = new jslet.ui.TableHead();\r\n\t\tohead.label = fldObj.label();\r\n\t\tohead.field = fldName;\r\n\t\tohead.level = level;\r\n\t\tohead.colNum = context.lastColNum;\r\n\t\tohead.id = jslet.nextId();\r\n\t\theads.push(ohead);\r\n\t\tcontext.depth = Math.max(level, context.depth);\r\n\t\tvar fldChildren = fldObj.children();\r\n\t\tif (fldChildren && fldChildren.length > 0){\r\n\t\t\tohead.subHeads = [];\r\n\t\t\tvar added = false;\r\n\t\t\tfor(var i = 0, cnt = fldChildren.length; i< cnt; i++){\r\n\t\t\t\tZ._convertField2Head(context, fldChildren[i], ohead);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tcontext.lastColNum ++;\r\n\t\t\tvar cobj, found = false;\r\n\t\t\tvar len = Z._columns ? Z._columns.length: 0;\r\n\t\t\tfor(var i = 0; i < len; i++){\r\n\t\t\t\tcobj = Z._columns[i];\r\n\t\t\t\tif (cobj.field == fldName){\r\n\t\t\t\t\tfound = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (!found){\r\n\t\t\t\tcobj = new jslet.ui.TableColumn();\r\n\t\t\t\tcobj.field = fldName;\r\n\t\t\t}\r\n\t\t\tif (!cobj.label){\r\n\t\t\t\tcobj.label = fldObj.label();\r\n\t\t\t}\r\n\t\t\tcobj.mergeSame = fldObj.mergeSame();\r\n\t\t\tcobj.colNum = ohead.colNum;\r\n\t\t\tif (!cobj.width){\r\n\t\t\t\tmaxWidth = fldObj ? fldObj.displayWidth() : 0;\r\n\t\t\t\tif (!Z._hideHead && cobj.label) {\r\n\t\t\t\t\tmaxWidth = Math.max(maxWidth, cobj.label.length);\r\n\t\t\t\t}\r\n\t\t\t\tcobj.width = maxWidth ? (maxWidth * Z.charWidth) : 10;\r\n\t\t\t}\r\n\t\t\t//check and set cell render\r\n\t\t\tif (!cobj.cellRender) {\r\n\t\t\t\tif (fldObj.getType() == jslet.data.DataType.BOOLEAN){//data type is boolean\r\n\t\t\t\t\tif (!Z._isCellEditable(cobj)) {// Not in edit mode\r\n\t\t\t\t\t\tcobj.cellRender = jslet.ui.DBTable.boolCellRender;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (cobj.field == Z._treeField) {\r\n\t\t\t\t\t\tcobj.cellRender = jslet.ui.DBTable.treeCellRender;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tohead.widthCssName = Z._widthStyleId + '-' + ohead.colNum;\r\n\t\t\tcobj.widthCssName = ohead.widthCssName;\r\n\t\t\t\r\n\t\t\tZ.innerColumns.push(cobj);\r\n\t\t}\r\n\t\treturn true;\r\n\t},\r\n\t\r\n\t_calcParams: function () {\r\n\t\tvar Z = this;\r\n\t\tZ._currColNum = 0;\r\n\t\tZ._preTmpColNum = -1;\r\n\t\tZ._preTmpRecno = -1;\r\n\t\tZ._preRecno = -1;\r\n\t\tZ._preColNum = -1;\r\n\r\n\t\tif (Z._treeField) {//if tree table, then can't sort by clicking column header\r\n\t\t\tZ._disableHeadSort = true;\r\n\t\t}\r\n\t\t// calculate Sequence column width\r\n\t\tif (Z._hasSeqCol) {\r\n\t\t\tZ.seqColWidth = ('' + Z._dataset.recordCount()).length * Z.charWidth + 5;\r\n\t\t\tvar sWidth = jslet.ui.htmlclass.TABLECLASS.selectColWidth;\r\n\t\t\tZ.seqColWidth = Z.seqColWidth > sWidth ? Z.seqColWidth: sWidth;\r\n\t\t} else {\r\n\t\t\tZ.seqColWidth = 0;\r\n\t\t}\r\n\t\t// calculate Select column width\r\n\t\tif (Z._hasSelectCol) {\r\n\t\t\tZ.selectColWidth = jslet.ui.htmlclass.TABLECLASS.selectColWidth;\r\n\t\t} else {\r\n\t\t\tZ.selectColWidth = 0;\r\n\t\t}\r\n\t\t//calculate Fixed row section's height\r\n\t\tif (Z._fixedRows > 0) {\r\n\t\t\tZ.fixedSectionHt = Z._fixedRows * Z._rowHeight;\r\n\t\t} else {\r\n\t\t\tZ.fixedSectionHt = 0;\r\n\t\t}\r\n\t\t//Calculate Foot section's height\r\n\t\tif (Z.aggraded() && Z.dataset().checkAggraded()){\r\n\t\t\tZ.footSectionHt = Z._rowHeight;\r\n\t\t} else {\r\n\t\t\tZ.footSectionHt = 0;\r\n\t\t}\r\n\t\tZ._prepareColumn();\r\n\r\n\t\t// fixed Column count must be less than total columns\r\n\t\tif (Z._fixedCols) {\r\n\t\t\tif (Z._fixedCols > Z.innerColumns.length) {\r\n\t\t\t\tZ._fixedCols = Z.innerColumns.length;\r\n\t\t\t}\r\n\t\t}\r\n\t\tZ.hasFixedCol = Z._sysColumns.length > 0 || Z._fixedCols > 0;\r\n\t\tif (Z.hasFixedCol){\r\n\t\t\tvar w = 0;\r\n\t\t\tfor(var i = 0, cnt = Z._sysColumns.length; i < cnt; i++){\r\n\t\t\t\tw += Z._sysColumns[i].width;\r\n\t\t\t}\r\n\t\t\tfor(var i = 0; i < Z._fixedCols; i++){\r\n\t\t\t\tw += Z.innerColumns[i].width;\r\n\t\t\t}\r\n\t\t\tZ.fixedColWidth = w + 4;\r\n\t\t} else {\r\n\t\t\tZ.fixedColWidth = 0;\r\n\t\t}\r\n\t}, // end _calcParams\r\n\r\n\t_setScrollBarMaxValue: function (maxValue) {\r\n\t\tvar Z = this,\r\n\t\t\tv = maxValue + Z._repairHeight;\r\n\t\tZ.jqVScrollBar.find('div').height(v);\r\n\t\tif(Z.contentSectionHt + Z.footSectionHt >= v) {\r\n\t\t\tZ.jqVScrollBar.parent().addClass('jl-scrollbar-hidden');\t\r\n\t\t} else {\r\n\t\t\tZ.jqVScrollBar.parent().removeClass('jl-scrollbar-hidden');\t\r\n\t\t}\r\n\t},\r\n\r\n\t_changeColWidthCssRule: function(cssName, width){\r\n\t\tvar Z = this,\r\n\t\t\tstyleEle = document.getElementById(Z._widthStyleId),\r\n\t\t\tstyleObj = styleEle.styleSheet || styleEle.sheet,\r\n\t\t\tcssRules = styleObj.cssRules || styleObj.rules,\r\n\t\t\tcssRule = null, found = false;\r\n\t\t\tcssName = '.' + cssName;\r\n\t\tfor(var i = 0, len = cssRules.length; i < len; i++) {\r\n\t\t\tcssRule = cssRules[i];\r\n\t\t\tif(cssRule.selectorText == cssName) {\r\n\t\t\t\tfound = true;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(found) {\r\n\t\t\tcssRule.style['width'] = width + 'px';\r\n\t\t}\r\n\t\treturn found;\r\n\t},\r\n\r\n\t_changeColWidth: function (index, deltaW) {\r\n\t\tvar Z = this,\r\n\t\t\tcolObj = Z.innerColumns[index];\r\n\t\tif (colObj.width + deltaW <= 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tcolObj.width += deltaW;\r\n\t\tif(colObj.field) {\r\n\t\t\tZ._dataset.designMode(true);\r\n\t\t\ttry {\r\n\t\t\t\tZ._dataset.getField(colObj.field).displayWidth(Math.round(colObj.width/Z.charWidth));\r\n\t\t\t} finally {\r\n\t\t\t\tZ._dataset.designMode(false);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(Z._changeColWidthCssRule(colObj.widthCssName, colObj.width)) {\r\n\t\t\tZ._changeContentWidth(deltaW);\r\n\t\t}\r\n\t},\r\n\r\n\t_refreshSeqColWidth: function() {\r\n\t\tvar Z = this;\r\n\t\tif (!Z._hasSeqCol) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar oldSeqColWidth = Z.seqColWidth;\r\n\t\tZ.seqColWidth = ('' + Z._dataset.recordCount()).length * Z.charWidth;\r\n\t\tvar sWidth = jslet.ui.htmlclass.TABLECLASS.selectColWidth;\r\n\t\tZ.seqColWidth = Z.seqColWidth > sWidth ? Z.seqColWidth: sWidth;\r\n\t\tif(Z.seqColWidth == oldSeqColWidth) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar colObj;\r\n\t\tfor(var i = 0, len = Z._sysColumns.length; i < len; i++) {\r\n\t\t\tcolObj = Z._sysColumns[i];\r\n\t\t\tif(colObj.isSeqCol) {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tcolObj.width = Z.seqColWidth;\r\n\t\tZ._changeColWidthCssRule(colObj.widthCssName, Z.seqColWidth);\r\n\t\tvar deltaW = Z.seqColWidth - oldSeqColWidth;\r\n\t\tZ._changeContentWidth(deltaW, true);\r\n\t},\r\n\r\n\t_changeContentWidth: function (deltaW, isLeft) {\r\n\t\tvar Z = this,\r\n\t\t\ttotalWidth = Z.getTotalWidth(isLeft),\r\n\t\t\ttotalWidthStr = totalWidth + 'px';\r\n\t\tif(!isLeft) {\r\n\t\t\tZ.rightHeadTbl.parentNode.style.width = totalWidthStr;\r\n\t\t\tZ.rightFixedTbl.parentNode.style.width = totalWidthStr;\r\n\t\t\tZ.rightContentTbl.parentNode.style.width = totalWidthStr;\r\n\t\t\tif (Z.footSectionHt) {\r\n\t\t\t\tZ.rightFootTbl.style.width = totalWidthStr;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tZ.fixedColWidth = totalWidth;\r\n\t\t\tZ.leftHeadTbl.parentNode.parentNode.style.width = Z.fixedColWidth + 1 + 'px';\r\n\t\t\tZ.leftHeadTbl.parentNode.style.width = totalWidthStr;\r\n\t\t\tZ.leftFixedTbl.parentNode.style.width = totalWidthStr;\r\n\t\t\tZ.leftContentTbl.parentNode.style.width = totalWidthStr;\r\n\t\t}\r\n\t\tZ._checkHoriOverflow();\r\n\t},\r\n\r\n\t_createFrame: function () {\r\n\t\tvar Z = this;\r\n\t\tZ.el.style.position = 'relative';\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tif (!jqEl.hasClass('jl-table')) {\r\n\t\t\tjqEl.addClass('jl-table jl-border-box jl-round5');\r\n\t\t}\r\n\t\tif(Z._noborder){\r\n\t\t\tjqEl.addClass('jl-tbl-noborder');\r\n\t\t}\r\n\t\t\r\n\t\tfunction generateWidthStyle() {\r\n\t\t\tvar colObj, cssName,\r\n\t\t\t\tstyleHtml = ['<style type=\"text/css\" id=\"' + Z._widthStyleId + '\">\\n'];\r\n\t\t\tfor(var i = 0, len = Z._sysColumns.length; i < len; i++) {\r\n\t\t\t\tcolObj = Z._sysColumns[i];\r\n\t\t\t\tstyleHtml.push('.' + colObj.widthCssName +'{width:' + colObj.width + 'px}\\n');\r\n\t\t\t}\r\n\t\t\tfor(var i = 0, len = Z.innerColumns.length; i< len; i++) {\r\n\t\t\t\tcolObj = Z.innerColumns[i];\r\n\t\t\t\tstyleHtml.push('.' + colObj.widthCssName +'{width:' + colObj.width + 'px}\\n');\r\n\t\t\t}\r\n\t\t\tstyleHtml.push('</style>');\r\n\t\t\treturn styleHtml.join('');\r\n\t\t}\r\n\t\t\r\n\t\tvar dbtableframe = [\r\n\t\t\t'<div class=\"jl-tbl-splitter\" style=\"display: none\"></div>',\r\n\t\t\tgenerateWidthStyle(),\r\n\t\t\t'<div class=\"jl-tbl-norecord\">',\r\n\t\t\tjslet.locale.DBTable.norecord,\r\n\t\t\t'</div>',\r\n//\t\t\t'<div class=\"jl-tbl-curr-cell\">&nbsp;</div>',\r\n\t\t\t'<table class=\"jl-tbl-container\"><tr>',\r\n\t\t\t'<td><div class=\"jl-tbl-fixedcol\"><table class=\"jl-tbl-data\"><tbody /></table><table class=\"jl-tbl-data\"><tbody /></table><div class=\"jl-tbl-content-div\"><table class=\"jl-tbl-data\"><tbody /></table></div><table><tbody /></table></div></td>',\r\n\t\t\t'<td><div class=\"jl-tbl-contentcol\"><div><table class=\"jl-tbl-data jl-tbl-content-table\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\"><tbody /></table></div><div><table class=\"jl-tbl-data jl-tbl-content-table\"><tbody /></table></div><div class=\"jl-tbl-content-div\"><table class=\"jl-tbl-data jl-tbl-content-table\"><tbody /></table></div><table class=\"jl-tbl-content-table jl-tbl-footer\"><tbody /></table></div></td>',\r\n\t\t\t'<td class=\"jl-scrollbar-col\"><div class=\"jl-tbl-vscroll-head\"></div><div class=\"jl-tbl-vscroll\"><div /></div></td></tr></table>'];\r\n\t\t\r\n\t\tjqEl.html(dbtableframe.join(''));\r\n\r\n\t\tvar children = jqEl.find('.jl-tbl-fixedcol')[0].childNodes;\r\n\t\tZ.leftHeadTbl = children[0];\r\n\t\tZ.leftFixedTbl = children[1];\r\n\t\tZ.leftContentTbl = children[2].firstChild;\r\n\t\tZ.leftFootTbl = children[3];\r\n\t\t\r\n\t\tchildren = jqEl.find('.jl-tbl-contentcol')[0].childNodes;\r\n\t\tZ.rightHeadTbl = children[0].firstChild;\r\n\t\tZ.rightFixedTbl = children[1].firstChild;\r\n\t\tZ.rightContentTbl = children[2].firstChild;\r\n\t\tZ.rightFootTbl = children[3];\r\n\r\n\t\tZ.height = jqEl.height();\r\n\t\tif (Z._hideHead){\r\n\t\t\tZ.leftHeadTbl.style.display = 'none';\r\n\t\t\tZ.rightHeadTbl.style.display = 'none';\r\n\t\t\tjqEl.find('.jl-tbl-vscroll-head').css('display', 'none');\r\n\t\t}\r\n\t\tif (Z._fixedRows <= 0){\r\n\t\t\tZ.leftFixedTbl.style.display = 'none';\r\n\t\t\tZ.rightFixedTbl.style.display = 'none';\r\n\t\t}\r\n\t\tif (!Z.footSectionHt){\r\n\t\t\tZ.leftFootTbl.style.display = 'none';\r\n\t\t\tZ.rightFootTbl.style.display = 'none';\r\n\t\t}\r\n\t\tZ.leftHeadTbl.parentNode.parentNode.style.width = Z.fixedColWidth + 'px';\r\n\t\t\r\n\t\tvar jqRightHead = jQuery(Z.rightHeadTbl);\r\n\t\tjqRightHead.off();\r\n\t\tvar x = jqRightHead.on('mousedown', Z._doSplitHookDown);\r\n\t\tvar y = jqRightHead.on('mouseup', Z._doSplitHookUp);\r\n\t\t\r\n\t\tjQuery(Z.leftHeadTbl).on('mousedown', '.jl-tbl-header-cell', function(event){\r\n\t\t\tevent = jQuery.event.fix(event || window.event);\r\n\t\t\tvar el = event.target;\r\n\t\t\tif (el.className == 'jl-tbl-splitter-hook') {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar colCfg = this.jsletColCfg;\r\n\t\t\tif(colCfg.field) {\r\n\t\t\t\tZ._processColumnSelection(colCfg, event.ctrlKey, event.shiftKey, event.altKey);\r\n\t\t\t}\r\n\t\t});\r\n\t\t\r\n\t\tjqRightHead.on('mousedown', '.jl-tbl-header-cell', function(event){\r\n\t\t\tevent = jQuery.event.fix(event || window.event);\r\n\t\t\tvar el = event.target;\r\n\t\t\tif (el.className == 'jl-tbl-splitter-hook') {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar colCfg = this.jsletColCfg;\r\n\t\t\tif(colCfg.field) {\r\n\t\t\t\tZ._processColumnSelection(colCfg, event.ctrlKey, event.shiftKey, event.altKey);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tjQuery(Z.leftHeadTbl).on('mouseup', '.jl-focusable-item', function(event){\r\n\t\t\tevent = jQuery.event.fix(event || window.event);\r\n\t\t\tvar el = event.target;\r\n\t\t\tif (Z.isDraggingColumn) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tZ._doHeadClick(this.parentNode.parentNode.parentNode.jsletColCfg, event.ctrlKey);\r\n\t\t\tZ._head_label_cliecked = true;\r\n\t\t\tevent.stopImmediatePropagation();\r\n\t\t\tevent.preventDefault();\r\n\t\t\treturn false;\r\n\t\t});\r\n\t\t\r\n\t\tjqRightHead.on('mouseup', '.jl-focusable-item', function(event){\r\n\t\t\tevent = jQuery.event.fix(event || window.event);\r\n\t\t\tvar el = event.target;\r\n\t\t\tif (Z.isDraggingColumn) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tZ._doHeadClick(this.parentNode.parentNode.parentNode.jsletColCfg, event.ctrlKey);\r\n\t\t\tZ._head_label_cliecked = true;\r\n\t\t\tevent.stopImmediatePropagation();\r\n\t\t\tevent.preventDefault();\r\n\t\t\treturn false;\r\n\t\t});\r\n\t\t\r\n\t\tdragTransfer = null;\r\n\t\tjqRightHead.on('dragstart', '.jl-focusable-item', function(event){\r\n\t\t\tvar otd = this.parentNode.parentNode.parentNode,\r\n\t\t\t\tcolCfg = otd.jsletColCfg,\r\n\t\t\t\te = event.originalEvent,\r\n\t\t\t\ttransfer = e.dataTransfer;\r\n\t\t\ttransfer.dropEffect = 'link';\r\n\t\t\ttransfer.effectAllowed = 'link';\r\n\t\t\tdragTransfer = {fieldName: colCfg.field, rowIndex: otd.parentNode.rowIndex, cellIndex: otd.cellIndex};\r\n\t\t\ttransfer.setData('fieldName', colCfg.field); //must has this row otherwise FF does not work.\r\n\t\t\treturn true;\r\n\t\t});\r\n\r\n\t\tfunction checkDropable(currCell) {\r\n\t\t\tvar colCfg = currCell.jsletColCfg,\r\n\t\t\t\tsrcRowIndex = dragTransfer.rowIndex,\r\n\t\t\t\tsrcCellIndex = dragTransfer.cellIndex,\r\n\t\t\t\tcurrRowIndex = currCell.parentNode.rowIndex,\r\n\t\t\t\tcurrCellIndex = currCell.cellIndex;\r\n\t\t\tvar result = (srcRowIndex == currRowIndex && currCellIndex != srcCellIndex);\r\n\t\t\tif(!result) {\r\n\t\t\t\treturn result;\r\n\t\t\t}\r\n\t\t\tvar\tsrcFldName = dragTransfer.fieldName,\r\n\t\t\t\tcurrFldName = colCfg.field,\r\n\t\t\t\tsrcPFldObj = Z._dataset.getField(srcFldName).parent(),\r\n\t\t\t\tcurrPFldObj = Z._dataset.getField(currFldName).parent();\r\n\t\t\tresult = (srcPFldObj === currPFldObj || (currPFldObj && srcPFldObj.name() == currPFldObj.name()));\r\n\t\t\treturn result;\r\n\t\t}\r\n\t\t\r\n\t\tjqRightHead.on('dragover', '.jl-tbl-header-cell .jl-tbl-header-div', function(event){\r\n\t\t\tif(!dragTransfer) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tvar otd = this.parentNode,\r\n\t\t\t\te = event.originalEvent,\r\n\t\t\t\ttransfer = e.dataTransfer;\r\n\t\t\tif(checkDropable(otd)) { \r\n\t\t\t\tjQuery(event.currentTarget).addClass('jl-tbl-col-over');\r\n\t\t\t\ttransfer.dropEffect = 'link';\r\n\t\t\t} else {\r\n\t\t\t\ttransfer.dropEffect = 'move';\r\n\t\t\t}\r\n\t\t    return false;\r\n\t\t});\r\n\r\n\t\tjqRightHead.on('dragenter', '.jl-tbl-header-cell .jl-tbl-header-div', function(event){\r\n\t\t\tif(!dragTransfer) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tvar otd = this.parentNode,\r\n\t\t\t\te = event.originalEvent,\r\n\t\t\t\ttransfer = e.dataTransfer;\r\n\t\t\tif(checkDropable(otd)) { \r\n\t\t\t\tjQuery(event.currentTarget).addClass('jl-tbl-col-over');\r\n\t\t\t\ttransfer.dropEffect = 'link';\r\n\t\t\t} else {\r\n\t\t\t\ttransfer.dropEffect = 'move';\r\n\t\t\t}\r\n\t\t    return false;\r\n\t\t});\r\n\t\t\r\n\t\tjqRightHead.on('dragleave', '.jl-tbl-header-cell .jl-tbl-header-div', function(event){\r\n\t\t\tif(!dragTransfer) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tjQuery(event.currentTarget).removeClass('jl-tbl-col-over');\r\n\t\t\treturn  false;\r\n\t\t});\r\n\t\t\r\n\t\tjqRightHead.on('drop', '.jl-tbl-header-cell .jl-tbl-header-div', function(event){\r\n\t\t\tif(!dragTransfer) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tjQuery(event.currentTarget).removeClass('jl-tbl-col-over');\r\n\t\t\tvar currCell = this.parentNode,\r\n\t\t\t\te = event.originalEvent,\r\n\t\t\t\ttransfer = e.dataTransfer,\r\n\t\t\t\tcolCfg = currCell.jsletColCfg,\r\n\t\t\t\tsrcRowIndex = dragTransfer.rowIndex,\r\n\t\t\t\tsrcCellIndex = dragTransfer.cellIndex,\r\n\t\t\t\tcurrRowIndex = currCell.parentNode.rowIndex,\r\n\t\t\t\tcurrCellIndex = currCell.cellIndex;\r\n\t\t\t\r\n\t\t\tif(!checkDropable(currCell)) { \r\n\t\t\t\treturn\r\n\t\t\t}\r\n\t\t\tvar destField = this.parentNode.jsletColCfg.field;\r\n\t\t\tif(!destField) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar\tsrcField = dragTransfer.fieldName;\r\n\t\t\tZ._moveColumn(srcRowIndex, srcCellIndex, currCellIndex);\r\n\t    \treturn false;\r\n\t\t});\r\n\t\t\r\n\t\tvar jqLeftFixedTbl = jQuery(Z.leftFixedTbl),\r\n\t\t\tjqRightFixedTbl = jQuery(Z.rightFixedTbl),\r\n\t\t\tjqLeftContentTbl = jQuery(Z.leftContentTbl),\r\n\t\t\tjqRightContentTbl = jQuery(Z.rightContentTbl);\r\n\t\t\r\n\t\tjqLeftFixedTbl.off();\r\n\t\tjqLeftFixedTbl.on('mouseenter', 'tr', function() {\r\n\t\t\tjQuery(this).addClass(jslet.ui.htmlclass.TABLECLASS.hoverrow);\r\n\t\t\tjQuery(jqRightFixedTbl[0].rows[this.rowIndex]).addClass(jslet.ui.htmlclass.TABLECLASS.hoverrow);\r\n\t\t});\r\n\t\tjqLeftFixedTbl.on('mouseleave', 'tr', function() {\r\n\t\t\tjQuery(this).removeClass(jslet.ui.htmlclass.TABLECLASS.hoverrow);\r\n\t\t\tjQuery(jqRightFixedTbl[0].rows[this.rowIndex]).removeClass(jslet.ui.htmlclass.TABLECLASS.hoverrow);\r\n\t\t});\r\n\r\n\t\tjqRightFixedTbl.off();\r\n\t\tjqRightFixedTbl.on('mouseenter', 'tr', function() {\r\n\t\t\tjQuery(this).addClass(jslet.ui.htmlclass.TABLECLASS.hoverrow);\r\n\t\t\tjQuery(jqLeftFixedTbl[0].rows[this.rowIndex]).addClass(jslet.ui.htmlclass.TABLECLASS.hoverrow);\r\n\t\t});\r\n\t\tjqRightFixedTbl.on('mouseleave', 'tr', function() {\r\n\t\t\tjQuery(this).removeClass(jslet.ui.htmlclass.TABLECLASS.hoverrow);\r\n\t\t\tjQuery(jqLeftFixedTbl[0].rows[this.rowIndex]).removeClass(jslet.ui.htmlclass.TABLECLASS.hoverrow);\r\n\t\t});\r\n\t\t\r\n\t\tjqLeftContentTbl.off();\r\n\t\tjqLeftContentTbl.on('mouseenter', 'tr', function() {\r\n\t\t\tjQuery(this).addClass(jslet.ui.htmlclass.TABLECLASS.hoverrow);\r\n\t\t\tjQuery(jqRightContentTbl[0].rows[this.rowIndex]).addClass(jslet.ui.htmlclass.TABLECLASS.hoverrow);\r\n\t\t});\r\n\t\tjqLeftContentTbl.on('mouseleave', 'tr', function(){\r\n\t\t\tjQuery(this).removeClass(jslet.ui.htmlclass.TABLECLASS.hoverrow);\r\n\t\t\tjQuery(jqRightContentTbl[0].rows[this.rowIndex]).removeClass(jslet.ui.htmlclass.TABLECLASS.hoverrow);\r\n\t\t});\r\n\t\t\r\n\t\tjqRightContentTbl.off();\r\n\t\tjqRightContentTbl.on('mouseenter', 'tr', function(){\r\n\t\t\tjQuery(this).addClass(jslet.ui.htmlclass.TABLECLASS.hoverrow);\r\n\t\t\tvar hasLeft = (Z._fixedRows > 0 || Z._sysColumns.length > 0);\r\n\t\t\tif(hasLeft) {\r\n\t\t\t\tjQuery(jqLeftContentTbl[0].rows[this.rowIndex]).addClass(jslet.ui.htmlclass.TABLECLASS.hoverrow);\r\n\t\t\t}\r\n\t\t});\r\n\t\tjqRightContentTbl.on('mouseleave', 'tr', function(){\r\n\t\t\tjQuery(this).removeClass(jslet.ui.htmlclass.TABLECLASS.hoverrow);\r\n\t\t\tvar hasLeft = (Z._fixedRows > 0 || Z._sysColumns.length > 0);\r\n\t\t\tif(hasLeft) {\r\n\t\t\t\tjQuery(jqLeftContentTbl[0].rows[this.rowIndex]).removeClass(jslet.ui.htmlclass.TABLECLASS.hoverrow);\r\n\t\t\t}\r\n\t\t});\r\n\t\t\r\n\t\tZ.jqVScrollBar = jqEl.find('.jl-tbl-vscroll');\r\n\r\n\t\tZ.noRecordDiv = jqEl.find('.jl-tbl-norecord')[0];\r\n\t\t//The scrollbar width must be set explicitly, otherwise it doesn't work in IE. \r\n\t\tZ.jqVScrollBar.width(jslet.scrollbarSize()+1);\r\n\t\t\r\n\t\tZ.jqVScrollBar.on('scroll', function () {\r\n\t\t\tif (Z._keep_silence_) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif(!Z._readOnly && Z._dataset.status() != jslet.data.DataSetStatus.BROWSE) {\r\n\t\t\t\tZ._dataset.confirm();\r\n\t\t\t}\r\n\t\t\tvar num = Math.round(this.scrollTop / Z._rowHeight);// + Z._fixedRows;\r\n\t\t\tif (num != Z.listvm.getVisibleStartRow()) {\r\n\t\t\t\tZ._keep_silence_ = true;\r\n\t\t\t\ttry {\r\n\t\t\t\t\tZ.listvm.setVisibleStartRow(num);\r\n\t\t\t\t\tZ._showCurrentRow();\r\n\t\t\t\t} finally {\r\n\t\t\t\t\tZ._keep_silence_ = false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tjqEl.find('.jl-tbl-contentcol').on('scroll', function () {\r\n\t\t\tif(Z._isCurrCellInView()) {\r\n\t\t\t\tZ._showCurrentCell();\t\t\t\r\n\t\t\t}\r\n\t\t});\r\n\t\t\r\n\t\tvar splitter = jqEl.find('.jl-tbl-splitter')[0];\r\n\t\tsplitter._doDragStart = function(){\r\n\t\t\tthis.style.display = 'block';\r\n\t\t};\r\n\t\t\r\n\t\tsplitter._doDragging = function (oldX, oldY, x, y, deltaX, deltaY) {\r\n\t\t\tvar bodyMleft = parseInt(jQuery(document.body).css('margin-left'));\r\n\r\n\t\t\tvar ojslet = splitter.parentNode.jslet;\r\n\t\t\tvar colObj = ojslet.innerColumns[ojslet.currColId];\r\n\t\t\tif (colObj.width + deltaX <= 40) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tsplitter.style.left = x - jQuery(splitter.parentNode).offset().left - bodyMleft + 'px';\r\n\t\t};\r\n\r\n\t\tsplitter._doDragEnd = function (oldX, oldY, x, y, deltaX,\r\n\t\t\tdeltaY) {\r\n\t\t\tvar Z = splitter.parentNode.jslet;\r\n\t\t\tZ._changeColWidth(Z.currColId, deltaX);\r\n\t\t\tsplitter.style.display = 'none';\r\n\t\t\tsplitter.parentNode.jslet.isDraggingColumn = false;\r\n\t\t};\r\n\r\n\t\tsplitter._doDragCancel = function () {\r\n\t\t\tsplitter.style.display = 'none';\r\n\t\t\tsplitter.parentNode.jslet.isDraggingColumn = false;\r\n\t\t};\r\n\r\n\t\tif (Z.footSectionHt){\r\n\t\t\tZ.leftFootTbl.style.display = '';\r\n\t\t\tZ.rightFootTbl.style.display = '';\r\n\t\t}\r\n\t\tZ._renderHeader();\r\n\t\t\r\n\t\tif (Z._hideHead) {\r\n\t\t\tZ.headSectionHt = 0;\r\n\t\t} else {\r\n\t\t\tZ.headSectionHt = Z.maxHeadRows * Z._headRowHeight;\r\n\t\t}\r\n\t\tZ._changeContentWidth(0);\r\n\r\n\t\tZ.noRecordDiv.style.top = Z.headSectionHt + 'px';\r\n\t\tZ.noRecordDiv.style.left = jqEl.find('.jl-tbl-fixedcol').width() + 5 + 'px';\r\n\t\tjqEl.find('.jl-tbl-vscroll-head').height(Z.headSectionHt + Z.fixedSectionHt);\r\n\t\tZ._renderBody();\r\n\t},\r\n\r\n\t_moveColumn: function(rowIndex, srcCellIndex, destCellIndex) {\r\n\t\tvar Z = this;\r\n\t\t\r\n\t\tfunction moveOneRow(cells, srcStart, srcEnd, destStart, destEnd) {\r\n\t\t\tvar cobj, \r\n\t\t\t\tcolNo = 0, \r\n\t\t\t\tsrcCells = [],\r\n\t\t\t\tdestCells = [];\r\n\t\t\t\r\n\t\t\tfor(var i = 0, len = cells.length; i < len; i++) {\r\n\t\t\t\tcobj = cells[i];\r\n\t\t\t\tif(colNo >= srcStart && colNo <= srcEnd) {\r\n\t\t\t\t\tsrcCells.push(cobj);\r\n\t\t\t\t} else if(colNo >= destStart && colNo <= destEnd) {\r\n\t\t\t\t\tdestCells.push(cobj);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif(colNo > srcEnd && colNo > destEnd) {\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tcolNo += cobj.colSpan || 1;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(srcStart > destStart) {\t\r\n\t\t\t\tvar destCell = destCells[0];\r\n\t\t\t\tfor(var i = 0, len = srcCells.length; i < len; i++) {\r\n\t\t\t\t\tjQuery(srcCells[i]).insertBefore(destCell);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tvar destCell = destCells[destCells.length - 1];\r\n\t\t\t\tfor(var i = srcCells.length; i >= 0; i--) {\r\n\t\t\t\t\tjQuery(srcCells[i]).insertAfter(destCell);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tfunction moveOneTableColumn(rows, rowIndex, srcStart, srcEnd, destStart, destEnd) {\r\n\t\t\tvar rowCnt = rows.length;\r\n\t\t\tif(rowCnt === 0 || rowCnt === rowIndex) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar colCfg = rows[rowIndex].cells[srcStart].jsletColCfg;\r\n\t\t\tvar rowObj, cellCnt;\r\n\t\t\tfor(var i = rowIndex, len = rows.length; i < len; i++) {\r\n\t\t\t\trowObj = rows[i];\r\n\t\t\t\tmoveOneRow(rowObj.cells, srcStart, srcEnd, destStart, destEnd);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tvar rows = Z.rightHeadTbl.createTHead().rows, cobj,\r\n\t\t\trowObj = rows[rowIndex],\r\n\t\t\tsrcStart = 0,\r\n\t\t\tsrcEnd = 0,\r\n\t\t\tdestStart = 0,\r\n\t\t\tdestEnd = 0, \r\n\t\t\tpreColNo = 0,\r\n\t\t\tcolNo = 0;\r\n\t\t\r\n\t\tfor(var i = 0, len = rowObj.cells.length; i < len; i++) {\r\n\t\t\tcobj = rowObj.cells[i];\r\n\t\t\tpreColNo = colNo; \r\n\t\t\tcolNo += (cobj.colSpan || 1);\r\n\t\t\tif(i === srcCellIndex) {\r\n\t\t\t\tsrcStart = preColNo;\r\n\t\t\t\tsrcEnd = colNo - 1;\r\n\t\t\t}\r\n\t\t\tif(i === destCellIndex) {\r\n\t\t\t\tdestStart = preColNo;\r\n\t\t\t\tdestEnd = colNo - 1;\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar srcCell = rowObj.cells[srcCellIndex],\r\n\t\t\tdestCell = rowObj.cells[destCellIndex];\r\n\t\tvar srcColCfg = srcCell.jsletColCfg,\r\n\t\t\tdestColCfg = destCell.jsletColCfg,\r\n\t\t\tsrcFldName = srcColCfg.field,\r\n\t\t\tdestFldName = destColCfg.field;\r\n\t\tif(srcFldName && destFldName) {\r\n\t\t\tZ._dataset.designMode(true);\r\n\t\t\ttry {\r\n\t\t\t\tZ._dataset.moveField(srcFldName, destFldName);\r\n\t\t\t} finally {\r\n\t\t\t\tZ._dataset.designMode(false);\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar headRows = Z.rightHeadTbl.createTHead().rows;\r\n\t\tZ._changeColNum(headRows[headRows.length - 1], srcStart, srcEnd, destStart, destEnd);\r\n\t\tvar dataRows = Z.rightContentTbl.tBodies[0].rows;\r\n\t\tZ._changeColNum(dataRows[0], srcStart, srcEnd, destStart, destEnd);\r\n\t\tZ._currColNum = 0;\r\n\t\tmoveOneTableColumn(headRows, rowIndex, srcStart, srcEnd, destStart, destEnd);\r\n\t\tmoveOneTableColumn(Z.rightFixedTbl.tBodies[0].rows, 0, srcStart, srcEnd, destStart, destEnd);\r\n\t\tmoveOneTableColumn(dataRows, 0, srcStart, srcEnd, destStart, destEnd);\r\n\t\tmoveOneTableColumn(Z.rightFootTbl.tBodies[0].rows, 0, srcStart, srcEnd, destStart, destEnd);\r\n\t\tZ._dataset.selection.removeAll();\r\n\t\tZ._refreshSelection();\r\n\t},\r\n\t\r\n\t_changeColNum: function(rowObj, srcStart, srcEnd, destStart, destEnd) {\r\n\t\tif(!rowObj) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar cobj, \r\n\t\t\tcolNo = 0, \r\n\t\t\tsrcCells = [],\r\n\t\t\tdestCells = [],\r\n\t\t\tcells = rowObj.cells;\r\n\t\t\r\n\t\tfor(var i = 0, len = cells.length; i < len; i++) {\r\n\t\t\tcobj = cells[i];\r\n\t\t\tif(colNo >= srcStart && colNo <= srcEnd) {\r\n\t\t\t\tsrcCells.push(cobj);\r\n\t\t\t} else if(colNo >= destStart && colNo <= destEnd) {\r\n\t\t\t\tdestCells.push(cobj);\r\n\t\t\t} else {\r\n\t\t\t\tif(colNo > srcEnd && colNo > destEnd) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tcolNo += cobj.colSpan || 1;\r\n\t\t}\r\n\t\tvar srcCellLen = srcCells.length,\r\n\t\t\tdestCellLen = destCells.length,\r\n\t\t\tfirstDestColNum= destCells[0].jsletColCfg.colNum,\r\n\t\t\tk = 0, colCfg;\r\n\t\tif(srcStart > destStart) {\r\n\t\t\tfor(var i = srcStart; i <= srcEnd; i++) {\r\n\t\t\t\tcolCfg = cells[i].jsletColCfg;\r\n\t\t\t\tcolCfg.colNum = firstDestColNum + (k++);\r\n\t\t\t}\r\n\t\t\tfor(var i = destStart; i < srcStart; i++) {\r\n\t\t\t\tcolCfg = cells[i].jsletColCfg;\r\n\t\t\t\tcolCfg.colNum = colCfg.colNum + srcCellLen;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tvar newStart = firstDestColNum - srcCellLen + destCellLen;\r\n\t\t\tfor(var i = srcStart; i <= srcEnd; i++) {\r\n\t\t\t\tcolCfg = cells[i].jsletColCfg;\r\n\t\t\t\tcolCfg.colNum = newStart + (k++);\r\n\t\t\t}\r\n\t\t\tfor(var i = srcEnd + 1; i <= destEnd; i++) {\r\n\t\t\t\tcolCfg = cells[i].jsletColCfg;\r\n\t\t\t\tcolCfg.colNum = colCfg.colNum - srcCellLen;\r\n\t\t\t}\r\n\t\t}\t\t\r\n\t},\r\n\t\r\n\t_calcAndSetContentHeight: function(){\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el);\r\n\r\n\t\tZ.contentSectionHt = Z.height - Z.headSectionHt - Z.fixedSectionHt - Z.footSectionHt;\r\n\t\tif (Z._isHoriOverflow){\r\n\t\t\tZ.contentSectionHt -= jslet.ui.htmlclass.TABLECLASS.scrollBarWidth;\r\n\t\t}\r\n\t\t\r\n\t\tZ.listvm.setVisibleCount(Math.floor((Z.contentSectionHt) / Z._rowHeight), true);\r\n\t\tZ._repairHeight = Z.contentSectionHt - Z.listvm.getVisibleCount() * Z._rowHeight;\r\n\t\t\r\n\t\tjqEl.find('.jl-tbl-contentcol').height(Z.height);\r\n\t\tjqEl.find('.jl-tbl-content-div').height(Z.contentSectionHt);\r\n\r\n\t\tZ.jqVScrollBar.height(Z.contentSectionHt + Z.footSectionHt);\r\n\t\tZ._setScrollBarMaxValue(Z.listvm.getNeedShowRowCount() * Z._rowHeight);\r\n\t},\r\n\t\r\n\t_checkHoriOverflow: function(){\r\n\t\tvar Z = this,\r\n\t\t\tcontentWidth = Z.getTotalWidth();\r\n\r\n\t\tif(Z._hideHead) {\r\n\t\t\tZ._isHoriOverflow = contentWidth > jQuery(Z.rightContentTbl.parentNode.parentNode).innerWidth();\r\n\t\t} else {\r\n\t\t\tZ._isHoriOverflow = contentWidth > Z.rightHeadTbl.parentNode.parentNode.clientWidth;\r\n\t\t}\r\n\t\tZ._calcAndSetContentHeight();\r\n\t},\r\n\t\r\n\t_refreshHeadCell: function(fldName) {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el), oth = null, cobj;\r\n\t\tjqEl.find('.jl-tbl-header-cell').each(function(index, value){\r\n\t\t\tcobj = this.jsletColCfg;\r\n\t\t\tif(cobj && cobj.field == fldName) {\r\n\t\t\t\toth = this;\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t});\r\n\t\tif(!oth) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar fldObj = Z._dataset.getField(cobj.field);\r\n\t\tcobj.label = fldObj.label();\r\n\t\tvar ochild = oth.childNodes[0];\r\n\t\tvar cellRender = cobj.cellRender || Z._defaultCellRender;\r\n\t\tif (cellRender && cellRender.createHeader) {\r\n\t\t\tochild.html('');\r\n\t\t\tcellRender.createHeader.call(Z, ochild, cobj);\r\n\t\t} else {\r\n\t\t\tvar sh = cobj.label || '&nbsp;';\r\n\t\t\tif(cobj.field && Z._isCellEditable(cobj)) {\r\n\t\t\t\tif(fldObj && fldObj.required()) {\r\n\t\t\t\t\tsh = '<span class=\"jl-lbl-required\">*</span>' + sh;\r\n\t\t\t\t}\r\n\t\t\t} \r\n\t\t\tjQuery(oth).find('.jl-focusable-item').html(sh);\r\n\t\t}\r\n\t},\r\n\t\r\n\t_createHeadCell: function (otr, cobj) {\r\n\t\tvar Z = this,\r\n\t\t\trowSpan = 0, colSpan = 0;\r\n\t\t\r\n\t\tif (!cobj.subHeads) {\r\n\t\t\trowSpan = Z.maxHeadRows - (cobj.level ? cobj.level: 0);\r\n\t\t} else {\r\n\t\t\tcolSpan = cobj.colSpan;\r\n\t\t}\r\n\t\tvar oth = document.createElement('th');\r\n\t\toth.className = 'jl-tbl-header-cell jl-unselectable';\r\n\t\toth.noWrap = true;\r\n\t\toth.jsletColCfg = cobj;\r\n\t\tif (rowSpan && rowSpan > 1) {\r\n\t\t\toth.rowSpan = rowSpan;\r\n\t\t}\r\n\t\tif (colSpan && colSpan > 1) {\r\n\t\t\toth.colSpan = colSpan;\r\n\t\t}\r\n\t\toth.innerHTML = '<div style=\"position: relative\" unselectable=\"on\" class=\"jl-unselectable jl-tbl-header-div jl-border-box ' + \r\n\t\t\t(cobj.widthCssName || '') +'\">';\r\n\t\tvar ochild = oth.childNodes[0];\r\n\t\tvar cellRender = cobj.cellRender || Z._defaultCellRender;\r\n\t\tif (cellRender && cellRender.createHeader) {\r\n\t\t\tcellRender.createHeader.call(Z, ochild, cobj);\r\n\t\t} else {\r\n\t\t\tvar sh = cobj.label || '&nbsp;';\r\n\t\t\tif(cobj.field && Z._isCellEditable(cobj)) {\r\n\t\t\t\tvar fldObj = Z._dataset.getField(cobj.field);\r\n\t\t\t\tif(fldObj && fldObj.required()) {\r\n\t\t\t\t\tsh = '<span class=\"jl-lbl-required\">*</span>' + sh;\r\n\t\t\t\t}\r\n\t\t\t} \r\n\t\t\tochild.innerHTML = [\r\n\t\t\t    Z._hasFilterDialog ? '<button class=\"jl-tbl-filter\"><i class=\"fa fa-filter\"></i></button>': '',\r\n\t\t\t    '<span id=\"',\r\n\t\t\t\tcobj.id, \r\n\t\t\t\t'\" unselectable=\"on\" style=\"width:100%;padding:0px 2px\">',\r\n\t\t\t\t((!Z._disableHeadSort && !cobj.disableHeadSort) ? '<span class=\"jl-focusable-item\" draggable=\"true\">' + sh +'</span>': sh),\r\n\t\t\t\t'</span><span unselectable=\"on\" class=\"jl-tbl-sorter\" title=\"',\r\n\t\t\t\tjslet.locale.DBTable.sorttitle,\r\n\t\t\t\t'\">&nbsp;</span><div  unselectable=\"on\" class=\"jl-tbl-splitter-hook\" colid=\"',\r\n\t\t\t\tcobj.colNum,\r\n\t\t\t\t'\">&nbsp;</div>'].join('');\r\n\t\t}\r\n\t\totr.appendChild(oth);\t\r\n\t}, // end _createHeadCell\r\n\r\n\t_renderHeader: function () {\r\n\t\tvar Z = this;\r\n\t\tif (Z._hideHead) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar otr, otrLeft = null, cobj, otrRight, otd, oth,\r\n\t\t\tleftHeadObj = Z.leftHeadTbl.createTHead(),\r\n\t\t\trightHeadObj = Z.rightHeadTbl.createTHead();\r\n\t\tfor(var i = 0; i < Z.maxHeadRows; i++){\r\n\t\t\tleftHeadObj.insertRow(-1);\r\n\t\t\trightHeadObj.insertRow(-1);\r\n\t\t}\r\n\t\totr = leftHeadObj.rows[0];\r\n\t\tfor(var i = 0, cnt = Z._sysColumns.length; i < cnt; i++){\r\n\t\t\tcobj = Z._sysColumns[i];\r\n\t\t\tcobj.rowSpan = Z.maxHeadRows;\r\n\t\t\tZ._createHeadCell(otr, cobj);\r\n\t\t}\r\n\t\tfunction travHead(arrHeadCfg){\r\n\t\t\tvar cobj, otr;\r\n\t\t\tfor(var m = 0, ccnt = arrHeadCfg.length; m < ccnt; m++){\r\n\t\t\t\tcobj = arrHeadCfg[m];\r\n\t\t\t\tif (cobj.colNum < Z._fixedCols) {\r\n\t\t\t\t\totr = leftHeadObj.rows[cobj.level];\r\n\t\t\t\t} else {\r\n\t\t\t\t\totr = rightHeadObj.rows[cobj.level];\r\n\t\t\t\t}\r\n\t\t\t\tZ._createHeadCell(otr, cobj);\r\n\t\t\t\tif (cobj.subHeads) {\r\n\t\t\t\t\ttravHead(cobj.subHeads);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\ttravHead(Z.innerHeads);\r\n\t\tvar jqTr1, jqTr2, h= Z._headRowHeight;\r\n\t\tfor(var i = 0; i <= Z.maxHeadRows; i++){\r\n\t\t\tjqTr1 = jQuery(leftHeadObj.rows[i]);\r\n\t\t\tjqTr2 = jQuery(rightHeadObj.rows[i]);\r\n\t\t\tjqTr1.height(h);\r\n\t\t\tjqTr2.height(h);\r\n\t\t}\r\n\t\tZ.sortedCell = null;\r\n\t\tZ.indexField = null;\r\n\t}, // end renderHead\r\n\r\n\tgetTotalWidth: function(isLeft){\r\n\t\tvar Z= this,\r\n\t\ttotalWidth = 0;\r\n\t\tif(!isLeft) {\r\n\t\t\tfor(var i = Z._fixedCols, cnt = Z.innerColumns.length; i < cnt; i++){\r\n\t\t\t\ttotalWidth += Z.innerColumns[i].width;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tfor(var i = 0, cnt = Z._sysColumns.length; i < cnt; i++){\r\n\t\t\t\ttotalWidth += Z._sysColumns[i].width;\r\n\t\t\t}\r\n\t\t\tfor(var i = 0, cnt = Z._fixedCols; i < cnt; i++){\r\n\t\t\t\ttotalWidth += Z.innerColumns[i].width;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn totalWidth;\r\n\t},\r\n\t\r\n\t_doSplitHookDown: function (event) {\r\n\t\tevent = jQuery.event.fix( event || window.event );\r\n\t\tvar ohook = event.target;\r\n\t\tif (ohook.className != 'jl-tbl-splitter-hook') {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar tblContainer = jslet.ui.findFirstParent(ohook, function (el) {\r\n\t\t\treturn el.tagName.toLowerCase() == 'div' && el.jslet && el.jslet._dataset;\r\n\t\t});\r\n\t\tvar jqTblContainer = jQuery(tblContainer);\r\n\t\t\r\n\t\tvar jqBody = jQuery(document.body); \r\n\t\tvar bodyMTop = parseInt(jqBody.css('margin-top'));\r\n\t\tvar bodyMleft = parseInt(jqBody.css('margin-left'));\r\n\t\tvar y = jqTblContainer.position().top - bodyMTop;\r\n\t\tvar jqHook = jQuery(ohook);\r\n\t\tvar h = jqTblContainer.height() - 20;\r\n\t\tvar currLeft = jqHook.offset().left - jqTblContainer.offset().left - bodyMleft;\r\n\t\tvar splitDiv = jqTblContainer.find('.jl-tbl-splitter')[0];\r\n\t\tsplitDiv.style.left = currLeft + 'px';\r\n\t\tsplitDiv.style.top = '1px';\r\n\t\tsplitDiv.style.height = h + 'px';\r\n\t\tjslet.ui.dnd.bindControl(splitDiv);\r\n\t\ttblContainer.jslet.currColId = parseInt(jqHook.attr('colid'));\r\n\t\ttblContainer.jslet.isDraggingColumn = true;\r\n\t},\r\n\r\n\t_doSplitHookUp: function (event) {\r\n\t\tevent = jQuery.event.fix( event || window.event );\r\n\t\tvar ohook = event.target.lastChild;\r\n\t\tif (!ohook || ohook.className != 'jl-tbl-splitter-hook') {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar tblContainer = jslet.ui.findFirstParent(ohook, function (el) {\r\n\t\t\treturn el.tagName.toLowerCase() == 'div' && el.jslet && el.jslet._dataset;\r\n\t\t});\r\n\r\n\t\tvar jqTblContainer = jQuery(tblContainer),\r\n\t\t\tjqBody = jQuery(document.body); \r\n\t\tjqBody.css('cursor','auto');\r\n\r\n\t\tvar splitDiv = jqTblContainer.find('.jl-tbl-splitter')[0];\r\n\t\tif (splitDiv.style.display != 'none') {\r\n\t\t\tsplitDiv.style.display = 'none';\r\n\t\t}\r\n\t\ttblContainer.jslet.isDraggingColumn = false;\r\n\t},\r\n\r\n\t_getColumnByField: function (fieldName) {\r\n\t\tvar Z = this;\r\n\t\tif (!Z.innerColumns) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tvar cobj;\r\n\t\tfor (var i = 0, cnt = Z.innerColumns.length; i < cnt; i++) {\r\n\t\t\tcobj = Z.innerColumns[i];\r\n\t\t\tif (cobj.field == fieldName) {\r\n\t\t\t\treturn cobj;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t},\r\n\r\n\t_doHeadClick: function (colCfg, ctrlKeyPressed) {\r\n\t\tvar Z = this;\r\n\t\tif (Z._disableHeadSort || colCfg.disableHeadSort || Z.isDraggingColumn) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tZ._doSort(colCfg.field, ctrlKeyPressed);\r\n\t}, // end _doHeadClick\r\n\r\n\t_doSort: function (sortField, isMultiSort) {\r\n\t\tvar Z = this;\r\n\t\tZ._dataset.confirm();\r\n\t\tZ._dataset.disableControls();\r\n\t\ttry {\r\n\t\t\tif (!Z._onCustomSort) {\r\n\t\t\t\tZ._dataset.toggleIndexField(sortField, !isMultiSort);\r\n\t\t\t} else {\r\n\t\t\t\tZ._onCustomSort.call(Z, sortField);\r\n\t\t\t}\r\n\t\t\tZ.listvm.refreshModel();\r\n\t\t} finally {\r\n\t\t\tZ._dataset.enableControls();\r\n\t\t}\r\n\t},\r\n\r\n\t_updateSortFlag: function () {\r\n\t\tvar Z = this;\r\n\t\tif (Z._hideHead) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar sortFields = Z._dataset.mergedIndexFields();\r\n\t\t\r\n\t\tvar leftHeadObj = Z.leftHeadTbl.createTHead(),\r\n\t\t\trightHeadObj = Z.rightHeadTbl.createTHead(),\r\n\t\t\tleftHeadCells = leftHeadObj.rows[0].cells,// jQuery(leftHeadObj).find('th'),\r\n\t\t\trightHeadCells =  rightHeadObj.rows[0].cells,// jQuery(rightHeadObj).find('th'),\r\n\t\t\tallHeadCells = [], oth;\r\n\r\n\t\tfor (var i = 0, cnt = leftHeadCells.length; i < cnt; i++){\r\n\t\t\toth = leftHeadCells[i];\r\n\t\t\tif (oth.jsletColCfg) {\r\n\t\t\t\tallHeadCells[allHeadCells.length] = oth;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor (var i = 0, cnt = rightHeadCells.length; i < cnt; i++){\r\n\t\t\toth = rightHeadCells[i];\r\n\t\t\tif (oth.jsletColCfg) {\r\n\t\t\t\tallHeadCells[allHeadCells.length] = oth;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar len = sortFields.length, sortDiv, \r\n\t\t\tcellCnt = allHeadCells.length;\r\n\t\tfor (var i = 0; i < cellCnt; i++) {\r\n\t\t\toth = allHeadCells[i];\r\n\t\t\tsortDiv = jQuery(oth).find('.jl-tbl-sorter')[0];\r\n\t\t\tif (sortDiv) {\r\n\t\t\t\tsortDiv.innerHTML = '&nbsp;';\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar fldName, sortFlag, sortObj, \r\n\t\t\tk = 1;\r\n\t\tfor (var i = 0; i < len; i++) {\r\n\t\t\tsortObj = sortFields[i];\r\n\t\t\tfor (var j = 0; j < cellCnt; j++) {\r\n\t\t\t\toth = allHeadCells[j];\r\n\t\t\t\tfldName = oth.jsletColCfg.field;\r\n\t\t\t\tif (!fldName) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tsortDiv = jQuery(oth).find('.jl-tbl-sorter')[0];\r\n\t\t\t\tsortFlag = '&nbsp;';\r\n\t\t\t\tif (fldName == sortObj.fieldName) {\r\n\t\t\t\t\tsortFlag = sortObj.order === 1 ? jslet.ui.htmlclass.TABLECLASS.sortAscChar : jslet.ui.htmlclass.TABLECLASS.sortDescChar;\r\n\t\t\t\t\tif (len > 1) {\r\n\t\t\t\t\t\tsortFlag += k++;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tsortDiv.innerHTML = sortFlag;\r\n\t\t\tif (!oth) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t_doSelectBoxClick: function (event) {\r\n\t\tvar ocheck = null;\r\n\t\tif (event){\r\n\t\t\tevent = jQuery.event.fix( event || window.event );\r\n\t\t\tocheck = event.target;\r\n\t\t} else {\r\n\t\t\tocheck = this;\r\n\t\t}\r\n\t\tvar otr = jslet.ui.getParentElement(ocheck, 2);\r\n\t\ttry {\r\n\t\t\tjQuery(otr).click();// tr click\r\n\t\t} finally {\r\n\t\t\tvar otable = jslet.ui.findFirstParent(otr, function (node) {\r\n\t\t\t\treturn node.jslet? true: false;\r\n\t\t\t});\r\n\t\t\tvar oJslet = otable.jslet;\r\n\r\n\t\t\tif (oJslet._onSelect) {\r\n\t\t\t\tvar flag = oJslet._onSelect.call(oJslet, ocheck.checked);\r\n\t\t\t\tif (flag !== undefined && !flag) {\r\n\t\t\t\t\tocheck.checked = !ocheck.checked;\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\toJslet._dataset.select(ocheck.checked ? 1 : 0, oJslet._selectBy);\r\n\t\t}\r\n\t}, // end _doSelectBoxClick\r\n\r\n\t_doCellClick: function () {\r\n\t\tvar Z = this;\r\n\t\tif (Z._onCellClick) {\r\n\t\t\tvar colNum = Z._currColNum;\r\n\t\t\tZ._onCellClick.call(Z, Z.innerColumns[colNum]);\r\n\t\t}\r\n\t},\r\n\t\r\n\t_doRowDblClick: function (event) {\r\n\t\tvar otable = jslet.ui.findFirstParent(this, function (node) {\r\n\t\t\treturn node.jslet? true: false;\r\n\t\t});\r\n\r\n\t\tvar Z = otable.jslet;\r\n\t\tif (Z._onRowDblClick) {\r\n\t\t\tZ._onRowDblClick.call(Z, event);\r\n\t\t}\r\n\t},\r\n\r\n\t_doRowClick: function (event) {\r\n\t\tvar otable = jslet.ui.findFirstParent(this, function (node) {\r\n\t\t\treturn node.jslet ? true: false;\r\n\t\t});\r\n\r\n\t\tvar Z = otable.jslet;\r\n\t\tvar dataset = Z.dataset();\r\n\t\tif(dataset.status() && (this.jsletrecno !== dataset.recno())) {\r\n\t\t\tdataset.confirm();\r\n\t\t}\r\n\r\n\t\tvar rowno = Z.listvm.recnoToRowno(this.jsletrecno);\r\n\t\tZ.listvm.setCurrentRowno(rowno);\r\n\t\tZ._dataset.recno(Z.listvm.getCurrentRecno())\r\n\t\tif (Z._onRowClick) {\r\n\t\t\tZ._onRowClick.call(Z, event);\r\n\t\t}\r\n\t},\r\n\r\n\t_renderCell: function (otr, colCfg, isFirstCol) {\r\n\t\tvar Z = this;\r\n\t\tvar otd = document.createElement('td');\r\n\t\totd.noWrap = true;\r\n\t\totd.jsletColCfg = colCfg;\r\n\t\tjQuery(otd).addClass('jl-tbl-cell');\r\n\t\totd.innerHTML = '<div class=\"jl-tbl-cell-div ' + (colCfg.widthCssName || '') + '\"></div>';\r\n\t\tvar ochild = otd.firstChild;\r\n\t\tvar cellRender = colCfg.cellRender || Z._defaultCellRender;\r\n\t\tif (cellRender && cellRender.createCell) {\r\n\t\t\tcellRender.createCell.call(Z, ochild, colCfg);\r\n\t\t} else if (!Z._isCellEditable(colCfg)) {\r\n\t\t\t\tjslet.ui.DBTable.defaultCellRender.createCell.call(Z, ochild, colCfg);\r\n\t\t\t\tcolCfg.editable = false;\r\n\t\t} else {\r\n\t\t\t\tjslet.ui.DBTable.editableCellRender.createCell.call(Z, ochild, colCfg);\r\n\t\t\t\tcolCfg.editable = true;\r\n\t\t}\r\n\t\totr.appendChild(otd);\r\n\t},\r\n\r\n\t_renderRow: function (sectionNum, onlyRefreshContent) {\r\n\t\tvar Z = this;\r\n\t\tvar rowCnt = 0, leftBody = null, rightBody,\r\n\t\t\thasLeft = Z._fixedCols > 0 || Z._sysColumns.length > 0;\r\n\t\tswitch (sectionNum) {\r\n\t\t\tcase 1:\r\n\t\t\t\t{//fixed data\r\n\t\t\t\t\trowCnt = Z._fixedRows;\r\n\t\t\t\t\tif (hasLeft) {\r\n\t\t\t\t\t\tleftBody = Z.leftFixedTbl.tBodies[0];\r\n\t\t\t\t\t}\r\n\t\t\t\t\trightBody = Z.rightFixedTbl.tBodies[0];\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\tcase 2:\r\n\t\t\t\t{//data content\r\n\t\t\t\t\trowCnt = Z.listvm.getVisibleCount();\r\n\t\t\t\t\tif (hasLeft) {\r\n\t\t\t\t\t\tleftBody = Z.leftContentTbl.tBodies[0];\r\n\t\t\t\t\t}\r\n\t\t\t\t\trightBody = Z.rightContentTbl.tBodies[0];\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t}\r\n\t\tvar otr, oth, colCfg, isfirstCol, \r\n\t\t\tstartRow = 0,\r\n\t\t\tfldCnt = Z.innerColumns.length;\r\n\t\tif (onlyRefreshContent){\r\n\t\t\tstartRow = rightBody.rows.length;\r\n\t\t}\r\n\t\t// create date content table row\r\n\t\tfor (var i = startRow; i < rowCnt; i++) {\r\n\t\t\tif (hasLeft) {\r\n\t\t\t\totr = leftBody.insertRow(-1);\r\n\t\t\t\totr.style.height = Z._rowHeight + 'px';\r\n\r\n\t\t\t\totr.ondblclick = Z._doRowDblClick;\r\n\t\t\t\totr.onclick = Z._doRowClick;\r\n\t\t\t\tvar sysColLen = Z._sysColumns.length;\r\n\t\t\t\tfor(var j = 0; j < sysColLen; j++){\r\n\t\t\t\t\tcolCfg = Z._sysColumns[j];\r\n\t\t\t\t\tZ._renderCell(otr, colCfg, j === 0);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tisfirstCol = sysColLen === 0;\r\n\t\t\t\tfor (var j = 0; j < Z._fixedCols; j++) {\r\n\t\t\t\t\tcolCfg = Z.innerColumns[j];\r\n\t\t\t\t\tZ._renderCell(otr, colCfg, isfirstCol && j === 0);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tisfirstCol = !hasLeft;\r\n\t\t\totr = rightBody.insertRow(-1);\r\n\t\t\totr.style.height = Z._rowHeight + 'px';\r\n\t\t\totr.ondblclick = Z._doRowDblClick;\r\n\t\t\totr.onclick = Z._doRowClick;\r\n\t\t\tfor (var j = Z._fixedCols; j < fldCnt; j++) {\r\n\t\t\t\tcolCfg = Z.innerColumns[j];\r\n\t\t\t\tZ._renderCell(otr, colCfg, j == Z._fixedCols);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t_renderBody: function (onlyRefreshContent) {\r\n\t\tvar Z = this;\r\n\t\tif (onlyRefreshContent){\r\n\t\t\tZ._renderRow(2, true);\r\n\t\t} else {\r\n\t\t\tZ._renderRow(1);\r\n\t\t\tZ._renderRow(2);\r\n\t\t\tZ._renderTotalSection();\r\n\t\t}\r\n\t}, // end _renderBody\r\n\r\n\t_renderTotalSection: function() {\r\n\t\tvar Z = this;\r\n\t\tif (!Z.footSectionHt) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar hasLeft = Z._fixedCols > 0 || Z._sysColumns.length > 0,\r\n\t\t\tleftBody,\r\n\t\t\trightBody,\r\n\t\t\totr, colCfg;\r\n\t\tif (hasLeft) {\r\n\t\t\tleftBody = Z.leftFootTbl.tBodies[0];\r\n\t\t}\r\n\t\trightBody = Z.rightFootTbl.tBodies[0];\r\n\t\t\r\n\t\tfunction createCell(colCfg) {\r\n\t\t\tvar otd = document.createElement('td');\r\n\t\t\totd.noWrap = true;\r\n\t\t\totd.innerHTML = '<div class=\"jl-tbl-footer-div ' + (colCfg.widthCssName || '') + '\"></div>';\r\n\t\t\totd.jsletColCfg = colCfg;\r\n\t\t\treturn otd;\r\n\t\t}\r\n\t\t\r\n\t\tif (hasLeft) {\r\n\t\t\totr = leftBody.insertRow(-1);\r\n\t\t\totr.style.height = Z._rowHeight + 'px';\r\n\r\n\t\t\tfor(var j = 0, len = Z._sysColumns.length; j < len; j++) {\r\n\t\t\t\tcolCfg = Z._sysColumns[j];\r\n\t\t\t\totr.appendChild(createCell(colCfg));\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tfor (var j = 0; j < Z._fixedCols; j++) {\r\n\t\t\t\tcolCfg = Z.innerColumns[j];\r\n\t\t\t\totr.appendChild(createCell(colCfg));\r\n\t\t\t}\r\n\t\t}\r\n\t\totr = rightBody.insertRow(-1);\r\n\t\totr.style.height = Z._rowHeight + 'px';\r\n\t\tfor (var j = Z._fixedCols, len = Z.innerColumns.length; j < len; j++) {\r\n\t\t\tcolCfg = Z.innerColumns[j];\r\n\t\t\totr.appendChild(createCell(colCfg));\r\n\t\t}\r\n\t\t\r\n\t},\r\n\t\r\n\t_fillTotalSection: function () {\r\n\t\tvar Z = this,\r\n\t\t\taggradeValues = Z._dataset.aggradedValues();\r\n\t\tif (!Z.footSectionHt || !aggradeValues) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar sysColCnt = Z._sysColumns.length,\r\n\t\t\thasLeft = Z._fixedCols > 0 || sysColCnt > 0,\r\n\t\t\totrLeft, otrRight;\r\n\t\tif (hasLeft) {\r\n\t\t\totrLeft = Z.leftFootTbl.tBodies[0].rows[0];\r\n\t\t}\r\n\t\totrRight = Z.rightFootTbl.tBodies[0].rows[0];\r\n\r\n\t\tvar otd, k = 0, fldObj, cobj, fldName, totalValue;\r\n\t\tvar aggradeValueObj,\r\n\t\t\tlabelDisplayed = false,\r\n\t\t\tcanShowLabel = true;\r\n\t\tif(sysColCnt > 0) {\r\n\t\t\totd = otrLeft.cells[sysColCnt - 1];\r\n\t\t\totd.innerHTML = jslet.locale.DBTable.totalLabel;\r\n\t\t\tcanShowLabel = false;\r\n\t\t}\r\n\t\tfor (var i = 0, len = Z.innerColumns.length; i < len; i++) {\r\n\t\t\tcobj = Z.innerColumns[i];\r\n\r\n\t\t\tif (i < Z._fixedCols) {\r\n\t\t\t\totd = otrLeft.cells[i + sysColCnt];\r\n\t\t\t} else {\r\n\t\t\t\totd = otrRight.cells[i - Z._fixedCols];\r\n\t\t\t}\r\n\t\t\totd.style.textAlign = 'right';\r\n\r\n\t\t\tfldName = cobj.field;\r\n\t\t\taggradeValueObj = aggradeValues[fldName];\r\n\t\t\tif (!aggradeValueObj) {\r\n\t\t\t\tif(canShowLabel) {\r\n\t\t\t\t\tvar content;\r\n\t\t\t\t\tif(labelDisplayed) {\r\n\t\t\t\t\t\tcontent = '&nbsp;';\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tcontent = jslet.locale.DBTable.totalLabel;\r\n\t\t\t\t\t\tlabelDisplayed = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\totd.firstChild.innerHTML = content;\r\n\t\t\t\t}\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tcanShowLabel = false;\r\n\t\t\tfldObj = Z._dataset.getField(fldName);\r\n\t\t\tif(fldObj.getType() === jslet.data.DataType.NUMBER) {\r\n\t\t\t\ttotalValue = aggradeValueObj.sum;\r\n\t\t\t} else {\r\n\t\t\t\ttotalValue = aggradeValueObj.count;\r\n\t\t\t}\r\n\t\t\tvar displayValue = totalValue? jslet.formatNumber(totalValue, fldObj.displayFormat()) : '';\r\n\t\t\totd.firstChild.innerHTML = displayValue;\r\n\t\t\totd.firstChild.title = displayValue;\r\n\t\t}\r\n\t},\r\n\t\r\n\t_fillData: function () {\r\n\t\tvar Z = this;\r\n\t\tvar preRecno = Z._dataset.recno(),\r\n\t\t\tallCnt = Z.listvm.getNeedShowRowCount(),\r\n\t\t\th = allCnt * Z._rowHeight + Z.footSectionHt;\r\n\t\tZ._setScrollBarMaxValue(h);\r\n\t\tZ.noRecordDiv.style.display = (allCnt === 0 ?'block':'none');\r\n\t\tvar oldRecno = Z._dataset.recnoSilence();\r\n\t\ttry {\r\n\t\t\tZ._fillRow(true);\r\n\t\t\tZ._fillRow(false);\r\n\t\t\tif (Z.footSectionHt) {\r\n\t\t\t\tZ._fillTotalSection();\r\n\t\t\t}\r\n\t\t} finally {\r\n\t\t\tZ._dataset.recnoSilence(oldRecno);\r\n\t\t}\r\n\t\tZ._refreshSeqColWidth();\r\n\t},\r\n\r\n\t_fillRow: function (isFixed) {\r\n\t\tvar Z = this,\r\n\t\t\trowCnt = 0, start = 0, leftBody = null, rightBody,\r\n\t\t\thasLeft = Z._fixedCols > 0 || Z._sysColumns.length > 0;\r\n\t\t\t\r\n\t\tif (isFixed) {\r\n\t\t\trowCnt = Z._fixedRows;\r\n\t\t\tstart = -1 * Z._fixedRows;\r\n\t\t\tif (rowCnt === 0) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif (hasLeft) {\r\n\t\t\t\tleftBody = Z.leftFixedTbl.tBodies[0];\r\n\t\t\t}\r\n\t\t\trightBody = Z.rightFixedTbl.tBodies[0];\r\n\t\t} else {\r\n\t\t\trowCnt = Z.listvm.getVisibleCount();\r\n\t\t\tstart = Z.listvm.getVisibleStartRow();\r\n\t\t\tif (hasLeft) {\r\n\t\t\t\tleftBody = Z.leftContentTbl.tBodies[0];\r\n\t\t\t}\r\n\t\t\trightBody = Z.rightContentTbl.tBodies[0];\r\n\t\t}\r\n\t\t\r\n\t\tvar otr, colCfg, isfirstCol, recNo = -1, cells, clen, otd,\r\n\t\t\tfldCnt = Z.innerColumns.length,\r\n\t\t\tallCnt = Z.listvm.getNeedShowRowCount() - Z.listvm.getVisibleStartRow(),\r\n\t\t\tfixedRows = hasLeft ? leftBody.rows : null,\r\n\t\t\tcontentRows = rightBody.rows,\r\n\t\t\tsameValueNodes = {},\r\n\t\t\tisFirst = true,\r\n\t\t\tactualCnt = Math.min(contentRows.length, rowCnt);\r\n\r\n\t\tfor (var i = 0; i < actualCnt ; i++) {\r\n\t\t\tif (i >= allCnt) {\r\n\t\t\t\tif (hasLeft) {\r\n\t\t\t\t\totr = fixedRows[i];\r\n\t\t\t\t\totr.style.display = 'none';\r\n\t\t\t\t}\r\n\t\t\t\totr = contentRows[i];\r\n\t\t\t\totr.style.display = 'none';\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tZ.listvm.setCurrentRowno(i + start, true);\r\n\t\t\trecNo = Z.listvm.getCurrentRecno();\r\n\t\t\tZ._dataset.recnoSilence(recNo);\r\n\t\t\tif (hasLeft) {\r\n\t\t\t\totr = fixedRows[i];\r\n\t\t\t\totr.jsletrecno = recNo;\r\n\t\t\t\totr.style.display = '';\r\n\t\t\t\tif (Z._onFillRow) {\r\n\t\t\t\t\tZ._onFillRow.call(Z, otr, Z._dataset);\r\n\t\t\t\t}\r\n\t\t\t\tcells = otr.childNodes;\r\n\t\t\t\tclen = cells.length;\r\n\t\t\t\tfor (var j = 0; j < clen; j++) {\r\n\t\t\t\t\totd = cells[j];\r\n\t\t\t\t\tZ._fillCell(recNo, otd, sameValueNodes, isFirst);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\totr = contentRows[i];\r\n\t\t\totr.jsletrecno = recNo;\r\n\t\t\totr.style.display = '';\r\n\t\t\tif (Z._onFillRow) {\r\n\t\t\t\tZ._onFillRow.call(Z, otr, Z._dataset);\r\n\t\t\t}\r\n\t\t\t// fill content table\r\n\t\t\totr = contentRows[i];\r\n\t\t\tcells = otr.childNodes;\r\n\t\t\tclen = cells.length;\r\n\t\t\tfor (var j = 0; j < clen; j++) {\r\n\t\t\t\totd = cells[j];\r\n\t\t\t\tZ._fillCell(recNo, otd, sameValueNodes, isFirst);\r\n\t\t\t} //end for data content field\r\n\t\t\tisFirst = 0;\r\n\t\t} //end for records\r\n\t},\r\n\r\n\t_fillCell: function (recNo, otd, sameValueNodes, isFirst) {\r\n\t\tvar Z = this,\r\n\t\tcolCfg = otd.jsletColCfg;\r\n\t\tif (!colCfg)\r\n\t\t\treturn;\r\n\t\tvar fldName = colCfg.field,\r\n\t\t\tcellPanel = otd.firstChild;\r\n\t\t\r\n\t\tif (Z._onFillCell) {\r\n\t\t\tZ._onFillCell.call(Z, cellPanel, Z._dataset, fldName);\r\n\t\t}\r\n\t\tif (fldName && colCfg.mergeSame && sameValueNodes) {\r\n\t\t\tif (isFirst || !Z._dataset.isSameAsPrevious(fldName)) {\r\n\t\t\t\tsameValueNodes[fldName] = { cell: otd, count: 1 };\r\n\t\t\t\tjQuery(otd).attr('rowspan', 1);\r\n\t\t\t\totd.style.display = '';\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tvar sameNode = sameValueNodes[fldName];\r\n\t\t\t\tsameNode.count++;\r\n\t\t\t\totd.style.display = 'none';\r\n\t\t\t\tjQuery(sameNode.cell).attr('rowspan', sameNode.count);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar cellRender = colCfg.cellRender || Z._defaultCellRender;\r\n\t\tif (cellRender && cellRender.refreshCell) {\r\n\t\t\tcellRender.refreshCell.call(Z, cellPanel, colCfg, recNo);\r\n\t\t} else if (!colCfg.editable) {\r\n\t\t\tjslet.ui.DBTable.defaultCellRender.refreshCell.call(Z, cellPanel, colCfg, recNo);\r\n\t\t} else {\r\n\t\t\tjslet.ui.DBTable.editableCellRender.refreshCell.call(Z, cellPanel, colCfg, recNo);\r\n\t\t}\r\n\t},\r\n\r\n\trefreshCurrentRow: function () {\r\n\t\tvar Z = this,\r\n\t\t\thasLeft = Z._fixedCols > 0 || Z._hasSeqCol || Z._hasSelectCol,\r\n\t\t\tfixedBody = null, contentBody, idx,\r\n\t\t\trecno = Z._dataset.recno();\r\n\r\n\t\tif (recno < Z._fixedRows) {\r\n\t\t\tif (hasLeft) {\r\n\t\t\t\tfixedBody = Z.leftFixedTbl.tBodies[0];\r\n\t\t\t}\r\n\t\t\tcontentBody = Z.rightFixedTbl.tBodies[0];\r\n\t\t\tidx = recno;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tif (hasLeft) {\r\n\t\t\t\tfixedBody = Z.leftContentTbl.tBodies[0];\r\n\t\t\t}\r\n\t\t\tcontentBody = Z.rightContentTbl.tBodies[0];\r\n\t\t\tidx = Z.listvm.recnoToRowno(Z._dataset.recno()) - Z.listvm.getVisibleStartRow();\r\n\t\t}\r\n\r\n\t\tvar otr, cells, otd, recNo, colCfg;\r\n\r\n\t\tif (hasLeft) {\r\n\t\t\totr = fixedBody.rows[idx];\r\n\t\t\tif (!otr) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tcells = otr.childNodes;\r\n\t\t\trecNo = otr.jsletrecno;\r\n\t\t\tif (Z._onFillRow) {\r\n\t\t\t\tZ._onFillRow.call(Z, otr, Z._dataset);\r\n\t\t\t}\r\n\t\t\tfor (var j = 0, clen = cells.length; j < clen; j++) {\r\n\t\t\t\totd = cells[j];\r\n\t\t\t\tcolCfg = otd.jsletColCfg;\r\n\t\t\t\tif (colCfg && colCfg.isSeqCol) {\r\n\t\t\t\t\totd.firstChild.innerHTML = recno + 1;\r\n\t\t\t\t\tif(Z._dataset.existRecordError(recno)) {\r\n\t\t\t\t\t\tjQuery(otd).addClass('has-error');\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tjQuery(otd).removeClass('has-error');\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tif (colCfg && colCfg.isSelectCol) {\r\n\t\t\t\t\tocheck = otd.firstChild;\r\n\t\t\t\t\tocheck.checked = Z._dataset.selected();\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tZ._fillCell(recNo, otd);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\totr = contentBody.rows[idx];\r\n\t\tif (!otr) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\trecNo = otr.jsletrecno;\r\n\t\tif (Z._onFillRow) {\r\n\t\t\tZ._onFillRow.call(Z, otr, Z._dataset);\r\n\t\t}\r\n\t\t// fill content table\r\n\t\tcells = otr.childNodes;\r\n\t\tfor (var j = 0, clen = cells.length; j < clen; j++) {\r\n\t\t\totd = cells[j];\r\n\t\t\tZ._fillCell(recNo, otd);\r\n\t\t}\r\n\t},\r\n\r\n\t_getLeftRowByRecno: function (recno) {\r\n\t\tvar Z = this;\r\n\t\tif (recno < Z._fixedRows) {\r\n\t\t\treturn Z.leftFixedTbl.tBodies[0].rows[recno];\r\n\t\t}\r\n\t\tvar rows = Z.leftContentTbl.tBodies[0].rows, row;\r\n\t\tfor (var i = 0, cnt = rows.length; i < cnt; i++) {\r\n\t\t\trow = rows[i];\r\n\t\t\tif (row.jsletrecno == recno) {\r\n\t\t\t\treturn row;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t}, // end _getLeftRowByRecno\r\n\r\n\t_showCurrentRow: function (checkVisible) {//Check if current row is in visible area\r\n\t\tvar Z = this,\r\n\t\t\trowno = Z.listvm.recnoToRowno(Z._dataset.recno());\r\n\t\tZ.listvm.setCurrentRowno(rowno, false, checkVisible);\r\n\t\tZ._showCurrentCell();\r\n\t},\r\n\r\n\t_getTrByRowno: function (rowno) {\r\n\t\tvar Z = this, \r\n\t\t\thasLeft = Z._fixedCols > 0 || Z._sysColumns.length > 0,\r\n\t\t\tidx, otr, k, rows, row, fixedRow;\r\n\r\n\t\tif (rowno < 0) {//fixed rows\r\n\t\t\trows = Z.rightFixedTbl.tBodies[0].rows;\r\n\t\t\tk = Z._fixedRows + rowno;\r\n\t\t\trow = rows[k];\r\n\t\t\tfixedRow = (hasLeft ? Z.leftFixedTbl.tBodies[0].rows[k] : null);\r\n\t\t\treturn { fixed: fixedRow, content: row };\r\n\t\t}\r\n\t\t//data content\r\n\t\trows = Z.rightContentTbl.tBodies[0].rows;\r\n\t\tk = rowno - Z.listvm.getVisibleStartRow();\r\n\t\tif (k >= 0) {\r\n\t\t\trow = rows[k];\r\n\t\t\tif (!row) {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t\tfixedRow = hasLeft ? Z.leftContentTbl.tBodies[0].rows[k] : null;\r\n\t\t\treturn { fixed: fixedRow, content: row };\r\n\t\t}\r\n\t\treturn null;\r\n\t},\r\n\r\n\t_adjustCurrentCellPos: function(isLeft) {\r\n\t\tvar Z = this;\r\n\t\tif(!Z._readOnly) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar\tjqEl = jQuery(Z.el),\r\n\t\t\tjqContentPanel = jqEl.find('.jl-tbl-contentcol'),\r\n\t\t\tcontentPanel = jqContentPanel[0],\r\n\t\t\toldScrLeft = contentPanel.scrollLeft;\r\n\t\tif(Z._currColNum < Z._fixedCols) { //If current cell is in fixed content area\r\n\t\t\tcontentPanel.scrollLeft = 0;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar borderW = (Z._noborder ? 0: 2);\r\n\t\tif(isLeft) {\r\n\t\t\tif(oldScrLeft === 0) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tvar currColLeft = 0;\r\n\t\t\tfor(var i = Z._fixedCols, len = Z.innerColumns.length; i < Z._currColNum; i++) {\r\n\t\t\t\tcurrColLeft += (Z.innerColumns[i].width + borderW); //\"2\" is the cell border's width(left+right)\r\n\t\t\t}\r\n\t\t\tif(currColLeft < oldScrLeft) {\r\n\t\t\t\tcontentPanel.scrollLeft = currColLeft; \r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tvar containerWidth = jqContentPanel.innerWidth() - 20;\r\n\t\t\tvar contentWidth = jqContentPanel.find('.jl-tbl-content-div').width();\r\n\t\t\tvar scrWidth = 0;\r\n\t\t\tfor(var i = Z.innerColumns.length - 1; i > Z._currColNum; i--) {\r\n\t\t\t\tscrWidth += (Z.innerColumns[i].width + borderW); //\"2\" is the cell border's width(left+right)\r\n\t\t\t}\r\n\t\t\tcurrColLeft = contentWidth - scrWidth - containerWidth;\r\n\t\t\tif(currColLeft > oldScrLeft) {\r\n\t\t\t\tcontentPanel.scrollLeft = (currColLeft >= 0? currColLeft: 0);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t_isCurrCellInView: function() {\r\n\t\tvar Z = this;\r\n\t\tif(!Z._readOnly) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\t\r\n\t\tvar\tjqEl = jQuery(Z.el),\r\n\t\t\tjqContentPanel = jqEl.find('.jl-tbl-contentcol'),\r\n\t\t\tcontentPanel = jqContentPanel[0],\r\n\t\t\tborderW = (Z._noborder ? 0: 2),\r\n\t\t\toldScrLeft = contentPanel.scrollLeft,\r\n\t\t\tcurrColLeft = 0;\r\n\t\tif(Z._currColNum < Z._fixedCols) { //If current cell is in fixed content area\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tfor(var i = Z._fixedCols, len = Z.innerColumns.length; i < Z._currColNum; i++) {\r\n\t\t\tcurrColLeft += (Z.innerColumns[i].width + borderW); //\"2\" is the cell border's width(left+right)\r\n\t\t}\r\n\t\tif(currColLeft < oldScrLeft) {\r\n\t\t\treturn false; \r\n\t\t}\r\n\t\tvar containerWidth = jqContentPanel.innerWidth(),\r\n\t\t\tcontentWidth = jqContentPanel.find('.jl-tbl-content-div').width();\r\n\t\t\tscrWidth = 0;\r\n\t\tfor(var i = Z.innerColumns.length - 1; i > Z._currColNum; i--) {\r\n\t\t\tscrWidth += (Z.innerColumns[i].width + borderW); //\"2\" is the cell border's width(left+right)\r\n\t\t}\r\n\t\tcurrColLeft = contentWidth - scrWidth - containerWidth;\r\n\t\tcurrColLeft = (currColLeft >= 0? currColLeft: 0);\r\n\t\tif(currColLeft > oldScrLeft) {\r\n\t\t\treturn false; \r\n\t\t}\r\n\t\t\r\n\t\treturn true;\r\n\t},\r\n\t\r\n\t_showCurrentCell: function() {\r\n\t\tvar Z = this,\r\n\t\t\totr,\r\n\t\t\trowObj = Z._currRow;\r\n\t\tif(!rowObj || !Z._readOnly) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(Z._currColNum >= Z._fixedCols) {\r\n\t\t\totr = rowObj.content;\r\n\t\t} else {\r\n\t\t\totr = rowObj.fixed;\r\n\t\t}\r\n\t\tvar recno = otr.jsletrecno;\r\n\t\tif(recno !== Z._dataset.recno()) {\r\n    \t\tif(Z.prevCell) {\r\n    \t\t\tZ.prevCell.removeClass('jl-tbl-curr-cell');\r\n    \t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar ocells = otr.cells, otd;\r\n\t\tfor(var i = 0, len = ocells.length; i < len; i++) {\r\n\t\t\totd = ocells[i];\r\n        \tvar colCfg = otd.jsletColCfg;\r\n        \tif(colCfg && colCfg.colNum == Z._currColNum) {\r\n        \t\tif(Z.prevCell) {\r\n        \t\t\tZ.prevCell.removeClass('jl-tbl-curr-cell');\r\n        \t\t}\r\n        \t\tvar jqCell = jQuery(otd);\r\n        \t\tjqCell.addClass('jl-tbl-curr-cell');\r\n        \t\tZ.prevCell = jqCell;\r\n        \t}\r\n\t\t}\r\n\t},\r\n\t\r\n\t_showSelected: function(otd, fldName, recno) {\r\n\t\tvar Z = this,\r\n\t\t\tjqCell = jQuery(otd);\r\n\t\tif(recno === undefined) {\r\n\t\t\trecno = Z._dataset.recno();\r\n\t\t}\r\n\t\tvar isSelected = Z._dataset.selection.isSelected(recno, fldName);\r\n\t\tif(isSelected) {\r\n\t\t\tjqCell.addClass('jl-tbl-selected');\r\n\t\t} else {\r\n\t\t\tjqCell.removeClass('jl-tbl-selected');\r\n\t\t}\r\n\t},\r\n\t\r\n\t_refreshSelection: function() {\r\n\t\tvar Z = this;\r\n\t\tjQuery(Z.el).find('td.jl-tbl-cell').each(function(k, otd){\r\n        \tvar colCfg = otd.jsletColCfg;\r\n        \tvar recno = parseInt(otd.parentNode.jsletrecno);\r\n        \tif((recno || recno === 0) && colCfg) {\r\n        \t\tvar fldName = colCfg.field;\r\n        \t\tif(fldName) {\r\n        \t\t\tZ._showSelected(otd, fldName, recno);\r\n        \t\t}\r\n        \t}\r\n\t\t});\r\n\t},\r\n\t\r\n\t_syncScrollBar: function (rowno) {\r\n\t\tvar Z = this;\r\n\t\tif (Z._keep_silence_) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar\tsw = rowno * Z._rowHeight;\r\n\t\tZ._keep_silence_ = true;\r\n\t\ttry {\r\n\t\t\tvar scrBar = Z.jqVScrollBar[0];\r\n\t\t\tif(scrBar.scrollTop != sw) {\r\n\t\t\t\tscrBar.scrollTop = sw;\r\n\t\t\t}\r\n\t\t} finally {\r\n\t\t\tZ._keep_silence_ = false;\r\n\t\t}\r\n\t},\r\n\r\n\texpandAll: function () {\r\n\t\tvar Z = this;\r\n\t\tZ.listvm.expandAll(function () {\r\n\t\t\tZ._fillData(); \r\n\t\t});\r\n\t},\r\n\r\n\tcollapseAll: function () {\r\n\t\tvar Z = this;\r\n\t\tZ.listvm.collapseAll(function () {\r\n\t\t\tZ._fillData(); \r\n\t\t});\r\n\t},\r\n\r\n\t_doMetaChanged: function(metaName, fldName) {\r\n\t\tvar Z = this;\r\n\t\tif(!fldName) {\r\n\t\t\tZ.renderAll();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(metaName == 'label' && !Z._hideHead) {\r\n\t\t\tZ._refreshHeadCell(fldName);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tif(metaName == 'required' && !Z._readOnly && !Z._hideHead) {\r\n\t\t\tZ._refreshHeadCell(fldName);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif(metaName == 'visible') {\r\n\t\t\t\r\n\t\t}\r\n\t},\r\n\t\r\n\trefreshControl: function (evt) {\r\n\t\tvar Z = this, \r\n\t\t\tevtType = evt.eventType;\r\n\t\tif (evtType == jslet.data.RefreshEvent.CHANGEMETA) {\r\n\t\t\tZ._doMetaChanged(evt.metaName, evt.fieldName);\r\n\t\t} else if (evtType == jslet.data.RefreshEvent.AGGRADED) {\r\n\t\t\tZ._fillTotalSection();\t\t\t\r\n\t\t} else if (evtType == jslet.data.RefreshEvent.BEFORESCROLL) {\r\n\t\t\t\r\n\t\t} else if (evtType == jslet.data.RefreshEvent.SCROLL) {\r\n\t\t\tif (Z._dataset.recordCount() === 0) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tZ._showCurrentRow(true);\r\n\t\t} else if (evtType == jslet.data.RefreshEvent.UPDATEALL) {\r\n\t\t\tZ.listvm.refreshModel();\r\n\t\t\tZ._updateSortFlag(true);\r\n\t\t\tZ._fillData();\r\n\t\t\tZ._showCurrentRow(true);\r\n\t\t\t//Clear \"Select all\" checkbox\r\n\t\t\tif(Z._hasSelectCol) {\r\n\t\t\t\tjQuery(Z.el).find('.jl-tbl-select-all')[0].checked = false;\r\n\t\t\t}\r\n\t\t} else if (evtType == jslet.data.RefreshEvent.UPDATERECORD) {\r\n\t\t\tZ.refreshCurrentRow();\r\n\t\t} else if (evtType == jslet.data.RefreshEvent.UPDATECOLUMN) {\r\n\t\t\tZ._fillData();\r\n\t\t} else if (evtType == jslet.data.RefreshEvent.INSERT) {\r\n\t\t\tZ.listvm.refreshModel();\r\n\t\t\tvar recno = Z._dataset.recno(),\r\n\t\t\t\tpreRecno = evt.preRecno;\r\n\t\t\t\r\n\t\t\tZ._fillData();\r\n\t\t\tZ._keep_silence_ = true;\r\n\t\t\ttry {\r\n\t\t\t\tZ.refreshControl(jslet.data.RefreshEvent.scrollEvent(recno, preRecno));\r\n\t\t\t} finally {\r\n\t\t\t\tZ._keep_silence_ = false;\r\n\t\t\t}\r\n\t\t} else if (evtType == jslet.data.RefreshEvent.DELETE) {\r\n\t\t\tZ.listvm.refreshModel();\r\n\t\t\tZ._fillData();\r\n\t\t} else if (evtType == jslet.data.RefreshEvent.SELECTRECORD) {\r\n\t\t\tif (!Z._hasSelectCol) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar col = 0;\r\n\t\t\tif (Z._hasSeqCol) {\r\n\t\t\t\tcol++;\r\n\t\t\t}\r\n\t\t\tvar recno = evt.recno, otr, otd, checked, ocheckbox;\r\n\t\t\tfor(var i = 0, cnt = recno.length; i < cnt; i++){\r\n\t\t\t\totr = Z._getLeftRowByRecno(recno[i]);\r\n\t\t\t\tif (!otr) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\totd = otr.cells[col];\r\n\t\t\t\tchecked = evt.selected ? true : false;\r\n\t\t\t\tocheckbox = jQuery(otd).find('[type=checkbox]')[0];\r\n\t\t\t\tocheckbox.checked = checked;\r\n\t\t\t\tocheckbox.defaultChecked = checked;\r\n\t\t\t}\r\n\t\t} else if (evtType == jslet.data.RefreshEvent.SELECTALL) {\r\n\t\t\tif (!Z._hasSelectCol) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar col = 0;\r\n\t\t\tif (Z._hasSeqCol) {\r\n\t\t\t\tcol++;\r\n\t\t\t}\r\n\t\t\tvar leftFixedBody = Z.leftFixedTbl.tBodies[0],\r\n\t\t\t\tleftContentBody = Z.leftContentTbl.tBodies[0],\r\n\t\t\t\tchecked, recno, otr, otd, ocheckbox, rec,\r\n\t\t\t\toldRecno = Z._dataset.recno();\r\n\r\n\t\t\ttry {\r\n\t\t\t\tfor (var i = 0, cnt = leftFixedBody.rows.length; i < cnt; i++) {\r\n\t\t\t\t\totr = leftFixedBody.rows[i];\r\n\t\t\t\t\tif (otr.style.display == 'none') {\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tZ._dataset.recnoSilence(otr.jsletrecno);\r\n\t\t\t\t\tchecked = Z._dataset.selected() ? true : false;\r\n\t\t\t\t\totd = otr.cells[col];\r\n\t\t\t\t\tocheckbox = jQuery(otd).find('[type=checkbox]')[0];\r\n\t\t\t\t\tocheckbox.checked = checked;\r\n\t\t\t\t\tocheckbox.defaultChecked = checked;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor (var i = 0, cnt = leftContentBody.rows.length; i < cnt; i++) {\r\n\t\t\t\t\totr = leftContentBody.rows[i];\r\n\t\t\t\t\tif (otr.style.display == 'none') {\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tZ._dataset.recnoSilence(otr.jsletrecno);\r\n\t\t\t\t\tchecked = Z._dataset.selected() ? true : false;\r\n\t\t\t\t\totd = otr.cells[col];\r\n\t\t\t\t\tocheckbox = jQuery(otd).find('[type=checkbox]')[0];\r\n\t\t\t\t\tocheckbox.checked = checked;\r\n\t\t\t\t\tocheckbox.defaultChecked = checked;\r\n\t\t\t\t}\r\n\t\t\t} finally {\r\n\t\t\t\tZ._dataset.recnoSilence(oldRecno);\r\n\t\t\t}\r\n\t\t} //end event selectall\r\n\t}, // refreshControl\r\n\r\n\t_isCellEditable: function(colCfg){\r\n\t\tvar Z = this;\r\n\t\tif (Z._readOnly) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tvar fldName = colCfg.field;\r\n\t\tif (!fldName) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tvar fldObj = Z._dataset.getField(fldName),\r\n\t\t\tisEditable = !fldObj.fieldDisabled() && !fldObj.fieldReadOnly() ? 1 : 0;\r\n\t\treturn isEditable;\r\n\t},\r\n\t\r\n\t_createEditControl: function (colCfg) {\r\n\t\tvar Z = this,\r\n\t\t\tfldName = colCfg.field;\r\n\t\tif (!fldName) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tvar fldObj = Z._dataset.getField(fldName),\r\n\t\t\tisEditable = !fldObj.fieldDisabled() && !fldObj.fieldReadOnly() ? 1 : 0;\r\n\t\tif (!isEditable) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tvar fldCtrlCfg = fldObj.editControl();\r\n\t\tfldCtrlCfg.dataset = Z._dataset;\r\n\t\tfldCtrlCfg.field = fldName;\r\n\t\tfldCtrlCfg.inTableCtrl = true;\r\n\t\tvar editCtrl = jslet.ui.createControl(fldCtrlCfg);\r\n\t\teditCtrl = editCtrl.el;\r\n\t\teditCtrl.id = jslet.nextId();\r\n\t\tjQuery(editCtrl).addClass('jl-tbl-incell').on('editing', function(event, editingField) {\r\n\t\t\tZ._editingField = editingField;\r\n\t\t});\r\n\t\treturn editCtrl;\r\n\t}, // end editControl\r\n\r\n\t/**\r\n\t * Run when container size changed, it's revoked by jslet.resizeeventbus.\r\n\t * \r\n\t */\r\n\tcheckSizeChanged: function(){\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el),\r\n\t\t\tnewHeight = jqEl.height();\r\n\t\tif (newHeight == Z._oldHeight) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tZ.height = newHeight;\r\n\t\tZ.renderAll();\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\tvar Z = this, jqEl = jQuery(Z.el);\r\n\t\tjslet.resizeEventBus.unsubscribe(Z);\r\n\t\tjqEl.off();\r\n\t\tZ.listvm.onTopRownoChanged = null;\r\n\t\tZ.listvm.onVisibleCountChanged = null;\r\n\t\tZ.listvm.onCurrentRownoChanged = null;\r\n\t\tZ.listvm = null;\r\n\t\t\r\n\t\tZ._currRow = null;\r\n\t\t\r\n\t\tZ.leftHeadTbl = null;\r\n\t\tZ.rightHeadTbl = null;\r\n\t\tjQuery(Z.rightHeadTbl).off();\r\n\r\n\t\tZ.leftFixedTbl = null;\r\n\t\tZ.rightFixedTbl = null;\r\n\r\n\t\tZ.leftContentTbl = null;\r\n\t\tZ.rightContentTbl = null;\r\n\r\n\t\tZ.leftFootTbl = null;\r\n\t\tZ.rightFootTbl = null;\r\n\t\t\r\n\t\tZ.noRecordDiv = null;\r\n\t\tZ.jqVScrollBar.off();\r\n\t\tZ.jqVScrollBar = null;\r\n\r\n\t\tvar splitter = jqEl.find('.jl-tbl-splitter')[0];\r\n\t\tsplitter._doDragging = null;\r\n\t\tsplitter._doDragEnd = null;\r\n\t\tsplitter._doDragCancel = null;\r\n\r\n\t\tZ.parsedHeads = null;\r\n\t\tjqEl.find('tr').each(function(){\r\n\t\t\tthis.ondblclick = null;\r\n\t\t\tthis.onclick = null;\r\n\t\t});\r\n\t\t\r\n\t\tjqEl.find('.jl-tbl-select-check').off();\r\n\t\t$super();\r\n\t} \r\n});\r\n\r\njslet.ui.DBTable = jslet.Class.create(jslet.ui.AbstractDBTable, {});\r\n\r\n\r\njslet.ui.register('DBTable', jslet.ui.DBTable);\r\njslet.ui.DBTable.htmlTemplate = '<div></div>';\r\n\r\njslet.ui.CellRender = jslet.Class.create({\r\n\tcreateHeader: function(cellPanel, colCfg) {\r\n\t\t\r\n\t},\r\n\t\r\n\tcreateCell: function (cellPanel, colCfg) {\r\n\t\r\n\t},\r\n\t\r\n\trefreshCell: function (cellPanel, colCfg, recNo) {\r\n\t\r\n\t}\r\n});\r\n\r\njslet.ui.DefaultCellRender =  jslet.Class.create(jslet.ui.CellRender, {\r\n\tcreateCell: function (cellPanel, colCfg) {\r\n\t\tvar Z = this,\r\n\t\t\tfldName = colCfg.field,\r\n\t\t\tfldObj = Z._dataset.getField(fldName);\r\n\t\tcellPanel.parentNode.style.textAlign = fldObj.alignment();\r\n\t},\r\n\t\t\t\t\t\t\t\t\r\n\trefreshCell: function (cellPanel, colCfg, recNo) {\r\n\t\tif (!colCfg || colCfg.noRefresh) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar Z = this,\r\n\t\t\tfldName = colCfg.field;\r\n\t\tif (!fldName) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tvar fldObj = Z._dataset.getField(fldName), text;\r\n\t\ttry {\r\n\t\t\ttext = Z._dataset.getFieldTextByRecno(recNo, fldName);\r\n\t\t} catch (e) {\r\n\t\t\ttext = 'error: ' + e.message;\r\n\t\t\tconsole.error(e);\r\n\t\t}\r\n\t\t\r\n\t\tif (fldObj.urlExpr()) {\r\n\t\t\tvar url = '<a href=' + fldObj.calcUrl(),\r\n\t\t\t\ttarget = fldObj.urlTarget();\r\n\t\t\tif (target) {\r\n\t\t\t\turl += ' target=' + target;\r\n\t\t\t}\r\n\t\t\turl += '>' + text + '</a>';\r\n\t\t\ttext = url;\r\n\t\t}\r\n\t\tif(text === '' || text === null || text === undefined) {\r\n\t\t\ttext = '&nbsp;';\r\n\t\t}\r\n\t\tvar jqCellPanel = jQuery(cellPanel); \r\n\t\tjqCellPanel.html(text);\r\n\t\tcellPanel.title = jqCellPanel.text();\r\n\t\tZ._showSelected(cellPanel.parentNode, fldName, recNo);\r\n\t} \r\n});\r\n\r\njslet.ui.EditableCellRender =  jslet.Class.create(jslet.ui.CellRender, {\r\n\tcreateCell: function (cellPanel, colCfg, rowNum) {\r\n\t\tvar Z = this,\r\n\t\t\tfldName = colCfg.field,\r\n\t\t\tfldObj = Z._dataset.getField(fldName);\r\n\t\t\r\n\t\tvar editCtrl = Z._createEditControl(colCfg);\r\n\t\tcellPanel.appendChild(editCtrl);\r\n\t},\r\n\t\r\n\trefreshCell: function (cellPanel, colCfg, recNo) {\r\n\t\tif (!colCfg || !cellPanel.firstChild) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar editCtrl = cellPanel.firstChild.jslet;\r\n\t\teditCtrl.ctrlRecno(recNo);\r\n\t} \r\n\r\n});\r\n\r\njslet.ui.SequenceCellRender = jslet.Class.create(jslet.ui.CellRender, {\r\n\tcreateHeader: function(cellPanel, colCfg) {\r\n\t\tcellPanel.innerHTML = this._seqColHeader || '&nbsp;';\r\n\t},\r\n\t\r\n\tcreateCell: function (cellPanel, colCfg) {\r\n\t\tjQuery(cellPanel.parentNode).addClass('jl-tbl-sequence');\r\n\t},\r\n\t\r\n\trefreshCell: function (cellPanel, colCfg) {\r\n\t\tif (!colCfg || colCfg.noRefresh) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar jqDiv = jQuery(cellPanel), \r\n\t\t\ttext,\r\n\t\t\trecno = this.listvm.getCurrentRecno();\r\n\t\tif(this._reverseSeqCol) {\r\n\t\t\ttext = this._dataset.recordCount() - recno;\r\n\t\t} else {\r\n\t\t\ttext = recno + 1;\r\n\t\t}\r\n\t\tif(this._dataset.existRecordError(recno)) {\r\n\t\t\tjqDiv.parent().addClass('has-error');\r\n\t\t} else {\r\n\t\t\tjqDiv.parent().removeClass('has-error');\r\n\t\t}\r\n\t\tcellPanel.title = text;\r\n\t\tjqDiv.html(text);\r\n\t}\r\n});\r\n\r\njslet.ui.SelectCellRender = jslet.Class.create(jslet.ui.CellRender, {\r\n\tcreateHeader: function(cellPanel, colCfg) {\r\n\t\tcellPanel.style.textAlign = 'center';\r\n\t\tvar ocheckbox = document.createElement('input');\r\n\t\tocheckbox.type = 'checkbox';\r\n\t\tvar Z = this;\r\n\t\tjQuery(ocheckbox).addClass('jl-tbl-select-check jl-tbl-select-all').on('click', function (event) {\r\n\t\t\tZ._dataset.selectAll(this.checked ? 1 : 0, Z._onSelectAll);\r\n\t\t});\r\n\t\tcellPanel.appendChild(ocheckbox);\r\n\t},\r\n\t\r\n   createCell: function (cellPanel, colCfg) {\r\n\t    cellPanel.style.textAlign = 'center';\r\n\t\tvar Z = this, \r\n\t\tocheck = document.createElement('input'),\r\n\t\tjqCheck = jQuery(ocheck);\r\n\t\tjqCheck.attr('type', 'checkbox').addClass('jl-tbl-select-check');\r\n\t\tjqCheck.click(Z._doSelectBoxClick);\r\n\t\tcellPanel.appendChild(ocheck);\r\n\t},\r\n\r\n\trefreshCell: function (cellPanel, colCfg, recNo) {\r\n\t\tif (!colCfg || colCfg.noRefresh) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar Z = this,\r\n\t\t\tocheck = cellPanel.firstChild;\r\n\t\tif(Z._dataset.checkSelectable(recNo)) {\r\n\t\t\tocheck.checked = Z._dataset.selectedByRecno(recNo);\r\n\t\t\tocheck.style.display = '';\r\n\t\t} else {\r\n\t\t\tocheck.style.display = 'none';\r\n\t\t}\r\n\t}\r\n});\r\n\r\njslet.ui.SubgroupCellRender = jslet.Class.create(jslet.ui.CellRender, {\r\n\tcreateCell: function(otd, colCfg){\r\n\t\t//TODO\r\n\t}\r\n});\r\n\r\njslet.ui.BoolCellRender = jslet.Class.create(jslet.ui.DefaultCellRender, {\r\n\trefreshCell: function (cellPanel, colCfg, recNo) {\r\n\t\tif (!colCfg || colCfg.noRefresh) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tcellPanel.style.textAlign = 'center';\r\n\t\tvar jqDiv = jQuery(cellPanel);\r\n\t\tjqDiv.html('&nbsp;');\r\n\t\tvar Z = this,\r\n\t\t\tfldName = colCfg.field, \r\n\t\t\tfldObj = Z._dataset.getField(fldName);\r\n\t\tif (Z._dataset.getFieldValueByRecno(recNo, fldName)) {\r\n\t\t\tjqDiv.addClass('jl-tbl-checked');\r\n\t\t\tjqDiv.removeClass('jl-tbl-unchecked');\r\n\t\t}\r\n\t\telse {\r\n\t\t\tjqDiv.removeClass('jl-tbl-checked');\r\n\t\t\tjqDiv.addClass('jl-tbl-unchecked');\r\n\t\t}\r\n\t\tZ._showSelected(cellPanel.parentNode, fldName, recNo);\r\n\t}\r\n});\r\n\t\t\r\njslet.ui.TreeCellRender = jslet.Class.create(jslet.ui.CellRender, {\r\n\tinitialize: function () {\r\n\t},\r\n\t\t\r\n\tcreateCell: function (cellPanel, colCfg, recNo) {\r\n\t\tvar Z = this;\r\n\r\n\t\tvar odiv = document.createElement('div'),\r\n\t\t\tjqDiv = jQuery(odiv);\r\n\t\todiv.style.height = Z._rowHeight - 2 + 'px';\r\n\t\tjqDiv.html('<span class=\"jl-tbltree-indent\"></span><span class=\"jl-tbltree-node\"></span><span class=\"jl-tbltree-icon\"></span><span class=\"jl-tbltree-text\"></span>');\r\n\t\t\r\n\t\tvar obtn = odiv.childNodes[1];\r\n\t\tobtn.onclick = function (event) {\r\n\t\t\tvar otr = jslet.ui.findFirstParent(this,\r\n\t\t\tfunction(node){\r\n\t\t\t\treturn node.tagName && node.tagName.toLowerCase() == 'tr';\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tevent.stopImmediatePropagation();\r\n\t\t\tevent.preventDefault();\r\n\t\t\tZ._dataset.recno(otr.jsletrecno);\r\n\t\t\tif(Z._dataset.aborted()) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tif (this.expanded) {\r\n\t\t\t\tZ.listvm.collapse(function(){\r\n\t\t\t\t\tZ._fillData();\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tZ.listvm.expand(function(){\r\n\t\t\t\t\tZ._fillData();\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t};\r\n\t\t\r\n\t\tobtn.onmouseover = function (event) {\r\n\t\t\tvar jqBtn = jQuery(this);\r\n\t\t\tif (jqBtn.hasClass('jl-tbltree-collapse')) {\r\n\t\t\t\tjqBtn.addClass('jl-tbltree-collapse-hover');\r\n\t\t\t} else {\r\n\t\t\t\tjqBtn.addClass('jl-tbltree-expand-hover');\r\n\t\t\t}\r\n\t\t};\r\n\t\t\r\n\t\tobtn.onmouseout = function (event) {\r\n\t\t\tvar jqBtn = jQuery(this);\r\n\t\t\tjqBtn.removeClass('jl-tbltree-collapse-hover');\r\n\t\t\tjqBtn.removeClass('jl-tbltree-expand-hover');\r\n\t\t};\r\n\t\t\r\n\t\tcellPanel.appendChild(odiv);\r\n\t},\r\n\t\r\n\trefreshCell: function (cellPanel, colCfg, recNo) {\r\n\t\tif (!colCfg || colCfg.noRefresh) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar odiv = cellPanel.firstChild,\r\n\t\t\tarrSpan = odiv.childNodes,\r\n\t\t\tZ = this,\r\n\t\t\tlevel = Z.listvm.getLevel(recNo);\r\n\t\t\r\n\t\tif (!jslet.ui.TreeCellRender.iconWidth) {\r\n\t\t\tjslet.ui.TreeCellRender.iconWidth = parseInt(jslet.ui.getCssValue('jl-tbltree-indent', 'width'));\r\n\t\t}\r\n\t\tvar hasChildren = Z.listvm.hasChildren(recNo),\r\n\t\t\tindentWidth = (!hasChildren ? level + 1 : level) * jslet.ui.TreeCellRender.iconWidth,\r\n\t\t\toindent = arrSpan[0];\r\n\t\toindent.style.width = indentWidth + 'px';\r\n\t\tvar expBtn = arrSpan[1]; //expand button\r\n\t\texpBtn.style.display = hasChildren ? 'inline-block' : 'none';\r\n\t\tif (hasChildren) {\r\n//\t\t\texpBtn.expanded = Z._dataset.getRecord(recNo)._expanded_;\r\n\t\t\texpBtn.expanded = Z._dataset.expandedByRecno(recNo);\r\n\t\t\tvar jqExpBtn = jQuery(expBtn);\r\n\t\t\tjqExpBtn.removeClass('jl-tbltree-expand');\r\n\t\t\tjqExpBtn.removeClass('jl-tbltree-collapse');\r\n\t\t\tjqExpBtn.addClass((expBtn.expanded ? 'jl-tbltree-expand' : 'jl-tbltree-collapse'));\r\n\t\t}\r\n\t\tif (colCfg.getIconClass) {\r\n\t\t\tvar iconCls = colCfg.getIconClass(level, hasChildren);\r\n\t\t\tif (iconCls) {\r\n\t\t\t\tvar jqIcon = jQuery(arrSpan[2]);\r\n\t\t\t\tjqIcon.addClass('jl-tbltree-icon ' + iconCls);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tvar otext = arrSpan[3];\r\n\t\t\r\n\t\tvar fldName = colCfg.field, fldObj = Z._dataset.getField(fldName), text;\r\n\t\ttry {\r\n\t\t\ttext = Z._dataset.getFieldTextByRecno(recNo, fldName);\r\n\t\t} catch (e) {\r\n\t\t\ttext = 'error: ' + e.message;\r\n\t\t}\r\n\t\tcellPanel.title = text;\r\n\t\tif (fldObj.urlExpr()) {\r\n\t\t\tvar url = '<a href=' + fldObj.calcUrl();\r\n\t\t\tvar target = fldObj.urlTarget();\r\n\t\t\tif (target) {\r\n\t\t\t\turl += ' target=' + target;\r\n\t\t\t}\r\n\t\t\turl += '>' + text + '</a>';\r\n\t\t\ttext = url;\r\n\t\t}\r\n\t\totext.innerHTML = text;\r\n\t\tZ._showSelected(cellPanel.parentNode, fldName, recNo);\r\n\t}\r\n});\r\n\r\njslet.ui.DBTable.defaultCellRender = new jslet.ui.DefaultCellRender();\r\njslet.ui.DBTable.editableCellRender = new jslet.ui.EditableCellRender();\r\n\r\njslet.ui.DBTable.treeCellRender = new jslet.ui.TreeCellRender();\r\njslet.ui.DBTable.boolCellRender = new jslet.ui.BoolCellRender();\r\njslet.ui.DBTable.sequenceCellRender = new jslet.ui.SequenceCellRender();\r\njslet.ui.DBTable.selectCellRender = new jslet.ui.SelectCellRender();\r\njslet.ui.DBTable.subgroupCellRender = new jslet.ui.SubgroupCellRender();\r\n\r\n/**\r\n* Splitter: used in jslet.ui.DBTable\r\n*/\r\njslet.ui.Splitter = function () {\r\n\tif (!jslet.ui._splitDiv) {\r\n\t\tvar odiv = document.createElement('div');\r\n\t\todiv.className = 'jl-split-column';\r\n\t\todiv.style.display = 'none';\r\n\t\tjslet.ui._splitDiv = odiv;\r\n\t\tdocument.body.appendChild(odiv);\r\n\t\todiv = null;\r\n\t}\r\n\t\r\n\tthis.isDragging = false;\r\n\t\r\n\tthis.attach = function (el, left, top, height) {\r\n\t\tif (!height) {\r\n\t\t\theight = jQuery(el).height();\r\n\t\t}\r\n\t\tvar odiv = jslet.ui._splitDiv;\r\n\t\todiv.style.height = height + 'px';\r\n\t\todiv.style.left = left + 'px';\r\n\t\todiv.style.top = top + 'px';\r\n\t\todiv.style.display = 'block';\r\n\t\tjslet.ui.dnd.bindControl(this);\r\n\t\tthis.isDragging = false;\r\n\t};\r\n\t\r\n\tthis.unattach = function () {\r\n\t\tjslet.ui._splitDiv.style.display = 'none';\r\n\t\tthis.onSplitEnd = null;\r\n\t\tthis.onSplitCancel = null;\r\n\t};\r\n\t\r\n\tthis.onSplitEnd = null;\r\n\tthis.onSplitCancel = null;\r\n\t\r\n\tthis._doDragEnd = function (oldX, oldY, x, y, deltaX, deltaY) {\r\n\t\tjslet.ui.dnd.unbindControl();\r\n\t\tif (this.onSplitEnd) {\r\n\t\t\tthis.onSplitEnd(x - oldX);\r\n\t\t}\r\n\t\tthis.unattach();\r\n\t\tthis.isDragging = false;\r\n\t};\r\n\t\r\n\tthis._doDragging = function (oldX, oldY, x, y, deltaX, deltaY) {\r\n\t\tthis.isDragging = true;\r\n\t\tjslet.ui._splitDiv.style.left = x + 'px';\r\n\t};\r\n\t\r\n\tthis._doDragCancel = function () {\r\n\t\tjslet.ui.dnd.unbindControl();\r\n\t\tif (this.onSplitCancel) {\r\n\t\t\tthis.onSplitCancel();\r\n\t\t}\r\n\t\tthis.unattach();\r\n\t\tthis.isDragging = false;\r\n\t};\r\n};\r\n\r\njslet.ui.DBTableFilterPanel = function(jqFilterBtn, fldName) {\r\n\tvar Z = this;\r\n\tZ.popupWidth = 200;\r\n\tZ.popupHeight = 200;\r\n\tZ.fieldName = fldName;\r\n\t\r\n\tZ.popup = new jslet.ui.PopupPanel();\r\n\tZ.popup.onHidePopup = function() {\r\n\t\tZ.jqFilterBtn.focus();\r\n\t};\r\n\t\r\n}\r\n\r\njslet.ui.DBTableFilterPanel.prototype = {\r\n\t\r\n\tshowPopup: function (left, top, ajustX, ajustY) {\r\n\t\tvar Z = this;\r\n\t\tif (!Z.panel) {\r\n\t\t\tZ.panel = Z._create();\r\n\t\t}\r\n\t\tZ.popup.setContent(Z.panel, '100%', '100%');\r\n\t\tZ.popup.show(left, top, Z.popupWidth, Z.popupHeight, ajustX, ajustY);\r\n\t\tjQuery(Z.panel).find(\".jl-combopnl-head input\").focus();\r\n\t},\r\n\r\n\tclosePopup: function () {\r\n\t\tvar Z = this;\r\n\t\tZ.popup.hide();\r\n\t\tvar dispCtrl = Z.otree ? Z.otree : Z.otable;\r\n\t\tif(dispCtrl) {\r\n\t\t\tdispCtrl.dataset().removeLinkedControl(dispCtrl);\r\n\t\t}\r\n\t},\r\n\t\r\n\t_create: function () {\r\n\t\tvar Z = this;\r\n\t\tif (!Z.panel) {\r\n\t\t\tZ.panel = document.createElement('div');\r\n\t\t}\r\nreturn Z.panel;\r\n\t\t//process variable\r\n\t\tvar fldObj = Z.dataset.getField(Z.field),\r\n\t\t\tlkfld = fldObj.lookup(),\r\n\t\t\tpfld = lkfld.parentField(),\r\n\t\t\tshowType = Z.showStyle.toLowerCase(),\r\n\t\t\tlkds = Z.lookupDs();\r\n\r\n\t\tvar template = ['<div class=\"jl-combopnl-head\"><div class=\"col-xs-12 jl-nospacing\">',\r\n\t\t                '<input class=\"form-control\" type=\"text\" size=\"20\"></input></div></div>',\r\n\t\t\t'<div class=\"jl-combopnl-content',\r\n\t\t\tZ.isMultiple() ? ' jl-combopnl-multiselect': '',\r\n\t\t\t'\"></div>',\r\n\t\t\t'<div class=\"jl-combopnl-footer\" style=\"display:none\"><button class=\"jl-combopnl-footer-cancel btn btn-default btn-sm\" >',\r\n\t\t\tjslet.locale.MessageBox.cancel,\r\n\t\t\t'</button><button class=\"jl-combopnl-footer-ok btn btn-default btn-sm\" >',\r\n\t\t\tjslet.locale.MessageBox.ok,\r\n\t\t\t'</button></div>'];\r\n\r\n\t\tZ.panel.innerHTML = template.join('');\r\n\t\tvar jqPanel = jQuery(Z.panel),\r\n\t\t\tjqPh = jqPanel.find('.jl-combopnl-head');\r\n\t\tjqPanel.on('keydown', function(event){\r\n\t\t\tif(event.keyCode === 27) {\r\n\t\t\t\tZ.closePopup();\r\n\t\t\t}\r\n\t\t});\r\n\t\tZ.searchBoxEle = jqPh.find('input')[0];\r\n\t\tjQuery(Z.searchBoxEle).on('keydown', jQuery.proxy(Z._findData, Z));\r\n\t\t\r\n\t\tvar jqContent = jqPanel.find('.jl-combopnl-content');\r\n\t\tif (Z.isMultiple()) {\r\n\t\t\tjqContent.addClass('jl-combopnl-content-nofooter').removeClass('jl-combopnl-content-nofooter');\r\n\t\t\tvar pnlFoot = jqPanel.find('.jl-combopnl-footer')[0];\r\n\t\t\tpnlFoot.style.display = 'block';\r\n\t\t\tvar jqFoot = jQuery(pnlFoot);\r\n\t\t\tjqFoot.find('.jl-combopnl-footer-cancel').click(jQuery.proxy(Z.closePopup, Z));\r\n\t\t\tjqFoot.find('.jl-combopnl-footer-ok').click(jQuery.proxy(Z._confirmSelect, Z));\r\n\t\t} else {\r\n\t\t\tjqContent.addClass('jl-combopnl-content-nofooter');\r\n\t\t}\r\n\r\n\t\tvar contentPanel = jqContent[0];\r\n\r\n\t\t//create popup content\r\n\t\tif (showType == 'tree') {\r\n\t\t\tvar treeparam = { \r\n\t\t\t\ttype: 'DBTreeView', \r\n\t\t\t\tdataset: lkds, \r\n\t\t\t\treadOnly: false, \r\n\t\t\t\tdisplayFields: lkfld.displayFields(), \r\n\t\t\t\thasCheckBox: Z.isMultiple()\r\n\t\t\t};\r\n\r\n\t\t\tif (!Z.isMultiple()) {\r\n\t\t\t\ttreeparam.onItemDblClick = jQuery.proxy(Z._confirmSelect, Z);\r\n\t\t\t}\r\n\t\t\ttreeparam.correlateCheck = Z.comboSelectObj.correlateCheck();\r\n\t\t\twindow.setTimeout(function(){\r\n\t\t\t\tZ.otree = jslet.ui.createControl(treeparam, contentPanel, '100%', '100%');\r\n\t\t\t}, 1);\r\n\t\t} else {\r\n\t\t\tvar tableparam = { type: 'DBTable', dataset: lkds, readOnly: true, hasSelectCol: Z.isMultiple(), hasSeqCol: false, hasFindDialog: false };\r\n\t\t\tif (!Z.isMultiple()) {\r\n\t\t\t\ttableparam.onRowDblClick = jQuery.proxy(Z._confirmSelect, Z);\r\n\t\t\t}\r\n\t\t\twindow.setTimeout(function(){\r\n\t\t\t\tZ.otable = jslet.ui.createControl(tableparam, contentPanel, '100%', '100%');\r\n\t\t\t}, 1);\r\n\t\t}\r\n\t\treturn Z.panel;\r\n\t},\r\n\r\n\tdestroy: function(){\r\n\t\tZ.popup = null;\r\n\t\tZ.panel = null;\r\n\t}\r\n};\r\n\r\n\n/* ========================================================================\r\n * Jslet framework: jslet.dbtreeview.js\r\n *\r\n * Copyright (c) 2014 Jslet Group(https://github.com/jslet/jslet/)\r\n * Licensed under MIT (https://github.com/jslet/jslet/LICENSE.txt)\r\n * ======================================================================== */\r\n\r\n/**\r\n * @class DBTreeView. \r\n * Functions:\r\n * 1. Perfect performance, you can load unlimited data;\r\n * 2. Checkbox on tree node;\r\n * 3. Relative check, when you check one tree node, its children and its parent will check too;\r\n * 4. Many events for you to customize tree control;\r\n * 5. Context menu supported and you can customize your context menu;\r\n * 6. Icon supported on each tree node.\r\n * \r\n * Example:\r\n * <pre><code>\r\n *\tvar jsletParam = { type: \"DBTreeView\", \r\n *\tdataset: \"dsAgency\", \r\n *\tdisplayFields: \"[code]+'-'+[name]\",\r\n *  keyField: \"id\", \r\n *\tparentField: \"parentid\",\r\n *  hasCheckBox: true, \r\n *\ticonClassField: \"iconcls\", \r\n *\tonCreateContextMenu: doCreateContextMenu, \r\n *\tcorrelateCheck: true\r\n * };\r\n * //1. Declaring:\r\n *  &lt;div id=\"ctrlId\" data-jslet=\"jsletParam\">\r\n *  or\r\n *  &lt;div data-jslet='jsletParam' />\r\n *  \r\n *  //2. Binding\r\n *  &lt;div id=\"ctrlId\"  />\r\n *  //Js snippet\r\n *\tvar el = document.getElementById('ctrlId');\r\n *  jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *  //3. Create dynamically\r\n *  jslet.ui.createControl(jsletParam, document.body);\r\n *\t\t\r\n * </code></pre>\r\n */\r\njslet.ui.DBTreeView = jslet.Class.create(jslet.ui.DBControl, {\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.allProperties = 'dataset,displayFields,hasCheckBox,correlateCheck,onlyCheckChildren,readOnly,expandLevel,codeField,codeFormat,onItemClick,onItemDblClick,beforeCheckBoxClick,iconClassField,onGetIconClass,onCreateContextMenu';\r\n\t\tZ.requiredProperties = 'displayFields';\r\n\t\t\r\n\t\t/**\r\n\t\t * {String} Display fields, it's a js expresssion, like: \"[code]+'-'+[name]\"\r\n\t\t */\r\n\t\tZ._displayFields = null;\r\n\t\t/**\r\n\t\t * {Boolean} Identify if there is checkbox on tree node.\r\n\t\t */\r\n\t\tZ._hasCheckBox = false;\r\n\t\t/**\r\n\t\t * {Boolean} Checkbox is readonly or not, ignored if hasCheckBox = false\r\n\t\t */\r\n\t\tZ._readOnly = false;\r\n\t\t\r\n\t\t/**\r\n\t\t * {Boolean} if true, when you check one tree node, its children and its parent will check too;\r\n\t\t */\r\n\t\tZ._correlateCheck = false;\r\n\t\t\r\n\t\tZ._onlyCheckChildren = false;\r\n\t\t\r\n\t\t///**\r\n\t\t// * {String} Key field, it will use 'keyField' and 'parentField' to construct tree nodes.\r\n\t\t// */\r\n\t\t//Z._keyField = null;\r\n\t\t///**\r\n\t\t// * {String} Parent field, it will use 'keyField' and 'parentField' to construct tree nodes.\r\n\t\t// */\r\n\t\t//Z._parentField = null;\r\n\t\t/**\r\n\t\t * {String} If icon class is stored one field, you can set this property to display different tree node icon.\r\n\t\t */\r\n\t\tZ._iconClassField = null;\r\n\t\t\r\n\t\t/**\r\n\t\t * {Integer} Identify the nodes which level is from 0 to \"expandLevel\" will be expanded when initialize tree.\r\n\t\t */\r\n\t\tZ._expandLevel = -1;\r\n\t\t\r\n\t\tZ._onItemClick = null;\r\n\t\t\r\n\t\tZ._onItemDblClick = null;\r\n\r\n\t\tZ._beforeCheckBoxClick = null;\r\n\t\t\r\n\t\t/**\r\n\t\t * {Event} You can use this event to customize your tree node icon flexibly.\r\n\t\t * Pattern: \r\n\t\t *   function(keyValue, level, isLeaf){}\r\n\t\t *   //keyValue: String, key value of tree node;\r\n\t\t *   //level: Integer, tree node level;\r\n\t\t *   //isLeaf: Boolean, Identify if the tree node is the leaf node.\r\n\t\t */\r\n\t\tZ._onGetIconClass = null;\r\n\t\t\r\n\t\tZ._onCreateContextMenu = null;\r\n\t\t\r\n\t\tZ.iconWidth = null;\r\n\t\t\r\n\t\t$super(el, params);\r\n\t},\r\n\t\r\n\t//keyField: function(keyField) {\r\n\t//\tif(keyField === undefined) {\r\n\t//\t\treturn this._keyField;\r\n\t//\t}\r\n\t//\tkeyField = jQuery.trim(keyField);\r\n\t//\t\tjslet.Checker.test('DBTreeView.keyField', keyField).required().isString();\r\n\t//\tthis._keyField = keyField;\r\n\t//},\r\n\t//\r\n\t//parentField: function(parentField) {\r\n\t//\tif(parentField === undefined) {\r\n\t//\t\treturn this._parentField;\r\n\t//\t}\r\n\t//\tparentField = jQuery.trim(parentField);\r\n\t//\t\tjslet.Checker.test('DBTreeView.parentField', parentField).required().isString();\r\n\t//\tthis._parentField = parentField;\r\n\t//},\r\n\t//\r\n\tdisplayFields: function(displayFields) {\r\n\t\tif(displayFields === undefined) {\r\n\t\t\treturn this._displayFields;\r\n\t\t}\r\n\t\tdisplayFields = jQuery.trim(displayFields);\r\n\t\tjslet.Checker.test('DBTreeView.displayFields', displayFields).required().isString();\r\n\t\tthis._displayFields = displayFields;\r\n\t},\r\n\t\r\n\ticonClassField: function(iconClassField) {\r\n\t\tif(iconClassField === undefined) {\r\n\t\t\treturn this._iconClassField;\r\n\t\t}\r\n\t\ticonClassField = jQuery.trim(iconClassField);\r\n\t\tjslet.Checker.test('DBTreeView.iconClassField', iconClassField).isString();\r\n\t\tthis._iconClassField = iconClassField;\r\n\t},\r\n\t\r\n\thasCheckBox: function(hasCheckBox) {\r\n\t\tif(hasCheckBox === undefined) {\r\n\t\t\treturn this._hasCheckBox;\r\n\t\t}\r\n\t\tthis._hasCheckBox = hasCheckBox ? true: false;\r\n\t},\r\n\t\r\n\tcorrelateCheck: function(correlateCheck) {\r\n\t\tif(correlateCheck === undefined) {\r\n\t\t\treturn this._correlateCheck;\r\n\t\t}\r\n\t\tthis._correlateCheck = correlateCheck ? true: false;\r\n\t},\r\n\t\r\n\tonlyCheckChildren: function(onlyCheckChildren) {\r\n\t\tif(onlyCheckChildren === undefined) {\r\n\t\t\treturn this._onlyCheckChildren;\r\n\t\t}\r\n\t\tthis._onlyCheckChildren = onlyCheckChildren ? true: false;\r\n\t},\r\n\t\r\n\treadOnly: function(readOnly) {\r\n\t\tif(readOnly === undefined) {\r\n\t\t\treturn this._readOnly;\r\n\t\t}\r\n\t\tthis._readOnly = readOnly ? true: false;\r\n\t},\r\n\t\r\n\texpandLevel: function(expandLevel) {\r\n\t\tif(expandLevel === undefined) {\r\n\t\t\treturn this._expandLevel;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTreeView.expandLevel', expandLevel).isGTEZero();\r\n\t\tthis._expandLevel = parseInt(expandLevel);\r\n\t},\r\n\t\r\n\tonItemClick: function(onItemClick) {\r\n\t\tif(onItemClick === undefined) {\r\n\t\t\treturn this._onItemClick;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTreeView.onItemClick', onItemClick).isFunction();\r\n\t\tthis._onItemClick = onItemClick;\r\n\t},\r\n\t\r\n\tonItemDblClick: function(onItemDblClick) {\r\n\t\tif(onItemDblClick === undefined) {\r\n\t\t\treturn this._onItemDblClick;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTreeView.onItemDblClick', onItemDblClick).isFunction();\r\n\t\tthis._onItemDblClick = onItemDblClick;\r\n\t},\r\n\t\r\n\tbeforeCheckBoxClick: function(beforeCheckBoxClick) {\r\n\t\tif(beforeCheckBoxClick === undefined) {\r\n\t\t\treturn this._beforeCheckBoxClick;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTreeView.beforeCheckBoxClick', beforeCheckBoxClick).isFunction();\r\n\t\tthis._beforeCheckBoxClick = beforeCheckBoxClick;\r\n\t},\r\n\t\r\n\tonGetIconClass: function(onGetIconClass) {\r\n\t\tif(onGetIconClass === undefined) {\r\n\t\t\treturn this._onGetIconClass;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTreeView.onGetIconClass', onGetIconClass).isFunction();\r\n\t\tthis._onGetIconClass = onGetIconClass;\r\n\t},\r\n\t\r\n\tonCreateContextMenu: function(onCreateContextMenu) {\r\n\t\tif(onCreateContextMenu === undefined) {\r\n\t\t\treturn this._onCreateContextMenu;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBTreeView.onCreateContextMenu', onCreateContextMenu).isFunction();\r\n\t\tthis._onCreateContextMenu = onCreateContextMenu;\r\n\t},\r\n\t\r\n\t/**\r\n\t\t * @override\r\n\t\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\treturn el.tagName.toLowerCase() == 'div';\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el);\r\n\t\tZ.scrBarSize = jslet.scrollbarSize() + 1;\r\n\t\t\r\n\t\tif (Z._keyField === undefined) {\r\n\t\t\tZ._keyField = Z._dataset.keyField();\r\n\t\t}\r\n\t\tvar ti = jqEl.attr('tabindex');\r\n\t\tif (Z._readOnly && !ti) {\r\n\t\t\tjqEl.attr('tabindex', 0);\r\n\t\t}\r\n\t\tjqEl.keydown(function(event){\r\n\t\t\tif (Z._doKeydown(event.which)) {\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t}\r\n\t\t});\r\n\t\tjqEl.on('mouseenter', 'td.jl-tree-text', function(event){\r\n\t\t\tjQuery(this).addClass('jl-tree-nodes-hover');\r\n\t\t});\r\n\t\tjqEl.on('mouseleave', 'td.jl-tree-text', function(event){\r\n\t\t\tjQuery(this).removeClass('jl-tree-nodes-hover');\r\n\t\t});\r\n\t\tif (!jqEl.hasClass('jl-tree')) {\r\n\t\t\tjqEl.addClass('jl-tree');\r\n\t\t}\r\n\t\tZ.renderAll();\r\n\t\tZ.refreshControl(jslet.data.RefreshEvent.scrollEvent(this._dataset.recno()));\r\n\t\tZ._createContextMenu();\t\t\r\n\t\tjslet.resizeEventBus.subscribe(Z);\r\n\t}, // end bind\r\n\t\r\n\t/**\r\n\t * @override\r\n\t*/\r\n\trenderAll: function () {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el);\r\n\t\tZ.evaluator = new jslet.Expression(Z._dataset, Z._displayFields);\r\n\t\t\r\n\t\tjqEl.html('');\r\n\t\tZ.oldWidth = jqEl.width();\r\n\t\tZ.oldHeight = jqEl.height();\r\n\t\tZ.nodeHeight = Z.iconWidth =  parseInt(jslet.ui.getCssValue('jl-tree', 'line-height'));\r\n\t\tZ.treePanelHeight = jqEl.height();\r\n\t\tZ.treePanelWidth = jqEl.width();\r\n\t\tZ.nodeCount = Math.floor(Z.treePanelHeight / Z.nodeHeight);\r\n\r\n\t\tZ._initVm();\r\n\t\tZ._initFrame();\r\n\t}, // end renderAll\r\n\t\r\n\t_initFrame: function(){\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el);\r\n\t\t\t\r\n\t\tjqEl.find('.jl-tree-container').off();\r\n\t\tjqEl.find('.jl-tree-scrollbar').off();\r\n\t\t\t\r\n\t\tvar lines = [];\r\n\t\tfor(var i = 0; i < 5; i++){//Default cells for lines is 5\r\n\t\t\tlines.push('<td class=\"jl-tree-lines\" ');\r\n\t\t\tlines.push(jslet.ui.DBTreeView.NODETYPE);\r\n\t\t\tlines.push('=\"0\"></td>');\r\n\t\t}\r\n\t\tvar s = lines.join(''),\r\n\t\t\ttmpl = ['<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" style=\"table-layout:fixed;width:100%;height:100%\"><tr><td style=\"vertical-align:top\"><div class=\"jl-tree-container\">'];\r\n\t\tfor(var i = 0, cnt = Z.nodeCount; i < cnt; i++){\r\n\t\t\ttmpl.push('<table class=\"jl-tree-nodes\" cellpadding=\"0\" cellspacing=\"0\"><tr>');\r\n\t\t\ttmpl.push(s);\r\n\t\t\ttmpl.push('<td class=\"jl-tree-expander\" ');\r\n\t\t\ttmpl.push(jslet.ui.DBTreeView.NODETYPE);//expander\r\n\t\t\ttmpl.push('=\"1\"></td><td ');\r\n\t\t\ttmpl.push(jslet.ui.DBTreeView.NODETYPE);//checkbox\r\n\t\t\ttmpl.push('=\"2\"></td><td ');\r\n\t\t\ttmpl.push(jslet.ui.DBTreeView.NODETYPE);//icon\r\n\t\t\ttmpl.push('=\"3\"></td><td class=\"jl-tree-text\" ');\r\n\t\t\ttmpl.push(jslet.ui.DBTreeView.NODETYPE);//text\r\n\t\t\ttmpl.push('=\"9\" nowrap=\"nowrap\"></td></tr></table>');\r\n\t\t}\r\n\t\ttmpl.push('</div></td><td class=\"jl-tree-scroll-col\"><div class=\"jl-tree-scrollbar\"><div class=\"jl-tree-tracker\"></div></div></td></tr></table>');\r\n\t\tjqEl.html(tmpl.join(''));\r\n\t\t\r\n\t\tvar treePnl = jqEl.find('.jl-tree-container');\r\n\t\ttreePnl.on('click', function(event){\r\n\t\t\tZ._doRowClick(event.target);\r\n\t\t});\r\n\t\ttreePnl.on('dblclick', function(event){\r\n\t\t\tZ._doRowDblClick(event.target);\r\n\t\t});\r\n\t\tZ.listvm.setVisibleCount(Z.nodeCount);\r\n\t\tvar sb = jqEl.find('.jl-tree-scrollbar');\r\n\t\t\r\n\t\tsb.on('scroll',function(){\r\n\t\t\tvar numb=Math.floor(this.scrollTop/Z.nodeHeight);\r\n\t\t\tif (numb!=Z.listvm.getVisibleStartRow()){\r\n\t\t\t\tZ._skip_ = true;\r\n\t\t\t\ttry {\r\n\t\t\t\t\tZ.listvm.setVisibleStartRow(numb);\r\n\t\t\t\t} finally {\r\n\t\t\t\t\tZ._skip_ = false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\t\r\n\t},\r\n\t\r\n\tresize: function(){\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el),\r\n\t\t\theight = jqEl.height(),\r\n\t\t\twidth = jqEl.width();\r\n\t\tif (width != Z.oldWidth){\r\n\t\t\tZ.oldWidth = width;\r\n\t\t\tZ.treePanelWidth = jqEl.innerWidth();\r\n\t\t\tZ._fillData();\r\n\t\t}\r\n\t\tif (height != Z.oldHeight){\r\n\t\t\tZ.oldHeight = height;\r\n\t\t\tZ.treePanelHeight = jqEl.innerHeight();\r\n\t\t\tZ.nodeCount = Math.floor(height / Z.nodeHeight) - 1;\r\n\t\t\tZ._initFrame();\r\n\t\t}\r\n\t},\r\n\t\r\n\thasChildren: function() {\r\n\t\treturn this.listvm.hasChildren();\r\n\t},\r\n\t\r\n\t_initVm:function(){\r\n\t\tvar Z=this;\r\n\t\tZ.listvm = new jslet.ui.ListViewModel(Z._dataset, true);\r\n\t\tZ.listvm.refreshModel(Z._expandLevel);\r\n\t\tZ.listvm.fixedRows=0;\r\n\t\t\r\n\t\tZ.listvm.onTopRownoChanged=function(rowno){\r\n\t\t\tvar rowno = Z.listvm.getCurrentRowno();\r\n\t\t\tZ._fillData();\r\n\t\t\tZ._doCurrentRowChanged(rowno);\r\n\t\t\tZ._syncScrollBar(rowno);\r\n\t\t};\r\n\t\t\r\n\t\tZ.listvm.onVisibleCountChanged=function(){\r\n\t\t\tZ._fillData();\r\n\t\t\tvar allCount = Z.listvm.getNeedShowRowCount();\r\n\t\t\tjQuery(Z.el).find('.jl-tree-tracker').height(Z.nodeHeight * allCount);\r\n\t\t};\r\n\t\t\r\n\t\tZ.listvm.onCurrentRownoChanged=function(prevRowno, rowno){\r\n\t\t\tZ._doCurrentRowChanged(rowno);\r\n\t\t};\r\n\t\t\r\n\t\tZ.listvm.onNeedShowRowsCountChanged = function(allCount){\r\n\t\t\tZ._fillData();\r\n\t\t\tjQuery(Z.el).find('.jl-tree-tracker').height(Z.nodeHeight * (allCount + 2));\r\n\t\t};\r\n\t\t\r\n\t\tZ.listvm.onCheckStateChanged = function(){\r\n\t\t\tZ._fillData();\r\n\t\t};\r\n\t},\r\n\t\r\n\t_doKeydown: function(keyCode){\r\n\t\tvar Z = this, result = false;\r\n\t\tif (keyCode == 32){//space\r\n\t\t\tZ._doCheckBoxClick();\r\n\t\t\tresult = true;\r\n\t\t} else if (keyCode == 38) {//KEY_UP\r\n\t\t\tZ.listvm.priorRow();\r\n\t\t\tresult = true;\r\n\t\t} else if (keyCode == 40) {//KEY_DOWN\r\n\t\t\tZ.listvm.nextRow();\r\n\t\t\tresult = true;\r\n\t\t} else if (keyCode == 37) {//KEY_LEFT\r\n\t\t\tif (jslet.locale.isRtl) {\r\n\t\t\t\tZ.listvm.expand();\r\n\t\t\t} else {\r\n\t\t\t\tZ.listvm.collapse();\r\n\t\t\t}\r\n\t\t\tresult = true;\r\n\t\t} else if (keyCode == 39) {//KEY_RIGHT\r\n\t\t\tif (jslet.locale.isRtl) {\r\n\t\t\t\tZ.listvm.collapse();\r\n\t\t\t} else {\r\n\t\t\t\tZ.listvm.expand();\r\n\t\t\t}\r\n\t\t\tresult = true;\r\n\t\t} else if (keyCode == 33) {//KEY_PAGEUP\r\n\t\t\tZ.listvm.priorPage();\r\n\t\t\tresult = true;\r\n\t\t} else if (keyCode == 34) {//KEY_PAGEDOWN\r\n\t\t\tZ.listvm.nextPage();\r\n\t\t\tresult = true;\r\n\t\t}\r\n\t\treturn result;\r\n\t},\r\n\t\r\n\t_getTrByRowno: function(rowno){\r\n\t\tvar nodes = jQuery(this.el).find('.jl-tree-nodes'), row;\r\n\t\tfor(var i = 0, cnt = nodes.length; i < cnt; i++){\r\n\t\t\trow = nodes[i].rows[0];\r\n\t\t\tif (row.jsletrowno == rowno) {\r\n\t\t\t\treturn row;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t},\r\n\t\r\n\t_doCurrentRowChanged: function(rowno){\r\n\t\tvar Z = this;\r\n\t\tif (Z.prevRow){\r\n\t\t\tjQuery(Z._getTextTd(Z.prevRow)).removeClass(jslet.ui.htmlclass.TREENODECLASS.selected);\r\n\t\t}\r\n\t\tvar otr = Z._getTrByRowno(rowno);\r\n\t\tif (otr) {\r\n\t\t\tjQuery(Z._getTextTd(otr)).addClass(jslet.ui.htmlclass.TREENODECLASS.selected);\r\n\t\t}\r\n\t\tZ.prevRow = otr;\r\n\t},\r\n\t\r\n\t_getTextTd: function(otr){\r\n\t\treturn otr.cells[otr.cells.length - 1];\r\n\t},\r\n\t\r\n\t_doExpand: function(){\r\n\t\tthis.expand();\r\n\t},\r\n\t\r\n\t_doRowClick: function(node){\r\n\t\tvar Z = this,\r\n\t\t\tnodeType = node.getAttribute(jslet.ui.DBTreeView.NODETYPE);\r\n\t\tif(!nodeType) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (nodeType != '0') {\r\n\t\t\tZ._syncToDs(node);\r\n\t\t}\r\n\t\tif (nodeType == '1' || nodeType == '2'){ //expander\r\n\t\t\tvar item = Z.listvm.getCurrentRow();\r\n\t\t\tif (nodeType == '1' && item.children && item.children.length > 0){\r\n\t\t\t\tif (item.expanded) {\r\n\t\t\t\t\tZ.collapse();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tZ.expand();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (nodeType == '2'){//checkbox\r\n\t\t\t\tZ._doCheckBoxClick();\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(nodeType == '9' && Z._onItemClick) {\r\n\t\t\tZ._onItemClick.call(Z);\r\n\t\t}\r\n\t},\r\n\t\r\n\t_doRowDblClick: function(node){\r\n\t\tthis._syncToDs(node);\r\n\t\tvar nodeType = node.getAttribute(jslet.ui.DBTreeView.NODETYPE);\r\n\t\tif (this._onItemDblClick && nodeType == '9') {\r\n\t\t\tthis._onItemDblClick.call(this);\r\n\t\t}\r\n\t},\r\n\t\r\n\t_doCheckBoxClick: function(){\r\n\t\tvar Z = this;\r\n\t\tif (Z._readOnly) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (Z._beforeCheckBoxClick && !Z._beforeCheckBoxClick.call(Z)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar node = Z.listvm.getCurrentRow();\r\n\t\tZ.listvm.checkNode(!node.state? 1:0, Z._correlateCheck, Z._onlyCheckChildren);\r\n\t},\r\n\t\r\n\t_syncToDs: function(otr){\r\n\t\tvar rowno = -1, k;\r\n\t\twhile(true){\r\n\t\t\tk = otr.jsletrowno;\r\n\t\t\tif (k === 0 || k){\r\n\t\t\t\trowno = k;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\totr = otr.parentNode;\r\n\t\t\tif (!otr) {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (rowno < 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.listvm.setCurrentRowno(rowno);\r\n\t\tthis._dataset.recno(this.listvm.getCurrentRecno());\r\n\t},\r\n\t\r\n\t_fillData: function(){\r\n\t\tvar Z = this,\r\n\t\t\tvCnt = Z.listvm.getVisibleCount(), \r\n\t\t\ttopRowno = Z.listvm.getVisibleStartRow(),\r\n\t\t\tallCnt = Z.listvm.getNeedShowRowCount(),\r\n\t\t\tavailbleCnt = vCnt + topRowno,\r\n\t\t\tindex = 0,\r\n\t\t\tjqEl = jQuery(Z.el),\r\n\t\t\tnodes = jqEl.find('.jl-tree-nodes'), node;\r\n\t\tif (Z._isRendering) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tZ._isRendering = true;\r\n\t\tZ._skip_ = true;\r\n\t\tvar oldRecno = Z._dataset.recnoSilence(),\r\n\t\t\tpreRowNo = Z.listvm.getCurrentRowno(),\r\n\t\t\tajustScrBar = true, maxNodeWidth = 0, nodeWidth;\r\n\t\ttry{\r\n\t\t\tif (allCnt < availbleCnt){\r\n\t\t\t\tfor(var i = availbleCnt - allCnt; i > 0; i--){\r\n\t\t\t\t\tnode = nodes[vCnt - i];\r\n\t\t\t\t\tnode.style.display = 'none';\r\n\t\t\t\t}\r\n\t\t\t\tajustScrBar = false; \r\n\t\t\t} else {\r\n\t\t\t\tallCnt = availbleCnt;\r\n\t\t\t}\r\n\t\t\tvar endRow = allCnt - 1;\r\n\t\t\t\r\n\t\t\tfor(var k = topRowno; k <= endRow; k++){\r\n\t\t\t\tnode = nodes[index++];\r\n\t\t\t\tnodeWidth = Z._fillNode(node, k);\r\n\t\t\t\tif (ajustScrBar && maxNodeWidth < Z.treePanelWidth){\r\n\t\t\t\t\tif (k == endRow && nodeWidth < Z.treePanelWidth) {\r\n\t\t\t\t\t\tajustScrBar = false;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tmaxNodeWidth = Math.max(maxNodeWidth, nodeWidth);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (k == endRow && ajustScrBar){\r\n\t\t\t\t\tnode.style.display = 'none';\r\n\t\t\t\t} else {\r\n\t\t\t\t\tnode.style.display = '';\r\n\t\t\t\t\tnode.jsletrowno = k;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tvar sb = jqEl.find('.jl-tree-scrollbar');\r\n\t\t\tif (ajustScrBar) {\r\n\t\t\t\tsb.height(Z.treePanelHeight - Z.scrBarSize - 2);\r\n\t\t\t} else {\r\n\t\t\t\tsb.height(Z.treePanelHeight - 2);\r\n\t\t\t}\r\n\t\t} finally {\r\n\t\t\tZ.listvm.setCurrentRowno(preRowNo, false);\r\n\t\t\tZ._dataset.recnoSilence(oldRecno);\r\n\t\t\tZ._isRendering = false;\r\n\t\t\tZ._skip_ = false;\r\n\t\t}\r\n\t},\r\n\r\n\t_getCheckClassName: function(expanded){\r\n\t\tif (!expanded) {\r\n\t\t\treturn jslet.ui.htmlclass.TREECHECKBOXCLASS.unChecked;\r\n\t\t}\r\n\t\tif (expanded == 2) { //mixed checked\r\n\t\t\treturn jslet.ui.htmlclass.TREECHECKBOXCLASS.mixedChecked;\r\n\t\t}\r\n\t\treturn jslet.ui.htmlclass.TREECHECKBOXCLASS.checked;\r\n\t},\r\n\t\r\n\t_fillNode: function(node, rowNo){\r\n\t\tvar row = node.rows[0],\r\n\t\t\tZ = this,\r\n\t\t\titem = Z.listvm.setCurrentRowno(rowNo, true),\r\n\t\t\tcells = row.cells, \r\n\t\t\tcellCnt = cells.length, \r\n\t\t\trequiredCnt = item.level + 4,\r\n\t\t\totd;\r\n\t\tZ._dataset.recnoSilence(Z.listvm.getCurrentRecno());\r\n\t\trow.jsletrowno = rowNo;\r\n\t\tif (cellCnt < requiredCnt){\r\n\t\t\tfor(var i = 1, cnt = requiredCnt - cellCnt; i <= cnt; i++){\r\n\t\t\t\totd = row.insertCell(0);\r\n\t\t\t\tjQuery(otd).addClass('jl-tree-lines').attr('jsletline', 1);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (cellCnt >= requiredCnt){\r\n\t\t\tfor( var i = 0, cnt = cellCnt - requiredCnt; i < cnt; i++){\r\n\t\t\t\tcells[i].style.display = 'none';\r\n\t\t\t}\r\n\t\t\tfor(var i = cellCnt - requiredCnt; i < requiredCnt; i++){\r\n\t\t\t\tcells[i].style.display = '';\r\n\t\t\t}\r\n\t\t}\r\n\t\tcellCnt = cells.length;\r\n\t\t//Line\r\n\t\tvar pitem = item, k = 1, totalWidth = Z.iconWidth * item.level;\r\n\t\tfor(var i = item.level; i >0; i--){\r\n\t\t\totd = row.cells[cellCnt- 4 - k++];\r\n\t\t\tpitem = pitem.parent;\r\n\t\t\tif (pitem.islast) {\r\n\t\t\t\totd.className = jslet.ui.htmlclass.TREELINECLASS.empty;\r\n\t\t\t} else {\r\n\t\t\t\totd.className = jslet.ui.htmlclass.TREELINECLASS.line;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//expander\r\n\t\tvar oexpander = row.cells[cellCnt- 4];\r\n\t\toexpander.noWrap = true;\r\n\t\toexpander.style.display = '';\r\n\t\tif (item.children && item.children.length > 0) {\r\n\t\t\tif (!item.islast) {\r\n\t\t\t\toexpander.className = item.expanded ? jslet.ui.htmlclass.TREELINECLASS.minus : jslet.ui.htmlclass.TREELINECLASS.plus;\r\n\t\t\t} else {\r\n\t\t\t\toexpander.className = item.expanded ? jslet.ui.htmlclass.TREELINECLASS.minusBottom : jslet.ui.htmlclass.TREELINECLASS.plusBottom;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (!item.islast) {\r\n\t\t\t\toexpander.className = jslet.ui.htmlclass.TREELINECLASS.join;\r\n\t\t\t} else {\r\n\t\t\t\toexpander.className = jslet.ui.htmlclass.TREELINECLASS.joinBottom;\r\n\t\t\t}\r\n\t\t}\r\n\t\ttotalWidth += Z.iconWidth;\r\n\t\t\t\t\r\n\t\t// CheckBox\r\n\t\tvar flag = Z._hasCheckBox && Z._dataset.checkSelectable();\r\n\t\tvar ocheckbox = row.cells[cellCnt- 3];\r\n\t\tif (flag) {\r\n\t\t\tocheckbox.noWrap = true;\r\n\t\t\tocheckbox.className = Z._getCheckClassName(Z._dataset.selected());\r\n\t\t\tocheckbox.style.display = '';\r\n\t\t\ttotalWidth += Z.iconWidth;\r\n\t\t} else {\r\n\t\t\tocheckbox.style.display = 'none';\r\n\t\t}\r\n\t\t//Icon\r\n\t\tvar oicon = row.cells[cellCnt- 2],\r\n\t\t\tclsName = 'jl-tree-icon',\r\n\t\t\ticonClsId = null;\r\n\r\n\t\tif(Z._iconClassField || Z._onGetIconClass) {\r\n\t\t\tif(Z._iconClassField) {\r\n\t\t\t\ticonClsId = Z._dataset.getFieldValue(Z._iconClassField);\r\n\t\t\t} else if (Z._onGetIconClass) {\r\n\t\t\t\tvar isLeaf = !(item.children && item.children.length > 0);\r\n\t\t\t\ticonClsId = Z._onGetIconClass.call(Z, Z._dataset.keyValue(), item.level, isLeaf); //keyValue, level, isLeaf\r\n\t\t\t}\r\n\t\t\tif (iconClsId) {\r\n\t\t\t\t\t\t\tclsName += ' '+ iconClsId;\r\n\t\t\t}\r\n\t\t\tif (oicon.className != clsName) {\r\n\t\t\t\toicon.className = clsName;\r\n\t\t\t}\r\n\t\t\toicon.style.display = '';\r\n\t\t\ttotalWidth += Z.iconWidth;\r\n\t\t} else {\r\n\t\t\toicon.style.display = 'none';\r\n\t\t}\r\n\t\t//Text\r\n\t\tvar text = Z.evaluator.eval() || '      ';\r\n\t\tjslet.ui.textMeasurer.setElement(Z.el);\r\n\t\tvar width = Math.round(jslet.ui.textMeasurer.getWidth(text)) + text.length * 4;\r\n\t\ttotalWidth += width + 10;\r\n\t\t//node.style.width = totalWidth + 'px';\r\n\t\tjslet.ui.textMeasurer.setElement();\r\n\t\tvar otd = row.cells[cellCnt- 1];\r\n\t\totd.style.width = width + 'px';\r\n\t\tvar jqTd = jQuery(otd);\r\n\t\tjqTd.html(text);\r\n\t\tif (item.isbold) {\r\n\t\t\tjqTd.addClass('jl-tree-child-checked');\r\n\t\t} else {\r\n\t\t\tjqTd.removeClass('jl-tree-child-checked');\r\n\t\t}\r\n\t\treturn totalWidth;\r\n\t},\r\n\t\t\r\n\t_updateCheckboxState: function(){\r\n\t\tvar Z = this, \r\n\t\t\toldRecno = Z._dataset.recnoSilence(),\r\n\t\t\tjqEl = jQuery(Z.el),\r\n\t\t\tnodes = jqEl.find('.jl-tree-nodes'),\r\n\t\t\trowNo, cellCnt, row;\r\n\t\ttry{\r\n\t\t\tfor(var i = 0, cnt = nodes.length; i < cnt; i++){\r\n\t\t\t\trow = nodes[i].rows[0];\r\n\t\t\t\tcellCnt = row.cells.length;\r\n\t\r\n\t\t\t\trowNo = row.jsletrowno;\r\n\t\t\t\tif(rowNo) {\r\n\t\t\t\t\tZ.listvm.setCurrentRowno(rowNo, true);\r\n\t\t\t\t\tZ._dataset.recnoSilence(Z.listvm.getCurrentRecno());\r\n\t\t\t\t\trow.cells[cellCnt- 3].className = Z._getCheckClassName(Z._dataset.selected());\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} finally {\r\n\t\t\tZ._dataset.recnoSilence(oldRecno);\r\n\t\t}\r\n\t},\r\n\t\r\n\t_syncScrollBar: function(){\r\n\t\tvar Z = this;\r\n\t\tif (Z._skip_) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tjQuery(Z.el).find('.jl-tree-scrollbar').scrollTop(Z.nodeHeight * Z.listvm.getVisibleStartRow());\r\n\t},\r\n\t\t\r\n\texpand: function () {\r\n\t\tthis.listvm.expand();\r\n\t},\r\n\t\r\n\tcollapse: function () {\r\n\t\tthis.listvm.collapse();\r\n\t},\r\n\t\r\n\texpandAll: function () {\r\n\t\tthis.listvm.expandAll();\r\n\t},\r\n\t\r\n\tcollapseAll: function () {\r\n\t\tthis.listvm.collapseAll();\r\n\t},\r\n\t\r\n\t_createContextMenu: function () {\r\n\t\tif (!jslet.ui.Menu) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar Z = this;\r\n\t\tvar menuCfg = { type: 'Menu', onItemClick: Z._menuItemClick, items: [\r\n\t\t\t{ id: 'expandAll', name: jslet.locale.DBTreeView.expandAll },\r\n\t\t\t{ id: 'collapseAll', name: jslet.locale.DBTreeView.collapseAll}]\r\n\t\t};\r\n\t\tif (Z._hasCheckBox && !Z._correlateCheck) {\r\n\t\t\tmenuCfg.items.push({ name: '-' });\r\n\t\t\tmenuCfg.items.push({ id: 'checkAll', name: jslet.locale.DBTreeView.checkAll });\r\n\t\t\tmenuCfg.items.push({ id: 'uncheckAll', name: jslet.locale.DBTreeView.uncheckAll });\r\n\t\t}\r\n\t\tif (Z._onCreateContextMenu) {\r\n\t\t\tZ._onCreateContextMenu.call(Z, menuCfg.items);\r\n\t\t}\r\n\t\tif (menuCfg.items.length === 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tZ.contextMenu = jslet.ui.createControl(menuCfg);\r\n\t\tjQuery(Z.el).on('contextmenu', function (event) {\r\n\t\t\tvar node = event.target,\r\n\t\t\t\tnodeType = node.getAttribute(jslet.ui.DBTreeView.NODETYPE);\r\n\t\t\tif(!nodeType || nodeType == '0') {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tZ._syncToDs(node);\r\n\t\t\tZ.contextMenu.showContextMenu(event, Z);\r\n\t\t});\r\n\t},\r\n\t\r\n\t_menuItemClick: function (menuid, checked) {\r\n\t\tif (menuid == 'expandAll') {\r\n\t\t\tthis.expandAll();\r\n\t\t} else if (menuid == 'collapseAll') {\r\n\t\t\tthis.collapseAll();\r\n\t\t} else if (menuid == 'checkAll') {\r\n\t\t\tthis.listvm.checkChildNodes(true, this._correlateCheck);\r\n\t\t} else if (menuid == 'uncheckAll') {\r\n\t\t\tthis.listvm.checkChildNodes(false, this._correlateCheck);\r\n\t\t}\r\n\t},\r\n\t\r\n\trefreshControl: function (evt) {\r\n\t\tvar Z = this,\r\n\t\t\tevtType = evt.eventType;\r\n\t\tif (evtType == jslet.data.RefreshEvent.CHANGEMETA) {\r\n\t\t\t//empty\r\n\t\t} else if (evtType == jslet.data.RefreshEvent.UPDATEALL ||\r\n\t\t\tevtType == jslet.data.RefreshEvent.INSERT ||\r\n\t\t\tevtType == jslet.data.RefreshEvent.DELETE){\r\n\t\t\tZ.listvm.refreshModel();\r\n\t\t\tif(evtType == jslet.data.RefreshEvent.INSERT) {\r\n\t\t\t\tZ.listvm.syncDataset();\r\n\t\t\t}\r\n\t\t} else if (evtType == jslet.data.RefreshEvent.UPDATERECORD ||\r\n\t\t\tevtType == jslet.data.RefreshEvent.UPDATECOLUMN){\r\n\t\t\tZ._fillData();\r\n\t\t} else if (evtType == jslet.data.RefreshEvent.SELECTALL || \r\n\t\t\tevtType == jslet.data.RefreshEvent.SELECTRECORD) {\r\n\t\t\tif (Z._hasCheckBox) {\r\n\t\t\t\tZ._updateCheckboxState();\r\n\t\t\t}\r\n\t\t} else if (evtType == jslet.data.RefreshEvent.SCROLL) {\r\n\t\t\tZ.listvm.syncDataset();\r\n\t\t}\r\n\t}, // end refreshControl\r\n\t\t\r\n\t/**\r\n\t * Run when container size changed, it's revoked by jslet.resizeeventbus.\r\n\t * \r\n\t */\r\n\tcheckSizeChanged: function(){\r\n\t\tthis.resize();\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el);\r\n\t\t\r\n\t\tjslet.resizeEventBus.unsubscribe(Z);\r\n\t\tjqEl.find('.jl-tree-nodes').off();\r\n\t\tZ.listvm.destroy();\r\n\t\tZ.listvm = null;\r\n\t\tZ.prevRow = null;\r\n\t\t\r\n\t\t$super();\r\n\t}\r\n});\r\n\r\njslet.ui.htmlclass.TREELINECLASS = {\r\n\t\tline : 'jl-tree-lines jl-tree-line',// '|'\r\n\t\tjoin : 'jl-tree-lines jl-tree-join',// |-\r\n\t\tjoinBottom : 'jl-tree-lines jl-tree-join-bottom',// |_\r\n\t\tminus : 'jl-tree-lines jl-tree-minus',// O-\r\n\t\tminusBottom : 'jl-tree-lines jl-tree-minus-bottom',// o-_\r\n\t\tnoLineMinus : 'jl-tree-lines jl-tree-noline-minus',// o-\r\n\t\tplus : 'jl-tree-lines jl-tree-plus',// o+\r\n\t\tplusBottom : 'jl-tree-lines jl-tree-plus-bottom',// o+_\r\n\t\tnoLinePlus : 'jl-tree-lines jl-tree-noline-plus',// o+\r\n\t\tempty : 'jl-tree-empty'\r\n};\r\njslet.ui.htmlclass.TREECHECKBOXCLASS = {\r\n//\t\tcheckbox : 'jl-tree-checkbox',\r\n\tchecked : 'jl-tree-checkbox jl-tree-checked',\r\n\tunChecked : 'jl-tree-checkbox jl-tree-unchecked',\r\n\tmixedChecked : 'jl-tree-checkbox jl-tree-mixedchecked'\r\n};\r\n\r\njslet.ui.htmlclass.TREENODECLASS = {\r\n\tselected : 'jl-tree-selected',\r\n\tchildChecked : 'jl-tree-child-checked',\r\n\ttreeNodeLevel : 'jl-tree-child-level'\r\n};\r\n\r\njslet.ui.DBTreeView.NODETYPE = 'data-nodetype';\r\n\r\njslet.ui.register('DBTreeView', jslet.ui.DBTreeView);\r\njslet.ui.DBTreeView.htmlTemplate = '<div></div>';\r\n\r\n\r\n\n/* ========================================================================\r\n * Jslet framework: jslet.listviewmodel.js\r\n *\r\n * Copyright (c) 2014 Jslet Group(https://github.com/jslet/jslet/)\r\n * Licensed under MIT (https://github.com/jslet/jslet/LICENSE.txt)\r\n * ======================================================================== */\r\n\r\n/**\r\n * Inner Class for DBTable and DBTreeView control\r\n */\r\njslet.ui.ListViewModel = function (dataset, isTree) {// boolean, identify if it's tree model\r\n\tvar visibleCount = 0,\r\n\t\tvisibleStartRow = 0,\r\n\t\tvisibleEndRow = 0,\r\n\t\tneedShowRows = null,//Array of all rows that need show, all of these rows's status will be 'expanded'\r\n\t\tallRows = null,//Array of all rows, include 'expanded' and 'collapsed' rows\r\n\t\tcurrentRowno = 0,\r\n\t\tcurrentRecno = 0;\r\n\tthis.onTopRownoChanged = null; //Event handler: function(rowno){}\r\n\tthis.onVisibleCountChanged = null; //Event handler: function(visibleRowCount){}\r\n\tthis.onCurrentRownoChanged = null; //Event handler: function(rowno){}\r\n\tthis.onNeedShowRowsCountChanged = null; //Event handler: function(needShowCount){}\r\n\tthis.onCheckStateChanged = null;  //Event handler: function(){}\r\n\t\t\r\n\tthis.fixedRows = 0;\r\n\tvar initial = function () {\r\n\t\tif (!isTree) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tvar ds = dataset;\r\n\t\tif (!ds._parentField || !ds._keyField) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\treturn true;\r\n\t};\r\n\tinitial();\r\n\t\t\r\n\tthis.refreshModel = function (expandLevel) {\r\n\t\tif (!isTree) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(expandLevel === undefined) {\r\n\t\t\texpandLevel = -1;\r\n\t\t}\r\n\t\tvar ds = dataset, \r\n\t\t\thiddenCnt = 0, \r\n\t\t\trecno, \r\n\t\t\tallCnt = ds.recordCount(), \r\n\t\t\tchildCnt, \r\n\t\t\tresult = [], \r\n\t\t\tpId,\r\n\t\t\toldRecno = ds.recnoSilence();\r\n\t\ttry {\r\n\t\t\tds.recnoSilence(this.fixedRows);\r\n\t\t\tvar level = 0, \r\n\t\t\t\tpnodes = [], \r\n\t\t\t\tnode, pnode, \r\n\t\t\t\ttmpNode, tmpKeyValue,\r\n\t\t\t\tcurrRec, state;\r\n\t\t\tfor(var recno = 0, recCnt = ds.recordCount(); recno < recCnt; recno++) {\r\n\t\t\t\tds.recnoSilence(recno);\r\n\t\t\t\tkeyValue = ds.keyValue();\r\n\t\t\t\tlevel = 0;\r\n\t\t\t\tpnode = null;\r\n\t\t\t\tpId = ds.parentValue();\r\n\t\t\t\tfor(var m = pnodes.length - 1; m>=0; m--) {\r\n\t\t\t\t\ttmpNode = pnodes[m];\r\n\t\t\t\t\ttmpKeyValue = tmpNode.keyvalue; \r\n\t\t\t\t\tif (tmpKeyValue !== null && \r\n\t\t\t\t\t\ttmpKeyValue !== undefined && \r\n\t\t\t\t\t\ttmpKeyValue !== '' && \r\n\t\t\t\t\t\ttmpKeyValue == pId) {\r\n\t\t\t\t\t\tlevel = tmpNode.level + 1;\r\n\t\t\t\t\t\tpnode = tmpNode;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (pnode){\r\n\t\t\t\t\tfor(var k = pnodes.length - 1; k > m; k--) {\r\n\t\t\t\t\t\tpnodes.pop();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tcurrRec = ds.getRecord();\r\n\t\t\t\tstate = ds.selected();\r\n\t\t\t\tif (!state) {\r\n\t\t\t\t\tstate = 0;\r\n\t\t\t\t}\r\n\t\t\t\tvar expanded = true;\r\n\t\t\t\tif(expandLevel >= 0 && level <= expandLevel) {\r\n\t\t\t\t\texpanded = true;\r\n\t\t\t\t} else { \r\n\t\t\t\t\texpanded = ds.expanded();\r\n\t\t\t\t}\r\n\t\t\t\tnode = { parent: pnode, recno: recno, keyvalue: keyValue, expanded: expanded, state: state, isbold: 0, level: level };\r\n\t\t\t\tpnodes.push(node);\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\tif (pnode){\r\n\t\t\t\t\tif (!pnode.children) {\r\n\t\t\t\t\t\tpnode.children = [];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tpnode.children.push(node);\r\n\t\t\t\t\tthis._updateParentNodeBoldByChecked(node);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tresult.push(node);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t} //end for recno\r\n\t\t} finally {\r\n\t\t\tds.recnoSilence(oldRecno);\r\n\t\t}\r\n\t\tallRows = result;\r\n\t\tthis._setLastFlag(result);\r\n\t\tthis._refreshNeedShowRows();\r\n\t};\r\n\t\t\r\n\tthis._updateParentNodeBoldByChecked = function(node){\r\n\t\tif (!node.state || !node.parent) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar pnode = node.parent;\r\n\t\twhile(true){\r\n\t\t\tif (pnode.isbold) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tpnode.isbold = 1;\r\n\t\t\tpnode = pnode.parent;\r\n\t\t\tif (!pnode) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tthis._updateParentNodeBoldByNotChecked = function(node){\r\n\t\tif (node.state || !node.parent) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar pnode = node.parent, cnode;\r\n\t\twhile(true){\r\n\t\t\tif (pnode.children){\r\n\t\t\t\tfor(var i = 0, cnt = pnode.children.length; i < cnt; i++){\r\n\t\t\t\t\tcnode = pnode.children[i];\r\n\t\t\t\t\tif (cnode.state) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tpnode.isbold = 0;\r\n\t\t\t}\r\n\t\t\tpnode = pnode.parent;\r\n\t\t\tif (!pnode) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\t\t\r\n\tthis._setLastFlag = function (nodes) {\r\n\t\tif (!nodes || nodes.length === 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar node;\r\n\t\tnodes[nodes.length - 1].islast = true;\r\n\t\tfor (var i = 0, cnt = nodes.length; i < cnt; i++) {\r\n\t\t\tnode = nodes[i];\r\n\t\t\tif (node.children && node.children.length > 0) {\r\n\t\t\t\tthis._setLastFlag(node.children);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t};\r\n\t\r\n\tthis._refreshNeedShowRows = function (notFireChangedEvent) {\r\n\t\tif (!isTree) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar result = [], node;\r\n\t\tif (!allRows) {\r\n\t\t\tthis.refreshModel();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar preCnt = needShowRows ? needShowRows.length: 0;\r\n\t\tneedShowRows = [];\r\n\t\tthis._findVisibleNode(allRows);\r\n\t\tvar currCnt = needShowRows.length;\r\n\t\tif (!notFireChangedEvent && this.onNeedShowRowsCountChanged){\r\n\t\t\tthis.onNeedShowRowsCountChanged(currCnt);\r\n\t\t}\r\n\t};\r\n\t\r\n\tthis.hasChildren = function (recno) {\r\n\t\tif (!isTree) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tif (!recno) {\r\n\t\t\trecno = dataset.recno();\r\n\t\t}\r\n\t\tvar node = this._innerFindNode(allRows, recno);\r\n\t\tif (node === null) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\treturn node.children && node.children.length > 0;\r\n\t};\r\n\t\r\n\tthis.getLevel = function (recno) {\r\n\t\tif (!isTree) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tif (!recno) {\r\n\t\t\trecno = dataset.recno();\r\n\t\t}\r\n\t\tvar node = this._innerFindNode(allRows, recno);\r\n\t\tif (node === null) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\treturn node.level;\r\n\t};\r\n\t\r\n\tthis._findVisibleNode = function (nodes) {\r\n\t\tif (!nodes) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar node;\r\n\t\tfor (var i = 0, cnt = nodes.length; i < cnt; i++) {\r\n\t\t\tnode = nodes[i];\r\n\t\t\tneedShowRows.push(node);\r\n\t\t\tif (node.expanded){\r\n\t\t\t\tthis._findVisibleNode(node.children);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\t\r\n\tthis.rownoToRecno = function (rowno) {\r\n\t\tif (!isTree) {\r\n\t\t\treturn rowno + this.fixedRows;\r\n\t\t}\r\n\t\tif (rowno < 0) {\r\n\t\t\trowno = rowno + this.fixedRows;\r\n\t\t\treturn rowno >= 0 ? rowno : -1;\r\n\t\t}\r\n\t\tif (rowno >= needShowRows.length) {\r\n\t\t\treturn -1;\r\n\t\t}\r\n\t\treturn needShowRows[rowno].recno;\r\n\t};\r\n\t\r\n\tthis.recnoToRowno = function (recno) {\r\n\t\tif (!isTree) {\r\n\t\t\treturn recno - this.fixedRows;\r\n\t\t}\r\n\t\tfor(var i = 0, cnt = needShowRows.length; i < cnt; i++){\r\n\t\t\tif (needShowRows[i].recno == recno) {\r\n\t\t\t\treturn i;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn -1;\r\n\t};\r\n\t\r\n\tthis.setVisibleStartRow = function (rowno, notFireEvt) {\r\n\t\tif (rowno >= 0) {\r\n\t\t\tvar maxVisibleNo = this.getNeedShowRowCount() - visibleCount;\r\n\t\t\tif (rowno > maxVisibleNo) {\r\n\t\t\t\trowno = maxVisibleNo;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (rowno < 0) {\r\n\t\t\trowno = 0;\r\n\t\t}\r\n\t\tif (visibleStartRow == rowno) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvisibleStartRow = rowno;\r\n\t\tvisibleEndRow = rowno + visibleCount - 1;\r\n\t\tif (!notFireEvt && this.onTopRownoChanged) {\r\n\t\t\tthis.onTopRownoChanged(rowno);\r\n\t\t}\r\n\t};\r\n\t\r\n\tthis.getVisibleStartRow = function () {\r\n\t\treturn visibleStartRow;\r\n\t};\r\n\t\r\n\tthis.setVisibleEndRow = function(endRow){\r\n\t\tvisibleEndRow = endRow;\r\n\t};\r\n\t\r\n\tthis.getVisibleEndRow = function(){\r\n\t\treturn visibleEndRow;\r\n\t};\r\n\t\r\n\tthis.setVisibleCount = function (count, notFireEvt) {\r\n\t\tif (visibleCount == count) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvisibleCount = count;\r\n\t\tvisibleEndRow = visibleStartRow + count - 1;\r\n\t\tif (!notFireEvt && this.onVisibleCountChanged) {\r\n\t\t\tthis.onVisibleCountChanged(count);\r\n\t\t}\r\n\t};\r\n\t\r\n\tthis.getVisibleCount = function () {\r\n\t\treturn visibleCount;\r\n\t};\r\n\t\r\n\tthis.getNeedShowRowCount = function () {\r\n\t\tif (!isTree) {\r\n\t\t\treturn dataset.recordCount()- this.fixedRows;\r\n\t\t}\r\n\t\treturn needShowRows.length;\r\n\t};\r\n\t\r\n\tthis.getCurrentRow = function(){\r\n\t\treturn needShowRows[currentRowno];\r\n\t};\r\n\t\r\n\tthis.skipSetCurrentRowno = function() {\r\n\t\tthis._skipSetCurrentRowno = true;\r\n\t};\r\n\t\r\n\tthis.setCurrentRowno = function (rowno, notFireEvt, checkVisible) {\r\n\t\tif(this._skipSetCurrentRowno) {\r\n\t\t\tthis._skipSetCurrentRowno = false;\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tif(rowno === undefined) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tvar preRowno = currentRowno, recno = 0, currRow=null;\r\n\t\tif (rowno < 0){//In the fixed row area\r\n\t\t\tvar lowestRowno = -1 * this.fixedRows;\r\n\t\t\tif (rowno < lowestRowno) {\r\n\t\t\t\trowno = lowestRowno;\r\n\t\t\t}\r\n\t\t\trecno = this.fixedRows + rowno;\r\n\t\t} else {\r\n\t\t\tvar maxRow = this.getNeedShowRowCount();\r\n\t\t\tif(maxRow === 0) {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t\tif (rowno >= maxRow) {\r\n\t\t\t\trowno = maxRow - 1;\r\n\t\t\t}\r\n\t\t\tif (!isTree) {\r\n\t\t\t\trecno = rowno + this.fixedRows;\r\n\t\t\t} else {\r\n\t\t\t\tcurrRow = needShowRows[rowno];\r\n\t\t\t\trecno = currRow.recno;\r\n\t\t\t}\r\n\t\t\tif (checkVisible) {\r\n\t\t\t\tif (rowno >= 0 && rowno < visibleStartRow){\r\n\t\t\t\t\tthis.setVisibleStartRow(rowno);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (rowno >= visibleStartRow + visibleCount) {\r\n\t\t\t\t\t\tthis.setVisibleStartRow(rowno - visibleCount + 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n//\t\tif (recno >= 0){\r\n//\t\t\tif(!dataset.recno(recno)) {\r\n//\t\t\t\treturn null;\r\n//\t\t\t}\r\n//\t\t}\r\n\t\tcurrentRowno = rowno;\r\n\t\tcurrentRecno = recno;\r\n\t\tif (!notFireEvt && this.onCurrentRownoChanged) {\r\n\t\t\tthis.onCurrentRownoChanged(preRowno, currentRowno);\r\n\t\t}\r\n\t\treturn currRow;\r\n\t};\r\n\t\r\n\tthis.getCurrentRowno = function () {\r\n\t\treturn currentRowno;\r\n\t};\r\n\t\r\n\tthis.getCurrentRecno = function() {\r\n\t\treturn currentRecno;\r\n\t};\r\n\t\r\n\tthis.nextRow = function () {\r\n\t\tdataset.confirm();\r\n\t\tthis.setCurrentRowno(currentRowno + 1, false, true);\r\n\t};\r\n\t\r\n\tthis.priorRow = function (num) {\r\n\t\tdataset.confirm();\r\n\t\tthis.setCurrentRowno(currentRowno - 1, false, true);\r\n\t};\r\n\t\r\n\tthis.nextPage = function () {\r\n\t\tdataset.confirm();\r\n\t\tthis.setVisibleStartRow(visibleStartRow + visibleCount);\r\n\t\tthis.setCurrentRowno(visibleStartRow);\r\n\t};\r\n\t\r\n\tthis.priorPage = function () {\r\n\t\tdataset.confirm();\r\n\t\tthis.setVisibleStartRow(visibleStartRow - visibleCount);\r\n\t\tthis.setCurrentRowno(visibleStartRow);\r\n\t};\r\n\t\r\n\tthis._innerFindNode = function (nodes, recno) {\r\n\t\tvar node, nextNode;\r\n\t\tfor (var i = 0, cnt = nodes.length - 1; i <= cnt; i++) {\r\n\t\t\tnode = nodes[i];\r\n\t\t\tif (node.recno == recno) {\r\n\t\t\t\treturn node;\r\n\t\t\t}\r\n\t\t\tif (node.children) {\r\n\t\t\t\tvar result = this._innerFindNode(node.children, recno);\r\n\t\t\t\tif (result) {\r\n\t\t\t\t\treturn result;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t};\r\n\t\r\n\tthis.expand = function (callbackFn) {\r\n\t\tif (!isTree) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar node = this._innerFindNode(allRows, dataset.recno());\r\n\t\tif (node === null) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tdataset.confirm();\r\n\t\tvar oldRecno = dataset.recnoSilence();\r\n\t\ttry {\r\n\t\t\tnode.expanded = node.children ? true : false;\r\n\t\t\tdataset.recnoSilence(node.recno);\r\n\t\t\tdataset.expanded(node.expanded);\r\n\t\t\tvar p = node;\r\n\t\t\twhile (true) {\r\n\t\t\t\tp = p.parent;\r\n\t\t\t\tif (!p) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tif (!p.expanded) {\r\n\t\t\t\t\tdataset.recnoSilence(p.recno);\r\n\t\t\t\t\tdataset.expanded(true);\r\n\t\t\t\t\tp.expanded = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} finally {\r\n\t\t\tdataset.recnoSilence(oldRecno);\r\n\t\t}\r\n\t\tthis._refreshNeedShowRows();\r\n\t\tif (callbackFn) {\r\n\t\t\tcallbackFn();\r\n\t\t}\r\n\t};\r\n\t\r\n\tthis.collapse = function (callbackFn) {\r\n\t\tif (!isTree) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar node = this._innerFindNode(allRows, dataset.recno());\r\n\t\tif (node === null) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tdataset.confirm();\r\n\t\tvar oldRecno = dataset.recnoSilence();\r\n\t\ttry {\r\n\t\t\tdataset.recnoSilence(node.recno);\r\n\t\t\tdataset.expanded(false);\r\n\t\t\tnode.expanded = false;\r\n\t\t} finally {\r\n\t\t\tdataset.recnoSilence(oldRecno);\r\n\t\t}\r\n\t\t\r\n\t\tthis._refreshNeedShowRows();\r\n\t\tif (callbackFn) {\r\n\t\t\tcallbackFn();\r\n\t\t}\r\n\t};\r\n\t\r\n\tthis._iterateNode = function (nodes, callbackFn) {\r\n\t\tvar node;\r\n\t\tfor (var i = 0, cnt = nodes.length; i < cnt; i++) {\r\n\t\t\tnode = nodes[i];\r\n\t\t\tif (node.children) {\r\n\t\t\t\tif (callbackFn) {\r\n\t\t\t\t\tcallbackFn(node);\r\n\t\t\t\t}\r\n\t\t\t\tif (node.children && node.children.length > 0) {\r\n\t\t\t\t\tthis._iterateNode(node.children, callbackFn);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t};\r\n\t\r\n\tthis._callbackFn = function (node, state) {\r\n\t\tvar oldRecno = dataset.recnoSilence();\r\n\t\ttry {\r\n\t\t\tdataset.recnoSilence(node.recno);\r\n\t\t\tdataset.expanded(state);\r\n\t\t\tnode.expanded = state;\r\n\t\t} finally {\r\n\t\t\tdataset.recnoSilence(oldRecno);\r\n\t\t}\r\n\t};\r\n\t\r\n\tthis.expandAll = function (callbackFn) {\r\n\t\tif (!isTree) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tdataset.confirm();\r\n\t\tvar Z = this;\r\n\t\tZ._iterateNode(allRows, function (node) {\r\n\t\t\tZ._callbackFn(node, true); \r\n\t\t});\r\n\t\tZ._refreshNeedShowRows();\r\n\t\tif (callbackFn) {\r\n\t\t\tcallbackFn();\r\n\t\t}\r\n\t};\r\n\t\r\n\tthis.collapseAll = function (callbackFn) {\r\n\t\tif (!isTree) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tdataset.confirm();\r\n\t\tvar Z = this;\r\n\t\tZ._iterateNode(allRows, function (node) {\r\n\t\t\tZ._callbackFn(node, false); \r\n\t\t});\r\n\t\tZ._refreshNeedShowRows();\r\n\t\tif (callbackFn) {\r\n\t\t\tcallbackFn();\r\n\t\t}\r\n\t};\r\n\t\r\n\tthis.syncDataset = function(){\r\n\t\tvar recno = dataset.recno();\r\n\t\tif(recno < 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar node = this._innerFindNode(allRows, dataset.recno()),\r\n\t\t\tpnode = node.parent;\r\n\t\tif (pnode && !pnode.expanded){\r\n\t\t\twhile(true){\r\n\t\t\t\tif (!pnode.expanded) {\r\n\t\t\t\t\tpnode.expanded = true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tpnode = pnode.parent;\r\n\t\t\t\tif (!pnode) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis._refreshNeedShowRows();\r\n\t\tvar rowno = this.recnoToRowno(recno);\r\n\t\tthis.setCurrentRowno(rowno, false, true);\r\n\t};\r\n\t\r\n\tthis.checkNode = function(state, relativeCheck, onlyCheckChildren){\r\n\t\tvar node = this.getCurrentRow();\r\n//\t\tif (node.state == state) {\r\n//\t\t\treturn;\r\n//\t\t}\r\n\t\tnode.state = state ? 1 : 0;\r\n\t\tdataset.selected(node.state);\r\n\r\n\t\tif (relativeCheck){\r\n\t\t\tif (node.children && node.children.length > 0) {\r\n\t\t\t\tthis._updateChildState(node, state);\r\n\t\t\t}\r\n\t\t\tif (node.parent && !onlyCheckChildren) {\r\n\t\t\t\tthis._updateParentState(node, state);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (state) {\r\n\t\t\tthis._updateParentNodeBoldByChecked(node);\r\n\t\t} else {\r\n\t\t\tthis._updateParentNodeBoldByNotChecked(node);\r\n\t\t}\r\n\t\t\r\n\t\tif (this.onCheckStateChanged) {\r\n\t\t\tthis.onCheckStateChanged();\r\n\t\t}\r\n\t};\r\n\t\r\n\tthis.checkChildNodes = function(state, relativeCheck){\r\n\t\tvar node = this.getCurrentRow();\r\n\t\tnode.state = state ? 1 : 0;\r\n\t\tdataset.selected(node.state);\r\n\r\n\t\tif (node.children && node.children.length > 0) {\r\n\t\t\tthis._updateChildState(node, state);\r\n\t\t}\r\n\t\tif (relativeCheck){\r\n\t\t\tif (node.parent) {\r\n\t\t\t\tthis._updateParentState(node, state);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (state) {\r\n\t\t\tthis._updateParentNodeBoldByChecked(node);\r\n\t\t} else {\r\n\t\t\tthis._updateParentNodeBoldByNotChecked(node);\r\n\t\t}\r\n\t\t\r\n\t\tif (this.onCheckStateChanged) {\r\n\t\t\tthis.onCheckStateChanged();\r\n\t\t}\r\n\t};\r\n\t\r\n\tthis._updateChildState = function(node, state){\r\n\t\tvar oldRecno = dataset.recnoSilence(),\r\n\t\t\tchildNode;\r\n\t\ttry{\r\n\t\t\tfor(var i = 0, cnt = node.children.length; i < cnt; i++){\r\n\t\t\t\tchildNode = node.children[i];\r\n\t\t\t\tchildNode.state = state;\r\n\t\t\t\tdataset.recnoSilence(childNode.recno);\r\n\t\t\t\tdataset.selected(state);\r\n\t\t\t\tif (childNode.children && childNode.children.length > 0) {\r\n\t\t\t\t\tthis._updateChildState(childNode, state);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} finally {\r\n\t\t\tdataset.recnoSilence(oldRecno);\r\n\t\t}\r\n\t};\r\n\t\r\n\tthis._updateParentState = function(node, state){\r\n\t\tvar pNode = node.parent;\r\n\t\tif (!pNode) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar childNode, newState;\r\n\t\tif (state != 2){\r\n\t\t\tfor(var i = 0, cnt = pNode.children.length; i < cnt; i++){\r\n\t\t\t\tchildNode = pNode.children[i];\r\n\t\t\t\tif (childNode.state == 2){\r\n\t\t\t\t\tnewState = 2;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tif (i === 0){\r\n\t\t\t\t\tnewState = childNode.state;\r\n\t\t\t\t} else if (newState != childNode.state){\r\n\t\t\t\t\t\tnewState =2;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t}//end for\r\n\t\t} else {\r\n\t\t\tnewState = state;\r\n\t\t}\r\n\t\tif (pNode.state != newState){\r\n\t\t\tpNode.state = newState;\r\n\t\t\tvar oldRecno = dataset.recnoSilence();\r\n\t\t\ttry{\r\n\t\t\t\tdataset.recnoSilence(pNode.recno);\r\n\t\t\t\tdataset.selected(newState);\r\n\t\t\t}finally{\r\n\t\t\t\tdataset.recnoSilence(oldRecno);\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis._updateParentState(pNode, newState);\r\n\t};\r\n\t\r\n\tthis.destroy = function(){\r\n\t\tdataset = null;\r\n\t\tallRows = null;\r\n\t\r\n\t\tthis.onTopRownoChanged = null;\r\n\t\tthis.onVisibleCountChanged = null;\r\n\t\tthis.onCurrentRownoChanged = null;\r\n\t\tthis.onNeedShowRowsCountChanged = null;\r\n\t\tthis.onCheckStateChanged = null;\r\n\t};\r\n};\r\n\n/* ========================================================================\r\n * Jslet framework: jslet.dbautocomplete.js\r\n *\r\n * Copyright (c) 2014 Jslet Group(https://github.com/jslet/jslet/)\r\n * Licensed under MIT (https://github.com/jslet/jslet/LICENSE.txt)\r\n * ======================================================================== */\r\n\r\n/**\r\n * @class DBAutoComplete. Example:\r\n * <pre><code>\r\n * var jsletParam = {type:\"DBAutoComplete\",field:\"department\", matchType:\"start\"};\r\n * //1. Declaring:\r\n *      &lt;input id=\"cboAuto\" type=\"text\" data-jslet='jsletParam' />\r\n *      \r\n *  //2. Binding\r\n *      &lt;input id=\"cboAuto\" type=\"text\" data-jslet='jsletParam' />\r\n *      //Js snippet\r\n *      var el = document.getElementById('cboAuto');\r\n *      jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *  //3. Create dynamically\r\n *      jslet.ui.createControl(jsletParam, document.body);\r\n *\r\n * </code></pre>\r\n */\r\njslet.ui.DBAutoComplete = jslet.Class.create(jslet.ui.DBText, {\r\n\t\r\n\tMatchModes: ['start','end', 'any'],\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tif (!Z.allProperties) {\r\n\t\t\tZ.allProperties = 'dataset,field,lookupField,minChars,minDelay,displayTemplate,matchMode,beforePopup,onGetFilterField,filterFields';\r\n\t\t}\r\n\t\t\r\n\t\tZ._lookupField = null;\r\n\t\t\r\n\t\tZ._minChars = 0;\r\n\r\n\t\tZ._minDelay = 0;\r\n\t\t\r\n\t\tZ._beforePopup = null;\r\n\t\t\r\n\t\tZ._filterFields = null;\r\n\t\t\r\n\t\tZ._defaultFilterFields = null;\r\n\t\t\r\n\t\tZ._onGetFilterField = null;\r\n\t\t\r\n\t\tZ._matchMode = 'start';\r\n\t\t\r\n\t\tZ._timeoutHandler = null; \r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set lookup field name.\r\n\t * \r\n\t * @Param {String} lookup field name.\r\n\t * @return {this or String}\r\n\t */\r\n\tlookupField: function(lookupField) {\r\n\t\tif(lookupField === undefined) {\r\n\t\t\treturn this._lookupField;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBAutoComplete.lookupField', lookupField).isString();\r\n\t\tthis._lookupField = lookupField;\r\n\t},\r\n   \r\n\t/**\r\n\t * Get or set minimum characters before searching.\r\n\t * \r\n\t * @Param {Integer} Minimum character before searching.\r\n\t * @return {this or Integer}\r\n\t */\r\n\tminChars: function(minChars) {\r\n\t\tif(minChars === undefined) {\r\n\t\t\treturn this._minChars;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBAutoComplete.minChars', minChars).isGTEZero();\r\n\t\tthis._minChars = parseInt(minChars);\r\n\t},\r\n   \r\n\t/**\r\n\t * Get or set delay time(ms) before auto searching.\r\n\t * \r\n\t * @param {Integer} minDelay Delay time.\r\n\t * @return {this or Integer}\r\n\t */\r\n\tminDelay: function(minDelay) {\r\n\t\tif(minDelay === undefined) {\r\n\t\t\treturn this._minDelay;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBAutoComplete.minDelay', minDelay).isGTEZero();\r\n\t\tthis._minDelay = parseInt(minDelay);\r\n\t},\r\n   \r\n\t/**\r\n\t * Get or set delay time(ms) before auto searching.\r\n\t * \r\n\t * @param {String} matchMode match mode,optional values: 'start', 'end', 'any', default: 'start'\r\n\t * @return {this or String}\r\n\t */\r\n\tmatchMode: function(matchMode) {\r\n\t\tif(matchMode === undefined) {\r\n\t\t\treturn this._matchMode;\r\n\t\t}\r\n\t\tmatchMode = jQuery.trim(matchMode);\r\n\t\tvar checker = jslet.Checker.test('DBAutoComplete.matchMode', matchMode).isString();\r\n\t\tmatchMode = matchMode.toLowerCase();\r\n\t\tchecker.testValue(matchMode).inArray(this.MatchModes);\r\n\t\tthis._matchMode = matchMode;\r\n\t},\r\n   \r\n\t/**\r\n\t * {Function} Before pop up event handler, you can use this to customize the display result.\r\n\t * Pattern: \r\n\t *   function(dataset, inputValue){}\r\n\t *   //dataset: jslet.data.Dataset; \r\n\t *   //inputValue: String\r\n\t */\r\n\tbeforePopup: function(beforePopup) {\r\n\t\tif(beforePopup === undefined) {\r\n\t\t\treturn this._beforePopup;\r\n\t\t}\r\n\t\tthis._beforePopup = beforePopup;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get or set filter fields, more than one fields are separated with ','.\r\n\t * \r\n\t * @param {String} filterFields filter fields.\r\n\t * @return {this or String}\r\n\t */\r\n\tfilterFields: function(filterFields) {\r\n\t\tif(filterFields === undefined) {\r\n\t\t\treturn Z._filterFields;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBAutoComplete.filterFields', filterFields).isString();\r\n\t\tZ._filterFields = filterFields;\r\n\t},\r\n\t\r\n\t/**\r\n\t * {Function} Get filter field event handler, you can use this to customize the display result.\r\n\t * Pattern: \r\n\t *   function(dataset, inputValue){}\r\n\t *   //dataset: jslet.data.Dataset; \r\n\t *   //inputValue: String\r\n\t *   //return: String Field name\r\n\t */\r\n\tonGetFilterField: function(onGetFilterField) {\r\n\t\tif(onGetFilterField === undefined) {\r\n\t\t\treturn this._onGetFilterField;\r\n\t\t}\r\n\t\tthis._onGetFilterField = onGetFilterField;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\treturn el.tagName.toLowerCase() == 'input' &&\r\n\t\t\tel.type.toLowerCase() == 'text';\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdoBlur: function () {\r\n\t\tvar Z = this;\r\n\t\tif (Z.el.disabled || Z.el.readOnly) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar\tfldObj = Z._dataset.getField(Z._field);\r\n\t\tif (fldObj.readOnly() || fldObj.disabled()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (Z.contentPanel && Z.contentPanel.isShowing()) {\r\n\t\t\twindow.setTimeout(function(){\r\n\t\t\t\tif(Z._isSelecting) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tvar value = Z.el.value, canBlur = true;\r\n\t\t\t\tif(!Z._lookupField) {\r\n\t\t\t\t\tvar fldObj = Z._dataset.getField(Z._field),\r\n\t\t\t\t\t\tlkf = fldObj.lookup(),\r\n\t\t\t\t\t\tlkds = lkf.dataset();\r\n\t\t\t\t\tif(value.length > 0 && lkds.recordCount() === 0) {\r\n\t\t\t\t\t\tcanBlur = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (Z.contentPanel && Z.contentPanel.isShowing()) {\r\n\t\t\t\t\tZ.contentPanel.closePopup();\r\n\t\t\t\t}\r\n\t\t\t\tZ.updateToDataset();\r\n\t\t\t\tZ.refreshControl(jslet.data.RefreshEvent.updateRecordEvent(Z._field));\r\n\t\t\t\tif(!canBlur) {\r\n\t\t\t\t\tZ.el.focus();\r\n\t\t\t\t}\r\n\t\t\t}, 200);\r\n\t\t} else {\r\n\t\t\tZ.updateToDataset();\r\n\t\t\tZ.refreshControl(jslet.data.RefreshEvent.updateRecordEvent(Z._field));\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdoChange: null,\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdoKeydown: function (event) {\r\n\t\tif (this.disabled || this.readOnly) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tevent = jQuery.event.fix( event || window.event );\r\n\r\n\t\tvar keyCode = event.which, Z = this.jslet;\r\n\t\tif(keyCode >= 112 && keyCode <= 123 || keyCode == 16 || keyCode == 17 || keyCode == 18 || //F1-F12, ctrl, shift, alt\r\n\t\t\t\tkeyCode == 20 || keyCode == 45 || keyCode == 35 || keyCode == 36 || keyCode == 34 || keyCode == 33) { //CapsLock, Insert, Home, End, PageUp, PageDown \r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif ((keyCode == 38 || keyCode == 40) && Z.contentPanel && Z.contentPanel.isPop) {\r\n\t\t\tvar fldObj = Z._dataset.getField(Z._lookupField || Z._field),\r\n\t\t\tlkf = fldObj.lookup(),\r\n\t\t\tlkds = lkf.dataset();\r\n\t\t\tif (keyCode == 38) { //up arrow\r\n\t\t\t\tlkds.prior();\r\n\t\t\t\tevent.preventDefault();\r\n\t       \t\tevent.stopImmediatePropagation();\r\n\t\t\t}\r\n\t\t\tif (keyCode == 40) {//down arrow\r\n\t\t\t\tlkds.next();\r\n\t\t\t\tevent.preventDefault();\r\n\t       \t\tevent.stopImmediatePropagation();\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (keyCode == 8 || keyCode == 46 || keyCode == 229) {//delete/backspace/ime\r\n\t\t\tthis.jslet._invokePopup();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (keyCode != 13 && keyCode != 9) {\r\n\t\t\tZ._invokePopup();\r\n\t\t} else if (Z.contentPanel) {\r\n\t\t\tif(Z.contentPanel.isShowing()) {\r\n\t\t\t\tZ.contentPanel.confirmSelect();\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdoKeypress: function (event) {\r\n\t\tif (this.disabled || this.readOnly) {\r\n\t\t\treturn;\r\n\t\t}\r\n//\t\tvar keyCode = event.keyCode ? event.keyCode : \r\n//\t\t\tevent.which\t? event.which: event.charCode;\r\n//\t\tvar Z = this.jslet;\r\n//\t\tif (keyCode != 13 && keyCode != 9) {\r\n//\t\t\tZ._invokePopup();\r\n//\t\t} else if (Z.contentPanel) {\r\n//\t\t\tif(Z.contentPanel.isShowing()) {\r\n//\t\t\t\tZ.contentPanel.confirmSelect();\r\n//\t\t\t}\r\n//\t\t}\r\n\t},\r\n\r\n\t_invokePopup: function () {\r\n\t\tvar Z = this;\r\n\t\tif (Z._timeoutHandler) {\r\n\t\t\tclearTimeout(Z._timeoutHandler);\r\n\t\t}\r\n\t\tvar delayTime = 100;\r\n\t\tif (Z._minDelay) {\r\n\t\t\tdelayTime = parseInt(Z._minDelay);\r\n\t\t}\r\n\t\t\r\n\t\tZ._timeoutHandler = setTimeout(function () {\r\n\t\t\tZ._populate(Z.el.value); \r\n\t\t}, delayTime);\r\n\t},\r\n\r\n\t_getDefaultFilterFields: function(lookupFldObj) {\r\n\t\tvar Z = this;\r\n\t\tif(Z._defaultFilterFields) {\r\n\t\t\treturn Z._defaultFilterFields;\r\n\t\t}\r\n\t\tvar codeFld = lookupFldObj.codeField(),\r\n\t\t\tnameFld = lookupFldObj.nameField(),\r\n\t\t\tlkDs = lookupFldObj.dataset(),\r\n\t\t\tcodeFldObj = lkDs.getField(codeFld),\r\n\t\t\tnameFldObj = lkDs.getField(nameFld),\r\n\t\t\tarrFields = [];\r\n\t\tif(codeFldObj && codeFldObj.visible()) {\r\n\t\t\tarrFields.push(codeFld);\r\n\t\t}\r\n\t\tif(codeFld != nameFld && nameFldObj && nameFldObj.visible()) {\r\n\t\t\tarrFields.push(nameFld);\r\n\t\t}\r\n\t\tZ._defaultFilterFields = arrFields;\r\n\t\treturn arrFields;\r\n\t},\r\n\t\r\n\t_getFilterFields: function(lkFldObj, inputValue) {\r\n\t\tvar Z = this;\r\n\t\tvar filterFlds = null;\r\n\t\t\r\n\t\tvar eventFunc = jslet.getFunction(Z._onGetFilterField);\r\n\t\tif (eventFunc) {\r\n\t\t\tfilterFlds = eventFunc.call(Z, lkFldObj.dataset(), inputValue);\r\n\t\t\tjslet.Checker.test('DBAutoComplete.onGetFilterField#return', filterFlds).isString();\r\n\t\t}\r\n\t\tfilterFlds = filterFlds || Z._filterFields;\r\n\t\tvar arrFields;\r\n\t\tif (filterFlds) {\r\n\t\t\tarrFields = filterFlds.split(',');\r\n\t\t} else {\r\n\t\t\tarrFields = Z._getDefaultFilterFields(lkFldObj);\r\n\t\t}\r\n\t\tif(arrFields.length === 0) {\r\n\t\t\tthrow new Error('Not specified [filter fields]!');\r\n\t\t}\r\n\t\tvar filterValue = inputValue;\r\n\t\tif (Z._matchMode == 'start') {\r\n\t\t\tfilterValue = filterValue + '%';\r\n\t\t} else {\r\n\t\t\tif (Z._matchMode == 'end') {\r\n\t\t\t\tfilterValue = '%' + filterValue;\r\n\t\t\t} else {\r\n\t\t\t\tfilterValue = '%' + filterValue + '%';\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar fldName, result = '';\r\n\t\tfor(var i = 0, len = arrFields.length; i < len; i++) {\r\n\t\t\tfldName = arrFields[i];\r\n\t\t\tif(i > 0) {\r\n\t\t\t\tresult += ' || '\r\n\t\t\t}\r\n\t\t\tresult += 'like([' + fldName + '],\"' + filterValue + '\")';\r\n\t\t}\r\n\t\treturn result;\r\n\t},\r\n\t\r\n\t_populate: function (inputValue) {\r\n\t\tvar Z = this;\r\n\t\tif (Z._minChars > 0 && inputValue && inputValue.length < Z._minChars) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar fldObj = Z._dataset.getField(Z._lookupField || Z._field),\r\n\t\t\tlkf = fldObj.lookup();\r\n\t\tif (!lkf) {\r\n\t\t\tconsole.error(Z._field + ' is NOT a lookup field!');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tvar lkds = lkf.dataset();\r\n\t\tvar eventFunc = jslet.getFunction(Z._beforePopup);\r\n\t\tif (eventFunc) {\r\n\t\t\teventFunc.call(Z, lkds, inputValue);\r\n\t\t} else if (inputValue) {\r\n\t\t\tvar filter = Z._getFilterFields(lkf, inputValue);\r\n\t\t\tlkds.filter(filter);\r\n\t\t\tlkds.filtered(true);\r\n\t\t} else {\r\n\t\t\tlkds.filter(null);\r\n\t\t}\r\n\t\t//Clear field value which specified by 'lookupField'.\r\n\t\tif(Z._lookupField) {\r\n\t\t\tZ._dataset.getRecord()[Z._lookupField] = null;\r\n\t\t}\r\n\t\tif (!Z.contentPanel) {\r\n\t\t\tZ.contentPanel = new jslet.ui.DBAutoCompletePanel(Z);\r\n\t\t} else {\r\n\t\t\tif(Z.contentPanel.isShowing()) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\tjslet.ui.PopupPanel.excludedElement = Z.el;\r\n\t\tvar jqEl = jQuery(Z.el),\r\n\t\t\tr = jqEl.offset(),\r\n\t\t\th = jqEl.outerHeight(),\r\n\t\t\tx = r.left,\r\n\t\t\ty = r.top + h;\r\n\t\t\r\n\t\tif (jslet.locale.isRtl){\r\n\t\t\tx = x + jqEl.outerWidth() - Z.contentPanel.dlgWidth;\r\n\t\t}\r\n\t\tZ.contentPanel.showPopup(x, y, 0, h);\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\tvar Z = this;\r\n\t\tjQuery(Z.el).off();\r\n\t\tif (Z.contentPanel){\r\n\t\t\tZ.contentPanel.destroy();\r\n\t\t\tZ.contentPanel = null;\r\n\t\t}\r\n\t\t$super();\r\n\t}\r\n\t\r\n});\r\n\r\n/**\r\n * @private\r\n * @class DBAutoCompletePanel\r\n * \r\n */\r\njslet.ui.DBAutoCompletePanel = function (autoCompleteObj) {\r\n\tvar Z = this;\r\n\tZ.dlgWidth = 320;\r\n\tZ.dlgHeight = 180;\r\n\r\n\tvar lkf, lkds;\r\n\tZ.comboCfg = autoCompleteObj;\r\n\tZ.dataset = autoCompleteObj.dataset();\r\n\tZ.field = autoCompleteObj.lookupField() || autoCompleteObj.field();\r\n\t\r\n\tZ.panel = null;\r\n\tZ.lkDataset = null;\r\n\tZ.popup = new jslet.ui.PopupPanel();\r\n\tZ.isPop = false;\r\n\r\n\tZ.create = function () {\r\n\t\tif (!Z.panel) {\r\n\t\t\tZ.panel = document.createElement('div');\r\n\t\t\tZ.panel.style.width = '100%';\r\n\t\t\tZ.panel.style.height = '100%';\r\n\t\t\tjQuery(Z.panel).on(\"mousedown\", function(event){\r\n\t\t\t\tZ.comboCfg._isSelecting = true;\r\n\t\t\t\tevent.stopPropagation();\r\n\t\t\t});\r\n\t\t}\r\n\t\t//process variable\r\n\t\tvar fldObj = Z.dataset.getField(Z.field),\r\n\t\t\tlkfld = fldObj.lookup(),\r\n\t\t\tlkds = lkfld.dataset();\r\n\t\tZ.lkDataset = lkds;\r\n\t\tvar fields = lkds.getNormalFields(),\r\n\t\t\ttotalChars = 0;\r\n\t\tfor(var i = 0, len = fields.length; i < len; i++) {\r\n\t\t\tfldObj = fields[i];\r\n\t\t\tif(fldObj.visible()) {\r\n\t\t\t\ttotalChars += fldObj.displayWidth();\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar totalWidth = totalChars * (jslet.global.defaultCharWidth || 12) + 30;\r\n\t\tZ.dlgWidth = totalWidth;\r\n\t\tif(Z.dlgWidth < 150) {\r\n\t\t\tZ.dlgWidth = 150;\r\n\t\t}\r\n\t\tif(Z.dlgWidth > 500) {\r\n\t\t\tZ.dlgWidth = 500;\r\n\t\t}\r\n\r\n\t\tZ.panel.innerHTML = '';\r\n\r\n\t\tvar cntw = Z.dlgWidth - 4,\r\n\t\t\tcnth = Z.dlgHeight - 4,\r\n\t\t\ttableparam = { type: 'DBTable', dataset: lkds, readOnly: true, noborder:true, hasSelectCol: false, hasSeqCol: false, hideHead: true };\r\n\t\ttableparam.onRowClick = Z.confirmSelect;\r\n\r\n\t\tZ.otable = jslet.ui.createControl(tableparam, Z.panel, '100%', cnth);\r\n\t\tZ.otable.el.focus();\r\n\t\tZ.otable.el.style.border = \"0\";\r\n\t\t\r\n\t\treturn Z.panel;\r\n\t};\r\n\r\n\tZ.confirmSelect = function () {\r\n\t\tZ.comboCfg._isSelecting = true;\r\n\t\tvar fldValue = Z.lkDataset.keyValue();\r\n\t\tif (fldValue || fldValue === 0) {\r\n\t\t\tZ.dataset.setFieldValue(Z.field, fldValue, Z.valueIndex);\r\n\t\t\t\r\n\t\t\tvar fldObj = Z.dataset.getField(Z.field),\r\n\t\t\t\tlkfldObj = fldObj.lookup(),\r\n\t\t\t\tfieldMap = lkfldObj.returnFieldMap();\r\n\t\t\tif(fieldMap) {\r\n\t\t\t\tvar lookupDs = lkfldObj.dataset();\r\n\t\t\t\t\tmainDs = Z.dataset;\r\n\t\t\t\tvar fldName, lkFldName;\r\n\t\t\t\tfor(var fldName in fieldMap) {\r\n\t\t\t\t\tlkFldName = fieldMap[fldName];\r\n\t\t\t\t\tmainDs.setFieldValue(fldName, lookupDs.getFieldValue(lkFldName));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tZ.comboCfg.el.focus();\r\n\t\t}\r\n\t\tif (Z.comboCfg.afterSelect) {\r\n\t\t\tZ.comboCfg.afterSelect(Z.dataset, Z.lkDataset);\r\n\t\t}\r\n\t\tZ.closePopup();\r\n\t};\r\n\r\n\tZ.showPopup = function (left, top, ajustX, ajustY) {\r\n\t\tif (!Z.panel) {\r\n\t\t\tZ.panel = Z.create();\r\n\t\t}\r\n\t\tZ.comboCfg._isSelecting = false;\r\n\t\tZ.isPop = true;\r\n\t\tvar p = Z.popup.getPopupPanel();\r\n\t\tp.style.padding = '0';\r\n\t\tZ.popup.setContent(Z.panel);\r\n\t\tZ.popup.onHidePopup = Z.doClosePopup;\r\n\t\tZ.popup.show(left, top, Z.dlgWidth, Z.dlgHeight, ajustX, ajustY);\r\n\t};\r\n\r\n\tZ.doClosePopup = function () {\r\n\t\tZ.isPop = false;\r\n\t\tvar oldRecno = Z.lkDataset.recno() || 0;\r\n\t\ttry {\r\n\t\t\tZ.lkDataset.filter(null);\r\n\t\t} finally {\r\n\t\t\tif(oldRecno >= 0) {\r\n\t\t\t\tZ.lkDataset.recno(oldRecno);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\t\r\n\tZ.closePopup = function () {\r\n\t\tZ.popup.hide();\r\n\t};\r\n\t\r\n\tZ.isShowing = function(){\r\n\t\tif (Z.popup) {\r\n\t\t\treturn Z.popup.isShowing;\r\n\t\t} else {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t};\r\n\t\r\n\tZ.destroy = function(){\r\n\t\tjQuery(Z.panel).off();\r\n\t\tZ.otable.onRowClick = null;\r\n\t\tZ.otable.destroy();\r\n\t\tZ.otable = null;\r\n\t\tZ.panel = null;\r\n\t\tZ.popup.destroy();\r\n\t\tZ.popup = null;\r\n\t\tZ.comboCfg = null;\r\n\t\tZ.dataset = null;\r\n\t\tZ.field = null;\r\n\t\tZ.lkDataset = null;\r\n\t};\r\n};\r\n\r\njslet.ui.register('DBAutoComplete', jslet.ui.DBAutoComplete);\r\njslet.ui.DBAutoComplete.htmlTemplate = '<input type=\"text\"></input>';\r\n\n/* ========================================================================\r\n * Jslet framework: jslet.dbbetweenedit.js\r\n *\r\n * Copyright (c) 2014 Jslet Group(https://github.com/jslet/jslet/)\r\n * Licensed under MIT (https://github.com/jslet/jslet/LICENSE.txt)\r\n * ======================================================================== */\r\n\r\n/**\r\n * @class DBBetweenEdit. \r\n * It implements \"From ... To ...\" style editor. This editor usually use in query parameter editor.\r\n * Example:\r\n * <pre><code>\r\n * var jsletParam = {type:\"DBBetweenEdit\",\"field\":\"dateFld\"};\r\n *\r\n * //1. Declaring:\r\n *  &lt;div data-jslet='jsletParam' />\r\n *\r\n *  //2. Binding\r\n *  &lt;div id=\"ctrlId\"  />\r\n * //Js snippet\r\n * var el = document.getElementById('ctrlId');\r\n * jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *  //3. Create dynamically\r\n * jslet.ui.createControl(jsletParam, document.body);\r\n *\r\n * </code></pre>\r\n */\r\njslet.ui.DBBetweenEdit = jslet.Class.create(jslet.ui.DBFieldControl, {\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tthis.allProperties = 'dataset,field';\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\tvar tagName = el.tagName.toLowerCase();\r\n\t\treturn tagName == 'div';\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tvar Z = this;\r\n\t\tZ.renderAll();\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trefreshControl: function (evt) {\r\n\t\treturn;\r\n\t}, // end refreshControl\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tvar Z = this;\r\n\t\tZ.removeAllChildControls();\r\n\t\tjslet.ui.textMeasurer.setElement(Z.el);\r\n\t\tvar lbl = jslet.locale.Dataset.betweenLabel;\r\n\t\tif (!lbl) {\r\n\t\t\tlbl = '-';\r\n\t\t}\r\n\t\tlbl = '&nbsp;' + lbl + '&nbsp;';\r\n\t\tvar w = jslet.ui.textMeasurer.getWidth(lbl);\r\n\r\n\t\tvar template = ['<table style=\"width:100%;margin:0px\" cellspacing=\"0\" cellpadding=\"0\"><col /><col width=\"', w,\r\n\t\t\t\t'px\" /><col /><tbody><tr><td></td><td>', lbl,\r\n\t\t\t\t'</td><td></td></tr></tbody></table>'];\r\n\t\tZ.el.innerHTML = template.join('');\r\n\t\tvar arrTd = jQuery(Z.el).find('td'),\r\n\t\t\tminTd = arrTd[0],\r\n\t\t\tmaxTd = arrTd[2],\r\n\t\t\tfldObj = Z._dataset.getField(Z._field),\r\n\t\t\tparam = fldObj.editControl();\r\n\r\n\t\tparam.dataset = Z._dataset;\r\n\t\tparam.field = Z._field;\r\n\t\tparam.valueIndex = 0;\r\n\t\tvar dbctrl = jslet.ui.createControl(param, minTd);\r\n\t\tdbctrl.el.style.width = '98%';\r\n\t\tZ.minElement = dbctrl;\r\n\t\tZ.addChildControl(dbctrl);\r\n\t\t\r\n\t\tparam.valueIndex = 1;\r\n\t\tdbctrl = jslet.ui.createControl(param, maxTd);\r\n\t\tdbctrl.el.style.width = '98%';\r\n\t\tZ.addChildControl(dbctrl);\r\n\t},\r\n\t\r\n\tfocus: function() {\r\n\t\tthis.minElement.focus();\r\n\t}\r\n\t\r\n});\r\n\r\njslet.ui.register('DBBetweenEdit', jslet.ui.DBBetweenEdit);\r\njslet.ui.DBBetweenEdit.htmlTemplate = '<div></div>';\r\n\n/* ========================================================================\r\n * Jslet framework: jslet.dbcheckbox.js\r\n *\r\n * Copyright (c) 2014 Jslet Group(https://github.com/jslet/jslet/)\r\n * Licensed under MIT (https://github.com/jslet/jslet/LICENSE.txt)\r\n * ======================================================================== */\r\n\r\n/**\r\n * @class DBCheckBox. \r\n * Example:\r\n * <pre><code>\r\n * var jsletParam = {type:\"DBCheckBox\", dataset:\"employee\", field:\"married\"};\r\n * \r\n * //1. Declaring:\r\n * &lt;input type='checkbox' data-jslet='type:\"DBCheckBox\",dataset:\"employee\", field:\"married\"' />\r\n * or\r\n * &lt;div data-jslet='jsletParam' />\r\n *\r\n *  //2. Binding\r\n * &lt;input id=\"ctrlId\" type=\"checkbox\" />\r\n * //Js snippet\r\n * var el = document.getElementById('ctrlId');\r\n * jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *  //3. Create dynamically\r\n * jslet.ui.createControl(jsletParam, document.body);\r\n * \r\n * </code></pre>\r\n */\r\n\r\n/**\r\n* DBCheckBox\r\n*/\r\njslet.ui.DBCheckBox = jslet.Class.create(jslet.ui.DBFieldControl, {\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.isCheckBox = true;\r\n\t\tZ.allProperties = 'dataset,field,beforeClick';\r\n\t\tZ._beforeClick = null;\r\n\t\t\r\n\t\tZ._skipRefresh = false;\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\tbeforeClick: function(beforeClick) {\r\n\t\tif(beforeClick === undefined) {\r\n\t\t\treturn this._beforeClick;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBCheckBox.beforeClick', beforeClick).isFunction();\r\n\t\tthis._beforeClick = beforeClick;\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\treturn el.tagName.toLowerCase() == 'input' &&\r\n\t\t\tel.type.toLowerCase() == 'checkbox';\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tvar Z = this;\r\n\r\n\t\tZ.renderAll();\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tjqEl.on('click', Z._doClick);\r\n\t\tjqEl.focus(function(event) {\r\n\t\t\tjqEl.trigger('editing', [Z._field]);\r\n\t\t});\r\n\t\tjqEl.addClass('checkbox-inline');\r\n\t}, // end bind\r\n\r\n\t_doClick: function (event) {\r\n\t\tvar Z = this.jslet;\r\n\t\tvar ctrlRecno = Z.ctrlRecno();\r\n\t\tif(ctrlRecno >= 0 && ctrlRecno != Z._dataset.recno()) {\r\n\t\t\tZ._skipRefresh = true;\r\n\t\t\ttry {\r\n\t\t\t\tZ._dataset.recno(ctrlRecno);\r\n\t\t\t} finally {\r\n\t\t\t\tZ._skipRefresh = false;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (Z._beforeClick) {\r\n\t\t\tvar result = Z._beforeClick.call(Z, Z.el);\r\n\t\t\tif (!result) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\tZ.updateToDataset();\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdoMetaChanged: function($super, metaName){\r\n\t\t$super(metaName);\r\n\t\tvar Z = this,\r\n\t\t\tfldObj = Z._dataset.getField(Z._field);\r\n\t\tif(!metaName || metaName == \"disabled\" || metaName == \"readOnly\") {\r\n\t\t\tvar disabled = fldObj.disabled() || fldObj.readOnly();\r\n\t\t\tjslet.ui.setEditableStyle(Z.el, disabled, disabled, false, fldObj.required());\r\n\t\t\tZ.setTabIndex();\r\n\t\t}\r\n\t\tif(!metaName || metaName == 'tabIndex') {\r\n\t\t\tZ.setTabIndex();\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdoValueChanged: function() {\r\n\t\tvar Z = this;\r\n\t\tif(Z._skipRefresh) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar fldObj = Z._dataset.getField(Z._field),\r\n\t\t\tvalue = Z.getValue();\r\n\t\tif (value) {\r\n\t\t\tZ.el.checked = true;\r\n\t\t} else {\r\n\t\t\tZ.el.checked = false;\r\n\t\t}\r\n\t},\r\n\t\r\n\tfocus: function() {\r\n\t\tthis.el.focus();\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tthis.refreshControl(jslet.data.RefreshEvent.updateAllEvent(), true);\r\n\t}, // end renderAll\r\n\r\n\tupdateToDataset: function () {\r\n\t\tvar Z = this;\r\n\t\tif (Z._keep_silence_) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar fldObj = Z._dataset.getField(Z._field),\r\n\t\t\tvalue = Z.el.checked;\r\n\t\tZ._keep_silence_ = true;\r\n\t\ttry {\r\n\t\t\tZ._dataset.setFieldValue(Z._field, value, Z._valueIndex);\r\n\t\t} finally {\r\n\t\t\tZ._keep_silence_ = false;\r\n\t\t}\r\n\t}, // end updateToDataset\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\tjQuery(this.el).off();\r\n\t\t$super();\r\n\t}\r\n});\r\n\r\njslet.ui.register('DBCheckBox', jslet.ui.DBCheckBox);\r\njslet.ui.DBCheckBox.htmlTemplate = '<input type=\"checkbox\"></input>';\r\n\r\n\n/* ========================================================================\r\n * Jslet framework: jslet.dbcheckboxgroup.js\r\n *\r\n * Copyright (c) 2014 Jslet Group(https://github.com/jslet/jslet/)\r\n * Licensed under MIT (https://github.com/jslet/jslet/LICENSE.txt)\r\n * ======================================================================== */\r\n\r\n/**\r\n * @class DBCheckBoxGroup. \r\n * Display a group of checkbox. Example:\r\n * <pre><code>\r\n * var jsletParam = {type:\"DBCheckBoxGroup\",dataset:\"employee\",field:\"department\", columnCount: 3};\r\n * \r\n * //1. Declaring:\r\n * &lt;div data-jslet='type:\"DBCheckBoxGroup\",dataset:\"employee\",field:\"department\", columnCount: 3' />\r\n * or\r\n * &lt;div data-jslet='jsletParam' />\r\n *  \r\n *  //2. Binding\r\n * &lt;div id=\"ctrlId\"  />\r\n * //Js snippet\r\n * var el = document.getElementById('ctrlId');\r\n * jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *  //3. Create dynamically\r\n * jslet.ui.createControl(jsletParam, document.body);\r\n *\r\n * </code></pre>\r\n */\r\njslet.ui.DBCheckBoxGroup = jslet.Class.create(jslet.ui.DBFieldControl, {\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.allProperties = 'dataset,field,columnCount,hasSelectAllBox';\r\n\t\t/**\r\n\t\t * {Integer} Column count\r\n\t\t */\r\n\t\tZ._columnCount = 99999;\r\n\t\tZ._itemIds = null;\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\tcolumnCount: function(columnCount) {\r\n\t\tif(columnCount === undefined) {\r\n\t\t\treturn this._columnCount;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBCheckBoxGroup.columnCount', columnCount).isGTEZero();\r\n\t\tthis._columnCount = parseInt(columnCount);\r\n\t},\r\n\t\r\n\thasSelectAllBox: function(hasSelectAllBox) {\r\n\t\tif(hasSelectAllBox === undefined) {\r\n\t\t\treturn this._hasSelectAllBox;\r\n\t\t}\r\n\t\tthis._hasSelectAllBox = hasSelectAllBox? true: false;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\tvar tagName = el.tagName.toLowerCase();\r\n\t\treturn tagName == 'div';\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tvar Z = this;\r\n\t\tZ.renderAll();\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tjqEl.on('click', 'input[type=\"checkbox\"]', function (event) {\r\n\t\t\tvar ctrl = this;\r\n\t\t\twindow.setTimeout(function(){ //Defer firing 'updateToDataset' when this control is in DBTable to make row changed firstly.\r\n\t\t\t\tevent.delegateTarget.jslet.updateToDataset(ctrl);\r\n\t\t\t}, 5)\r\n\t\t});\r\n\t\tjqEl.on('focus', 'input[type=\"checkbox\"]', function (event) {\r\n\t\t\tjqEl.trigger('editing', [Z._field]);\r\n\t\t});\r\n\t\tjqEl.addClass('form-control');//Bootstrap class\r\n\t\tjqEl.css('height', 'auto');\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdoMetaChanged: function($super, metaName){\r\n\t\t$super(metaName);\r\n\t\tvar Z = this,\r\n\t\t\tfldObj = Z._dataset.getField(Z._field);\r\n\t\tif(!metaName || metaName == \"disabled\" || metaName == \"readOnly\" || metaName == 'tabIndex') {\r\n\t\t\tvar disabled = fldObj.disabled(),\r\n\t\t\t\treadOnly = fldObj.readOnly();\r\n\t\t\tdisabled = disabled || readOnly;\r\n\t\t\tvar chkBoxes = jQuery(Z.el).find('input[type=\"checkbox\"]'),\r\n\t\t\t\tchkEle, \r\n\t\t\t\ttabIndex = fldObj.tabIndex(),\r\n\t\t\t\trequired = fldObj.required();\r\n\t\t\tfor(var i = 0, cnt = chkBoxes.length; i < cnt; i++){\r\n\t\t\t\tchkEle = chkBoxes[i];\r\n\t\t\t\tjslet.ui.setEditableStyle(chkEle, disabled, readOnly, false, required);\r\n\t\t\t\tchkEle.tabIndex = tabIndex;\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdoValueChanged: function() {\r\n\t\tvar Z = this;\r\n\t\tif (Z._keep_silence_) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar checkboxs = jQuery(Z.el).find('input[type=\"checkbox\"]'),\r\n\t\t\tchkcnt = checkboxs.length, \r\n\t\t\tcheckbox, i;\r\n\t\tfor (i = 0; i < chkcnt; i++) {\r\n\t\t\tcheckbox = checkboxs[i];\r\n\t\t\tif(jQuery(checkbox).hasClass('jl-selectall')) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tcheckbox.checked = false;\r\n\t\t}\r\n\t\tvar values = Z.getValue();\r\n\t\tif(values && values.length > 0) {\r\n\t\t\tvar valueCnt = values.length, value;\r\n\t\t\tfor (i = 0; i < chkcnt; i++) {\r\n\t\t\t\tcheckbox = checkboxs[i];\r\n\t\t\t\tfor (var j = 0; j < valueCnt; j++) {\r\n\t\t\t\t\tvalue = values[j];\r\n\t\t\t\t\tif (value == checkbox.value) {\r\n\t\t\t\t\t\tcheckbox.checked = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdoLookupChanged: function () {\r\n\t\tvar Z = this,\r\n\t\t\tfldObj = Z._dataset.getField(Z._field), \r\n\t\t\tlkf = fldObj.lookup();\r\n\t\tif (!lkf) {\r\n\t\t\tconsole.error(jslet.formatString(jslet.locale.Dataset.lookupNotFound,\r\n\t\t\t\t\t[fldObj.name()]));\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(fldObj.valueStyle() != jslet.data.FieldValueStyle.MULTIPLE) {\r\n\t\t\tfldObj.valueStyle(jslet.data.FieldValueStyle.MULTIPLE);\r\n\t\t}\r\n\t\t\r\n\t\tvar lkds = lkf.dataset(),\r\n\t\t\tlkCnt = lkds.recordCount();\r\n\t\tif(lkCnt === 0) {\r\n\t\t\tZ.el.innerHTML = jslet.locale.DBCheckBoxGroup.noOptions;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tZ._itemIds = [];\r\n\t\tvar template = ['<table cellpadding=\"0\" cellspacing=\"0\">'],\r\n\t\t\tisNewRow = false;\r\n\t\tvar editFilter = lkf.editFilter();\r\n\t\tZ._innerEditFilterExpr = null;\r\n\t\tvar editItemDisabled = lkf.editItemDisabled();\r\n\t\tif(editFilter) {\r\n\t\t\tZ._innerEditFilterExpr = new jslet.Expression(lkds, editFilter);\r\n\t\t}\r\n\t\tvar disableOption = false,\r\n\t\t\titemId = jslet.nextId(), k = -1;\r\n\t\tif(Z._hasSelectAllBox && lkCnt > 0) {\r\n\t\t\ttemplate.push('<tr>');\r\n\t\t\titemId = jslet.nextId();\r\n\t\t\ttemplate.push('<td style=\"white-space: nowrap; \"><input type=\"checkbox\" class=\"jl-selectall\"');\r\n\t\t\ttemplate.push(' id=\"');\r\n\t\t\ttemplate.push(itemId);\r\n\t\t\ttemplate.push('\"/><label for=\"');\r\n\t\t\ttemplate.push(itemId);\r\n\t\t\ttemplate.push('\">');\r\n\t\t\ttemplate.push(jslet.locale.DBCheckBoxGroup.selectAll);\r\n\t\t\ttemplate.push('</label></td>');\r\n\t\t\tk = 0;\r\n\t\t}\r\n\t\tvar oldRecno = lkds.recnoSilence();\r\n\t\ttry {\r\n\t\t\tfor (var i = 0; i < lkCnt; i++) {\r\n\t\t\t\tlkds.recnoSilence(i);\r\n\t\t\t\tdisableOption = false;\r\n\t\t\t\tif(Z._innerEditFilterExpr && !Z._innerEditFilterExpr.eval()) {\r\n\t\t\t\t\tif(!editItemDisabled) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tdisableOption = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tk++;\r\n\t\t\t\tisNewRow = (k % Z._columnCount === 0);\r\n\t\t\t\tif (isNewRow) {\r\n\t\t\t\t\tif (k > 0) {\r\n\t\t\t\t\t\ttemplate.push('</tr>');\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttemplate.push('<tr>');\r\n\t\t\t\t}\r\n\t\t\t\titemId = jslet.nextId();\r\n\t\t\t\ttemplate.push('<td style=\"white-space: nowrap; \"><input type=\"checkbox\" value=\"');\r\n\t\t\t\ttemplate.push(lkds.getFieldValue(lkf.keyField()));\r\n\t\t\t\ttemplate.push('\" id=\"');\r\n\t\t\t\ttemplate.push(itemId);\r\n\t\t\t\ttemplate.push('\" ' + (disableOption? ' disabled': '') + '/><label for=\"');\r\n\t\t\t\ttemplate.push(itemId);\r\n\t\t\t\ttemplate.push('\">');\r\n\t\t\t\ttemplate.push(lkf.getCurrentDisplayValue());\r\n\t\t\t\ttemplate.push('</label></td>');\r\n\t\t\t\tisNewRow = (k % Z._columnCount === 0);\r\n\t\t\t} // end for\r\n\t\t\tif (lkCnt > 0) {\r\n\t\t\t\ttemplate.push('</tr>');\r\n\t\t\t}\r\n\t\t\ttemplate.push('</table>');\r\n\t\t\tZ.el.innerHTML = template.join('');\r\n\t\t} finally {\r\n\t\t\tlkds.recnoSilence(oldRecno);\r\n\t\t}\r\n\t}, // end renderOptions\r\n\r\n\tupdateToDataset: function(currCheckBox) {\r\n\t\tvar Z = this;\r\n\t\tif (Z._is_silence_) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar allBoxes = jQuery(Z.el).find('input[type=\"checkbox\"]'), chkBox;\r\n\t\tif(jQuery(currCheckBox).hasClass('jl-selectall')) {\r\n\t\t\tvar isAllSelected = currCheckBox.checked;\r\n\t\t\tfor(var j = 0, allCnt = allBoxes.length; j < allCnt; j++){\r\n\t\t\t\tchkBox = allBoxes[j];\r\n\t\t\t\tif(chkBox == currCheckBox) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tif (!chkBox.disabled) {\r\n\t\t\t\t\tchkBox.checked = isAllSelected;\r\n\t\t\t\t}\r\n\t\t\t} //end for j\r\n\t\t\t\r\n\t\t}\r\n\t\tvar fldObj = Z._dataset.getField(Z._field),\r\n\t\t\tlimitCount = fldObj.valueCountLimit();\r\n\t\t\r\n\t\tvar values = [], count = 0;\r\n\t\tfor(var j = 0, allCnt = allBoxes.length; j < allCnt; j++){\r\n\t\t\tchkBox = allBoxes[j];\r\n\t\t\tif(jQuery(chkBox).hasClass('jl-selectall')) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif (chkBox.checked) {\r\n\t\t\t\tvalues.push(chkBox.value);\r\n\t\t\t\tcount ++;\r\n\t\t\t}\r\n\t\t} //end for j\r\n\r\n\t\tif (limitCount && count > limitCount) {\r\n\t\t\tcurrCheckBox.checked = !currCheckBox.checked;\r\n\t\t\tjslet.showInfo(jslet.formatString(jslet.locale.DBCheckBoxGroup.invalidCheckedCount,\r\n\t\t\t\t\t[''\t+ limitCount]));\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tZ._is_silence_ = true;\r\n\t\ttry {\r\n\t\t\tZ._dataset.setFieldValue(Z._field, values);\r\n\t\t} finally {\r\n\t\t\tZ._is_silence_ = false;\r\n\t\t}\r\n\t},\r\n\t\r\n\tfocus: function() {\r\n\t\tif (_itemIds && _itemIds.length > 0) {\r\n\t\t\tdocument.getElementById(_itemIds[0]).focus();\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tvar Z = this, \r\n\t\t\tjqEl = jQuery(Z.el);\r\n\t\tif(!jqEl.hasClass(\"jl-checkboxgroup\")) {\r\n\t\t\tjqEl.addClass(\"jl-checkboxgroup\");\r\n\t\t}\r\n\t\tZ.refreshControl(jslet.data.RefreshEvent.updateAllEvent(), true);\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\tvar jqEl = jQuery(this.el);\r\n\t\tjqEl.off();\r\n\t\t$super();\r\n\t}\r\n});\r\n\r\njslet.ui.register('DBCheckBoxGroup', jslet.ui.DBCheckBoxGroup);\r\njslet.ui.DBCheckBoxGroup.htmlTemplate = '<div></div>';\r\n\r\n\n/* ========================================================================\r\n * Jslet framework: jslet.dbcomboselect.js\r\n *\r\n * Copyright (c) 2014 Jslet Group(https://github.com/jslet/jslet/)\r\n * Licensed under MIT (https://github.com/jslet/jslet/LICENSE.txt)\r\n * ======================================================================== */\r\n\r\n/**\r\n * @class DBCombodlg. \r\n * Show data on a popup panel, it can display tree style or table style. \r\n * Example:\r\n * <pre><code>\r\n * var jsletParam = {type:\"DBCombodlg\",dataset:\"employee\",field:\"department\", textReadOnly:true};\r\n * \r\n * //1. Declaring:\r\n * &lt;div data-jslet='type:\"DBCombodlg\",dataset:\"employee\",field:\"department\", textReadOnly:true' />\r\n * or\r\n * &lt;div data-jslet='jsletParam' />\r\n *  \r\n *  //2. Binding\r\n * &lt;div id=\"ctrlId\"  />\r\n * //Js snippet\r\n * var el = document.getElementById('ctrlId');\r\n * jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *  //3. Create dynamically\r\n * jslet.ui.createControl(jsletParam, document.body);\r\n * \r\n * </code></pre>\r\n */\r\njslet.ui.DBComboSelect = jslet.Class.create(jslet.ui.DBCustomComboBox, {\r\n\tshowStyles: ['auto', 'table', 'tree'],\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.allProperties = 'dataset,field,textField,searchField,popupHeight,popupWidth,showStyle,textReadOnly,onGetSearchField,correlateCheck';\r\n\t\tZ._textField = null;\r\n\t\t\r\n\t\tZ._showStyle = 'auto';\r\n\t\t\r\n\t\tZ._popupWidth = 300;\r\n\r\n\t\tZ._popupHeight = 300;\r\n\t\t\r\n\t\tZ._contentPanel = null;\r\n\t\t\r\n\t\tZ._pickupField = null;\r\n\t\t\r\n\t\tZ._onGetSearchField = null;\r\n\t\t\r\n\t\tZ._correlateCheck = false;\r\n\t\t\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set the field name of text box.\r\n\t * \r\n\t * @param textField {String} Field name of text box.\r\n\t * @return {String or this}\r\n\t */\r\n\ttextField: function(textField) {\r\n\t\tif(textField === undefined) {\r\n\t\t\treturn this._textField;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBComboSelect.textField', textField).required().isString();\r\n\t\tthis._textField = textField.trim();\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get or set popup panel height.\r\n\t * \r\n\t * @param popupHeight {Integer} Popup panel height.\r\n\t * @return {Integer or this}\r\n\t */\r\n\tpopupHeight: function(popupHeight) {\r\n\t\tif(popupHeight === undefined) {\r\n\t\t\treturn this._popupHeight;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBComboSelect.popupHeight', popupHeight).isGTEZero();\r\n\t\tthis._popupHeight = parseInt(popupHeight);\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set popup panel width.\r\n\t * \r\n\t * @param popupHeight {Integer} Popup panel width.\r\n\t * @return {Integer or this}\r\n\t */\r\n\tpopupWidth: function(popupWidth) {\r\n\t\tif(popupWidth === undefined) {\r\n\t\t\treturn this._popupWidth;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBComboSelect.popupWidth', popupWidth).isGTEZero();\r\n\t\tthis._popupWidth = parseInt(popupWidth);\r\n\t},\r\n\t\t\r\n\t/**\r\n\t * Get or set panel content style.\r\n\t * \r\n\t * @param {String} Optional value: auto, table, tree.\r\n\t * @return {String or this}\r\n\t */\r\n\tshowStyle: function(showStyle) {\r\n\t\tif(showStyle === undefined) {\r\n\t\t\treturn this._showStyle;\r\n\t\t}\r\n\t\tshowStyle = jQuery.trim(showStyle);\r\n\t\tvar checker = jslet.Checker.test('DBComboSelect.showStyle', showStyle).isString();\r\n\t\tshowStyle = showStyle.toLowerCase();\r\n\t\tchecker.testValue(showStyle).inArray(this.showStyles);\r\n\t\tthis._showStyle = showStyle;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get or set onGetSearchField event handler.\r\n\t * \r\n\t * @param {Function} Optional onGetSearchField event handler.\r\n\t * @return {Function or this}\r\n\t */\r\n\tonGetSearchField: function(onGetSearchField) {\r\n\t\tif(onGetSearchField === undefined) {\r\n\t\t\treturn this._onGetSearchField;\r\n\t\t}\r\n\t\tthis._onGetSearchField = onGetSearchField;\r\n\t},\r\n\t\t\r\n\tcorrelateCheck: function(correlateCheck) {\r\n\t\tif(correlateCheck === undefined) {\r\n\t\t\treturn this._correlateCheck;\r\n\t\t}\r\n\t\tthis._correlateCheck = correlateCheck;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\treturn true;\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tafterBind: function ($super) {\r\n\t\t$super();\r\n\t\t\r\n\t\tif (this._contentPanel) {\r\n\t\t\tthis._contentPanel = null;\r\n\t\t}\r\n\t},\r\n\r\n\tbuttonClick: function (btnEle) {\r\n\t\tvar Z = this, \r\n\t\t\tel = Z.el, \r\n\t\t\tfldObj = Z._dataset.getField(Z._field), \r\n\t\t\tlkf = fldObj.lookup(),\r\n\t\t\tjqEl = jQuery(el);\r\n\t\tif (fldObj.readOnly() || fldObj.disabled()) {\r\n\t\t\treturn;\t\t\r\n\t\t}\r\n\t\tif (lkf === null && lkf === undefined) {\r\n\t\t\tthrow new Error(Z._field + ' is NOT a lookup field!');\r\n\t\t}\r\n\t\tvar style = Z._showStyle;\r\n\t\tif (Z._showStyle == 'auto') {\r\n\t\t\tstyle = lkf.parentField() ? 'tree' : 'table';\r\n\t\t}\r\n\t\tif (!Z._contentPanel) {\r\n\t\t\tZ._contentPanel = new jslet.ui.DBComboSelectPanel(Z);\r\n\t\t\tZ._contentPanel.showStyle = style;\r\n\t\t\tZ._contentPanel.customButtonLabel = Z.customButtonLabel;\r\n\t\t\tZ._contentPanel.onCustomButtonClick = Z.onCustomButtonClick;\r\n\t\t\tif (Z._popupWidth) {\r\n\t\t\t\tZ._contentPanel.popupWidth = Z._popupWidth;\r\n\t\t\t}\r\n\t\t\tif (Z._popupHeight) {\r\n\t\t\t\tZ._contentPanel.popupHeight = Z._popupHeight;\r\n\t\t\t}\r\n\t\t}\r\n\t\tjslet.ui.PopupPanel.excludedElement = btnEle;\r\n\t\tvar r = jqEl.offset(), h = jqEl.outerHeight(), x = r.left, y = r.top + h;\r\n\t\tif (jslet.locale.isRtl){\r\n\t\t\tx = x + jqEl.outerWidth();\r\n\t\t}\r\n\t\tZ._contentPanel.showPopup(x, y, 0, h);\r\n\t},\r\n\t\r\n\tclosePopup: function(){\r\n\t\tif(this._contentPanel) {\r\n\t\t\tthis._contentPanel.closePopup();\r\n\t\t}\r\n\t\tthis._contentPanel = null;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\tvar Z = this;\r\n\t\tif (Z._contentPanel){\r\n\t\t\tZ._contentPanel.destroy();\r\n\t\t\tZ._contentPanel = null;\r\n\t\t}\r\n\t\tjslet.ui.PopupPanel.excludedElement = null;\r\n\t\t$super();\r\n\t}\r\n});\r\n\r\njslet.ui.DBComboSelectPanel = function (comboSelectObj) {\r\n\tvar Z = this;\r\n\r\n\tZ.showStyle = 'auto';\r\n\r\n\tZ.customButtonLabel = null;\r\n\tZ.onCustomButtonClick = null;\r\n\tZ.popupWidth = 350;\r\n\tZ.popupHeight = 350;\r\n\r\n\tvar otree, otable, showType, valueSeperator = ',', lkf, lkds, self = this;\r\n\tZ.comboSelectObj = comboSelectObj;\r\n\r\n\tZ.dataset = comboSelectObj._dataset;\r\n\tZ.field = comboSelectObj._field;\r\n\tZ.fieldObject = Z.dataset.getField(Z.field);\r\n\tZ.panel = null;\r\n\tZ.searchBoxEle = null;\r\n\t\r\n\tZ.popup = new jslet.ui.PopupPanel();\r\n\tZ.popup.onHidePopup = function() {\r\n\t\tZ.comboSelectObj.focus();\r\n\t};\r\n};\r\n\r\njslet.ui.DBComboSelectPanel.prototype = {\r\n\t\t\r\n\tlookupDs: function() {\r\n\t\treturn this.fieldObject.lookup().dataset();\r\n\t},\r\n\t\r\n\tisMultiple: function() {\r\n\t\treturn this.fieldObject.valueStyle() == jslet.data.FieldValueStyle.MULTIPLE;\r\n\t},\r\n\t\t\r\n\tshowPopup: function (left, top, ajustX, ajustY) {\r\n\t\tvar Z = this;\r\n\t\tZ._initSelected();\r\n\t\tvar showType = Z.showStyle.toLowerCase();\r\n\t\tif (!Z.panel) {\r\n\t\t\tZ.panel = Z._create();\r\n\t\t} else {\r\n\t\t\tvar ojslet = Z.otree ? Z.otree : Z.otable;\r\n\t\t\tojslet.dataset().addLinkedControl(ojslet);\r\n\t\t\twindow.setTimeout(function(){\r\n\t\t\t\tojslet.renderAll();\r\n\t\t\t}, 1);\r\n\t\t}\r\n\t\tif(showType == 'table') {\r\n\t\t\tvar fields = Z.lookupDs().getNormalFields(),\r\n\t\t\t\tfldObj, totalChars = 0;\r\n\t\t\tfor(var i = 0, len = fields.length; i < len; i++) {\r\n\t\t\t\tfldObj = fields[i];\r\n\t\t\t\tif(fldObj.visible()) {\r\n\t\t\t\t\ttotalChars += fldObj.displayWidth();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tvar totalWidth = totalChars * (jslet.global.defaultCharWidth || 12) + 40;\r\n\t\t\tZ.popupWidth = totalWidth;\r\n\t\t\tif(Z.popupWidth < 150) {\r\n\t\t\t\tZ.popupWidth = 150;\r\n\t\t\t}\r\n\t\t\tif(Z.popupWidth > 500) {\r\n\t\t\t\tZ.popupWidth = 500;\r\n\t\t\t}\r\n\t\t}\r\n\t\tZ.popup.setContent(Z.panel, '100%', '100%');\r\n\t\tZ.popup.show(left, top, Z.popupWidth, Z.popupHeight, ajustX, ajustY);\r\n\t\tjQuery(Z.panel).find(\".jl-combopnl-head input\").focus();\r\n\t},\r\n\r\n\tclosePopup: function () {\r\n\t\tvar Z = this;\r\n\t\tvar fldObj = Z.dataset.getField(Z.field),\r\n\t\t\tlkfld = fldObj.lookup();\r\n\t\tif(Z.isMultiple() && lkfld.onlyLeafLevel()) {\r\n\t\t\tZ.lookupDs().onCheckSelectable(null);\r\n\t\t}\r\n\t\t\r\n\t\tZ.popup.hide();\r\n\t\tvar dispCtrl = Z.otree ? Z.otree : Z.otable;\r\n\t\tif(dispCtrl) {\r\n\t\t\tdispCtrl.dataset().removeLinkedControl(dispCtrl);\r\n\t\t}\r\n\t},\r\n\t\r\n\t_create: function () {\r\n\t\tvar Z = this;\r\n\t\tif (!Z.panel) {\r\n\t\t\tZ.panel = document.createElement('div');\r\n\t\t}\r\n\r\n\t\t//process variable\r\n\t\tvar fldObj = Z.dataset.getField(Z.field),\r\n\t\t\tlkfld = fldObj.lookup(),\r\n\t\t\tpfld = lkfld.parentField(),\r\n\t\t\tshowType = Z.showStyle.toLowerCase(),\r\n\t\t\tlkds = Z.lookupDs();\r\n\r\n\t\tvar template = ['<div class=\"jl-combopnl-head\"><div class=\"col-xs-12 jl-nospacing\">',\r\n\t\t                '<input class=\"form-control\" type=\"text\" size=\"20\"></input></div></div>',\r\n\t\t\t'<div class=\"jl-combopnl-content',\r\n\t\t\tZ.isMultiple() ? ' jl-combopnl-multiselect': '',\r\n\t\t\t'\"></div>',\r\n\t\t\t'<div class=\"jl-combopnl-footer\" style=\"display:none\"><button class=\"jl-combopnl-footer-cancel btn btn-default btn-sm\" >',\r\n\t\t\tjslet.locale.MessageBox.cancel,\r\n\t\t\t'</button><button class=\"jl-combopnl-footer-ok btn btn-default btn-sm\" >',\r\n\t\t\tjslet.locale.MessageBox.ok,\r\n\t\t\t'</button></div>'];\r\n\r\n\t\tZ.panel.innerHTML = template.join('');\r\n\t\tvar jqPanel = jQuery(Z.panel),\r\n\t\t\tjqPh = jqPanel.find('.jl-combopnl-head');\r\n\t\tjqPanel.on('keydown', function(event){\r\n\t\t\tif(event.keyCode === 27) {\r\n\t\t\t\tZ.closePopup();\r\n\t\t\t}\r\n\t\t});\r\n\t\tZ.searchBoxEle = jqPh.find('input')[0];\r\n\t\tjQuery(Z.searchBoxEle).on('keydown', jQuery.proxy(Z._findData, Z));\r\n\t\t\r\n\t\tvar jqContent = jqPanel.find('.jl-combopnl-content');\r\n\t\tif (Z.isMultiple()) {\r\n\t\t\tjqContent.addClass('jl-combopnl-content-nofooter').removeClass('jl-combopnl-content-nofooter');\r\n\t\t\tvar pnlFoot = jqPanel.find('.jl-combopnl-footer')[0];\r\n\t\t\tpnlFoot.style.display = 'block';\r\n\t\t\tvar jqFoot = jQuery(pnlFoot);\r\n\t\t\tjqFoot.find('.jl-combopnl-footer-cancel').click(jQuery.proxy(Z.closePopup, Z));\r\n\t\t\tjqFoot.find('.jl-combopnl-footer-ok').click(jQuery.proxy(Z._confirmSelect, Z));\r\n\t\t} else {\r\n\t\t\tjqContent.addClass('jl-combopnl-content-nofooter');\r\n\t\t}\r\n\r\n\t\tvar contentPanel = jqContent[0];\r\n\r\n\t\t//create popup content\r\n\t\tif (showType == 'tree') {\r\n\t\t\tvar treeparam = { \r\n\t\t\t\ttype: 'DBTreeView', \r\n\t\t\t\tdataset: lkds, \r\n\t\t\t\treadOnly: false, \r\n\t\t\t\tdisplayFields: lkfld.displayFields(), \r\n\t\t\t\thasCheckBox: Z.isMultiple()\r\n\t\t\t};\r\n\r\n\t\t\tif (!Z.isMultiple()) {\r\n\t\t\t\ttreeparam.onItemDblClick = jQuery.proxy(Z._confirmSelect, Z);\r\n\t\t\t}\r\n\t\t\ttreeparam.correlateCheck = Z.comboSelectObj.correlateCheck();\r\n\t\t\twindow.setTimeout(function(){\r\n\t\t\t\tZ.otree = jslet.ui.createControl(treeparam, contentPanel, '100%', '100%');\r\n\t\t\t}, 1);\r\n\t\t} else {\r\n\t\t\tvar tableparam = { type: 'DBTable', dataset: lkds, readOnly: true, hasSelectCol: Z.isMultiple(), hasSeqCol: false, hasFindDialog: false };\r\n\t\t\tif (!Z.isMultiple()) {\r\n\t\t\t\ttableparam.onRowDblClick = jQuery.proxy(Z._confirmSelect, Z);\r\n\t\t\t}\r\n\t\t\twindow.setTimeout(function(){\r\n\t\t\t\tZ.otable = jslet.ui.createControl(tableparam, contentPanel, '100%', '100%');\r\n\t\t\t}, 1);\r\n\t\t}\r\n\t\treturn Z.panel;\r\n\t},\r\n\r\n\t_initSelected: function () {\r\n\t\tvar Z = this;\r\n\t\tvar fldValue = Z.comboSelectObj.getValue(), \r\n\t\t\tlkds = Z.lookupDs();\r\n\r\n\t\tvar fldObj = Z.dataset.getField(Z.field),\r\n\t\t\tlkfld = fldObj.lookup();\r\n\r\n\t\tif(lkfld.onlyLeafLevel()) {\r\n\t\t\tlkds.onCheckSelectable(function(){\r\n\t\t\t\treturn !this.hasChildren();\r\n\t\t\t});\r\n\t\t}\r\n\t\tif (!Z.isMultiple()) {\r\n\t\t\tif (fldValue) {\r\n\t\t\t\tlkds.findByKey(fldValue);\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlkds.selectAll(false);\r\n\t\tif (fldValue) {\r\n\t\t\tvar arrKeyValues = fldValue;\r\n\t\t\tif(!jslet.isArray(fldValue)) {\r\n\t\t\t\tarrKeyValues = fldValue.split(jslet.global.valueSeparator);\r\n\t\t\t}\r\n\t\t\tfor (var i = 0, len = arrKeyValues.length; i < len; i++){\r\n\t\t\t\tlkds.selectByKeyValue(true, arrKeyValues[i]);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t_findData: function (event) {\r\n\t\tevent = jQuery.event.fix( event || window.event );\r\n\t\tif (event.which != 13) {//enter\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar Z = this;\r\n\t\tvar findFldName = Z.comboSelectObj.searchField, \r\n\t\t\tfindValue = this.searchBoxEle.value;\r\n\t\tif (!findValue) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar eventFunc = jslet.getFunction(Z.comboSelectObj.onGetSearchField);\r\n\t\tif (eventFunc) {\r\n\t\t\tfindFldName = eventFunc.call(findValue);\r\n\t\t}\r\n\t\tvar findFldNames = null;\r\n\t\tif(!findFldName) {\r\n\t\t\tvar lkFldObj = Z.fieldObject.lookup(),\r\n\t\t\t\tcodeFldName = lkFldObj.codeField(),\r\n\t\t\t\tnameFldName = lkFldObj.nameField();\r\n\t\t\t \r\n\t\t\tfindFldNames = [];\r\n\t\t\tcodeFldName && findFldNames.push(codeFldName);\r\n\t\t\tnameFldName && codeFldName != nameFldName && findFldNames.push(nameFldName);\r\n\t\t} else {\r\n\t\t\tfindFldNames = findFldName.split(',');\r\n\t\t}\r\n\t\tif(!findFldNames || findFldNames.length === 0) {\r\n\t\t\tconsole.warn('Search field NOT specified! Can\\'t search data!')\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar lkds = Z.lookupDs(), fldObj;\r\n\t\tfor(var i = 0, len = findFldNames.length; i < len; i++) {\r\n\t\t\tfindFldName = findFldNames[i];\r\n\t\t\tfldObj = lkds.getField(findFldName);\r\n\t\t\tif(!fldObj) {\r\n\t\t\t\tconsole.warn('Field Name: ' + findFldName + ' NOT exist!');\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif(lkds.find('like([' + findFldName + '],\"%' + findValue + '%\")')) {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t_confirmSelect: function () {\r\n\t\tvar Z = this;\r\n\t\tvar fldValue = Z.comboSelectObj.getValue(),\r\n\t\t\tfldObj = Z.dataset.getField(Z.field),\r\n\t\t\tlkfld = fldObj.lookup(),\r\n\t\t\tisMulti = Z.isMultiple(),\r\n\t\t\tlookupDs = Z.lookupDs();\r\n\t\t\r\n\t\tif(!lookupDs.checkSelectable()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (isMulti) {\r\n\t\t\tfldValue = lookupDs.selectedKeyValues();\r\n\t\t} else {\r\n\t\t\tfldValue = lookupDs.keyValue();\r\n\t\t}\r\n\r\n\t\tZ.dataset.setFieldValue(Z.field, fldValue, Z._valueIndex);\r\n\t\tif (!isMulti && Z.comboSelectObj._afterSelect) {\r\n\t\t\tZ.comboSelectObj._afterSelect(Z.dataset, lookupDs);\r\n\t\t}\r\n\t\tif(!isMulti) {\r\n\t\t\tvar fieldMap = lkfld.returnFieldMap();\r\n\t\t\tif(fieldMap) {\r\n\t\t\t\tvar mainDs = Z.dataset,\r\n\t\t\t\t\tfldName, \r\n\t\t\t\t\tlkFldName;\r\n\t\t\t\tfor(var fldName in fieldMap) {\r\n\t\t\t\t\tlkFldName = fieldMap[fldName];\r\n\t\t\t\t\tZ.dataset.setFieldValue(fldName, lookupDs.getFieldValue(lkFldName));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tZ.closePopup();\r\n\t},\r\n\r\n\tdestroy: function(){\r\n\t\tvar Z = this;\r\n\t\tif (Z.otree){\r\n\t\t\tZ.otree.destroy();\r\n\t\t\tZ.otree = null;\r\n\t\t}\r\n\t\tif (Z.otable){\r\n\t\t\tZ.otable.destroy();\r\n\t\t\tZ.otable = null;\r\n\t\t}\r\n\t\tZ.comboSelectObj = null;\r\n\t\t\r\n\t\tvar jqPanel = jQuery(Z.panel),\r\n\t\t\tjqFoot = jqPanel.find('.jl-combopnl-footer');\r\n\t\tjqFoot.find('.jl-combopnl-footer-cancel').off();\r\n\t\tjqFoot.find('.jl-combopnl-footer-ok').off();\r\n\t\tjQuery(Z.searchBoxEle).off();\r\n\t\tZ.fieldObject = null;\r\n\t\t\r\n\t\tZ.searchBoxEle = null;\r\n\t\tZ.popup = null;\r\n\t\tZ.panel = null;\r\n\t}\r\n};\r\n\r\njslet.ui.register('DBComboSelect', jslet.ui.DBComboSelect);\r\njslet.ui.DBComboSelect.htmlTemplate = '<div></div>';\r\n\n/* ========================================================================\r\n * Jslet framework: jslet.dbcustomcombobox.js\r\n *\r\n * Copyright (c) 2014 Jslet Group(https://github.com/jslet/jslet/)\r\n * Licensed under MIT (https://github.com/jslet/jslet/LICENSE.txt)\r\n * ======================================================================== */\r\n\r\n/**\r\n* @class DBCustomComboBox: used in jslet.ui.DBComboDlg and jslet.ui.DBDatePicker\r\n*/\r\njslet.ui.DBCustomComboBox = jslet.Class.create(jslet.ui.DBFieldControl, {\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.allProperties = 'dataset,field,textReadOnly';\r\n\t\tZ._textReadOnly = false;\r\n\t\tZ.enableInvalidTip = false;\r\n\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\ttextReadOnly: function(textReadOnly) {\r\n\t\tif(textReadOnly === undefined) {\r\n\t\t\treturn this._textReadOnly;\r\n\t\t}\r\n\t\tthis._textReadOnly = textReadOnly ? true: false;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tafterBind: function ($super) {\r\n\t\t$super();\r\n\t\t\r\n\t\tif (this._textReadOnly) {\r\n\t\t\tthis.el.childNodes[0].readOnly = true;\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tctrlRecno: function($super, ctrlRecno) {\r\n\t\tvar result = $super(ctrlRecno);\r\n\t\tif(ctrlRecno !== undefined) {\r\n\t\t\tthis.textCtrl.ctrlRecno(ctrlRecno);\r\n\t\t}\r\n\t\treturn result;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tvar Z = this;\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tif (!jqEl.hasClass('input-group')) {\r\n\t\t\tjqEl.addClass('input-group');\r\n\t\t}\r\n\t\tvar btnCls = Z.comboButtonCls ? Z.comboButtonCls:'fa-caret-down'; \r\n\t\tvar s = '<input type=\"text\" class=\"form-control\">' + \r\n    \t'<div class=\"jl-comb-btn-group\"><button class=\"btn btn-default btn-sm\" tabindex=\"-1\"><i class=\"fa ' + btnCls + '\"></i></button></div>'; \r\n\t\tjqEl.html(s);\r\n\t\tvar dbtext = jqEl.find('[type=\"text\"]')[0];\r\n\t\tZ.textCtrl = new jslet.ui.DBText(dbtext, {\r\n\t\t\ttype: 'dbtext',\r\n\t\t\tdataset: Z._dataset,\r\n\t\t\tfield: Z._textField || Z._field,\r\n\t\t\tenableInvalidTip: true,\r\n\t\t\tvalueIndex: Z._valueIndex\r\n\t\t});\r\n\t\tjQuery(Z.textCtrl.el).on('keydown', this.popupUp);\r\n\t\tZ.addChildControl(Z.textCtrl);\r\n\t\t\r\n\t\tvar jqBtn = jqEl.find('button');\r\n\t\tif (this.buttonClick) {\r\n\t\t\t\r\n\t\t\tjqBtn.on('click', function(event){\r\n\t\t\t\tZ.buttonClick(jqBtn[0]);\r\n\t\t\t});\r\n\t\t\tjqBtn.on('focus', function (event) {\r\n\t\t\t\tjqEl.trigger('editing', [Z._field]);\r\n\t\t\t});\r\n\t\t\t\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tthis.refreshControl();\r\n\t},\r\n\t\r\n\tpopupUp: function(event) {\r\n\t\tif(event.keyCode == jslet.ui.KeyCode.DOWN) {\r\n\t\t\tvar Z = jslet(this);\r\n\t\t\tif(Z.ctrlRecno() < 0) {\r\n\t\t\t\tZ.doBlur(event);\r\n\t\t\t\tvar el = jslet.ui.findJsletParent(this.parentNode);\r\n\t\t\t\tel.jslet.buttonClick();\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\tfocus: function() {\r\n\t\tthis.textCtrl.focus();\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tforceRefreshControl: function(){\r\n\t\tthis.textCtrl.forceRefreshControl();\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdoMetaChanged: function($super, metaName){\r\n\t\t$super(metaName);\r\n\t\tvar Z = this;\r\n\t\tif(!metaName || metaName == \"disabled\" || metaName == \"readOnly\") {\r\n\t\t\tvar fldObj = Z._dataset.getField(Z._field),\r\n\t\t\t\tflag = fldObj.disabled() || fldObj.readOnly();\r\n\t\t\tvar jqEl = jQuery(Z.el);\r\n\t\t\tjqEl.find('button').attr(\"disabled\", flag);\r\n\t\t}\r\n\t\tif(!metaName || metaName == 'tabIndex') {\r\n\t\t\tZ.setTabIndex();\r\n\t\t}\r\n\r\n\t},\r\n\t\r\n\t/** \r\n\t * @override\r\n\t */ \r\n\tsetTabIndex: function(tabIdx) {\r\n\t\tvar Z = this;\r\n\t\tif(Z.inTableCtrl()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(tabIdx !== 0 && !tabIdx) {\r\n\t\t\tfldObj = Z._dataset.getField(Z._field);\r\n\t\t\tif(fldObj) {\r\n\t\t\t\ttabIdx = fldObj.tabIndex();\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(tabIdx === 0 || tabIdx) {\r\n\t\t\tZ.textCtrl.el.tabIndex = tabIdx;\r\n\t\t}\t\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\tvar Z = this;\r\n\t\tvar dbbtn = Z.el.childNodes[1];\r\n\t\tdbbtn.onclick = null;\r\n\t\tjQuery(Z.textCtrl.el).off('keydown', this.popupUp);\r\n\t\tZ.textCtrl.destroy();\r\n\t\tZ.textCtrl = null;\r\n\t\t$super();\r\n\t}\r\n});\r\n\r\n\r\n\r\n\n/* ========================================================================\r\n * Jslet framework: jslet.dbdatalabel.js\r\n *\r\n * Copyright (c) 2014 Jslet Group(https://github.com/jslet/jslet/)\r\n * Licensed under MIT (https://github.com/jslet/jslet/LICENSE.txt)\r\n * ======================================================================== */\r\n\r\n/**\r\n * @class DBDataLabel. \r\n * Show field value in a html label. \r\n * Example:\r\n * <pre><code>\r\n * var jsletParam = {type:\"DBDataLabel\",dataset:\"employee\",field:\"department\"};\r\n * \r\n * //1. Declaring:\r\n * &lt;label data-jslet='type:\"DBDataLabel\",dataset:\"employee\",field:\"department\"' />\r\n * or\r\n * &lt;label data-jslet='jsletParam' />\r\n *\r\n *  //2. Binding\r\n * &lt;label id=\"ctrlId\"  />\r\n * //Js snippet\r\n * var el = document.getElementById('ctrlId');\r\n * jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *  //3. Create dynamically\r\n * jslet.ui.createControl(jsletParam, document.body);\r\n *\r\n * </code></pre>\r\n */\r\njslet.ui.DBDataLabel = jslet.Class.create(jslet.ui.DBFieldControl, {\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tthis.allProperties = 'dataset,field';\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tthis.renderAll();\r\n\t\tjQuery(this.el).addClass('form-control-static jl-datalabel');//Bootstrap class\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\treturn el.tagName.toLowerCase() == 'label';\r\n\t},\r\n\r\n\tdoValueChanged: function() {\r\n\t\tvar Z = this,\r\n\t\t\tfldObj = Z._dataset.getField(Z._field);\r\n\t\tvar text = Z.getText();\r\n\t\tZ.el.innerHTML = text;\r\n\t\tZ.el.title = text;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tthis.refreshControl(jslet.data.RefreshEvent.updateAllEvent(), true);\r\n\t}\r\n});\r\n\r\njslet.ui.register('DBDataLabel', jslet.ui.DBDataLabel);\r\njslet.ui.DBDataLabel.htmlTemplate = '<label></label>';\r\n\r\n\n/* ========================================================================\r\n * Jslet framework: jslet.dbdatepicker.js\r\n *\r\n * Copyright (c) 2014 Jslet Group(https://github.com/jslet/jslet/)\r\n * Licensed under MIT (https://github.com/jslet/jslet/LICENSE.txt)\r\n * ======================================================================== */\r\n\r\n/**\r\n * @class DBDatePicker. Example:\r\n * <pre><code>\r\n * var jsletParam = {type:\"DBDatePicker\",dataset:\"employee\",field:\"birthday\", textReadOnly:true};\r\n * \r\n * //1. Declaring:\r\n * &lt;div data-jslet='type:\"DBDatePicker\",dataset:\"employee\",field:\"birthday\", textReadOnly:true' />\r\n * or\r\n * &lt;div data-jslet='jsletParam' />\r\n * \r\n *  //2. Binding\r\n * &lt;div id=\"ctrlId\"  />\r\n * //Js snippet\r\n * var el = document.getElementById('ctrlId');\r\n * jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *  //3. Create dynamically\r\n * jslet.ui.createControl(jsletParam, document.body);\r\n *\r\n * </code></pre>\r\n */\r\njslet.ui.DBDatePicker = jslet.Class.create(jslet.ui.DBCustomComboBox, {\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.allProperties = 'dataset,field,textReadOnly,popupWidth, popupHeight';\r\n\t\t\r\n\t\t/**\r\n\t\t * {Integer} Popup panel width\r\n\t\t */\r\n\t\tZ._popupWidth = 260;\r\n\r\n\t\t/**\r\n\t\t * {Integer} Popup panel height\r\n\t\t */\r\n\t\tZ._popupHeight = 226;\r\n\r\n\t\tZ.popup = new jslet.ui.PopupPanel();\r\n\t\t\r\n\t\tZ.popup.onHidePopup = function() {\r\n\t\t\tZ.focus();\r\n\t\t};\r\n\t\t\r\n\t\tZ.comboButtonCls = 'fa-calendar';\r\n\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\tpopupHeight: function(popupHeight) {\r\n\t\tif(popupHeight === undefined) {\r\n\t\t\treturn this._popupHeight;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBDatePicker.popupHeight', popupHeight).isGTEZero();\r\n\t\tthis._popupHeight = parseInt(popupHeight);\r\n\t},\r\n\r\n\tpopupWidth: function(popupWidth) {\r\n\t\tif(popupWidth === undefined) {\r\n\t\t\treturn this._popupWidth;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBDatePicker.popupWidth', popupWidth).isGTEZero();\r\n\t\tthis._popupWidth = parseInt(popupWidth);\r\n\t},\r\n\t\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\treturn true;\r\n\t},\r\n\r\n\tbuttonClick: function (btnEle) {\r\n\t\tvar el = this.el, \r\n\t\t\tZ = this, \r\n\t\t\tfldObj = Z._dataset.getField(Z._field),\r\n\t\t\tjqEl = jQuery(el);\r\n\t\tif (fldObj.readOnly() || fldObj.disabled()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar width = Z._popupWidth,\r\n\t\t\theight = Z._popupHeight,\r\n\t\t\tdateValue = Z.getValue(),\r\n\t\t\trange = fldObj.dataRange(),\r\n\t\t\tminDate = null,\r\n\t\t\tmaxDate = null;\r\n\t\t\r\n\t\tif (range){\r\n\t\t\tif (range.min) {\r\n\t\t\t\tminDate = range.min;\r\n\t\t\t}\r\n\t\t\tif (range.max) {\r\n\t\t\t\tmaxDate = range.max;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (!Z.contentPanel) {\r\n\t\t\tZ.contentPanel = jslet.ui.createControl({ type: 'Calendar', value: dateValue, minDate: minDate, maxDate: maxDate,\r\n\t\t\t\tonDateSelected: function (date) {\r\n\t\t\t\t\tZ.popup.hide();\r\n\t\t\t\t\tZ.el.focus();\r\n\t\t\t\t\tvar value = Z.getValue();\r\n\t\t\t\t\tif(!value) {\r\n\t\t\t\t\t\tvalue = date;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tvalue.setFullYear(date.getFullYear());\r\n\t\t\t\t\t\tvalue.setMonth(date.getMonth());\r\n\t\t\t\t\t\tvalue.setDate(date.getDate());\r\n\t\t\t\t\t}\r\n\t\t\t\t\tZ._dataset.setFieldValue(Z._field, new Date(value.getTime()), Z._valueIndex);\r\n\t\t\t\t}\r\n\t\t\t}, null, width + 'px', height + 'px', true); //Hide panel first\r\n\t\t}\r\n\t\t\r\n\t\tjslet.ui.PopupPanel.excludedElement = btnEle;//event.element();\r\n\t\tvar r = jqEl.offset(), \r\n\t\t\th = jqEl.outerHeight(), \r\n\t\t\tx = r.left, y = r.top + h;\r\n\t\tif (jslet.locale.isRtl){\r\n\t\t\tx = x + jqEl.outerWidth();\r\n\t\t}\r\n\t\tZ.popup.setContent(Z.contentPanel.el, '100%', '100%');\r\n\t\tZ.contentPanel.el.style.display = 'block';\r\n\t\tZ.contentPanel.setValue(dateValue);\r\n\t\tZ.popup.show(x, y, width + 3, height + 3, 0, h);\r\n\t\tZ.contentPanel.focus();\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\tvar Z = this;\r\n\t\tif(Z.contentPanel) {\r\n\t\t\tZ.contentPanel.destroy();\r\n\t\t\tZ.contentPanel = null;\r\n\t\t}\r\n\t\tZ.popup.destroy();\r\n\t\tZ.popup = null;\r\n\t\t$super();\r\n\t}\r\n\t\r\n});\r\n\r\njslet.ui.register('DBDatePicker', jslet.ui.DBDatePicker);\r\njslet.ui.DBDatePicker.htmlTemplate = '<div></div>';\r\n\n/* ========================================================================\r\n * Jslet framework: jslet.dbhtml.js\r\n *\r\n * Copyright (c) 2014 Jslet Group(https://github.com/jslet/jslet/)\r\n * Licensed under MIT (https://github.com/jslet/jslet/LICENSE.txt)\r\n * ======================================================================== */\r\n\r\n/**\r\n * @class DBHtml. \r\n * Display html text from one field. \r\n * Example:\r\n * <pre><code>\r\n * var jsletParam = {type:\"DBHtml\",dataset:\"employee\",field:\"comment\"};\r\n * \r\n * //1. Declaring:\r\n * &lt;div data-jslet='type:\"DBHtml\",dataset:\"employee\",field:\"comment\"' />\r\n * or\r\n * &lt;div data-jslet='jsletParam' />\r\n * \r\n *  //2. Binding\r\n * &lt;div id=\"ctrlId\"  />\r\n * //Js snippet\r\n * var el = document.getElementById('ctrlId');\r\n * jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *  //3. Create dynamically\r\n * jslet.ui.createControl(jsletParam, document.body);\r\n *\r\n * </code></pre>\r\n */\r\njslet.ui.DBHtml = jslet.Class.create(jslet.ui.DBFieldControl, {\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tthis.allProperties = 'dataset,field';\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tthis.renderAll();\r\n\t\tjQuery(this.el).addClass('form-control');\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\treturn el.tagName.toLowerCase() == 'div';\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdoValueChanged: function() {\r\n\t\tvar content = this.getText();\r\n\t\tthis.el.innerHTML = content;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tthis.refreshControl(jslet.data.RefreshEvent.updateAllEvent(), true);\r\n\t}\r\n});\r\n\r\njslet.ui.register('DBHtml', jslet.ui.DBHtml);\r\njslet.ui.DBHtml.htmlTemplate = '<div style=\"width:200px;height:200px\"></div>';\r\n\n/* ========================================================================\r\n * Jslet framework: jslet.dbimage.js\r\n *\r\n * Copyright (c) 2014 Jslet Group(https://github.com/jslet/jslet/)\r\n * Licensed under MIT (https://github.com/jslet/jslet/LICENSE.txt)\r\n * ======================================================================== */\r\n\r\n/**\r\n * @class DBImage. \r\n * Display an image which store in database or which's path store in database. \r\n * Example:\r\n * <pre><code>\r\n * var jsletParam = {type:\"DBImage\",dataset:\"employee\",field:\"photo\"};\r\n * \r\n * //1. Declaring:\r\n * &lt;img data-jslet='{type:\"DBImage\",dataset:\"employee\",field:\"photo\"}' />\r\n * or\r\n * &lt;img data-jslet='jsletParam' />\r\n *\r\n *  //2. Binding\r\n * &lt;img id=\"ctrlId\"  />\r\n * //Js snippet\r\n * var el = document.getElementById('ctrlId');\r\n * jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *  //3. Create dynamically\r\n * jslet.ui.createControl(jsletParam, document.body);\r\n *\r\n * </code></pre>\r\n */\r\njslet.ui.DBImage = jslet.Class.create(jslet.ui.DBFieldControl, {\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.allProperties = 'dataset,field,locked,baseUrl,altField';\r\n\t\t/**\r\n\t\t * Stop refreshing image when move dataset's cursor.\r\n\t\t */\r\n\t\tZ._locked = false;\r\n\t\t/**\r\n\t\t * {String} The base url\r\n\t\t */\r\n\t\tZ._baseUrl = null;\r\n\t\t\r\n\t\tZ._altField = null;\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\tbaseUrl: function(baseUrl) {\r\n\t\tif(baseUrl === undefined) {\r\n\t\t\treturn this._baseUrl;\r\n\t\t}\r\n\t\tbaseUrl = jQuery.trim(baseUrl);\r\n\t\tjslet.Checker.test('DBImage.baseUrl', baseUrl).isString();\r\n\t\tthis._baseUrl = baseUrl;\r\n\t},\r\n   \r\n\taltField: function(altField) {\r\n\t\tif(altField === undefined) {\r\n\t\t\treturn this._altField;\r\n\t\t}\r\n\t\taltField = jQuery.trim(altField);\r\n\t\tjslet.Checker.test('DBImage.altField', altField).isString();\r\n\t\tthis._altField = altField;\r\n\t},\r\n   \r\n\tlocked: function(locked) {\r\n\t\tif(locked === undefined) {\r\n\t\t\treturn this._locked;\r\n\t\t}\r\n\t\tthis._locked = locked;\r\n\t},\r\n   \r\n\t/**\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\treturn el.tagName.toLowerCase() == 'img';\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tthis.renderAll();\r\n\t\tjQuery(this.el).addClass('img-responsive img-rounded')\r\n\t\t\r\n\t}, // end bind\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdoValueChanged: function() {\r\n\t\tvar Z = this,\r\n\t\t\tfldObj = Z._dataset.getField(Z._field);\r\n\t\tif (Z._locked) {\r\n\t\t\tZ.el.alt = jslet.locale.DBImage.lockedImageTips;\r\n\t\t\tZ.el.src = '';\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar srcURL = Z.getValue();\r\n\t\tif (!srcURL) {\r\n\t\t\tsrcURL = '';\r\n\t\t} else {\r\n\t\t\tif (Z._baseUrl) {\r\n\t\t\t\tsrcURL = Z._baseUrl + srcURL;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (Z.el.src != srcURL) {\r\n\t\t\tvar altText = srcURL;\r\n\t\t\tif(Z._altField) {\r\n\t\t\t\tvar ctrlRecno = Z.ctrlRecno();\r\n\t\t\t\tif(ctrlRecno < 0) {\r\n\t\t\t\t\taltText = Z._dataset.getFieldText(Z._altField);\r\n\t\t\t\t} else {\r\n\t\t\t\t\taltText = Z._dataset.getFieldTextByRecno(ctrlRecno, Z._altField);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tZ.el.alt = altText;\r\n\t\t\tZ.el.src = srcURL;\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tthis.refreshControl(jslet.data.RefreshEvent.updateAllEvent(), true);\r\n\t}\r\n});\r\n\r\njslet.ui.register('DBImage', jslet.ui.DBImage);\r\njslet.ui.DBImage.htmlTemplate = '<img></img>';\r\n\n/* ========================================================================\r\n * Jslet framework: jslet.dblabel.js\r\n *\r\n * Copyright (c) 2014 Jslet Group(https://github.com/jslet/jslet/)\r\n * Licensed under MIT (https://github.com/jslet/jslet/LICENSE.txt)\r\n * ======================================================================== */\r\n\r\n/**\r\n * @class DBLabel. \r\n * Display field name, use this control to void hard-coding field name, and you can change field name dynamically. \r\n * Example:\r\n * <pre><code>\r\n * var jsletParam = {type:\"DBLabel\",dataset:\"employee\",field:\"department\"};\r\n * \r\n * //1. Declaring:\r\n * &lt;label data-jslet='type:\"DBLabel\",dataset:\"employee\",field:\"department\"' />\r\n * or\r\n * &lt;label data-jslet='jsletParam' />\r\n *\r\n *  //2. Binding\r\n * &lt;label id=\"ctrlId\"  />\r\n * //Js snippet\r\n * var el = document.getElementById('ctrlId');\r\n * jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *  //3. Create dynamically\r\n * jslet.ui.createControl(jsletParam, document.body);\r\n *\r\n * </code></pre>\r\n */\r\njslet.ui.DBLabel = jslet.Class.create(jslet.ui.DBFieldControl, {\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tthis.allProperties = 'dataset,field';\r\n\t\tthis.isLabel = true;\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tjQuery(this.el).addClass('control-label');\r\n\t\tthis.renderAll();\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\treturn el.tagName.toLowerCase() == 'label';\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdoMetaChanged: function(metaName) {\r\n\t\tif(metaName && jslet.ui.DBLabel.METANAMES.indexOf(metaName) < 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar Z = this, subType = Z._fieldMeta,\r\n\t\t\tfldObj = Z._dataset.getField(Z._field),\r\n\t\t\tcontent = '';\r\n\t\tif(!fldObj) {\r\n\t\t\tthrow new Error('Field: ' + this._field + ' NOT exist!');\r\n\t\t}\r\n\t\tif((!subType || subType == 'label') && (!metaName || metaName == 'label' || metaName == 'required')) {\r\n\t\t\tif (fldObj.required()) {\r\n\t\t\t\tcontent += '<span class=\"jl-lbl-required\">' + \r\n\t\t\t\t\tjslet.ui.DBLabel.REQUIREDCHAR + '</span>';\r\n\t\t\t}\r\n\t\t\tcontent += fldObj.label();\r\n\t\t\tZ.el.innerHTML = content || '';\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(subType && subType == 'tip' && \r\n\t\t\t(!metaName || metaName == subType)) {\r\n\t\t\tcontent = fldObj.tip();\r\n\t\t\tZ.el.innerHTML = content || '';\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(subType  && subType == 'error' && \r\n\t\t\t(metaName && metaName == subType)) {\r\n\t\t\tvar errObj = Z.getFieldError();\r\n\t\t\tvar content = errObj && errObj.message;\r\n\t\t\tZ.el.innerHTML = content || '';\r\n\t\t\treturn;\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tvar jqEl = jQuery(this.el),\r\n\t\t\tsubType = this.fieldMeta();\r\n\t\t\r\n\t\tthis.refreshControl(jslet.data.RefreshEvent.updateAllEvent());\r\n\t\tif(subType == 'error') {\r\n\t\t\tif(!jqEl.hasClass('jl-lbl-error')) {\r\n\t\t\t\tjqEl.addClass('jl-lbl-error');\r\n\t\t\t}\r\n\t\t} else \r\n\t\tif(subType == 'tip') {\r\n\t\t\tif(!jqEl.hasClass('jl-lbl-tip')) {\r\n\t\t\t\tjqEl.addClass('jl-lbl-tip');\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif(!jqEl.hasClass('jl-lbl')) {\r\n\t\t\t\tjqEl.addClass('jl-lbl');\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n});\r\n\r\njslet.ui.DBLabel.REQUIREDCHAR = '*';\r\njslet.ui.DBLabel.METANAMES = ['label', 'required', 'tip', 'error'];\r\njslet.ui.register('DBLabel', jslet.ui.DBLabel);\r\njslet.ui.DBLabel.htmlTemplate = '<label></label>';\r\n\r\n\n/* ========================================================================\r\n * Jslet framework: jslet.dblookuplabel.js\r\n *\r\n * Copyright (c) 2014 Jslet Group(https://github.com/jslet/jslet/)\r\n * Licensed under MIT (https://github.com/jslet/jslet/LICENSE.txt)\r\n * ======================================================================== */\r\n\r\n/**\r\n * @class DBLookupLabel. \r\n * Display field value according to another field and its value.\r\n * Example:\r\n * <pre><code>\r\n * \t\tvar jsletParam = {type:\"DBLookupLabel\",dataset:\"department\",lookupField:\"deptcode\", lookupValue: '0101', returnField: 'name'};\r\n * \r\n * //1. Declaring:\r\n *\t  &lt;label data-jslet='{type:\"DBLookupLabel\",dataset:\"department\",lookupField:\"deptcode\", lookupValue: \"0101\", returnField: \"name\"}' />\r\n *\t  or\r\n *\t  &lt;label data-jslet='jsletParam' />\r\n *\t  \r\n *  //2. Binding\r\n *\t  &lt;label id=\"ctrlId\"  />\r\n *  \t//Js snippet\r\n * \t\tvar el = document.getElementById('ctrlId');\r\n *  \tjslet.ui.bindControl(el, jsletParam);\r\n *\r\n *  //3. Create dynamically\r\n *  \tjslet.ui.createControl(jsletParam, document.body);\r\n *  \t\r\n * </code></pre>\r\n */\r\njslet.ui.DBLookupLabel = jslet.Class.create(jslet.ui.DBControl, {\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.allProperties = 'dataset,lookupField,returnField,lookupValue';\r\n\t\tZ.requiredProperties = 'lookupValue,lookupField,returnField';\r\n\r\n\t\t/**\r\n\t\t * {String} Lookup field name.\r\n\t\t */\r\n\t\tZ.lookupField;\r\n\t\t/**\r\n\t\t * {String} Lookup field value.\r\n\t\t */\r\n\t\tZ.lookupValue;\r\n\t\t/**\r\n\t\t * {String} Return field name.\r\n\t\t */\r\n\t\tZ.returnField;\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tthis.renderAll();\r\n\t\tjQuery(this.el).addClass('form-control');\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\treturn el.tagName.toLowerCase() == 'label';\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trefreshControl: function (evt, isForce) {\r\n\t\tif (evt.eventType != jslet.data.RefreshEvent.UPDATEALL) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (!isForce && !Z.isActiveRecord()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar Z = this;\r\n\t\tvar result = Z.dataset.lookup(Z.lookupField, Z.lookupValue,\r\n\t\t\t\tZ.returnField);\r\n\t\tif (result == null) {\r\n\t\t\tresult = 'NOT found: ' + Z.lookupValue;\r\n\t\t}\r\n\t\tZ.el.innerHTML = result;\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tthis.refreshControl(jslet.data.RefreshEvent.updateAllEvent, true);\r\n\t}\r\n});\r\njslet.ui.register('DBLookupLabel', jslet.ui.DBLookupLabel);\r\njslet.ui.DBLookupLabel.htmlTemplate = '<label></label>';\r\n\r\n\n/* ========================================================================\r\n * Jslet framework: jslet.dbplace.js\r\n *\r\n * Copyright (c) 2014 Jslet Group(https://github.com/jslet/jslet/)\r\n * Licensed under MIT (https://github.com/jslet/jslet/LICENSE.txt)\r\n * ======================================================================== */\r\n\r\n/**\r\n * @class DBPlace. \r\n * It's an placeholder for other dbcontrols.\r\n * Example:\r\n * <pre><code>\r\n * var jsletParam = {type:\"DBPlace\",dataset: \"dataset\", \"field\":\"fieldName\"};\r\n *\r\n * //1. Declaring:\r\n *  &lt;div data-jslet='jsletParam' />\r\n *\r\n *  //2. Binding\r\n *  &lt;div id=\"ctrlId\"  />\r\n * //Js snippet\r\n * var el = document.getElementById('ctrlId');\r\n * jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *  //3. Create dynamically\r\n * jslet.ui.createControl(jsletParam, document.body);\r\n *\r\n * </code></pre>\r\n */\r\njslet.ui.DBPlace = jslet.Class.create(jslet.ui.DBFieldControl, {\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tthis.allProperties = 'dataset,field';\r\n\t\tthis.editControl = null;\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\tvar tagName = el.tagName.toLowerCase();\r\n\t\treturn tagName == 'div';\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tvar Z = this;\r\n\t\tZ.renderAll();\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trefreshControl: function (evt) {\r\n\t\tvar Z = this,\r\n\t\t\tevtType = evt.eventType;\r\n\t\t// Meta changed \r\n\t\tif (evtType == jslet.data.RefreshEvent.CHANGEMETA &&\r\n\t\t\tZ._field == evt.fieldName && \r\n\t\t\tevt.metaName == 'editControl') {\r\n\t\t\tZ.renderAll();\r\n\t\t\treturn true;\r\n\t\t}\r\n\t}, // end refreshControl\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tvar Z = this;\r\n\t\tZ.removeAllChildControls();\r\n\t\tvar\tfldObj = Z._dataset.getField(Z._field),\r\n\t\t\tparam = fldObj.editControl();\r\n\t\tparam.dataset = Z._dataset;\r\n\t\tparam.field = Z._field;\r\n\t\tvar dbCtrl = jslet.ui.createControl(param, Z.el);\r\n\t\tdbCtrl.el.style.width = '100%';\r\n\t\tZ.addChildControl(dbCtrl);\r\n\t}\r\n});\r\n\r\njslet.ui.register('DBPlace', jslet.ui.DBPlace);\r\njslet.ui.DBPlace.htmlTemplate = '<div></div>';\r\n\n/* ========================================================================\r\n * Jslet framework: jslet.dbradiogroup.js\r\n *\r\n * Copyright (c) 2014 Jslet Group(https://github.com/jslet/jslet/)\r\n * Licensed under MIT (https://github.com/jslet/jslet/LICENSE.txt)\r\n * ======================================================================== */\r\n\r\n/**\r\n * @class DBRadioGroup. \r\n * Display a group of radio that user can select one option. Example:\r\n * <pre><code>\r\n * var jsletParam = {type:\"DBRadioGroup\",dataset:\"employee\",field:\"department\"};\r\n * \r\n * //1. Declaring:\r\n * &lt;div data-jslet='type:\"DBRadioGroup\",dataset:\"employee\",field:\"department\"'' />\r\n * or\r\n * &lt;div data-jslet='jsletParam' />\r\n * \r\n *  //2. Binding\r\n * &lt;div id=\"ctrlId\"  />\r\n * //Js snippet\r\n * var el = document.getElementById('ctrlId');\r\n * jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *  //3. Create dynamically\r\n * jslet.ui.createControl(jsletParam, document.body);\r\n * \r\n * </code></pre>\r\n */\r\njslet.ui.DBRadioGroup = jslet.Class.create(jslet.ui.DBFieldControl, {\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.allProperties = 'dataset,field,columnCount';\r\n\t\t/**\r\n\t\t * {Integer} Column count\r\n\t\t */\r\n\t\tZ._columnCount = 99999;\r\n\t\tZ._itemIds = null;\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\tcolumnCount: function(columnCount) {\r\n\t\tif(columnCount === undefined) {\r\n\t\t\treturn this._columnCount;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBRadioGroup.columnCount', columnCount).isGTEZero();\r\n\t\tthis._columnCount = parseInt(columnCount);\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\tvar tagName = el.tagName.toLowerCase();\r\n\t\treturn tagName == 'div';\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tvar Z = this;\r\n\t\tZ.renderAll();\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tjqEl.on('click', 'input[type=\"radio\"]', function(event){\r\n\t\t\tvar ctrl = this;\r\n\t\t\twindow.setTimeout(function(){ //Defer firing 'updateToDataset' when this control is in DBTable to make row changed firstly.\r\n\t\t\t\tevent.delegateTarget.jslet.updateToDataset(ctrl);\r\n\t\t\t}, 5)\r\n\t\t});\r\n\t\tjqEl.on('focus', 'input[type=\"radio\"]', function (event) {\r\n\t\t\tjqEl.trigger('editing', [Z._field]);\r\n\t\t});\r\n\t\tjqEl.addClass('form-control');//Bootstrap class\r\n\t\tjqEl.css('height', 'auto');\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdoMetaChanged: function($super, metaName) {\r\n\t\t$super(metaName);\r\n\t\tvar Z = this,\r\n\t\t\tfldObj = Z._dataset.getField(Z._field);\r\n\t\tif(!metaName || metaName == \"disabled\" || metaName == \"readOnly\" || metaName == 'tabIndex') {\r\n\t\t\tvar disabled = fldObj.disabled(),\r\n\t\t\t\treadOnly = fldObj.readOnly();\r\n\t\t\r\n\t\t\tZ.disabled = disabled || readOnly;\r\n\t\t\tdisabled = Z.disabled;\r\n\t\t\tvar radios = jQuery(Z.el).find('input[type=\"radio\"]'),\r\n\t\t\t\trequired = fldObj.required(),\r\n\t\t\t\tradioEle,\r\n\t\t\t\ttabIdx = fldObj.tabIndex();\r\n\t\t\t\r\n\t\t\tfor(var i = 0, cnt = radios.length; i < cnt; i++){\r\n\t\t\t\tradioEle = radios[i];\r\n\t\t\t\tjslet.ui.setEditableStyle(radioEle, disabled, readOnly, false, required);\r\n\t\t\t\tradioEle.tabIndex = tabIdx;\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdoValueChanged: function() {\r\n\t\tvar Z = this;\r\n\t\tif (Z._keep_silence_) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar value = Z.getValue(),\r\n\t\t\tradios = jQuery(Z.el).find('input[type=\"radio\"]'), \r\n\t\t\tradio;\r\n\t\tfor(var i = 0, cnt = radios.length; i < cnt; i++){\r\n\t\t\tradio = radios[i];\r\n\t\t\tradio.checked = (value == jQuery(radio.parentNode).attr('value'));\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdoLookupChanged: function () {\r\n\t\tvar Z = this;\r\n\t\tvar fldObj = Z._dataset.getField(Z._field), lkf = fldObj.lookup();\r\n\t\tif (!lkf) {\r\n\t\t\tconsole.error(jslet.formatString(jslet.locale.Dataset.lookupNotFound,\r\n\t\t\t\t\t[fldObj.name()]));\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar lkds = lkf.dataset(),\r\n\t\tcnt = lkds.recordCount();\r\n\t\tif(cnt === 0) {\r\n\t\t\tZ.el.innerHTML = jslet.locale.DBRadioGroup.noOptions;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar oldRecno = lkds.recno();\r\n\t\ttry {\r\n\t\t\tvar template = ['<table cellpadding=\"0\" cellspacing=\"0\">'],\r\n\t\t\t\tisNewRow = false, \r\n\t\t\t\titemId;\r\n\t\t\tvar editFilter = lkf.editFilter();\r\n\t\t\tZ._innerEditFilterExpr = null;\r\n\t\t\tvar editItemDisabled = lkf.editItemDisabled();\r\n\t\t\tif(editFilter) {\r\n\t\t\t\tZ._innerEditFilterExpr = new jslet.Expression(lkds, editFilter);\r\n\t\t\t}\r\n\t\t\tvar disableOption = false, k = -1;\r\n\t\t\t\r\n\t\t\tZ._itemIds = [];\r\n\t\t\tfor (var i = 0; i < cnt; i++) {\r\n\t\t\t\tlkds.recnoSilence(i);\r\n\t\t\t\tdisableOption = false;\r\n\t\t\t\tif(Z._innerEditFilterExpr && !Z._innerEditFilterExpr.eval()) {\r\n\t\t\t\t\tif(!editItemDisabled) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tdisableOption = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tk++;\r\n\t\t\t\tisNewRow = (k % Z._columnCount === 0);\r\n\t\t\t\tif (isNewRow) {\r\n\t\t\t\t\tif (k > 0) {\r\n\t\t\t\t\t\ttemplate.push('</tr>');\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttemplate.push('<tr>');\r\n\t\t\t\t}\r\n\t\t\t\titemId = jslet.nextId();\r\n\t\t\t\tZ._itemIds.push(itemId);\r\n\t\t\t\ttemplate.push('<td style=\"white-space: nowrap\" value=\"');\r\n\t\t\t\ttemplate.push(lkds.getFieldValue(lkf.keyField()));\r\n\t\t\t\ttemplate.push('\"><input name=\"');\r\n\t\t\t\ttemplate.push(Z._field);\r\n\t\t\t\ttemplate.push('\" type=\"radio\"  id=\"');\r\n\t\t\t\ttemplate.push(itemId);\r\n\t\t\t\ttemplate.push('\" ' + (disableOption? ' disabled': '') + '/><label for=\"');\r\n\t\t\t\ttemplate.push(itemId);\r\n\t\t\t\ttemplate.push('\">');\r\n\t\t\t\ttemplate.push(lkf.getCurrentDisplayValue());\r\n\t\t\t\ttemplate.push('</label></td>');\r\n\t\t\t} // end while\r\n\t\t\tif (cnt > 0) {\r\n\t\t\t\ttemplate.push('</tr>');\r\n\t\t\t}\r\n\t\t\ttemplate.push('</table>');\r\n\t\t\tZ.el.innerHTML = template.join('');\r\n\t\t} finally {\r\n\t\t\tlkds.recnoSilence(oldRecno);\r\n\t\t}\r\n\r\n\t}, // end renderOptions\r\n\r\n\tupdateToDataset: function(currCheckBox) {\r\n\t\tvar Z = this;\r\n\t\tif (Z._keep_silence_ || Z.disabled) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tZ._keep_silence_ = true;\r\n\t\ttry {\r\n\t\t\tZ._dataset.setFieldValue(Z._field, jQuery(currCheckBox.parentNode).attr('value'));\r\n\t\t\tcurrCheckBox.checked = true;\r\n\t\t} finally {\r\n\t\t\tZ._keep_silence_ = false;\r\n\t\t}\r\n\t},\r\n\t\r\n\tfocus: function() {\r\n\t\tif (_itemIds && _itemIds.length > 0) {\r\n\t\t\tdocument.getElementById(_itemIds[0]).focus();\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tvar Z = this, \r\n\t\t\tjqEl = jQuery(Z.el);\r\n\t\tif(!jqEl.hasClass(\"jl-radiogroup\")) {\r\n\t\t\tjqEl.addClass(\"jl-radiogroup\");\r\n\t\t}\r\n\t\tZ.refreshControl(jslet.data.RefreshEvent.updateAllEvent(), true);\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\tvar jqEl = jQuery(this.el);\r\n\t\tjqEl.off();\r\n\t\t$super();\r\n\t}\r\n});\r\n\r\njslet.ui.register('DBRadioGroup', jslet.ui.DBRadioGroup);\r\njslet.ui.DBRadioGroup.htmlTemplate = '<div></div>';\r\n\n/* ========================================================================\r\n * Jslet framework: jslet.dbrangeselect.js\r\n *\r\n * Copyright (c) 2014 Jslet Group(https://github.com/jslet/jslet/)\r\n * Licensed under MIT (https://github.com/jslet/jslet/LICENSE.txt)\r\n * ======================================================================== */\r\n\r\n/**\r\n * @class DBRangeSelect. \r\n * Display a select which options produce with 'beginItem' and 'endItem'. Example:\r\n * <pre><code>\r\n * var jsletParam = {type:\"DBRangeSelect\",dataset:\"employee\",field:\"age\",beginItem:10,endItem:100,step:5};\r\n * \r\n * //1. Declaring:\r\n * &lt;select data-jslet='type:\"DBRangeSelect\",dataset:\"employee\",field:\"age\",beginItem:10,endItem:100,step:5' />\r\n * or\r\n * &lt;select data-jslet='jsletParam' />\r\n * \r\n *  //2. Binding\r\n * &lt;select id=\"ctrlId\"  />\r\n * //Js snippet\r\n * var el = document.getElementById('ctrlId');\r\n * jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *  //3. Create dynamically\r\n * jslet.ui.createControl(jsletParam, document.body);\r\n *\r\n * </code></pre>\r\n */\r\njslet.ui.DBRangeSelect = jslet.Class.create(jslet.ui.DBFieldControl, {\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.allProperties = 'dataset,field,beginItem,endItem,step';\r\n\t\tif (!Z.requiredProperties) {\r\n\t\t\tZ.requiredProperties = 'field,beginItem,endItem,step';\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * {Integer} Begin item \r\n\t\t */\r\n\t\tZ._beginItem = 0;\r\n\t\t/**\r\n\t\t * {Integer} End item\r\n\t\t */\r\n\t\tZ._endItem = 10;\r\n\t\t/**\r\n\t\t * {Integer} Step\r\n\t\t */\r\n\t\tZ._step = 1;\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\tbeginItem: function(beginItem) {\r\n\t\tif(beginItem === undefined) {\r\n\t\t\treturn this._beginItem;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBRangeSelect.beginItem', beginItem).isNumber();\r\n\t\tthis._beginItem = parseInt(beginItem);\r\n\t},\r\n\r\n\tendItem: function(endItem) {\r\n\t\tif(endItem === undefined) {\r\n\t\t\treturn this._endItem;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBRangeSelect.endItem', endItem).isNumber();\r\n\t\tthis._endItem = parseInt(endItem);\r\n\t},\r\n\r\n\tstep: function(step) {\r\n\t\tif(step === undefined) {\r\n\t\t\treturn this._step;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBRangeSelect.step', step).isNumber();\r\n\t\tthis._step = parseInt(step);\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\treturn (el.tagName.toLowerCase() == 'select');\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tvar Z = this,\r\n\t\t\tfldObj = Z._dataset.getField(Z._field),\r\n\t\t\tvalueStyle = fldObj.valueStyle();\r\n\t\t\r\n\t\tif(Z.el.multiple && valueStyle != jslet.data.FieldValueStyle.MULTIPLE) {\r\n\t\t\tfldObj.valueStyle(jslet.data.FieldValueStyle.MULTIPLE);\r\n\t\t} else if(valueStyle == jslet.data.FieldValueStyle.MULTIPLE && !Z.el.multiple) {\r\n\t\t\tZ.el.multiple = \"multiple\";\t\r\n\t\t}\r\n\t\tZ.renderAll();\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tjqEl.on('change', Z._doChanged);// end observe\r\n\t\tjqEl.focus(function(event) {\r\n\t\t\tjqEl.trigger('editing', [Z._field]);\r\n\t\t});\r\n\t\tif(Z.el.multiple) {\r\n\t\t\tjqEl.on('click', 'option', function () {\r\n\t\t\t\tZ._currOption = this;\r\n\t\t\t});// end observe\r\n\t\t}\r\n\t\tjqEl.addClass('form-control');//Bootstrap class\r\n\t}, // end bind\r\n\r\n\t_doChanged: function (event) {\r\n\t\tvar Z = this.jslet;\r\n\t\tif(Z.el.multiple) {\r\n\t\t\tif(Z.inProcessing) {\r\n\t\t\t\tZ.inProcessing = false;\r\n\t\t\t}\r\n\t\t\tvar fldObj = Z._dataset.getField(Z._field),\r\n\t\t\t\tlimitCount = fldObj.valueCountLimit();\r\n\t\t\tif(limitCount) {\r\n\t\t\t\tvar values = Z.getValue(),\r\n\t\t\t\t\tcount = 1;\r\n\t\t\t\tif(jslet.isArray(values)) {\r\n\t\t\t\t\tcount = values.length;\r\n\t\t\t\t}\r\n\t\t\t\tif (count >= limitCount) {\r\n\t\t\t\t\tjslet.showInfo(jslet.formatString(jslet.locale.DBCheckBoxGroup.invalidCheckedCount,\r\n\t\t\t\t\t\t\t[''\t+ limitCount]));\r\n\t\t\t\t\t\r\n\t\t\t\t\twindow.setTimeout(function(){\r\n\t\t\t\t\t\tif(Z._currOption) {\r\n\t\t\t\t\t\t\tZ.inProcessing = true;\r\n\t\t\t\t\t\t\tZ._currOption.selected = false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}, 10);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.jslet.updateToDataset();\r\n\t},\r\n\t\t\r\n\trenderOptions: function () {\r\n\t\tvar Z = this,\r\n\t\t\tarrhtm = [];\r\n\t\t\r\n\t\tvar fldObj = Z._dataset.getField(Z._field);\r\n\t\tif (!fldObj.required()){\r\n\t\t\tarrhtm.push('<option value=\"_null_\">');\r\n\t\t\tarrhtm.push(fldObj.nullText());\r\n\t\t\tarrhtm.push('</option>');\r\n\t\t}\r\n\r\n\t\tfor (var i = Z._beginItem; i <= Z._endItem; i += Z._step) {\r\n\t\t\tarrhtm.push('<option value=\"');\r\n\t\t\tarrhtm.push(i);\r\n\t\t\tarrhtm.push('\">');\r\n\t\t\tarrhtm.push(i);\r\n\t\t\tarrhtm.push('</option>');\r\n\t\t}\r\n\t\tjQuery(Z.el).html(arrhtm.join(''));\r\n\t}, // end renderOptions\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdoMetaChanged: function($super, metaName){\r\n\t\t$super(metaName);\r\n\t\tvar Z = this,\r\n\t\t\tfldObj = Z._dataset.getField(Z._field);\r\n\t\tif(!metaName || metaName == \"disabled\" || metaName == \"readOnly\") {\r\n\t\t\tvar disabled = fldObj.disabled() || fldObj.readOnly();\r\n\t\t\tZ.el.disabled = disabled;\r\n\t\t\tjslet.ui.setEditableStyle(Z.el, disabled, disabled, true, fldObj.required());\r\n\t\t}\r\n\t\tif(!metaName || metaName == 'tabIndex') {\r\n\t\t\tZ.setTabIndex();\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdoValueChanged: function() {\r\n\t\tvar Z = this;\r\n\t\tif (Z._keep_silence_) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (!Z.el.multiple) {\r\n\t\t\tvar value = Z.getValue();\r\n\t\t\tif (value !== null) {\r\n\t\t\t\tZ.el.value = value;\r\n\t\t\t} else {\r\n\t\t\t\tZ.el.value = null;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tvar arrValue = Z.getValue(),\r\n\t\t\t\toptCnt = Z.el.options.length, opt, selected, i;\r\n\t\t\tZ._keep_silence_ = true;\r\n\t\t\ttry {\r\n\t\t\t\tfor (i = 0; i < optCnt; i++) {\r\n\t\t\t\t\topt = Z.el.options[i];\r\n\t\t\t\t\tif (opt) {\r\n\t\t\t\t\t\topt.selected = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar vcnt = arrValue.length - 1;\r\n\t\t\t\tfor (i = 0; i < optCnt; i++) {\r\n\t\t\t\t\topt = Z.el.options[i];\r\n\t\t\t\t\tfor (j = vcnt; j >= 0; j--) {\r\n\t\t\t\t\t\tselected = (arrValue[j] == opt.value);\r\n\t\t\t\t\t\tif (selected) {\r\n\t\t\t\t\t\t\topt.selected = selected;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} // end for j\r\n\t\t\t\t} // end for i\r\n\t\t\t} finally {\r\n\t\t\t\tZ._keep_silence_ = false;\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\tfocus: function() {\r\n\t\tthis.el.focus();\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tthis.renderOptions();\r\n\t\tthis.refreshControl(jslet.data.RefreshEvent.updateAllEvent(), true);\r\n\t},\r\n\r\n\tupdateToDataset: function () {\r\n\t\tvar Z = this;\r\n\t\tif (Z._keep_silence_) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar value,\r\n\t\t\tisMulti = Z.el.multiple;\r\n\t\tif (!isMulti) {\r\n\t\t\tvalue = Z.el.value;\r\n\t\t\tvar fldObj = Z._dataset.getField(Z._field);\r\n\t\t\tif (value == '_null_' && !fldObj.required()) {\r\n\t\t\t\tvalue = null;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tvar opts = jQuery(Z.el).find('option'),\r\n\t\t\t\toptCnt = opts.length - 1;\r\n\t\t\tvalue = [];\r\n\t\t\tfor (var i = 0; i <= optCnt; i++) {\r\n\t\t\t\topt = opts[i];\r\n\t\t\t\tif (opt.selected) {\r\n\t\t\t\t\tvalue.push(opt.value);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tZ._keep_silence_ = true;\r\n\t\ttry {\r\n\t\t\tif (!isMulti) {\r\n\t\t\t\tZ._dataset.setFieldValue(Z._field, value, Z._valueIndex);\r\n\t\t\t} else {\r\n\t\t\t\tZ._dataset.setFieldValue(Z._field, value);\r\n\t\t\t}\r\n\t\t} finally {\r\n\t\t\tZ._keep_silence_ = false;\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\tjQuery(this.el).off();\r\n\t\t$super();\r\n\t}\r\n});\r\n\r\njslet.ui.register('DBRangeSelect', jslet.ui.DBRangeSelect);\r\njslet.ui.DBRangeSelect.htmlTemplate = '<select></select>';\r\n\n/* ========================================================================\r\n * Jslet framework: jslet.dbrating.js\r\n *\r\n * Copyright (c) 2014 Jslet Group(https://github.com/jslet/jslet/)\r\n * Licensed under MIT (https://github.com/jslet/jslet/LICENSE.txt)\r\n * ======================================================================== */\r\n\r\n/**\r\n * @class DBRating. \r\n * A control which usually displays some star to user, and user can click to rate something. Example:\r\n * <pre><code>\r\n * var jsletParam = {type:\"DBRating\",dataset:\"employee\",field:\"grade\", itemCount: 5};\r\n * \r\n * //1. Declaring:\r\n * &lt;div data-jslet='type:\"DBRating\",dataset:\"employee\",field:\"grade\"', itemCount: 5' />\r\n * or\r\n * &lt;div data-jslet='jsletParam' />\r\n * \r\n *  //2. Binding\r\n * &lt;div id=\"ctrlId\"  />\r\n * //Js snippet\r\n * var el = document.getElementById('ctrlId');\r\n * jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *  //3. Create dynamically\r\n * jslet.ui.createControl(jsletParam, document.body);\r\n *\r\n * </code></pre>\r\n */\r\njslet.ui.DBRating = jslet.Class.create(jslet.ui.DBFieldControl, {\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.allProperties = 'dataset,field,itemCount,splitCountitemWidth';\r\n\t\t/**\r\n\t\t * {Integer} Rate item count, In other words, the count of 'Star' sign.\r\n\t\t */\r\n\t\tZ._itemCount = 5;\r\n\t\t/**\r\n\t\t * {Integer} You can use it to split the 'Star' sign to describe decimal like: 1.5, 1.25.\r\n\t\t * SplitCount equals 2, that means cut 'Star' sign into two part, it can express: 0, 0.5, 1, 1.5, ...\r\n\t\t */\r\n\t\tZ._splitCount = 1;\r\n\t\t/**\r\n\t\t * {Integer} The width of one 'Star' sign.\r\n\t\t */\r\n\t\tZ._itemWidth = 20;\r\n\t\t/**\r\n\t\t * {Boolean} Required or not. If it is not required, you can rate 0 by double clicking first item. \r\n\t\t */\r\n\t\tZ._required = false;\r\n\t\t/**\r\n\t\t * {Boolean} read only or not.\r\n\t\t */\r\n\t\tZ._readOnly = false;\r\n\t\t\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\titemCount: function(itemCount) {\r\n\t\tif(itemCount === undefined) {\r\n\t\t\treturn this._itemCount;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBRating.itemCount', itemCount).isGTZero();\r\n\t\tthis._itemCount = parseInt(itemCount);\r\n\t},\r\n\r\n\tsplitCount: function(splitCount) {\r\n\t\tif(splitCount === undefined) {\r\n\t\t\treturn this._splitCount;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBRating.splitCount', splitCount).isGTZero();\r\n\t\tthis._splitCount = parseInt(splitCount);\r\n\t},\r\n\r\n\titemWidth: function(itemWidth) {\r\n\t\tif(itemWidth === undefined) {\r\n\t\t\treturn this._itemWidth;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBRating.itemWidth', itemWidth).isGTZero();\r\n\t\tthis._itemWidth = parseInt(itemWidth);\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\treturn el.tagName.toLowerCase() == 'div';\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tvar Z = this;\r\n\r\n\t\tZ.renderAll();\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tjqEl.on('mousedown', 'td', Z._mouseDown);\r\n\t\tjqEl.on('mousemove', 'td', Z._mouseMove);\r\n\t\tjqEl.on('mouseout', 'td', Z._mouseOut);\r\n\t\tjqEl.on('mouseup', 'td', Z._mouseUp);\r\n\t}, // end bind\r\n\r\n\t_mouseMove: function domove(event) {\r\n\t\tevent = jQuery.event.fix( event || window.event );\r\n\t\tvar rating = event.delegateTarget, Z = rating.jslet;\r\n\t\tif (Z._readOnly) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar jqRating = jQuery(rating),\r\n\t\t\tx1 = event.pageX - jqRating.offset().left,\r\n\t\t\tk = Math.ceil(x1 / Z.splitWidth), offsetW,\r\n\t\t\toRow = rating.firstChild.rows[0],\r\n\t\t\titemCnt = oRow.cells.length;\r\n\r\n\t\tvar valueNo = this.cellIndex + 1;\r\n\t\tfor (var i = 0; i < itemCnt; i++) {\r\n\t\t\tvar oitem = oRow.cells[i];\r\n\t\t\tZ._setBackgroundPos(oitem, Z._getPosX(i % Z._splitCount, i < valueNo ? 1: 2));\r\n\t\t}\r\n\t},\r\n\r\n\t_mouseOut: function doout(event) {\r\n\t\tevent = jQuery.event.fix( event || window.event );\r\n\t\tvar Z = event.delegateTarget.jslet;\r\n\t\tif (Z._readOnly) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tZ.doValueChanged();\r\n\t},\r\n\r\n\t_mouseDown: function dodown(event) {\r\n\t\tevent = jQuery.event.fix( event || window.event );\r\n\t\tvar rating = event.delegateTarget,\r\n\t\tZ = rating.jslet;\r\n\t\tif (Z._readOnly) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar oRow = rating.firstChild.rows[0],\r\n\t\t\titemCnt = oRow.cells.length;\r\n\t\t\r\n\t\t//if can set zero and current item is first one, then clear value\r\n\t\tvar k = this.cellIndex+1;\r\n\t\tif (!Z._required && k == 1) {\r\n\t\t\tk = (Z.value * Z._splitCount) == 1 ? 0 : 1;\r\n\t\t}\r\n\t\tZ.value = k / Z._splitCount;\r\n\t\tZ._dataset.setFieldValue(Z._field, Z.value, Z._valueIndex);\r\n\t\tZ.doValueChanged();\r\n\t},\r\n\r\n\t_mouseUp: function(event) {\r\n\t\tevent = jQuery.event.fix( event || window.event );\r\n\t\tvar rating = event.delegateTarget,\r\n\t\t\toRow = rating.firstChild.rows[0],\r\n\t\t\tZ = rating.jslet;\r\n\t\tif (Z._readOnly) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (Z._selectedItem >= 0) {\r\n\t\t\tvar oitem = oRow.cells[Z._selectedItem];\r\n\t\t\tZ._setBackgroundPos(oitem, Z._selectedPx);\r\n\t\t}\r\n\t},\r\n\r\n\t_getPosX: function(index, status){\r\n\t\tvar Z = this, isRtl = jslet.locale.isRtl,bgX;\r\n\t\tbgX = 0 - status * Z._itemWidth;\r\n\t\tif (isRtl){\r\n\t\t\tbgX += (index+1)*Z.splitWidth - Z._itemWidth;\r\n\t\t} else {\r\n\t\t\tbgX -= index * Z.splitWidth;\r\n\t\t}\r\n\t\treturn bgX;\r\n\t},\r\n\t\r\n\t_setBackgroundPos: function (oitem, posX) {\r\n\t\tif (oitem.style.backgroundPositionX !== undefined) {\r\n\t\t\toitem.style.backgroundPositionX = posX + 'px';\r\n\t\t} else {\r\n\t\t\toitem.style.backgroundPosition = posX + 'px 0px';\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdoMetaChanged: function($super, metaName){\r\n\t\t$super(metaName);\r\n\t\tvar Z = this,\r\n\t\t\tfldObj = Z._dataset.getField(Z._field);\r\n\t\tif(!metaName || metaName == \"disabled\" || metaName == \"readOnly\") {\r\n\t\t\tZ._readOnly = fldObj.disabled() || fldObj.readOnly();\r\n\t\t}\r\n\t\tif(!metaName || metaName == \"required\") {\r\n\t\t\tZ._required = fldObj.required();\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdoValueChanged: function() {\r\n\t\tvar Z = this,\r\n\t\t\tfldObj = Z._dataset.getField(Z._field),\r\n\t\t\tvalue = Z.getValue(),\r\n\t\t\titemCnt = Z._itemCount * Z._splitCount,\r\n\t\t\tvalueNo = Math.ceil(value * Z._splitCount),\r\n\t\t\toitem, offsetW, bgX, ratingRow = Z.el.firstChild.rows[0],\r\n\t\t\tbgW = Z._itemWidth * 2,\r\n\t\t\tisRtl = jslet.locale.isRtl;\r\n\t\t\r\n\t\tZ.value = value;\r\n\t\tfor (var i = 0; i < itemCnt; i++) {\r\n\t\t\toitem = ratingRow.childNodes[i];\r\n\t\t\tZ._setBackgroundPos(oitem, Z._getPosX(i % Z._splitCount, i < valueNo ? 0: 2));\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tvar Z = this, \r\n\t\t\tfldObj = Z._dataset.getField(Z._field);\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tif (!jqEl.hasClass('jl-rating')) {\r\n\t\t\tjqEl.addClass('jl-rating');\r\n\t\t}\r\n\t\tjqEl.html('<table border=\"0\" cellspacing=\"0\" cellpadding=\"0\" style=\"table-layout:fixed;border-collapse:collapse\"><tr></tr></table>');\r\n\r\n\t\tvar oitem, itemCnt = Z._itemCount * Z._splitCount,\r\n\t\t\totr = Z.el.firstChild.rows[0];\r\n\t\t\t\r\n\t\tZ.splitWidth = parseInt(Z._itemWidth / Z._splitCount);\r\n\t\tfor (var i = 1; i <= itemCnt; i++) {\r\n\t\t\toitem = document.createElement('td');\r\n\t\t\toitem.className = 'jl-rating-item';\r\n\t\t\toitem.style.width = Z.splitWidth + 'px';\r\n\t\t\toitem.style.height = Z._itemWidth + 'px';\r\n\t\t\toitem.title = i / Z._splitCount;\r\n\t\t\totr.appendChild(oitem);\r\n\t\t}\r\n\t\tjqEl.width(Z._itemCount * Z._itemWidth);\r\n\t\tZ.refreshControl(jslet.data.RefreshEvent.updateAllEvent(), true);\r\n\t}, // end renderAll\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tjqEl.off();\r\n\t\t\r\n\t\t$super();\r\n\t}\r\n});\r\n\r\njslet.ui.DBRating.CHECKED = 0;\r\njslet.ui.DBRating.UNCHECKED = 1;\r\njslet.ui.DBRating.FOCUS = 2;\r\n\r\njslet.ui.register('DBRating', jslet.ui.DBRating);\r\njslet.ui.DBRating.htmlTemplate = '<Div></Div>';\r\n\n/* ========================================================================\r\n * Jslet framework: jslet.dbselect.js\r\n *\r\n * Copyright (c) 2014 Jslet Group(https://github.com/jslet/jslet/)\r\n * Licensed under MIT (https://github.com/jslet/jslet/LICENSE.txt)\r\n * ======================================================================== */\r\n\r\n/**\r\n * @class DBSelect. Example:\r\n * <pre><code>\r\n * var jsletParam = {type:\"DBSelect\",dataset:\"employee\",field:\"department\"};\r\n * \r\n * //1. Declaring:\r\n * &lt;select data-jslet='type:\"DBSelect\",dataset:\"employee\",field:\"department\"' />\r\n * or\r\n * &lt;select data-jslet='jsletParam' />\r\n *\r\n *  //2. Binding\r\n * &lt;select id=\"ctrlId\"  />\r\n * //Js snippet\r\n * var el = document.getElementById('ctrlId');\r\n * jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *  //3. Create dynamically\r\n * jslet.ui.createControl(jsletParam, document.body);\r\n * \r\n * </code></pre>\r\n */\r\njslet.ui.DBSelect = jslet.Class.create(jslet.ui.DBFieldControl, {\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.allProperties = 'dataset,field,groupField,lookupDataset';\r\n\t\t/**\r\n\t\t * {String} Group field name, you can use this to group options.\r\n\t\t * Detail to see html optgroup element.\r\n\t\t */\r\n\t\tZ._groupField = null;\r\n\t\t\r\n\t\t/**\r\n\t\t * {String or jslet.data.Dataset} It will use this dataset to render Select Options.\r\n\t\t */\r\n\t\tZ._lookupDataset = null;\r\n\t\t\r\n\t\tZ._enableInvalidTip = true;\r\n\t\t\r\n\t\tZ._innerEditFilterExpr;\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\tgroupField: function(groupField) {\r\n\t\tif(groupField === undefined) {\r\n\t\t\treturn this._groupField;\r\n\t\t}\r\n\t\tgroupField = jQuery.trim(groupField);\r\n\t\tjslet.Checker.test('DBSelect.groupField', groupField).isString();\r\n\t\tthis._groupField = groupField;\r\n\t},\r\n\t\r\n\tlookupDataset: function(lookupDataset) {\r\n\t\tif(lookupDataset === undefined) {\r\n\t\t\treturn this._lookupDataset;\r\n\t\t}\r\n\r\n\t\tif (jslet.isString(lookupDataset)) {\r\n\t\t\tlookupDataset = jslet.data.dataModule.get(jQuery.trim(lookupDataset));\r\n\t\t}\r\n\t\t\r\n\t\tjslet.Checker.test('DBSelect.lookupDataset', lookupDataset).isClass(jslet.data.Dataset.className);\r\n\t\tthis._lookupDataset = lookupDataset;\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\treturn (el.tagName.toLowerCase() == 'select');\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tvar Z = this,\r\n\t\t\tfldObj = Z._dataset.getField(Z._field),\r\n\t\t\tvalueStyle = fldObj.valueStyle();\r\n\t\t\r\n\t\tif(Z.el.multiple && valueStyle != jslet.data.FieldValueStyle.MULTIPLE) {\r\n\t\t\tfldObj.valueStyle(jslet.data.FieldValueStyle.MULTIPLE);\r\n\t\t} else if(valueStyle == jslet.data.FieldValueStyle.MULTIPLE && !Z.el.multiple) {\r\n\t\t\tZ.el.multiple = \"multiple\";\t\r\n\t\t}\r\n\t\tZ.renderAll();\r\n\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tjqEl.on('change', Z._doChanged);\r\n\t\tjqEl.on('mousedown', Z._doMouseDown);\r\n\t\tjqEl.focus(function(event) {\r\n\t\t\tjqEl.trigger('editing', [Z._field]);\r\n\t\t});\r\n\t\tif(Z.el.multiple) {\r\n\t\t\tjqEl.on('click', 'option', Z._doCheckLimitCount);\r\n\t\t}\r\n\t\tjqEl.addClass('form-control');//Bootstrap class\r\n\t\tZ.doMetaChanged('required');\r\n\t}, // end bind\r\n\r\n\t_doMouseDown: function(event) {\r\n\t\tvar Z = this.jslet,\r\n\t\t\tctrlRecno = Z.ctrlRecno();\r\n\t\tif(ctrlRecno >= 0 && ctrlRecno != Z._dataset.recno()) {\r\n\t\t\tZ._skipRefresh = true;\r\n\t\t\ttry {\r\n\t\t\t\tZ._dataset.recno(ctrlRecno);\r\n\t\t\t} finally {\r\n\t\t\t\tZ._skipRefresh = false;\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\t_doChanged: function (event) {\r\n\t\tvar Z = this.jslet;\r\n\t\tif(Z.el.multiple) {\r\n\t\t\tif(Z.inProcessing) {\r\n\t\t\t\tZ.inProcessing = false;\r\n\t\t\t}\r\n\t\t\tvar fldObj = Z._dataset.getField(Z._field),\r\n\t\t\t\tlimitCount = fldObj.valueCountLimit();\r\n\r\n\t\t\tif(limitCount) {\r\n\t\t\t\tvar values = Z._dataset.getFieldValue(Z._field),\r\n\t\t\t\t\tcount = 1;\r\n\t\t\t\tif(jslet.isArray(values)) {\r\n\t\t\t\t\tcount = values.length;\r\n\t\t\t\t}\r\n\t\t\t\tif (count >= limitCount) {\r\n\t\t\t\t\tjslet.showInfo(jslet.formatString(jslet.locale.DBCheckBoxGroup.invalidCheckedCount,\r\n\t\t\t\t\t\t\t[''\t+ limitCount]));\r\n\t\t\t\t\t\r\n\t\t\t\t\twindow.setTimeout(function(){\r\n\t\t\t\t\t\tif(Z._currOption) {\r\n\t\t\t\t\t\t\tZ.inProcessing = true;\r\n\t\t\t\t\t\t\tZ._currOption.selected = false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}, 10);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.jslet.updateToDataset();\r\n\t},\r\n\t\r\n\t_doCheckLimitCount: function(event) {\r\n\t\tvar Z = event.delegateTarget.jslet;\r\n\t\tZ._currOption = this;\r\n\t},\r\n\r\n\t_setDefaultValue: function(fldObj, firstItemValue) {\r\n\t\tif(!firstItemValue || !fldObj.required()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar dftValue = fldObj.defaultValue();\r\n\t\tif(dftValue) {\r\n\t\t\tvar lkds = fldObj.lookup().dataset();\r\n\t\t\tvar found = lkds.findByKey(dftValue);\r\n\t\t\tif(found) {\r\n\t\t\t\treturn;\r\n\t\t\t} else {\r\n\t\t\t\tdftValue = null;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tif(!dftValue) {\r\n\t\t\tfldObj.defaultValue(firstItemValue);\r\n\t\t}\r\n\t\tif(this._dataset.changedStatus() && !fldObj.getValue()) {\r\n\t\t\tfldObj.setValue(firstItemValue);\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdoLookupChanged: function () {\r\n\t\tvar Z = this,\r\n\t\t\tfldObj = Z._dataset.getField(Z._field),\r\n\t\t\tlkf = fldObj.lookup();\r\n\t\tif(Z._lookupDataset) {\r\n\t\t\tlkf = new jslet.data.FieldLookup();\r\n\t\t\tlkf.dataset(Z._lookupDataset);\r\n\t\t} else {\r\n\t\t\tif (!lkf) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar lkds = lkf.dataset(),\r\n\t\t\tgroupIsLookup = false,\r\n\t\t\tgroupLookup, \r\n\t\t\tgroupFldObj, \r\n\t\t\textraIndex;\r\n\r\n\t\tif (Z._groupField) {\r\n\t\t\tgroupFldObj = lkds.getField(Z._groupField);\r\n\t\t\tif (groupFldObj === null) {\r\n\t\t\t\tthrow 'NOT found field: ' + Z._groupField + ' in ' + lkds.name();\r\n\t\t\t}\r\n\t\t\tgroupLookup = groupFldObj.lookup();\r\n\t\t\tgroupIsLookup = (groupLookup !== null);\r\n\t\t\tif (groupIsLookup) {\r\n\t\t\t\textraIndex = Z._groupField + '.' + groupLookup.codeField();\r\n\t\t\t} else {\r\n\t\t\t\textraIndex = Z._groupField;\r\n\t\t\t}\r\n\t\t\tvar indfld = lkds.indexFields();\r\n\t\t\tif (indfld) {\r\n\t\t\t\tlkds.indexFields(extraIndex + ';' + indfld);\r\n\t\t\t} else {\r\n\t\t\t\tlkds.indexFields(extraIndex);\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar preGroupValue = null, groupValue, groupDisplayValue, content = [];\r\n\r\n\t\tif (!Z.el.multiple && !fldObj.required()){\r\n\t\t\tcontent.push('<option value=\"_null_\">');\r\n\t\t\tcontent.push(fldObj.nullText());\r\n\t\t\tcontent.push('</option>');\r\n\t\t}\r\n\t\tvar oldRecno = lkds.recno(),\r\n\t\t\toptValue, optDispValue, \r\n\t\t\tfirstItemValue = null,\r\n\t\t\teditFilter = lkf.editFilter();\r\n\t\tZ._innerEditFilterExpr = null;\r\n\t\tvar editItemDisabled = lkf.editItemDisabled();\r\n\t\tif(editFilter) {\r\n\t\t\tZ._innerEditFilterExpr = new jslet.Expression(lkds, editFilter);\r\n\t\t}\r\n\t\tvar disableOption = false;\r\n\t\ttry {\r\n\t\t\tfor (var i = 0, cnt = lkds.recordCount(); i < cnt; i++) {\r\n\t\t\t\tlkds.recnoSilence(i);\r\n\t\t\t\tdisableOption = false;\r\n\t\t\t\tif(Z._innerEditFilterExpr && !Z._innerEditFilterExpr.eval()) {\r\n\t\t\t\t\tif(!editItemDisabled) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tdisableOption = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (Z._groupField) {\r\n\t\t\t\t\tgroupValue = lkds.getFieldValue(Z._groupField);\r\n\t\t\t\t\tif (groupValue != preGroupValue) {\r\n\t\t\t\t\t\tif (preGroupValue !== null) {\r\n\t\t\t\t\t\t\tcontent.push('</optgroup>');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (groupIsLookup) {\r\n\t\t\t\t\t\t\tif (!groupLookup.dataset()\r\n\t\t\t\t\t\t\t\t\t\t\t.findByField(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tgroupLookup\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.keyField(),\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tgroupValue)) {\r\n\t\t\t\t\t\t\t\tthrow 'Not found: [' + groupValue + '] in Dataset: [' +\r\n\t\t\t\t\t\t\t\t\tgroupLookup.dataset().name() +\r\n\t\t\t\t\t\t\t\t\t']field: [' + groupLookup.keyField() + ']';\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tgroupDisplayValue = groupLookup.getCurrentDisplayValue();\r\n\t\t\t\t\t\t} else\r\n\t\t\t\t\t\t\tgroupDisplayValue = groupValue;\r\n\r\n\t\t\t\t\t\tcontent.push('<optgroup label=\"');\r\n\t\t\t\t\t\tcontent.push(groupDisplayValue);\r\n\t\t\t\t\t\tcontent.push('\">');\r\n\t\t\t\t\t\tpreGroupValue = groupValue;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tcontent.push('<option value=\"');\r\n\t\t\t\toptValue = lkds.getFieldValue(lkf.keyField());\r\n\t\t\t\tif(firstItemValue === null) {\r\n\t\t\t\t\tfirstItemValue = optValue;\r\n\t\t\t\t}\r\n\t\t\t\tcontent.push(optValue);\r\n\t\t\t\tcontent.push('\"'+ (disableOption? ' disabled': '') +  '>');\r\n\t\t\t\tcontent.push(lkf.getCurrentDisplayValue());\r\n\t\t\t\tcontent.push('</option>');\r\n\t\t\t} // end for\r\n\t\t\tif (preGroupValue !== null) {\r\n\t\t\t\tcontent.push('</optgroup>');\r\n\t\t\t}\r\n\t\t\tjQuery(Z.el).html(content.join(''));\r\n\t\t\tZ._setDefaultValue(fldObj, firstItemValue);\r\n\t\t\tZ.doValueChanged();\r\n\t\t} finally {\r\n\t\t\tlkds.recnoSilence(oldRecno);\r\n\t\t}\r\n\t}, // end renderOptions\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdoMetaChanged: function($super, metaName){\r\n\t\t$super(metaName);\r\n\t\tvar Z = this,\r\n\t\t\tfldObj = Z._dataset.getField(Z._field);\r\n\t\tif(!metaName || metaName == \"disabled\" || metaName == \"readOnly\") {\r\n\t\t\tvar disabled = fldObj.disabled() || fldObj.readOnly();\r\n\t\t\tZ.el.disabled = disabled;\r\n\t\t\tjslet.ui.setEditableStyle(Z.el, disabled, disabled, true, fldObj.required());\r\n\t\t}\r\n\t\tif(metaName && metaName == 'required') {\r\n\t\t\tvar jqEl = jQuery(Z.el);\r\n\t\t\tif (fldObj.required()) {\r\n\t\t\t\tjqEl.addClass('jl-ctrl-required');\r\n\t\t\t} else {\r\n\t\t\t\tjqEl.removeClass('jl-ctrl-required');\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(!metaName || metaName == 'tabIndex') {\r\n\t\t\tZ.setTabIndex();\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdoValueChanged: function() {\r\n\t\tvar Z = this;\r\n\t\tif (Z._skipRefresh) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar errObj = Z.getFieldError();\r\n\t\tif(errObj && errObj.message) {\r\n\t\t\tZ.el.value = errObj.inputText;\r\n\t\t\tZ.renderInvalid(errObj);\r\n\t\t\treturn;\r\n\t\t} else {\r\n\t\t\tZ.renderInvalid(null);\r\n\t\t}\r\n\t\tvar value = Z.getValue();\r\n\t\tif(!Z.el.multiple && value === Z.el.value) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar optCnt = Z.el.options.length, \r\n\t\t\topt, i;\r\n\t\tfor (i = 0; i < optCnt; i++) {\r\n\t\t\topt = Z.el.options[i];\r\n\t\t\tif (opt) {\r\n\t\t\t\topt.selected = false;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tvar fldObj = Z._dataset.getField(Z._field);\r\n\t\tif (!Z.el.multiple) {\r\n\t\t\tif(!Z._checkOptionEditable(fldObj, value)) {\r\n\t\t\t\tvalue = null;\r\n\t\t\t}\r\n\t\t\tif (value === null){\r\n\t\t\t\tif (!fldObj.required()) {\r\n\t\t\t\t\tvalue = '_null_';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tZ.el.value = value;\r\n\t\t} else {\r\n\t\t\tvar arrValue = value;\r\n\t\t\tif(arrValue === null || arrValue.length === 0) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\t\r\n\t\t\tvar vcnt = arrValue.length - 1, selected;\r\n\t\t\tZ._skipRefresh = true;\r\n\t\t\ttry {\r\n\t\t\t\tfor (i = 0; i < optCnt; i++) {\r\n\t\t\t\t\topt = Z.el.options[i];\r\n\r\n\t\t\t\t\tfor (j = vcnt; j >= 0; j--) {\r\n\t\t\t\t\t\tselected = (arrValue[j] == opt.value);\r\n\t\t\t\t\t\tif (selected) {\r\n\t\t\t\t\t\t\topt.selected = selected;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} // end for j\r\n\t\t\t\t} // end for i\r\n\t\t\t} finally {\r\n\t\t\t\tZ._skipRefresh = false;\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n \r\n\t_checkOptionEditable: function(fldObj, fldValue) {\r\n\t\tvar Z = this;\r\n\t\tif(!Z._innerEditFilterExpr || fldValue === null || fldValue === undefined || fldValue === '') {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tvar lkDs = fldObj.lookup().dataset(); \r\n\t\tif(lkDs.findByKey(fldValue) && !Z._innerEditFilterExpr.eval()) {\r\n\t\t\treturn false;\r\n\t\t} else {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t},\r\n\t\r\n\tfocus: function() {\r\n\t\tthis.el.focus();\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tthis.refreshControl(jslet.data.RefreshEvent.updateAllEvent(), true);\r\n\t},\r\n\r\n\tupdateToDataset: function () {\r\n\t\tvar Z = this;\r\n\t\tif (Z._skipRefresh) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar opt, value,\r\n\t\t\tisMulti = Z.el.multiple;\r\n\t\tif (!isMulti) {\r\n\t\t\tvalue = Z.el.value;\r\n\t\t\tif (!value) {\r\n\t\t\t\topt = Z.el.options[Z.el.selectedIndex];\r\n\t\t\t\tvalue = opt.innerHTML;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tvar opts = jQuery(Z.el).find('option'),\r\n\t\t\t\toptCnt = opts.length - 1;\r\n\t\t\tvalue = [];\r\n\t\t\tfor (var i = 0; i <= optCnt; i++) {\r\n\t\t\t\topt = opts[i];\r\n\t\t\t\tif (opt.selected) {\r\n\t\t\t\t\tvalue.push(opt.value ? opt.value : opt.innerHTML);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tZ._skipRefresh = true;\r\n\t\ttry {\r\n\t\t\tif (!isMulti) {\r\n\t\t\t\tvar fldObj = Z._dataset.getField(Z._field);\r\n\t\t\t\tif (value == '_null_' && !fldObj.required()) {\r\n\t\t\t\t\tvalue = null;\r\n\t\t\t\t}\r\n\t\t\t\tZ._dataset.setFieldValue(Z._field, value, Z._valueIndex);\r\n\t\t\t\tvar lkfldObj = fldObj.lookup(),\r\n\t\t\t\t\tfieldMap = lkfldObj.returnFieldMap();\r\n\t\t\t\tif(fieldMap) {\r\n\t\t\t\t\tvar lookupDs = lkfldObj.dataset();\r\n\t\t\t\t\t\tmainDs = Z._dataset;\r\n\t\t\t\t\tif(lookupDs.findByKey(value)) {\r\n\t\t\t\t\t\tvar fldName, lkFldName;\r\n\t\t\t\t\t\tfor(var fldName in fieldMap) {\r\n\t\t\t\t\t\t\tlkFldName = fieldMap[fldName];\r\n\t\t\t\t\t\t\tmainDs.setFieldValue(fldName, lookupDs.getFieldValue(lkFldName));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\t\t\t\t\r\n\t\t\t} else {\r\n\t\t\t\tZ._dataset.setFieldValue(Z._field, value);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t} finally {\r\n\t\t\tZ._skipRefresh = false;\r\n\t\t}\r\n\t}, // end updateToDataset\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\tthis._currOption = null;\r\n\t\tjQuery(this.el).off();\r\n\t\t$super();\r\n\t}\r\n});\r\n\r\njslet.ui.register('DBSelect', jslet.ui.DBSelect);\r\njslet.ui.DBSelect.htmlTemplate = '<select></select>';\r\n\n/* ========================================================================\r\n * Jslet framework: jslet.dbspinedit.js\r\n *\r\n * Copyright (c) 2014 Jslet Group(https://github.com/jslet/jslet/)\r\n * Licensed under MIT (https://github.com/jslet/jslet/LICENSE.txt)\r\n * ======================================================================== */\r\n\r\n/**\r\n * @class DBSpinEdit. \r\n * <pre><code>\r\n * var jsletParam = {type:\"DBSpinEdit\",dataset:\"employee\",field:\"age\", minValue:18, maxValue: 100, step: 5};\r\n * \r\n * //1. Declaring:\r\n * &lt;div data-jslet='type:\"DBSpinEdit\",dataset:\"employee\",field:\"age\", minValue:18, maxValue: 100, step: 5' />\r\n * or\r\n * &lt;div data-jslet='jsletParam' />\r\n *\r\n *  //2. Binding\r\n * &lt;div id=\"ctrlId\"  />\r\n * //Js snippet\r\n * var el = document.getElementById('ctrlId');\r\n * jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *  //3. Create dynamically\r\n * jslet.ui.createControl(jsletParam, document.body);\r\n *\r\n * </code></pre>\r\n */\r\njslet.ui.DBSpinEdit = jslet.Class.create(jslet.ui.DBFieldControl, {\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.allProperties = 'dataset,field,step';\r\n\t\t/**\r\n\t\t * {Integer} Step value.\r\n\t\t */\r\n\t\tZ._step = 1;\r\n\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\tstep: function(step) {\r\n\t\tif(step === undefined) {\r\n\t\t\treturn this._step;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBSpinEdit.step', step).isNumber();\r\n\t\tthis._step = step;\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\tvar tag = el.tagName.toLowerCase();\r\n\t\treturn tag == 'div';\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el);\r\n\t\tif(!jqEl.hasClass('jl-spinedit')) {\r\n\t\t\tjqEl.addClass('input-group jl-spinedit');\r\n\t\t}\r\n\t\tZ._createControl();\r\n\t\tZ.renderAll();\r\n\t}, // end bind\r\n\r\n\t_createControl: function() {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el),\r\n\t\t\ts = '<input type=\"text\" class=\"form-control\">' + \r\n\t\t    \t'<div class=\"jl-spinedit-btn-group\">' +\r\n\t\t    \t'<button class=\"btn btn-default jl-spinedit-up\" tabindex=\"-1\"><i class=\"fa fa-caret-up\"></i></button>' + \r\n\t\t    \t'<button class=\"btn btn-default jl-spinedit-down\" tabindex=\"-1\"><i class=\"fa fa-caret-down\"></i></button>';\r\n\t\tjqEl.html(s);\r\n\t\t\r\n\t\tvar editor = jqEl.find('input')[0],\r\n\t\t\tupButton = jqEl.find('.jl-spinedit-up')[0],\r\n\t\t\tdownButton = jqEl.find('.jl-spinedit-down')[0];\r\n\t\tZ.editor = editor;\r\n\t\tjQuery(Z.editor).on(\"keydown\", function(event){\r\n\t\t\tif(Z._isDisabled()) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar keyCode = event.keyCode;\r\n\t\t\tif(keyCode == jslet.ui.KeyCode.UP) {\r\n\t\t\t\tZ.decValue();\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif(keyCode == jslet.ui.KeyCode.DOWN) {\r\n\t\t\t\tZ.incValue();\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t});\r\n\t\tnew jslet.ui.DBText(editor, {\r\n\t\t\tdataset: Z._dataset,\r\n\t\t\tfield: Z._field,\r\n\t\t\tbeforeUpdateToDataset: Z.beforeUpdateToDataset,\r\n\t\t\tvalueIndex: Z._valueIndex\r\n\t\t});\r\n\t\t\r\n\t\tjQuery(upButton).on('click', function () {\r\n\t\t\tZ.incValue();\r\n\t\t});\r\n\t\t\r\n\t\tjQuery(upButton).on('focus', function () {\r\n\t\t\tjqEl.trigger('editing', [Z._field]);\r\n\t\t});\r\n\t\t\r\n\t\tjQuery(downButton).on('click', function () {\r\n\t\t\tZ.decValue();\r\n\t\t});\r\n\t\t\r\n\t\tjQuery(downButton).on('focus', function () {\r\n\t\t\tjqEl.trigger('editing', [Z._field]);\r\n\t\t});\r\n\t\t\r\n\t},\r\n\t\r\n\t/** \r\n\t * @override\r\n\t */ \r\n\tsetTabIndex: function(tabIdx) {\r\n\t\tvar Z = this;\r\n\t\tif(Z.inTableCtrl()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tif(tabIdx !== 0 && !tabIdx) {\r\n\t\t\tfldObj = Z._dataset.getField(Z._field);\r\n\t\t\tif(fldObj) {\r\n\t\t\t\ttabIdx = fldObj.tabIndex();\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(tabIdx === 0 || tabIdx) {\r\n\t\t\tZ.textCtrl.el.tabIndex = tabIdx;\r\n\t\t}\t\r\n\t},\r\n\t\r\n\t_isDisabled: function() {\r\n\t\tvar Z = this,\r\n\t\t\tfldObj = Z._dataset.getField(Z._field);\r\n\t\treturn fldObj.disabled() || fldObj.readOnly();\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tbeforeUpdateToDataset: function () {\r\n\t\tvar Z = this,\r\n\t\t\tval = Z.el.value;\r\n\t\tvar fldObj = Z._dataset.getField(Z._field),\r\n\t\t\trange = fldObj.dataRange(),\r\n\t\t\tminValue = Number.NEGATIVE_INFINITY, \r\n\t\t\tmaxValue = Number.POSITIVE_INFINITY;\r\n\t\t\r\n\t\tif(range) {\r\n\t\t\tif(range.min) {\r\n\t\t\t\tminValue = parseFloat(range.min);\r\n\t\t\t}\r\n\t\t\tif(range.max) {\r\n\t\t\t\tmaxValue = parseFloat(range.max);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (val) {\r\n\t\t\tval = parseFloat(val);\r\n//\t\t\tif (val) {\r\n//\t\t\t\tif (val > maxValue)\r\n//\t\t\t\t\tval = maxValue;\r\n//\t\t\t\telse if (val < minValue)\r\n//\t\t\t\t\tval = minValue;\r\n//\t\t\t\tval = String(val);\r\n//\t\t\t}\r\n\t\t}\r\n\t\tjQuery(Z.el).attr('aria-valuenow', val);\r\n\t\tZ.el.value = val;\r\n\t\treturn true;\r\n\t}, // end beforeUpdateToDataset\r\n\r\n\tsetValueToDataset: function (val) {\r\n\t\tvar Z = this;\r\n\t\tif (Z.silence) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tZ.silence = true;\r\n\t\tif (val === undefined) {\r\n\t\t\tval = Z.value;\r\n\t\t}\r\n\t\ttry {\r\n\t\t\tZ._dataset.setFieldValue(Z._field, val, Z._valueIndex);\r\n\t\t} finally {\r\n\t\t\tZ.silence = false;\r\n\t\t}\r\n\t}, // end setValueToDataset\r\n\r\n\tincValue: function () {\r\n\t\tvar Z = this,\r\n\t\t\tval = Z.getValue();\r\n\t\tif (!val) {\r\n\t\t\tval = 0;\r\n\t\t}\r\n\t\tvar maxValue = Z._getRange().maxValue;\r\n\t\tif (val == maxValue) {\r\n\t\t\treturn;\r\n\t\t} else if (val < maxValue) {\r\n\t\t\tval += Z._step;\r\n\t\t} else {\r\n\t\t\tval = maxValue;\r\n\t\t}\r\n\t\tif (val > maxValue) {\r\n\t\t\tvalue = maxValue;\r\n\t\t}\r\n\t\tjQuery(Z.el).attr('aria-valuenow', val);\r\n\t\tZ.setValueToDataset(val);\r\n\t}, // end incValue\r\n\r\n\t_getRange: function() {\r\n\t\tvar Z = this,\r\n\t\t\tfldObj = Z._dataset.getField(Z._field),\r\n\t\t\trange = fldObj.dataRange(),\r\n\t\t\tminValue = Number.NEGATIVE_INFINITY, \r\n\t\t\tmaxValue = Number.POSITIVE_INFINITY;\r\n\t\t\r\n\t\tif(range) {\r\n\t\t\tif(range.min) {\r\n\t\t\t\tminValue = parseFloat(range.min);\r\n\t\t\t}\r\n\t\t\tif(range.max) {\r\n\t\t\t\tmaxValue = parseFloat(range.max);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn {minValue: minValue, maxValue: maxValue};\r\n\t},\r\n\t\r\n\tdecValue: function () {\r\n\t\tvar Z = this,\r\n\t\t\tval = Z.getValue();\r\n\t\tif (!val) {\r\n\t\t\tval = 0;\r\n\t\t}\r\n\t\tvar minValue = Z._getRange().minValue;\r\n\t\tif (val == minValue) {\r\n\t\t\treturn;\r\n\t\t} else if (val > minValue) {\r\n\t\t\tval -= Z._step;\r\n\t\t} else {\r\n\t\t\tval = minValue;\r\n\t\t}\r\n\t\tif (val < minValue)\r\n\t\t\tval = minValue;\r\n\t\tjQuery(Z.el).attr('aria-valuenow', val);\r\n\t\tZ.setValueToDataset(val);\r\n\t}, // end decValue\r\n\t\r\n\tfocus: function() {\r\n\t\tif(Z._isDisabled()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.editor.focus();\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdoMetaChanged: function($super, metaName) {\r\n\t\t$super(metaName);\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(this.el),\r\n\t\t\tfldObj = Z._dataset.getField(Z._field);\r\n\t\t\r\n\t\tif(!metaName || metaName == 'disabled' || metaName == 'readOnly') {\r\n\t\t\tvar disabled = fldObj.disabled() || fldObj.readOnly(),\r\n\t\t\t\tjqUpBtn = jqEl.find('.jl-spinedit-up'),\r\n\t\t\t\tjqDownBtn = jqEl.find('.jl-spinedit-down');\r\n\t\t\t\t\r\n\t\t\tif (disabled) {\r\n\t\t\t\tjqUpBtn.attr('disabled', 'disabled');\r\n\t\t\t\tjqDownBtn.attr('disabled', 'disabled');\r\n\t\t\t} else {\r\n\t\t\t\tjqUpBtn.attr('disabled', false);\r\n\t\t\t\tjqDownBtn.attr('disabled', false);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(!metaName || metaName == 'dataRange') {\r\n\t\t\trange = fldObj.dataRange();\r\n\t\t\tjqEl.attr('aria-valuemin', range && (range.min || range.min === 0) ? range.min: '');\r\n\t\t\tjqEl.attr('aria-valuemin', range && (range.max || range.max === 0) ? range.max: '');\r\n\t\t}\r\n\t\tif(!metaName || metaName == 'tabIndex') {\r\n\t\t\tZ.setTabIndex();\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function(){\r\n\t\tthis.refreshControl(jslet.data.RefreshEvent.updateAllEvent(), true);\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function(){\r\n\t\tvar jqEl = jQuery(this.el);\r\n\t\tjQuery(this.editor).off();\r\n\t\tthis.editor = null;\r\n\t\tjqEl.find('.jl-upbtn-up').off();\r\n\t\tjqEl.find('.jl-downbtn-up').off();\r\n\t}\r\n\t\r\n});\r\njslet.ui.register('DBSpinEdit', jslet.ui.DBSpinEdit);\r\njslet.ui.DBSpinEdit.htmlTemplate = '<div></div>';\r\n\r\n\n/* ========================================================================\r\n * Jslet framework: jslet.dbtext.js\r\n *\r\n * Copyright (c) 2014 Jslet Group(https://github.com/jslet/jslet/)\r\n * Licensed under MIT (https://github.com/jslet/jslet/LICENSE.txt)\r\n * ======================================================================== */\r\n\r\n/**\r\n * @class DBText is a powerful control, it can input any data type, like:\r\n *\t\tnumber, date etc. Example:\r\n * \r\n * <pre><code>\r\n * var jsletParam = {type:&quot;DBText&quot;,field:&quot;name&quot;};\r\n * //1. Declaring:\r\n * &lt;input id=&quot;ctrlId&quot; type=&quot;text&quot; data-jslet='jsletParam' /&gt;\r\n * or\r\n * &lt;input id=&quot;ctrlId&quot; type=&quot;text&quot; data-jslet='{type:&quot;DBText&quot;,field:&quot;name&quot;}' /&gt;\r\n * \r\n *  //2. Binding\r\n * &lt;input id=&quot;ctrlId&quot; type=&quot;text&quot; data-jslet='jsletParam' /&gt;\r\n * //Js snippet\r\n * var el = document.getElementById('ctrlId');\r\n * jslet.ui.bindControl(el, jsletParam);\r\n * \r\n *  //3. Create dynamically\r\n * jslet.ui.createControl(jsletParam, document.body);\r\n *\r\n * </code></pre>\r\n */\r\njslet.ui.DBText = jslet.Class.create(jslet.ui.DBFieldControl, {\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.allProperties = 'dataset,field,beforeUpdateToDataset,enableInvalidTip,onKeyDown,autoSelectAll';\r\n\r\n\t\t/**\r\n\t\t * @protected\r\n\t\t */\r\n\t\tZ._beforeUpdateToDataset = null;\r\n\t\tZ._enableInvalidTip = true;\r\n\t\t\r\n\t\tZ._enterProcessed = false;\r\n\t\t\r\n\t\tZ._autoSelectAll = true;\r\n\t\t/**\r\n\t\t * @private\r\n\t\t */\r\n\t\tZ.oldValue = null;\r\n\t\tZ.editMask = null;\r\n\t\tZ._position;\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\tbeforeUpdateToDataset: function(beforeUpdateToDataset) {\r\n\t\tif(beforeUpdateToDataset === undefined) {\r\n\t\t\treturn this._beforeUpdateToDataset;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBText.beforeUpdateToDataset', beforeUpdateToDataset).isFunction();\r\n\t\tthis._beforeUpdateToDataset = beforeUpdateToDataset;\r\n\t},\r\n\r\n\tenableInvalidTip: function(enableInvalidTip) {\r\n\t\tif(enableInvalidTip === undefined) {\r\n\t\t\treturn this._enableInvalidTip;\r\n\t\t}\r\n\t\tthis._enableInvalidTip = enableInvalidTip? true: false;\r\n\t},\r\n\r\n\tautoSelectAll: function(autoSelectAll) {\r\n\t\tif(autoSelectAll === undefined) {\r\n\t\t\treturn this._autoSelectAll;\r\n\t\t}\r\n\t\tthis._autoSelectAll = autoSelectAll? true: false;\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\treturn el.tagName.toLowerCase() == 'input' && \r\n\t\t\t\tel.type.toLowerCase() == 'text';\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tvar Z = this;\r\n\t\tZ.renderAll();\r\n\t\tvar jqEl = jQuery(Z.el);\r\n\t\tjqEl.addClass('form-control');\r\n\t\t\r\n\t\tif (Z.doFocus) {\r\n\t\t\tjqEl.on('focus', jQuery.proxy(Z.doFocus, Z));\r\n\t\t}\r\n\t\tif (Z.doBlur) {\r\n\t\t\tjqEl.on('blur', jQuery.proxy(Z.doBlur, Z));\r\n\t\t}\r\n\t\tif (Z.doKeydown) {\r\n\t\t\tjqEl.on('keydown', Z.doKeydown);\r\n\t\t}\r\n\t\tif (Z.doKeypress) {\r\n\t\t\tjqEl.on('keypress', Z.doKeypress);\r\n\t\t}\r\n\t\tZ.doMetaChanged('required');\r\n\t}, // end bind\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdoFocus: function () {\r\n\t\tvar Z = this;\r\n\t\tif (Z._skipFocusEvent) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar ctrlRecno = Z.ctrlRecno();\r\n\t\tif(ctrlRecno >= 0 && ctrlRecno != Z._dataset.recno()) {\r\n\t\t\tif(!Z._dataset.recno(ctrlRecno)) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\tZ.doValueChanged();\r\n\t\tZ.oldValue = Z.el.value;\r\n\t\tif(Z._autoSelectAll) {\r\n\t\t\tjslet.ui.textutil.selectText(Z.el);\r\n\t\t}\r\n\t\tjQuery(Z.el).trigger('editing', [Z._field]);\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdoBlur: function () {\r\n\t\tvar Z = this,\r\n\t\t\tfldObj = Z._dataset.getField(Z._field);\r\n\t\tZ._position = jslet.ui.textutil.getCursorPos(Z.el);\r\n\t\tif (fldObj.readOnly() || fldObj.disabled()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar jqEl = jQuery(this);\r\n\t\tif(jqEl.attr('readOnly') || jqEl.attr('disabled')) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tZ.updateToDataset();\r\n\t\tZ._isBluring = true;\r\n\t\ttry {\r\n\t\t\tZ.doValueChanged();\r\n\t\t} finally {\r\n\t\t\tZ._isBluring = false;\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdoKeydown: function(event) {\r\n\t\tevent = jQuery.event.fix( event || window.event );\r\n\t\tvar keyCode = event.which;\r\n\t\t//When press 'enter', write data to dataset.\r\n\t\tvar Z = this.jslet;\r\n\t\tif(keyCode == 13) {\r\n\t\t\tZ._enterProcessed = true;\r\n\t\t\tZ.updateToDataset();\r\n\t\t}\r\n\t\t//Process 'ArrowUp', 'ArrowDown', 'PageUp', 'PageDown' key when it is editing. \r\n\t\tvar isEditing = Z.ctrlRecno() >= 0 && Z._dataset.status() > 0;\r\n\t\tif(isEditing && (keyCode == 38 || keyCode == 40 || keyCode == 33 || keyCode == 34)) {\r\n\t\t\tZ._enterProcessed = true;\r\n\t\t\tZ.updateToDataset();\r\n\t\t}\r\n\t\tvar fldObj = Z._dataset.getField(Z._field);\r\n\t\tif (!fldObj.readOnly() && !fldObj.disabled() && (keyCode == 8 || keyCode == 46)) {\r\n\t\t\tZ._dataset.editRecord();\r\n\t\t}\r\n\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdoKeypress: function (event) {\r\n\t\tvar Z = this.jslet,\r\n\t\t\tfldObj = Z._dataset.getField(Z._field);\r\n\t\tif (fldObj.readOnly() || fldObj.disabled()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tevent = jQuery.event.fix( event || window.event );\r\n\t\tvar keyCode = event.which,\r\n\t\t\texistStr = jslet.getRemainingString(Z.el.value, jslet.ui.textutil.getSelectedText(Z.el)),\r\n\t\t\tcursorPos = jslet.ui.textutil.getCursorPos(Z.el);\r\n\t\tif (!Z._dataset.fieldValidator().checkInputChar(fldObj, String.fromCharCode(keyCode), existStr, cursorPos.begin)) {\r\n\t\t\tevent.preventDefault();\r\n\t\t}\r\n\t\tZ._dataset.editRecord();\r\n\t\t//When press 'enter', write data to dataset.\r\n\t\tif(keyCode == 13) {\r\n\t\t\tif(!Z._enterProcessed) {\r\n\t\t\t\tZ.updateToDataset();\r\n\t\t\t} else {\r\n\t\t\t\tZ._enterProcessed = false;\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\tfocus: function() {\r\n\t\tvar jqEl = jQuery(this.el);\r\n\t\tif(!jqEl.attr('disabled')) {\r\n\t\t\tthis.el.focus();\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * Select text.\r\n\t * \r\n\t * @param {Integer} start (Optional) start of cursor position\r\n\t * @param {Integer} end (Optional) end of cursor position\r\n\t */\r\n\tselectText: function(start, end){\r\n\t\tjslet.ui.textutil.selectText(this.el, start, end);\r\n\t},\r\n\t\r\n\t/**\r\n\t * Input a text into text control at current cursor position.\r\n\t * \r\n\t * @param {String} text the text need to be input.\r\n\t */\r\n\tinputText: function(text) {\r\n\t\tif(!text) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBText.inputText#text', text).isString();\r\n\t\t\r\n\t\tvar Z = this,\r\n\t\t\tfldObj = Z._dataset.getField(Z._field);\r\n\t\tif(fldObj.getType() !== jslet.data.DataType.STRING) {\r\n\t\t\tconsole.warn('Only String Field can be input!');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar ch, chs = [];\r\n\t\tfor(var i = 0, len = text.length; i < len; i++) {\r\n\t\t\tch = text[i];\r\n\t\t\tif (Z._dataset.fieldValidator().checkInputChar(fldObj, ch)) {\r\n\t\t\t\tchs.push(ch);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(!Z._position) {\r\n\t\t\tZ._position = jslet.ui.textutil.getCursorPos(Z.el);\r\n\t\t}\r\n\t\tvar subStr = chs.join(''),\r\n\t\t\tvalue =Z.el.value,\r\n\t\t\tbegin = Z._position.begin,\r\n\t\t\tend = Z._position.end;\r\n\t\tvar prefix = value.substring(0, begin), \r\n\t\t\tsuffix = value.substring(end); \r\n\t\tZ.el.value = prefix + text + suffix;\r\n\t\tZ._position = jslet.ui.textutil.getCursorPos(Z.el);\t\t\r\n\t\tZ.updateToDataset();\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trefreshControl: function ($super, evt, isForce) {\r\n\t\tif($super(evt, isForce) && this.afterRefreshControl) {\r\n\t\t\tthis.afterRefreshControl(evt);\r\n\t\t}\r\n\t}, \r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdoMetaChanged: function($super, metaName){\r\n\t\t$super(metaName);\r\n\t\tvar Z = this,\r\n\t\t\tfldObj = Z._dataset.getField(Z._field);\r\n\t\tif(!metaName || metaName == \"disabled\" || metaName == \"readOnly\") {\r\n\t\t\tjslet.ui.setEditableStyle(Z.el, fldObj.disabled(), fldObj.readOnly(), false, fldObj.required());\r\n\t\t}\r\n\t\t\r\n\t\tif(metaName && metaName == 'required') {\r\n\t\t\tvar jqEl = jQuery(Z.el);\r\n\t\t\tif (fldObj.required()) {\r\n\t\t\t\tjqEl.addClass('jl-ctrl-required');\r\n\t\t\t} else {\r\n\t\t\t\tjqEl.removeClass('jl-ctrl-required');\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(!metaName || metaName == 'editMask') {\r\n\t\t\tvar editMaskCfg = fldObj.editMask();\r\n\t\t\tif (editMaskCfg) {\r\n\t\t\t\tif(!Z.editMask) {\r\n\t\t\t\t\tZ.editMask = new jslet.ui.EditMask();\r\n\t\t\t\t\tZ.editMask.attach(Z.el);\r\n\t\t\t\t}\r\n\t\t\t\tmask = editMaskCfg.mask;\r\n\t\t\t\tkeepChar = editMaskCfg.keepChar;\r\n\t\t\t\ttransform = editMaskCfg.transform;\r\n\t\t\t\tZ.editMask.setMask(mask, keepChar, transform);\r\n\t\t\t} else {\r\n\t\t\t\tif(Z.editMask) {\r\n\t\t\t\t\tZ.editMask.detach();\r\n\t\t\t\t\tZ.editMask = null;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tif(!metaName || metaName == 'tabIndex') {\r\n\t\t\tZ.setTabIndex();\r\n\t\t}\r\n\t\t\r\n\t\tZ.el.maxLength = fldObj.getEditLength();\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdoValueChanged: function() {\r\n\t\tvar Z = this;\r\n\t\tif (Z._keep_silence_) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar errObj = Z.getFieldError();\r\n\t\tif(errObj && errObj.message) {\r\n\t\t\tZ.el.value = errObj.inputText || '';\r\n\t\t\tZ.renderInvalid(errObj);\r\n\t\t\treturn;\r\n\t\t} else {\r\n\t\t\tZ.renderInvalid(null);\r\n\t\t}\r\n\t\tvar fldObj = Z._dataset.getField(Z._field);\r\n\t\tvar align = fldObj.alignment();\r\n\t\r\n\t\tif (jslet.locale.isRtl){\r\n\t\t\tif (align == 'left') {\r\n\t\t\t\talign= 'right';\r\n\t\t\t} else {\r\n\t\t\t\talign = 'left';\r\n\t\t\t}\r\n\t\t}\r\n\t\tZ.el.style.textAlign = align;\r\n\t\tvar value;\r\n\t\tif (Z.editMask){\r\n\t\t\tvalue = Z.getValue();\r\n\t\t\tZ.editMask.setValue(value);\r\n\t\t} else {\r\n\t\t\tif (document.activeElement != Z.el || Z.el.readOnly || Z._isBluring) {\r\n\t\t\t\tvalue = Z.getText(false);\r\n\t\t\t} else {\r\n\t\t\t\tvalue = Z.getText(true);\r\n\t\t\t}\r\n\t\t\tif(fldObj.getType() === jslet.data.DataType.STRING && fldObj.antiXss()) {\r\n\t\t\t\tvalue = jslet.htmlDecode(value);\r\n\t\t\t}\r\n\t\t\tZ.el.value = value;\r\n\t\t}\r\n\t\tZ.oldValue = Z.el.value;\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tthis.refreshControl(jslet.data.RefreshEvent.updateAllEvent(), true);\r\n\t}, // end renderAll\r\n\r\n\tupdateToDataset: function () {\r\n\t\tvar Z = this;\r\n\t\tif (Z._keep_silence_) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tvar value = Z.el.value;\r\n\t\tif(Z.oldValue == value) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tvar ctrlRecno = Z.ctrlRecno();\r\n\t\tif(ctrlRecno >= 0) {\r\n\t\t\tvar oldRecno = Z._dataset.recnoSilence();\r\n\t\t\tZ._dataset.recnoSilence(Z.ctrlRecno());\r\n\t\t}\r\n\t\ttry {\r\n\t\t\tZ._dataset.editRecord();\r\n\t\t\tif (this.editMask && !this.editMask.validateValue()) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tif (Z._beforeUpdateToDataset) {\r\n\t\t\t\tif (!Z._beforeUpdateToDataset.call(Z)) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\r\n\t\t\tZ._keep_silence_ = true;\r\n\t\t\ttry {\r\n\t\t\t\tif (Z.editMask) {\r\n\t\t\t\t\tvalue = Z.editMask.getValue();\r\n\t\t\t\t}\r\n\t\t\t\tZ._dataset.setFieldText(Z._field, value, Z._valueIndex);\r\n\t\t\t} finally {\r\n\t\t\t\tZ._keep_silence_ = false;\r\n\t\t\t}\r\n\t\t} finally {\r\n\t\t\tif(ctrlRecno >= 0) {\r\n\t\t\t\tZ._dataset.recnoSilence(oldRecno);\r\n\t\t\t}\r\n\t\t}\r\n\t\tZ.refreshControl(jslet.data.RefreshEvent.updateRecordEvent(Z._field));\r\n\t\treturn true;\r\n\t}, // end updateToDataset\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\tvar Z = this;\r\n\t\tjQuery(Z.el).off();\r\n\t\tif (Z.editMask){\r\n\t\t\tZ.editMask.detach();\r\n\t\t\tZ.editMask = null;\r\n\t\t}\r\n\t\tZ._beforeUpdateToDataset = null;\r\n\t\tZ.onKeyDown = null;\r\n\t\t$super();\r\n\t}\r\n});\r\njslet.ui.register('DBText', jslet.ui.DBText);\r\njslet.ui.DBText.htmlTemplate = '<input type=\"text\"></input>';\r\n\r\n/**\r\n * DBPassword\r\n */\r\njslet.ui.DBPassword = jslet.Class.create(jslet.ui.DBText, {\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\treturn el.tagName.toLowerCase() == 'input' &&\r\n\t\t\tel.type.toLowerCase() == 'password';\r\n\t}\r\n});\r\n\r\njslet.ui.register('DBPassword', jslet.ui.DBPassword);\r\njslet.ui.DBPassword.htmlTemplate = '<input type=\"password\"></input>';\r\n\r\n/**\r\n * DBTextArea\r\n */\r\njslet.ui.DBTextArea = jslet.Class.create(jslet.ui.DBText, {\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\treturn el.tagName.toLowerCase() == 'textarea';\r\n\t}\r\n});\r\n\r\njslet.ui.register('DBTextArea', jslet.ui.DBTextArea);\r\njslet.ui.DBTextArea.htmlTemplate = '<textarea></textarea>';\r\n\r\n\n/* ========================================================================\r\n * Jslet framework: jslet.dbtimepicker.js\r\n *\r\n * Copyright (c) 2014 Jslet Group(https://github.com/jslet/jslet/)\r\n * Licensed under MIT (https://github.com/jslet/jslet/LICENSE.txt)\r\n * ======================================================================== */\r\n\r\n/**\r\n * @class DBTimePicker is used for time inputting. Example:\r\n * <pre><code>\r\n * var jsletParam = {type:\"DBTimePicker\",field:\"time\"};\r\n * //1. Declaring:\r\n *  &lt;input id=\"ctrlId\" type=\"text\" data-jslet='jsletParam' />\r\n *  or\r\n *  &lt;input id=\"ctrlId\" type=\"text\" data-jslet='{type:\"DBTimePicker\",field:\"time\"}' />\r\n *  \r\n *  //2. Binding\r\n *  &lt;input id=\"ctrlId\" type=\"text\" data-jslet='jsletParam' />\r\n *  //Js snippet\r\n *  var el = document.getElementById('ctrlId');\r\n *  jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *  //3. Create dynamically\r\n *  jslet.ui.createControl(jsletParam, document.body);\r\n *\r\n * </code></pre>\r\n */\r\njslet.ui.DBTimePicker = jslet.Class.create(jslet.ui.DBFieldControl, {\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.allProperties = 'dataset,field,is12Hour,hasSecond';\r\n\t\tZ._is12Hour = false;\r\n\t\tZ._hasSecond = false;\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\tis12Hour: function(is12Hour) {\r\n\t\tif(is12Hour === undefined) {\r\n\t\t\treturn this._is12Hour;\r\n\t\t}\r\n\t\tthis._is12Hour = is12Hour? true: false;\r\n\t},\r\n\r\n\thasSecond: function(hasSecond) {\r\n\t\tif(hasSecond === undefined) {\r\n\t\t\treturn this._hasSecond;\r\n\t\t}\r\n\t\tthis._hasSecond = hasSecond? true: false;\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\tvar tagName = el.tagName.toLowerCase();\r\n\t\treturn tagName == 'div' || tagName == 'span';\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el);\r\n\t\tif(!jqEl.hasClass('jl-timepicker')) {\r\n\t\t\tjqEl.addClass('form-control jl-timepicker');\r\n\t\t}\r\n\t\tZ.renderAll();\r\n\t\tjqEl.on('change', 'select', function(event){\r\n\t\t\tZ.updateToDataset();\r\n\t\t});\r\n\t}, // end bind\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el),\r\n\t\t\tfldObj = Z._dataset.getField(Z._field),\r\n\t\t\trange = fldObj.dataRange(),\r\n\t\t\tminTimePart = {hour: 0, minute: 0, second: 0},\r\n\t\t\tmaxTimePart = {hour: 23, minute: 59, second: 59};\r\n\t\t\r\n\t\tif(range) {\r\n\t\t\tif(range.min) {\r\n\t\t\t\tminTimePart = Z._splitTime(range.min);\r\n\t\t\t}\r\n\t\t\tif(range.max) {\r\n\t\t\t\tmaxTimePart = Z._splitTime(range.max);\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar\ttmpl = [];\r\n\t\t\r\n\t\ttmpl.push('<select class=\"jl-time-hour\">');\r\n\t\tif(Z._is12Hour) {\r\n\t\t\tvar minHour = minTimePart.hour;\r\n\t\t\tvar maxHour = maxTimePart.hour;\r\n\t\t\tvar min = 100, max = 0, hour;\r\n\t\t\tfor(var k = minHour; k < maxHour; k++) {\r\n\t\t\t\thour = k;\r\n\t\t\t\tif( k > 11) {\r\n\t\t\t\t\thour = k - 12;\r\n\t\t\t\t}\r\n\t\t\t\tmin = Math.min(min, hour);\r\n\t\t\t\tmax = Math.max(max, hour);\r\n\t\t\t}\r\n\t\t\ttmpl.push(Z._getOptions(min, max));\r\n\t\t} else {\r\n\t\t\ttmpl.push(Z._getOptions(minTimePart.hour, maxTimePart.hour || 23));\r\n\t\t}\r\n\t\ttmpl.push('</select>');\r\n\t\t\r\n\t\ttmpl.push('<select class=\"jl-time-minute\">');\r\n\t\ttmpl.push(Z._getOptions(0, 59));\r\n\t\ttmpl.push('</select>');\r\n\t\t\r\n\t\tif(Z._hasSecond) {\r\n\t\t\ttmpl.push('<select class=\"jl-time-second\">');\r\n\t\t\ttmpl.push(Z._getOptions(0, 59));\r\n\t\t\ttmpl.push('</select>');\r\n\t\t}\r\n\t\t\r\n\t\tif(Z._is12Hour) {\r\n\t\t\ttmpl.push('<select class=\"jl-time-ampm\"><option value=\"am\">AM</option><option value=\"pm\">PM</option></select>');\r\n\t\t}\r\n\t\tjqEl.html(tmpl.join(''));\r\n\t\tZ.refreshControl(jslet.data.RefreshEvent.updateAllEvent(), true);\r\n\t}, // end renderAll\r\n\r\n\t_getOptions: function(begin, end) {\r\n\t\tvar result = [], value;\r\n\t\tfor(var i = begin; i <= end; i++) {\r\n\t\t\tif( i < 10) {\r\n\t\t\t\tvalue = '0' + i;\r\n\t\t\t} else {\r\n\t\t\t\tvalue = '' + i;\r\n\t\t\t}\r\n\t\t\tresult.push('<option value=\"');\r\n\t\t\tresult.push(i);\r\n\t\t\tresult.push('\">');\r\n\t\t\tresult.push(value);\r\n\t\t\tresult.push('</option>');\r\n\t\t}\r\n\t\treturn result.join('');\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdoMetaChanged: function($super, metaName){\r\n\t\t$super(metaName);\r\n\t\tvar Z = this,\r\n\t\t\tfldObj = Z._dataset.getField(Z._field);\r\n\t\tif(!metaName || metaName == \"disabled\" || metaName == \"readOnly\" || metaName == 'tabIndex') {\r\n\t\t\tvar disabled = fldObj.disabled() || fldObj.readOnly();\r\n\t\t\tvar items = jQuery(Z.el).find(\"select\"), item,\r\n\t\t\t\trequired = fldObj.required(),\r\n\t\t\t\ttabIdx = fldObj.tabIndex();\r\n\t\t\tfor(var i = 0, cnt = items.length; i < cnt; i++){\r\n\t\t\t\titem = items[i];\r\n\t\t\t\titem.disabled = disabled;\r\n\t\t\t\tjslet.ui.setEditableStyle(item, disabled, disabled, true, required);\r\n\t\t\t\titem.tabIndex = tabIdx;\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdoValueChanged: function() {\r\n\t\tvar Z = this;\r\n\t\tif (Z._keep_silence_) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar value = Z.getValue(),\r\n\t\t\ttimePart = Z._splitTime(value),\r\n\t\t\thour = timePart.hour,\r\n\t\t\tjqEl = jQuery(Z.el),\r\n\t\t\tjqHour = jqEl.find('.jl-time-hour'),\r\n\t\t\tjqMinute = jqEl.find('.jl-time-minute');\r\n\t\t\r\n\t\tif(Z._is12Hour) {\r\n\t\t\tjqAmPm = jqEl.find('.jl-time-ampm');\r\n\t\t\tjqAmPm.prop('selectedIndex', hour < 12 ? 0: 1);\r\n\t\t\tif(hour > 11) {\r\n\t\t\t\thour -= 12;\r\n\t\t\t}\r\n\t\t}\r\n\t\tjqHour.val(hour);\r\n\t\tjqMinute.val(timePart.minute);\r\n\t\tif(Z._hasSecond) {\r\n\t\t\tjqMinute = jqEl.find('.jl-time-second');\r\n\t\t\tjqMinute.val(timePart.second);\r\n\t\t}\r\n\t},\r\n\t \r\n\t_splitTime: function(value) {\r\n\t\tvar\thour = 0,\r\n\t\t\tminute = 0,\r\n\t\t\tsecond = 0;\r\n\t\tif(value) {\r\n\t\t\tif(jslet.isDate(value)) {\r\n\t\t\t\thour = value.getHours();\r\n\t\t\t\tminute = value.getMinutes();\r\n\t\t\t\tsecond = value.getSeconds();\r\n\t\t\t} else if(jslet.isString(value)) {\r\n\t\t\t\tvar parts = value.split(\":\");\r\n\t\t\t\thour = parseInt(parts[0]);\r\n\t\t\t\tif(parts.length > 1) {\r\n\t\t\t\t\tminute = parseInt(parts[1]);\r\n\t\t\t\t}\r\n\t\t\t\tif(parts.length > 2) {\r\n\t\t\t\t\tsecond = parseInt(parts[2]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn {hour: hour, minute: minute, second: second};\r\n\t},\r\n\t\r\n\t_prefix: function(value) {\r\n\t\tif(parseInt(value) < 10) {\r\n\t\t\treturn '0' + value;\r\n\t\t}\r\n\t\treturn value;\r\n\t},\r\n\t\r\n\tupdateToDataset: function () {\r\n\t\tvar Z = this;\r\n\t\tif (Z._keep_silence_) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\tZ._keep_silence_ = true;\r\n\t\ttry {\r\n\t\t\tvar jqEl = jQuery(Z.el),\r\n\t\t\t\tfldObj = Z._dataset.getField(Z._field),\r\n\t\t\t\tvalue = null, hour;\r\n\t\t\tif(fldObj.getType() != jslet.data.DataType.DATE) {\r\n\t\t\t\tvalue = [];\r\n\t\t\t\tif(Z._is12Hour && jqEl.find('.jl-time-ampm').prop(\"selectedIndex\") > 0) {\r\n\t\t\t\t\thour = parseInt(jqEl.find('.jl-time-hour').val()) + 12;\r\n\t\t\t\t\tvalue.push(hour);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvalue.push(Z._prefix(jqEl.find('.jl-time-hour').val()));\r\n\t\t\t\t}\r\n\t\t\t\tvalue.push(':');\r\n\t\t\t\tvalue.push(Z._prefix(jqEl.find('.jl-time-minute').val()));\r\n\t\t\t\tif(Z._hasSecond) {\r\n\t\t\t\t\tvalue.push(':');\r\n\t\t\t\t\tvalue.push(Z._prefix(jqEl.find('.jl-time-second').val()));\r\n\t\t\t\t}\r\n\t\t\t\tvalue = value.join('');\r\n\t\t\t} else {\r\n\t\t\t\tvalue = Z.getValue();\r\n\t\t\t\tif(!value) {\r\n\t\t\t\t\tvalue = new Date();\r\n\t\t\t\t}\r\n\t\t\t\thour = parseInt(jqEl.find('.jl-time-hour').val());\r\n\t\t\t\tif(Z._is12Hour && jqEl.find('.jl-time-ampm').prop(\"selectedIndex\") > 0) {\r\n\t\t\t\t\thour += 12;\r\n\t\t\t\t}\r\n\t\t\t\tvar minute = parseInt(jqEl.find('.jl-time-minute').val());\r\n\t\t\t\tvar second = 0;\r\n\t\t\t\tif(Z._hasSecond) {\r\n\t\t\t\t\tsecond = parseInt(jqEl.find('.jl-time-second').val());\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tvalue.setHours(hour);\r\n\t\t\t\tvalue.setMinutes(minute);\r\n\t\t\t\tvalue.setSeconds(second);\r\n\t\t\t}\r\n\t\t\tZ._dataset.setFieldValue(Z._field, value, Z._valueIndex);\r\n\t\t} finally {\r\n\t\t\tZ._keep_silence_ = false;\r\n\t\t}\r\n\t\treturn true;\r\n\t}, // end updateToDataset\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\tjQuery(this.el).off();\r\n\t\t$super();\r\n\t}\r\n});\r\njslet.ui.register('DBTimePicker', jslet.ui.DBTimePicker);\r\njslet.ui.DBTimePicker.htmlTemplate = '<div></div>';\r\n\n/* ========================================================================\r\n * Jslet framework: jslet.dberror.js\r\n *\r\n * Copyright (c) 2014 Jslet Group(https://github.com/jslet/jslet/)\r\n * Licensed under MIT (https://github.com/jslet/jslet/LICENSE.txt)\r\n * ======================================================================== */\r\n\r\n/**\r\n * @class DBError. \r\n * Display dataset error.\r\n * \r\n * Example:\r\n * <pre><code>\r\n *  var jsletParam = {type:\"DBError\",dataset:\"employee\"};\r\n *  \r\n * //1. Declaring:\r\n *  &lt;div data-jslet='type:\"DBError\",dataset:\"employee\"' />\r\n *  or\r\n *  &lt;div data-jslet='jsletParam' />\r\n *  \r\n *  //2. Binding\r\n *  &lt;div id=\"ctrlId\"  />\r\n *  //Js snippet\r\n *  var el = document.getElementById('ctrlId');\r\n *  jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *  //3. Create dynamically\r\n *  jslet.ui.createControl(jsletParam, document.body);\r\n *  \r\n * </code></pre>\r\n */\r\njslet.ui.DBError = jslet.Class.create(jslet.ui.DBControl, {\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tthis.allProperties = 'dataset';\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\tvar tagName = el.tagName.toLowerCase();\r\n\t\treturn tagName == 'div';\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el);\r\n\t\tif (!jqEl.hasClass('jl-errorpanel')) {\r\n\t\t\tjqEl.addClass('jl-errorpanel');\r\n\t\t}\r\n\r\n\t\tZ.renderAll();\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trefreshControl: function (evt) {\r\n\t\tif (evt && evt.eventType == jslet.data.RefreshEvent.ERROR) {\r\n\t\t\tthis.el.innerHTML = evt.message || '';\r\n\t\t}\r\n\t}, // end refreshControl\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tthis.refreshControl();\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\tvar Z = this;\r\n\t\t\t\t\r\n\t\t$super();\r\n\t}\r\n\r\n});\r\n\r\njslet.ui.register('DBError', jslet.ui.DBError);\r\njslet.ui.DBError.htmlTemplate = '<div></div>';\r\n\n/* ========================================================================\r\n * Jslet framework: jslet.dbpagebar.js\r\n *\r\n * Copyright (c) 2014 Jslet Group(https://github.com/jslet/jslet/)\r\n * Licensed under MIT (https://github.com/jslet/jslet/LICENSE.txt)\r\n * ======================================================================== */\r\n\r\n/**\r\n * @class DBPageBar. \r\n * Functions:\r\n * 1. First page, Prior Page, Next Page, Last Page;\r\n * 2. Can go to specified page;\r\n * 3. Can specify page size on runtime;\r\n * 4. Need not write any code;\r\n * \r\n * Example:\r\n * <pre><code>\r\n *  var jsletParam = {type:\"DBPageBar\",dataset:\"bom\",pageSizeList:[20,50,100,200]};\r\n *  \r\n * //1. Declaring:\r\n *  &lt;div data-jslet='type:\"DBPageBar\",dataset:\"bom\",pageSizeList:[20,50,100,200]' />\r\n *  or\r\n *  &lt;div data-jslet='jsletParam' />\r\n *\r\n *  //2. Binding\r\n *  &lt;div id=\"ctrlId\"  />\r\n *  //Js snippet\r\n *  var el = document.getElementById('ctrlId');\r\n *  jslet.ui.bindControl(el, jsletParam);\r\n *\r\n *  //3. Create dynamically\r\n *  jslet.ui.createControl(jsletParam, document.body);\r\n *  \r\n * </code></pre>\r\n */\r\njslet.ui.DBPageBar = jslet.Class.create(jslet.ui.DBControl, {\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tinitialize: function ($super, el, params) {\r\n\t\tvar Z = this;\r\n\t\tZ.allProperties = 'dataset,showPageSize,showGotoButton,pageSizeList';\r\n\t\t/**\r\n\t\t * {Boolean} Identify if the \"Page Size\" part shows or not\r\n\t\t */\r\n\t\tZ._showPageSize = true;\r\n\t\t/**\r\n\t\t * {Boolean} Identify if the \"GoTo\" part shows or not\r\n\t\t */\r\n\t\tZ._showGotoButton = true;\r\n\t\t\r\n\t\t/**\r\n\t\t * {Integer[]) Array of integer, like: [50,100,200]\r\n\t\t */\r\n\t\tZ._pageSizeList = [100, 200, 500];\r\n\r\n\t\t$super(el, params);\r\n\t},\r\n\r\n\tshowPageSize: function(showPageSize) {\r\n\t\tif(showPageSize === undefined) {\r\n\t\t\treturn this._showPageSize;\r\n\t\t}\r\n\t\tthis._showPageSize = showPageSize ? true: false;\r\n\t},\r\n\t\r\n\tshowGotoButton: function(showGotoButton) {\r\n\t\tif(showGotoButton === undefined) {\r\n\t\t\treturn this._showGotoButton;\r\n\t\t}\r\n\t\tthis._showGotoButton = showGotoButton ? true: false;\r\n\t},\r\n\t\r\n\tpageSizeList: function(pageSizeList) {\r\n\t\tif(pageSizeList === undefined) {\r\n\t\t\treturn this._pageSizeList;\r\n\t\t}\r\n\t\tjslet.Checker.test('DBPageBar.pageSizeList', pageSizeList).isArray();\r\n\t\tvar size;\r\n\t\tfor(var i = 0, len = pageSizeList.length; i < len; i++) {\r\n\t\t\tsize = pageSizeList[i];\r\n\t\t\tjslet.Checker.test('DBPageBar.pageSizeList', size).isGTZero();\r\n\t\t}\r\n\t\tthis._pageSizeList = pageSizeList;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tisValidTemplateTag: function (el) {\r\n\t\tvar tagName = el.tagName.toLowerCase();\r\n\t\treturn tagName == 'div';\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tbind: function () {\r\n\t\tvar Z = this,\r\n\t\t\tjqEl = jQuery(Z.el);\r\n\t\tif (!jqEl.hasClass('jl-pagebar')) {\r\n\t\t\tjqEl.addClass('jl-pagebar');\r\n\t\t}\r\n\t\tvar template = ['<select class=\"jl-pb-item\"></select><label class=\"jl-pb-item jl-pb-label\">', jslet.locale.DBPageBar.pageSizeLabel,\r\n\t\t\t\t\t\t'</label><a class=\"jl-pb-item jl-pb-button jl-pb-first\" href=\"javascript:;\"></a><a class=\"jl-pb-item jl-pb-button jl-pb-prior\" href=\"javascript:;\"></a><label class=\"jl-pb-item jl-pb-label\">',\r\n\t\t\t\t\t\tjslet.locale.DBPageBar.pageNumLabel,\r\n\t\t\t\t\t\t'</label><input class=\"jl-pb-item jl-pb-pagenum\" value=\"1\" size=\"2\" ></input><a class=\"jl-pb-item jl-pb-button jl-pb-goto\" href=\"javascript:;\"></a><label class=\"jl-pb-item jl-pb-label\">',\r\n\t\t\t\t\t\tjslet.formatString(jslet.locale.DBPageBar.pageCountLabel, [0]),\r\n\t\t\t\t\t\t'</label><a class=\"jl-pb-item jl-pb-button jl-pb-next\" href=\"javascript:;\"></a><a class=\"jl-pb-item jl-pb-button jl-pb-last\" href=\"javascript:;\"></a></div>'\r\n\t\t\t\t\t\t];\r\n\t\tjqEl.html(template.join(''));\r\n\r\n\t\tvar oPageSize = Z.el.childNodes[0];\r\n\t\tif (Z._showPageSize) {\r\n\t\t\tvar rows = Z._pageSizeList;\r\n\t\t\tvar cnt = rows.length, s = '';\r\n\t\t\tfor (var i = 0; i < cnt; i++) {\r\n\t\t\t\ts += '<option value=' + rows[i] + '>' + rows[i] + '</option>';\r\n\t\t\t}\r\n\r\n\t\t\toPageSize.innerHTML = s;\r\n\t\t\tZ._dataset.pageSize(parseInt(oPageSize.value));\r\n\t\t}\r\n\r\n\t\tjQuery(oPageSize).on('change', function (event) {\r\n\t\t\tvar ds = this.parentElement.jslet.dataset();\r\n\t\t\tds.pageNo(1);\r\n\t\t\tds.pageSize(parseInt(this.value));\r\n\t\t\tds.requery();\r\n\t\t});\r\n\r\n\t\tZ._firstBtn = Z.el.childNodes[2];\r\n\t\tZ._priorBtn = Z.el.childNodes[3];\r\n\r\n\t\tZ._pageNoTxt = Z.el.childNodes[5];\r\n\t\tZ._gotoBtn = Z.el.childNodes[6];\r\n\r\n\t\tZ._pageCountLbl = Z.el.childNodes[7];\r\n\r\n\t\tZ._nextBtn = Z.el.childNodes[8];\r\n\t\tZ._lastBtn = Z.el.childNodes[9];\r\n\r\n\t\tjQuery(Z._firstBtn).on('click', function (event) {\r\n\t\t\tif(this.disabled) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar ds = this.parentElement.jslet.dataset();\r\n\t\t\tds.pageNo(1);\r\n\t\t\tds.requery();\r\n\t\t});\r\n\r\n\t\tjQuery(Z._priorBtn).on('click', function (event) {\r\n\t\t\tif(this.disabled) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar ds = this.parentElement.jslet.dataset(),\r\n\t\t\t\tnum = ds.pageNo();\r\n\t\t\tif (num == 1) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tds.pageNo(num - 1);\r\n\t\t\tds.requery();\r\n\t\t});\r\n\r\n\t\tjQuery(Z._gotoBtn).on('click', function (event) {\r\n\t\t\tvar oJslet = this.parentElement.jslet;\r\n\t\t\tvar ds = oJslet.dataset();\r\n\t\t\tvar num = parseInt(oJslet._pageNoTxt.value);\r\n\t\t\tif (num < 1) {\r\n\t\t\t\tnum = 1;\r\n\t\t\t}\r\n\t\t\tif (num > ds.pageCount()) {\r\n\t\t\t\tnum = ds.pageCount();\r\n\t\t\t}\r\n\t\t\tds.pageNo(num);\r\n\t\t\tds.requery();\r\n\t\t});\r\n\r\n\t\tjQuery(Z._nextBtn).on('click', function (event) {\r\n\t\t\tif(this.disabled) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar oJslet = this.parentElement.jslet,\r\n\t\t\t\tds = oJslet.dataset(),\r\n\t\t\t\tnum = ds.pageNo();\r\n\t\t\tif (num >= ds.pageCount()) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tds.pageNo(++num);\r\n\t\t\tds.requery();\r\n\t\t});\r\n\r\n\t\tjQuery(Z._lastBtn).on('click', function (event) {\r\n\t\t\tif(this.disabled) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar oJslet = this.parentElement.jslet,\r\n\t\t\t\tds = oJslet.dataset();\r\n\r\n\t\t\tif (ds.pageCount() < 1) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tds.pageNo(ds.pageCount());\r\n\t\t\tds.requery();\r\n\t\t});\r\n\r\n\t\tjQuery(Z._pageNoTxt).on('keypress', function (event) {\r\n\t\t\tevent = jQuery.event.fix( event || window.event );\r\n\t\t\tvar keyCode = event.which;\r\n\r\n\t\t\tvar validChars = new Array('0', '1', '2', '3', '4', '5', '6', '7', '8', '9');\r\n\t\t\tif (validChars.indexOf(String.fromCharCode(keyCode)) < 0) {\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tZ.renderAll();\r\n\t},\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trefreshControl: function (evt) {\r\n\t\tif (evt && evt.eventType != jslet.data.RefreshEvent.CHANGEPAGE) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar Z = this,\r\n\t\t\tnum = Z._dataset.pageNo(), \r\n\t\t\tcount = Z._dataset.pageCount();\r\n\t\tZ._pageNoTxt.value = num;\r\n\t\tZ._pageCountLbl.innerHTML = jslet.formatString(jslet.locale.DBPageBar.pageCountLabel, [count]);\r\n\t\tZ._refreshButtonStatus();\r\n\t}, // end refreshControl\r\n\r\n\t_refreshButtonStatus: function() {\r\n\t\tvar Z = this, \r\n\t\t\tds = Z._dataset,\r\n\t\t\tpageNo = ds.pageNo(),\r\n\t\t\tpageCnt = ds.pageCount(),\r\n\t\t\tprevDisabled = true,\r\n\t\t\tnextDisabled = true;\r\n\t\tif(pageNo > 1) {\r\n\t\t\tprevDisabled = false;\r\n\t\t}\r\n\t\tif(pageNo < pageCnt) {\r\n\t\t\tnextDisabled = false;\r\n\t\t}\r\n\t\tif(prevDisabled) {\r\n\t\t\tjQuery(Z._firstBtn).addClass('jl-pb-first-disabled jl-pb-button-disabled');\r\n\t\t\tjQuery(Z._priorBtn).addClass('jl-pb-prior-disabled jl-pb-button-disabled');\r\n\t\t}\r\n\t\telse {\r\n\t\t\tjQuery(Z._firstBtn).removeClass('jl-pb-first-disabled jl-pb-button-disabled');\r\n\t\t\tjQuery(Z._priorBtn).removeClass('jl-pb-prior-disabled jl-pb-button-disabled');\r\n\t\t}\r\n\t\tif(nextDisabled) {\r\n\t\t\tjQuery(Z._nextBtn).addClass('jl-pb-next-disabled jl-pb-button-disabled');\r\n\t\t\tjQuery(Z._lastBtn).addClass('jl-pb-last-disabled jl-pb-button-disabled');\r\n\t\t}\r\n\t\telse {\r\n\t\t\tjQuery(Z._nextBtn).removeClass('jl-pb-next-disabled jl-pb-button-disabled');\r\n\t\t\tjQuery(Z._lastBtn).removeClass('jl-pb-last-disabled jl-pb-button-disabled');\r\n\t\t}\r\n\t\tZ._firstBtn.disabled = prevDisabled;\r\n\t\tZ._priorBtn.disabled = prevDisabled;\r\n\t\tZ._nextBtn.disabled = nextDisabled;\r\n\t\tZ._lastBtn.disabled = nextDisabled;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\trenderAll: function () {\r\n\t\tvar displayStyle = this._showPageSize ? 'inline' : 'none';\r\n\t\tvar oel = this.el;\r\n\t\toel.childNodes[0].style.display = displayStyle;\r\n\t\toel.childNodes[1].style.display = displayStyle;\r\n\r\n\t\tthis.refreshControl();\r\n\t},\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tdestroy: function($super){\r\n\t\tvar Z = this;\r\n\t\t\r\n\t\tjQuery(Z._firstBtn).off();\r\n\t\tjQuery(Z._priorBtn).off();\r\n\t\tjQuery(Z._pageNoTxt).off();\r\n\t\tjQuery(Z._gotoBtn).off();\r\n\t\tjQuery(Z._pageCountLbl).off();\r\n\t\tjQuery(Z._nextBtn).off();\r\n\t\tjQuery(Z._lastBtn).off();\r\n\t\t\r\n\t\tZ._firstBtn = null;\r\n\t\tZ._priorBtn = null;\r\n\t\tZ._pageNoTxt = null;\r\n\t\tZ._gotoBtn = null;\r\n\t\tZ._pageCountLbl = null;\r\n\t\tZ._nextBtn = null;\r\n\t\tZ._lastBtn = null;\r\n\t\t\r\n\t\t$super();\r\n\t}\r\n\r\n});\r\n\r\njslet.ui.register('DBPageBar', jslet.ui.DBPageBar);\r\njslet.ui.DBPageBar.htmlTemplate = '<div></div>';\r\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./build/jslet-ui.debug.js\n ** module id = 12\n ** module chunks = 0 1 2 3 4 5 6\n **/","/* ========================================================================\r\n* Jslet framework: jslet.locale.js\r\n*\r\n* Copyright (c) 2014 Jslet Group(https://github.com/jslet/jslet/)\r\n* Licensed under MIT (https://github.com/jslet/jslet/LICENSE.txt)\r\n* ======================================================================== */\r\n\r\n/**\r\n* Chinese language pack\r\n*/\r\nvar locale = {};\r\nlocale.isRtl = false;//false: direction = 'ltr', true: direction = 'rtl'\r\n\r\nlocale.Common = {\r\n\tjsonParseError: 'JSON格式错误，无法解析：{0}',\r\n\tConnectError: '连接超时或者无法连接服务器!'\r\n};\r\n\r\nlocale.Date = {\r\n\tformat: 'yyyy-MM-dd'\t\r\n};\r\n\r\nlocale.Dataset = {\r\n\t\tinvalidDateFieldValue: '字段: [{0}]是日期字段, 但值不是日期型的!',\r\n\t\tfieldNotFound:  '字段: {0} 未定义!',\r\n\t\tvalueNotFound: '找不到指定的值!',\r\n\t\tlookupNotFound: '字段: {0} 没有设置查找字段, 不能使用字段链!',\r\n\t\tdatasetFieldNotBeSetValue: '不能给数据集字段: {0} 设置值!',\r\n\t\tdatasetFieldNotBeCalculated: '数据集字段: {0} 不能参与计算!',\r\n\t\tinsertMasterFirst: '主数据集没有数据，请先在主数据集中新增数据!',\r\n\t\tlookupFieldExpected: '字段: {0} 必须是查找字段!',\r\n\t\tinvalidLookupField: '字段: {0} 的是一个无效的查找字段，请检查参数!',\r\n\t\tinvalidContextRule: '字段: [{0}]的上下文规则的条件中必须要有字段!如果是固定条件，请直接设置过滤条件!',\r\n\t\tfieldValueRequired: '[{0}]不能为空!',\r\n\t\tinvalidFieldTranslate: '字段: {0}里的属性: displayValueField 和 inputValueField不能为空!',\r\n\t\ttranslateListenerRequired: '必须设置事件监听器: translateListener!',\r\n\t\tminMaxValueError: '[{0}] 的最小值必须要小于或者等于最大值!',\r\n\t\tinvalidDate: '无效日期!',\r\n\t\tinvalidInt: '只允许:0-9,-',\r\n\t\tinvalidFloat: '只允许:0-9,-,.',\r\n\t\tinvalidIntegerPart: '整数部分超长，允许：{0}位，实际：{1}位！',\r\n\t\tinvalidDecimalPart: '小数部分超长，允许：{0}位，实际：{1}位！',\r\n\t\tcannotConfirm: '数据录入有误，请先检查!',\r\n\t\tnotInRange: '录入的值必须在:{0}和{1}之间',\r\n\t\tlessThanValue: '录入的值必须小于: {0}',\r\n\t\tmoreThanValue: '录入的值必须大于: {0}',\r\n\t\tcannotDelParent: '该笔数据下还有下级数据,不能删除!',\r\n\t\tnotUnique: '数据不能重复!',\r\n\t\tLookupDatasetNotSameAsHost: '查找数据源不能为主数据集!',\r\n\t\tbetweenLabel: ' - ',\r\n\t\tbetwwenInvalid: '最小值不得大于最大值',\r\n\t\tvalue: '值',\r\n\t\tnullText: '(空)',\r\n\t\tnoDataSubmit: '无数据可提交!',\r\n\t\ttrueText: '是',\r\n\t\tfalseText: ''\r\n};\r\n\r\nlocale.DBControl = {\r\n\tdatasetNotFound: '找不到数据集： {0}, 请先定义并设置其名称!',\r\n\texpectedProperty: '请先设置属性值: {0}!',\r\n\tpropertyValueMustBeInt: '属性: {0} 的值必须是数字!',\r\n\tjsletPropRequired: 'HTML模板上缺少jslet属性!',\r\n\tinvalidHtmlTag: '所附加HTML标签无效，可参考: {0} !',\r\n\tinvalidJsletProp: 'jslet控件参数不符合JSON规范: {0}'\r\n};\r\n\r\nlocale.DBImage = {\r\n\tlockedImageTips: '图片被锁定 '\r\n};\r\n\r\nlocale.DBChart = {\r\n\tonlyNumberFieldAllowed: '图表字段必须为Number类型!'\r\n};\r\n\r\nlocale.DBCheckBoxGroup = {\r\n\tinvalidCheckedCount: '最大可选择的个数不能超过: {0}!',\r\n\tnoOptions: '无可选项',\r\n\tselectAll: '全部'\r\n};\r\n\r\nlocale.DBRadioGroup = {\r\n\tnoOptions: '无可选项'\r\n};\r\n\r\nlocale.DBBetweenEdit = {\r\n\tbetweenLabel: '-'\r\n};\r\n\r\nlocale.DBPageBar = {\r\n\tpageSizeLabel: '/页 ',\r\n\tpageNumLabel: '第 ',\r\n\tpageCountLabel: '共:{0}页 '\r\n};\r\n\r\nlocale.DBComboSelect = { \r\n\tfind: '查找'\r\n};\r\n\r\nlocale.MessageBox = { \r\n\tok: '确定',\r\n\tcancel: '取消',\r\n\tyes: '是',\r\n\tno: '否',\r\n\tinfo: '提示',\r\n\terror: '错误',\r\n\twarn: '警告',\r\n\tconfirm: '确认',\r\n\tprompt: '请输入'\r\n};\r\n\r\nlocale.Calendar = { \r\n\tyearPrev: '前一年',\r\n\tmonthPrev: '前一月',\r\n\tyearNext: '下一年',\r\n\tmonthNext: '下一月',\r\n\tSun: '日',\r\n\tMon: '一',\r\n\tTue: '二',\r\n\tWed: '三',\r\n\tThu: '四',\r\n\tFri: '五',\r\n\tSat: '六',\r\n\ttoday: '今日',\r\n\tmonthNames: ['一月', '二月', '三月', '四月', '五月', '六月', '七月', '八月', '九月', '十月', '十一月', '十二月'],\r\n\tfirstDayOfWeek: 0\r\n};\r\n\r\nlocale.DBTreeView = { \r\n\texpandAll: '全部展开',\r\n\tcollapseAll: '全部收缩',\r\n\tcheckAll: '全部选择',\r\n\tuncheckAll: '全部不选'\r\n};\r\n\r\nlocale.TabControl ={ \r\n\tclose: '关闭',\r\n\tcloseOther: '关闭其它'\r\n};\r\n\r\nlocale.DBTable = { \r\n\tnorecord: '没有数据',\r\n\tsorttitle: '按Ctrl可多列排序',\r\n\ttotalLabel: '合计'\r\n};\t\r\n\r\nlocale.findDialog = {\r\n\tcaption: '查找 - {0}',\r\n\tmatchFirst: '匹配开头',\r\n\tmatchLast: '匹配结尾',\r\n\tmatchAny: '任意匹配'\r\n};\r\n\t\t\r\nif (window.jslet === undefined || jslet === undefined){\r\n\tjslet=window.jslet = function(id){\r\n\t\tvar ele = jQuery(id)[0];\r\n\t\treturn (ele && ele.jslet)?ele.jslet:null;\r\n\t};\r\n}\r\njslet.locale = locale;\r\n\r\nrequire('../../jslet-data.debug.js');\r\nrequire('../../jslet-ui.debug.js');\r\n\r\nmodule.exports = jslet;\r\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./build/locale/zh-cn/locale.js\n ** module id = 13\n ** module chunks = 0 1 2 3 4 5 6\n **/","\r\nrequire('./panel.css');\r\n\r\n// Hack: maybe exist more good method\r\nfunction Interpreter(tpl) {\r\n\tthis.tpl = tpl;\r\n}\r\n\r\nInterpreter.prototype.parse = function() {\r\n\tvar i = 0, tpl = this.tpl, len = tpl.controls.length;\r\n\r\n\tvar rootEl = tpl.root ? document.getElementById(tpl.root) : document.body;\r\n\r\n\tvar control, bind;\r\n\tfor (; i < len; i++) {\r\n\t\tcontrol = tpl.controls[i];\r\n\t\t\r\n\t\tcreatePanel(control.panel, rootEl);\r\n\t\t\r\n\t\tbind = control.bind;\r\n\r\n\t\tfor (var k = 0, blen = bind.length; k < blen; k++) {\r\n\t\t\tjslet.ui.bindControl(document.getElementById(bind[k].el), bind[k].jsletParams);\r\n\t\t}\r\n\t\t\r\n\t}\t\r\n\r\n}\r\n\r\nfunction createPanel(panel, rootEl) {\r\n\tvar source = require('./panel.handlebars');\r\n\tvar result = source(panel);\r\n\tvar fragment = document.createDocumentFragment();\r\n\tvar div = document.createElement('div');\r\n\tdiv.innerHTML = result;\r\n\trootEl.appendChild(div.firstChild);\r\n}\r\n \r\nmodule.exports = Interpreter;\r\n\r\n\r\n\r\n\r\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./interpreter/interpreter.js\n ** module id = 14\n ** module chunks = 0 1 2 3 4 5 6\n **/","/*\r\n\tMIT License http://www.opensource.org/licenses/mit-license.php\r\n\tAuthor Tobias Koppers @sokra\r\n*/\r\nvar stylesInDom = {},\r\n\tmemoize = function(fn) {\r\n\t\tvar memo;\r\n\t\treturn function () {\r\n\t\t\tif (typeof memo === \"undefined\") memo = fn.apply(this, arguments);\r\n\t\t\treturn memo;\r\n\t\t};\r\n\t},\r\n\tisIE9 = memoize(function() {\r\n\t\treturn /msie 9\\b/.test(window.navigator.userAgent.toLowerCase());\r\n\t}),\r\n\tgetHeadElement = memoize(function () {\r\n\t\treturn document.head || document.getElementsByTagName(\"head\")[0];\r\n\t}),\r\n\tsingletonElement = null,\r\n\tsingletonCounter = 0;\r\n\r\nmodule.exports = function(list, options) {\r\n\tif(typeof DEBUG !== \"undefined\" && DEBUG) {\r\n\t\tif(typeof document !== \"object\") throw new Error(\"The style-loader cannot be used in a non-browser environment\");\r\n\t}\r\n\r\n\toptions = options || {};\r\n\t// Force single-tag solution on IE9, which has a hard limit on the # of <style>\r\n\t// tags it will allow on a page\r\n\tif (typeof options.singleton === \"undefined\") options.singleton = isIE9();\r\n\r\n\tvar styles = listToStyles(list);\r\n\taddStylesToDom(styles, options);\r\n\r\n\treturn function update(newList) {\r\n\t\tvar mayRemove = [];\r\n\t\tfor(var i = 0; i < styles.length; i++) {\r\n\t\t\tvar item = styles[i];\r\n\t\t\tvar domStyle = stylesInDom[item.id];\r\n\t\t\tdomStyle.refs--;\r\n\t\t\tmayRemove.push(domStyle);\r\n\t\t}\r\n\t\tif(newList) {\r\n\t\t\tvar newStyles = listToStyles(newList);\r\n\t\t\taddStylesToDom(newStyles, options);\r\n\t\t}\r\n\t\tfor(var i = 0; i < mayRemove.length; i++) {\r\n\t\t\tvar domStyle = mayRemove[i];\r\n\t\t\tif(domStyle.refs === 0) {\r\n\t\t\t\tfor(var j = 0; j < domStyle.parts.length; j++)\r\n\t\t\t\t\tdomStyle.parts[j]();\r\n\t\t\t\tdelete stylesInDom[domStyle.id];\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction addStylesToDom(styles, options) {\r\n\tfor(var i = 0; i < styles.length; i++) {\r\n\t\tvar item = styles[i];\r\n\t\tvar domStyle = stylesInDom[item.id];\r\n\t\tif(domStyle) {\r\n\t\t\tdomStyle.refs++;\r\n\t\t\tfor(var j = 0; j < domStyle.parts.length; j++) {\r\n\t\t\t\tdomStyle.parts[j](item.parts[j]);\r\n\t\t\t}\r\n\t\t\tfor(; j < item.parts.length; j++) {\r\n\t\t\t\tdomStyle.parts.push(addStyle(item.parts[j], options));\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tvar parts = [];\r\n\t\t\tfor(var j = 0; j < item.parts.length; j++) {\r\n\t\t\t\tparts.push(addStyle(item.parts[j], options));\r\n\t\t\t}\r\n\t\t\tstylesInDom[item.id] = {id: item.id, refs: 1, parts: parts};\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction listToStyles(list) {\r\n\tvar styles = [];\r\n\tvar newStyles = {};\r\n\tfor(var i = 0; i < list.length; i++) {\r\n\t\tvar item = list[i];\r\n\t\tvar id = item[0];\r\n\t\tvar css = item[1];\r\n\t\tvar media = item[2];\r\n\t\tvar sourceMap = item[3];\r\n\t\tvar part = {css: css, media: media, sourceMap: sourceMap};\r\n\t\tif(!newStyles[id])\r\n\t\t\tstyles.push(newStyles[id] = {id: id, parts: [part]});\r\n\t\telse\r\n\t\t\tnewStyles[id].parts.push(part);\r\n\t}\r\n\treturn styles;\r\n}\r\n\r\nfunction createStyleElement() {\r\n\tvar styleElement = document.createElement(\"style\");\r\n\tvar head = getHeadElement();\r\n\tstyleElement.type = \"text/css\";\r\n\thead.appendChild(styleElement);\r\n\treturn styleElement;\r\n}\r\n\r\nfunction addStyle(obj, options) {\r\n\tvar styleElement, update, remove;\r\n\r\n\tif (options.singleton) {\r\n\t\tvar styleIndex = singletonCounter++;\r\n\t\tstyleElement = singletonElement || (singletonElement = createStyleElement());\r\n\t\tupdate = applyToSingletonTag.bind(null, styleElement, styleIndex, false);\r\n\t\tremove = applyToSingletonTag.bind(null, styleElement, styleIndex, true);\r\n\t} else {\r\n\t\tstyleElement = createStyleElement();\r\n\t\tupdate = applyToTag.bind(null, styleElement);\r\n\t\tremove = function () {\r\n\t\t\tstyleElement.parentNode.removeChild(styleElement);\r\n\t\t};\r\n\t}\r\n\r\n\tupdate(obj);\r\n\r\n\treturn function updateStyle(newObj) {\r\n\t\tif(newObj) {\r\n\t\t\tif(newObj.css === obj.css && newObj.media === obj.media && newObj.sourceMap === obj.sourceMap)\r\n\t\t\t\treturn;\r\n\t\t\tupdate(obj = newObj);\r\n\t\t} else {\r\n\t\t\tremove();\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction replaceText(source, id, replacement) {\r\n\tvar boundaries = [\"/** >>\" + id + \" **/\", \"/** \" + id + \"<< **/\"];\r\n\tvar start = source.lastIndexOf(boundaries[0]);\r\n\tvar wrappedReplacement = replacement\r\n\t\t? (boundaries[0] + replacement + boundaries[1])\r\n\t\t: \"\";\r\n\tif (source.lastIndexOf(boundaries[0]) >= 0) {\r\n\t\tvar end = source.lastIndexOf(boundaries[1]) + boundaries[1].length;\r\n\t\treturn source.slice(0, start) + wrappedReplacement + source.slice(end);\r\n\t} else {\r\n\t\treturn source + wrappedReplacement;\r\n\t}\r\n}\r\n\r\nfunction applyToSingletonTag(styleElement, index, remove, obj) {\r\n\tvar css = remove ? \"\" : obj.css;\r\n\r\n\tif(styleElement.styleSheet) {\r\n\t\tstyleElement.styleSheet.cssText = replaceText(styleElement.styleSheet.cssText, index, css);\r\n\t} else {\r\n\t\tvar cssNode = document.createTextNode(css);\r\n\t\tvar childNodes = styleElement.childNodes;\r\n\t\tif (childNodes[index]) styleElement.removeChild(childNodes[index]);\r\n\t\tif (childNodes.length) {\r\n\t\t\tstyleElement.insertBefore(cssNode, childNodes[index]);\r\n\t\t} else {\r\n\t\t\tstyleElement.appendChild(cssNode);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction applyToTag(styleElement, obj) {\r\n\tvar css = obj.css;\r\n\tvar media = obj.media;\r\n\tvar sourceMap = obj.sourceMap;\r\n\r\n\tif(sourceMap && typeof btoa === \"function\") {\r\n\t\ttry {\r\n\t\t\tcss += \"\\n/*# sourceMappingURL=data:application/json;base64,\" + btoa(JSON.stringify(sourceMap)) + \" */\";\r\n\t\t\tcss = \"@import url(\\\"data:text/css;base64,\" + btoa(css) + \"\\\")\";\r\n\t\t} catch(e) {}\r\n\t}\r\n\r\n\tif(media) {\r\n\t\tstyleElement.setAttribute(\"media\", media)\r\n\t}\r\n\r\n\tif(styleElement.styleSheet) {\r\n\t\tstyleElement.styleSheet.cssText = css;\r\n\t} else {\r\n\t\twhile(styleElement.firstChild) {\r\n\t\t\tstyleElement.removeChild(styleElement.firstChild);\r\n\t\t}\r\n\t\tstyleElement.appendChild(document.createTextNode(css));\r\n\t}\r\n}\r\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** C:/Users/Administrator/AppData/Roaming/npm/~/spm/~/spm-webpack/~/style-loader/addStyles.js\n ** module id = 15\n ** module chunks = 0 1 2 3 4 5 6\n **/","// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!C:\\\\Users\\\\Administrator\\\\AppData\\\\Roaming\\\\npm\\\\node_modules\\\\spm\\\\node_modules\\\\spm-webpack\\\\node_modules\\\\css-loader\\\\index.js!!C:\\\\spm_git_space\\\\spm-case\\\\case23-jslet\\\\commonjs\\\\interpreter\\\\panel.css\");\nif(typeof content === 'string') content = [[module.id, content, '']];\n// add the styles to the DOM\nvar update = require(\"!C:\\\\Users\\\\Administrator\\\\AppData\\\\Roaming\\\\npm\\\\node_modules\\\\spm\\\\node_modules\\\\spm-webpack\\\\node_modules\\\\style-loader\\\\addStyles.js\")(content, {});\n// Hot Module Replacement\nif(module.hot) {\n\t// When the styles change, update the <style> tags\n\tmodule.hot.accept(\"!!C:\\\\Users\\\\Administrator\\\\AppData\\\\Roaming\\\\npm\\\\node_modules\\\\spm\\\\node_modules\\\\spm-webpack\\\\node_modules\\\\css-loader\\\\index.js!!C:\\\\spm_git_space\\\\spm-case\\\\case23-jslet\\\\commonjs\\\\interpreter\\\\panel.css\", function() {\n\t\tvar newContent = require(\"!!C:\\\\Users\\\\Administrator\\\\AppData\\\\Roaming\\\\npm\\\\node_modules\\\\spm\\\\node_modules\\\\spm-webpack\\\\node_modules\\\\css-loader\\\\index.js!!C:\\\\spm_git_space\\\\spm-case\\\\case23-jslet\\\\commonjs\\\\interpreter\\\\panel.css\");\n\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\t\tupdate(newContent);\n\t});\n\t// When the module is disposed, remove the <style> tags\n\tmodule.hot.dispose(function() { update(); });\n}\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./interpreter/panel.css\n ** module id = 16\n ** module chunks = 0 1 2 3 4 5 6\n **/","//Define Dataset Object\r\nvar lkf, dataList, dataSet = {};\r\n//Dataset object: Gender. There are two fields in enum dataset: code, name\r\nvar dsGender = jslet.data.createEnumDataset('gender', 'F:Female,M:Male,U:Unknown');\r\n//------------------------------------------------------------------------------------------------------\r\n\r\n//Dataset object: Position\r\nvar dsPosition = jslet.data.createEnumDataset('position', '0:Senior Manger,1:Junior Manger,2:Team Leader,3:Employee');\r\n//------------------------------------------------------------------------------------------------------\r\n\r\n//Dataset object: Province\r\n//Global variable for demo\r\nvar dsProvince = dataSet.dsProvince = jslet.data.createEnumDataset('province',\r\n        '01:Anhui,02:Beijing,03:Fujian,04:Gansu,05:Guangdong,06:Guangxi,' + \r\n         '07:Guizhou,08:Hainan,09:Hebei,10:Henan,11:Hei Nongjiang,12:Hubei,'+\r\n         '13:Hunan,14:Jilin,15:Jiangsu,16:Jiangxi,17:Liaoning,18:Neimenggu,'+\r\n         '19:Ningxia,20:Qinghai,21:Shangdong,22:Shangxi,23:Shanxi,24:Shanghai,'+\r\n         '25:Sichuan,26:Tianjing,27:Xizang,28:Xinjiang,29:Yunnan,30:Zhejiang,31:Chongqing');\r\n//------------------------------------------------------------------------------------------------------\r\n\r\n//Dataset object: Department\r\nvar fldCfg = [{\r\n    name: 'deptid',\r\n    type: 'S',\r\n    length: 6,\r\n    label: 'Dept Code'\r\n}, {\r\n    name: 'name',\r\n    type: 'S',\r\n    length: 15,\r\n    label: 'Dept. Name'\r\n}, {\r\n    name: 'address',\r\n    type: 'S',\r\n    length: 20,\r\n    label: 'Address'\r\n}, {\r\n    name: 'parentid',\r\n    type: 'S',\r\n    length: 6,\r\n    visible:false,\r\n    label: 'ParentID'\r\n}];\r\n\r\nvar dsDept = jslet.data.createDataset('department', fldCfg, \r\n        {keyField: 'deptid',codeField: 'deptid', nameField: 'name', \r\n        parentField: 'parentid', autoRefreshHostDataset: true});\r\n\r\nvar data = [{\r\n    deptid: '00',\r\n    name: 'Admin Dept.',\r\n    address: 'Shenzhen',\r\n    parentid: ''\r\n}, {\r\n    deptid: '01',\r\n    name: 'Marketing Dept.',\r\n    address: 'Beijing',\r\n    parentid: ''\r\n}, {\r\n    deptid: '0101',\r\n    name: 'Chengdu Branch.',\r\n    address: 'Chengdu',\r\n    parentid: '01'\r\n}, {\r\n    deptid: '0102',\r\n    name: 'Shanghai Branch ',\r\n    address: 'Shanghai',\r\n    parentid: '01'\r\n}, {\r\n    deptid: '02',\r\n    name: 'Dev. Dept.',\r\n    address: 'Shenzhen',\r\n    parentid: ''\r\n}, {\r\n    deptid: '0201',\r\n    name: 'Dev. Branch 1',\r\n    address: 'Shenzhen',\r\n    parentid: '02'\r\n}, {\r\n    deptid: '0202',\r\n    name: 'Dev. Branch 2',\r\n    address: 'Shenzhen',\r\n    parentid: '02'\r\n}, {\r\n    deptid: '03',\r\n    name: 'QA',\r\n    address: 'Shenzhen',\r\n    parentid: ''\r\n}, {\r\n    deptid: '04',\r\n    name: 'FA Dept.',\r\n    address: 'Shenzhen',\r\n    parentid: ''\r\n}];\r\ndsDept.dataList(data);//In real environment, you can call dataset.applyQuery() to retrieve data from server\r\n//------------------------------------------------------------------------------------------------------\r\n\r\n//Dataset object: Employee\r\n//Global variable\r\nvar dsEmployee = dataSet.dsEmployee = new jslet.data.Dataset('employee');\r\n\r\n//Define fields and add to dsEmployee\r\nvar fldObj = jslet.data.createNumberField('workerid');\r\nfldObj.label('ID');\r\nfldObj.required(true);\r\nfldObj.displayWidth(6);\r\nfldObj.tip('Employee ID must be unique!');\r\ndsEmployee.addField(fldObj);\r\n\r\nfldObj = jslet.data.createStringField('name', 12);\r\nfldObj.label('Name');\r\nfldObj.required(true);\r\nfldObj.unique(true);\r\nfldObj.aggraded(true);\r\nfldObj.tip('Name is required and unique');\r\ndsEmployee.addField(fldObj);\r\n\r\nfldObj = jslet.data.createStringField('department', 6);\r\nfldObj.label('Department');\r\nfldObj.required(false);\r\nfldObj.displayWidth(16);\r\nfldObj.nullText('(Empty)');\r\nlkf = new jslet.data.FieldLookup();\r\nlkf.dataset(dsDept);\r\nfldObj.lookup(lkf);\r\n\r\ndsEmployee.addField(fldObj);\r\n\r\nfldObj = jslet.data.createStringField('gender', 1);\r\nfldObj.label('Gender');\r\nlkf = new jslet.data.FieldLookup();\r\nlkf.dataset(dsGender);\r\nfldObj.lookup(lkf);\r\nfldObj.displayWidth(16);\r\ndsEmployee.addField(fldObj);\r\n\r\nfldObj = jslet.data.createNumberField('age', 5, 0);\r\nfldObj.label('Age');\r\nfldObj.displayWidth(6);\r\nfldObj.dataRange({ min: 18, max: 60 });\r\ndsEmployee.addField(fldObj);\r\n\r\nfldObj = jslet.data.createBooleanField('married');\r\nfldObj.label('Married');\r\nfldObj.trueValue(1);\r\nfldObj.falseValue(0);\r\nfldObj.displayWidth(10);\r\ndsEmployee.addField(fldObj);\r\n\r\nfldObj = jslet.data.createDateField('birthday');\r\nfldObj.label('Birthday');\r\nfldObj.displayFormat('yyyy-MM-dd');\r\nfldObj.dataRange({ min: new Date(1960, 1, 1) });\r\ndsEmployee.addField(fldObj);\r\n\r\nfldObj = jslet.data.createStringField('position', 10);\r\nfldObj.label('Position');\r\nlkf = new jslet.data.FieldLookup();\r\nlkf.dataset(dsPosition);\r\nfldObj.lookup(lkf);\r\ndsEmployee.addField(fldObj);\r\n\r\nfldObj = jslet.data.createNumberField('salary', 16, 2);\r\nfldObj.label('Salary');\r\nfldObj.displayFormat('￥#,##0.##');\r\nfldObj.aggraded(true);\r\ndsEmployee.addField(fldObj);\r\n\r\nfldObj = jslet.data.createStringField('university', 20);\r\nfldObj.label('University');\r\nfldObj.displayWidth(20);\r\ndsEmployee.addField(fldObj);\r\n\r\nfldObj = jslet.data.createStringField('province', 10);\r\nfldObj.label('Province');\r\nlkf = new jslet.data.FieldLookup();\r\nlkf.dataset(dsProvince);\r\nfldObj.lookup(lkf);\r\ndsEmployee.addField(fldObj);\r\n\r\nfldObj = jslet.data.createStringField('city', 8);\r\nfldObj.label('City');\r\nfldObj.visible(false);\r\ndsEmployee.addField(fldObj);\r\n\r\nfldObj = jslet.data.createStringField('photo', 10);\r\nfldObj.label('Photo');\r\nfldObj.visible(true);\r\ndsEmployee.addField(fldObj);\r\n\r\nfldObj = jslet.data.createStringField('officephone', 12);\r\nfldObj.label('Office Phone');\r\nfldObj.regularExpr(/(\\(\\d{3,4}\\)|\\d{3,4}-|\\s)?\\d{8}/ig, 'Invalid phone number!');//like: 0755-12345678\r\nfldObj.tip('Format:999-99999999');\r\ndsEmployee.addField(fldObj);\r\n\r\nfldObj = jslet.data.createStringField('cellphone', 12);\r\nfldObj.label('Cell Phone');\r\nfldObj.regularExpr(/1\\d{10}/ig, 'Invalid cell phone number!');//like: 13912345678\r\nfldObj.tip('\"1\"+10 digits');\r\ndsEmployee.addField(fldObj);\r\n\r\nfldObj = jslet.data.createStringField('email', 20);\r\nfldObj.label('Email');\r\nfldObj.regularExpr(/^[a-zA-Z_0-9-'\\+~]+(\\.[a-zA-Z_0-9-'\\+~]+)*@([a-zA-Z_0-9-]+\\.)+[a-zA-Z]{2,7}$/ig, 'Invalid email address!');//like: foo@gmail.com\r\nfldObj.tip('foo@foo.com');\r\ndsEmployee.addField(fldObj);\r\n\r\nfldObj = jslet.data.createStringField('idcard', 18);\r\nfldObj.label('ID Card');\r\nfldObj.regularExpr(/\\d{18}/ig, 'Invalid IDCard number, 18 digits allowed!');//18 digits\r\nfldObj.tip('18 digits');\r\ndsEmployee.addField(fldObj);\r\n\r\nfldObj = jslet.data.createStringField('summary', 200);\r\nfldObj.label('Summary');\r\nfldObj.displayWidth(10);\r\nfldObj.visible(false);\r\ndsEmployee.addField(fldObj);\r\n\r\ndsEmployee.keyField('workerid');\r\ndsEmployee.codeField('workerid');\r\ndsEmployee.nameField('name');\r\n//Add data into dsEmployee\r\nvar dataList = [{\r\n    workerid: 1,\r\n    name: 'Tom',\r\n    department: '0101',\r\n    gender: 'M',\r\n    age: 48,\r\n    birthday: new Date(1961, 1, 23),\r\n    province: '01',\r\n    city: '0110',\r\n    position: '1',\r\n    married: 1,\r\n    university: 'Peking University',\r\n    photo: '1.jpg',\r\n    salary: 1000\r\n},\r\n\r\n{\r\n    workerid: 2,\r\n    name: 'Marry',\r\n    department: '03',\r\n    gender: 'F',\r\n    age: 26,\r\n    birthday: new Date(1983, 8, 23),\r\n    province: '02',\r\n    city: '0201',\r\n    position: '2',\r\n    married: 0,\r\n    university: 'Harvard University',\r\n    photo: '2.jpg',\r\n    salary: 2000\r\n},\r\n\r\n{\r\n    workerid: 3,\r\n    name: 'Jerry',\r\n    department: '0201',\r\n    gender: 'M',\r\n    age: 32,\r\n    birthday: new Date(1977, 5, 22),\r\n    province: '13',\r\n    city: '1305',\r\n    position: '3',\r\n    married: 1,\r\n    university: 'TsingHua University',\r\n    photo: '3.jpg',\r\n    salary: 3200\r\n},\r\n\r\n{\r\n    workerid: 4,\r\n    name: 'John',\r\n    department: '00',\r\n    gender: 'M',\r\n    age: 48,\r\n    birthday: new Date(1961, 1, 6),\r\n    province: '13',\r\n    city: '1311',\r\n    position: '0',\r\n    married: 1,\r\n    university: 'Peking University',\r\n    photo: '4.jpg',\r\n    salary: 7800\r\n},\r\n\r\n{\r\n    workerid: 5,\r\n    name: 'Monica',\r\n    department: '04',\r\n    gender: 'F',\r\n    age: 38,\r\n    birthday: new Date(1971, 8, 23),\r\n    province: '06',\r\n    city: '0605',\r\n    position: '1',\r\n    married: 0,\r\n    university: 'Cambridge University',\r\n    photo: '5.jpg',\r\n    salary: 5000\r\n},\r\n\r\n{\r\n    workerid: 6,\r\n    name: 'Ted',\r\n    department: '02',\r\n    gender: 'U',\r\n    age: 26,\r\n    birthday: new Date(1983, 7, 12),\r\n    province: '06',\r\n    city: '0606',\r\n    position: '3',\r\n    married: 0,\r\n    university: 'Cambridge University',\r\n    photo: '6.jpg',\r\n    salary: 3000\r\n},\r\n\r\n{\r\n    workerid: 7,\r\n    name: 'Jack',\r\n    department: '02',\r\n    gender: 'M',\r\n    age: 26,\r\n    birthday: new Date(1983, 9, 12),\r\n    province: '06',\r\n    city: '0606',\r\n    position: '3',\r\n    married: 0,\r\n    university: 'MIT',\r\n    photo: '6.jpg',\r\n    salary: 3000\r\n},\r\n\r\n{\r\n    workerid: 8,\r\n    name: 'Mike',\r\n    department: '02',\r\n    gender: 'M',\r\n    age: 26,\r\n    birthday: new Date(1983, 8, 12),\r\n    province: '06',\r\n    city: '0606',\r\n    position: '3',\r\n    married: 0,\r\n    university: 'MIT',\r\n    photo: '6.jpg',\r\n    salary: 3000\r\n},\r\n\r\n{\r\n    workerid: 9,\r\n    name: 'Jessica',\r\n    department: '03',\r\n    gender: 'F',\r\n    age: 25,\r\n    birthday: new Date(1984, 8, 23),\r\n    province: '03',\r\n    city: '0307',\r\n    position: '3',\r\n    married: 1,\r\n    university: 'Harvard University',\r\n    photo: '7.jpg',\r\n    salary: 8000\r\n}];\r\n// Set field context rule\r\n// var contextRule = new jslet.data.ContextRule(dsEmployee);\r\n// contextRule.addRuleItem('city',null,'[province]==[human!province]',null);\r\n// dsEmployee.contextRule(contextRule);\r\n// dsEmployee.enableContextRule();\r\ndsEmployee.dataList(dataList);//In real environment, you can call dataset.applyQuery() to retrieve data from server\r\n\r\nmodule.exports = dataSet;\r\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./demo/dataModel/employee.js\n ** module id = 17\n ** module chunks = 2 3 4 5 10\n **/","\r\nvar jslet = require('../../build/locale/zh-cn/locale.js');\r\nvar Interpreter = require('../../interpreter/interpreter.js');\r\n\r\nvar dataSet = require('../dataModel/employee.js');\r\n\r\nvar dsEmployee = dataSet.dsEmployee;\r\n\r\n\r\n// pares....\r\nvar tpl = {\r\n\troot: 'root',\r\n\tmasterDataset: '',\r\n\tcontrols: [\r\n\t\t{\r\n\t\t\tpanel: {\r\n\t\t\t\ttitle: 'DBEditPanel', \r\n\t\t\t\tbodyTpl: '<div id=\"tablePanel\"></div><hr><div id=\"editPanel\"></div>',\r\n\t\t\t\ttoolbar: ['column2Count', 'label2Column', 'spanColums', 'specify']\r\n\t\t\t},\r\n\t\t\tbind: [{\r\n\t\t\t\tel: 'tablePanel',\r\n\t\t\t\tjsletParams: {type:'DBTable', dataset: 'employee'}\r\n\t\t\t},{\r\n\t\t\t\tel: 'editPanel',\r\n\t\t\t\tjsletParams: {type:\"DBeditpanel\",dataset:\"employee\", \r\n\t\t\t\t\tfields:[\r\n\t\t\t\t\t\t{field:\"workerid\", colSpan: 2},\r\n\t\t\t\t\t\t{field:\"department\", colSpan: 3, showLine: true}\r\n\t\t\t\t\t]\r\n\t\t\t\t}\r\n\t\t\t}]\r\n\t\t}\r\n\t]\r\n};\r\n\r\nvar interpreter = new Interpreter(tpl);\r\n\r\ninterpreter.parse();\r\n\r\nvar edtPnlObj = document.getElementById('editPanel');\r\n\r\n\r\ndocument.getElementById('column2CountBtn').addEventListener('click', doColumn2Count);\r\n\r\nfunction doColumn2Count() {\r\n\tvar ojslet = edtPnlObj.jslet;\r\n\tojslet.columnCount(2);\r\n\tojslet.renderAll();\r\n}\r\n\r\ndocument.getElementById('label2ColumnBtn').addEventListener('click', doLabel2Column);\r\n\r\nfunction doLabel2Column() {\r\n\tvar ojslet = edtPnlObj.jslet;\r\n\tojslet.labelCols(2);\r\n\tojslet.renderAll();\r\n}\r\n\r\ndocument.getElementById('spanColumsBtn').addEventListener('click', doSpanColums);\r\n\r\nfunction doSpanColums() {\r\n\tvar ojslet = edtPnlObj.jslet;\r\n\tvar fld = ojslet.getEditField(\"name\");\r\n\tfld.dataCols = 5;\r\n\tfld = ojslet.getEditField(\"workerid\");\r\n\tfld.dataCols = 2;\r\n\tojslet.renderAll();\r\n}\r\n\r\ndocument.getElementById('specifyBtn').addEventListener('click', doSpecify);\r\n\r\nfunction doSpecify() {\r\n\tvar ojslet = edtPnlObj.jslet;\r\n\tojslet.onlySpecifiedFields(true)\r\n\tojslet.renderAll();\r\n}\r\n\r\n\r\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./demo/editPanel/index.js\n ** module id = 24\n ** module chunks = 4\n **/"],"sourceRoot":""}